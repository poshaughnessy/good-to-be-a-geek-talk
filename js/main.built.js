/*!
 * jQuery JavaScript Library v1.9.1
 * http://jquery.com/
 *
 * Includes Sizzle.js
 * http://sizzlejs.com/
 *
 * Copyright 2005, 2012 jQuery Foundation, Inc. and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: 2013-2-4
 */

/*!
 * Sizzle CSS Selector Engine
 * Copyright 2012 jQuery Foundation and other contributors
 * Released under the MIT license
 * http://sizzlejs.com/
 */

/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2013 Photon Storm Ltd.
* @license      https://github.com/photonstorm/phaser/blob/master/license.txt  MIT License
* @module       Phaser.Utils
*/

/*
	PolyK library
	url: http://polyk.ivank.net
	Released under MIT licence.
	
	Copyright (c) 2012 Ivan Kuckir

	Permission is hereby granted, free of charge, to any person
	obtaining a copy of this software and associated documentation
	files (the "Software"), to deal in the Software without
	restriction, including without limitation the rights to use,
	copy, modify, merge, publish, distribute, sublicense, and/or sell
	copies of the Software, and to permit persons to whom the
	Software is furnished to do so, subject to the following
	conditions:

	The above copyright notice and this permission notice shall be
	included in all copies or substantial portions of the Software.

	THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
	EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
	OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
	NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
	HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
	WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
	FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
	OTHER DEALINGS IN THE SOFTWARE.

	This is an amazing lib! 
	
	slightly modified by mat groves (matgroves.com);
*/

/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2013 Photon Storm Ltd.
* @license      https://github.com/photonstorm/phaser/blob/master/license.txt  MIT License
* @module       Phaser.Camera
*/

/**
* State
*
* This is a base State class which can be extended if you are creating your own game.
* It provides quick access to common functions such as the camera, cache, input, match, sound and more.
*
* @package    Phaser.State
* @author     Richard Davey <rich@photonstorm.com>
* @copyright  2013 Photon Storm Ltd.
* @license    https://github.com/photonstorm/phaser/blob/master/license.txt  MIT License
*/

/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2013 Photon Storm Ltd.
* @license      https://github.com/photonstorm/phaser/blob/master/license.txt  MIT License
* @module       Phaser.Stage
*/

/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2013 Photon Storm Ltd.
* @license      https://github.com/photonstorm/phaser/blob/master/license.txt  MIT License
* @module       Phaser.World
*/

/**
* Phaser.Game
*
* This is where the magic happens. The Game object is the heart of your game,
* providing quick access to common functions and handling the boot process.
*
* "Hell, there are no rules here - we're trying to accomplish something."
*                                                       Thomas A. Edison
*
* @package    Phaser.Game
* @author     Richard Davey <rich@photonstorm.com>
* @copyright  2013 Photon Storm Ltd.
* @license    https://github.com/photonstorm/phaser/blob/master/license.txt  MIT License
*/

/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2013 Photon Storm Ltd.
* @license      https://github.com/photonstorm/phaser/blob/master/license.txt  MIT License
* @module       Phaser.Button
*/

/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2013 Photon Storm Ltd.
* @license      https://github.com/photonstorm/phaser/blob/master/license.txt  MIT License
* @module       Phaser.Canvas
*/

/*
 Copyright Â© 2012 Timo Hausmann

Permission is hereby granted, free of charge, to any person obtaining
a copy of this software and associated documentation files (the
"Software"), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

The above copyright notice and this permission notice shall be
included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*/

/**
* Phaser - Point
*
* The Point object represents a location in a two-dimensional coordinate system, where x represents the horizontal axis and y represents the vertical axis.
*
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2013 Photon Storm Ltd.
* @license      https://github.com/photonstorm/phaser/blob/master/license.txt  MIT License
* @module       Phaser
*/

/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2013 Photon Storm Ltd.
* @license      https://github.com/photonstorm/phaser/blob/master/license.txt  MIT License
* @module       Phaser.Time
*/

/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2013 Photon Storm Ltd.
* @license      https://github.com/photonstorm/phaser/blob/master/license.txt  MIT License
* @module       Phaser.Animation
*/

/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2013 Photon Storm Ltd.
* @license      https://github.com/photonstorm/phaser/blob/master/license.txt  MIT License
* @module       Phaser.Animation.FrameData
*/

/**
* Responsible for parsing sprite sheet and JSON data into the internal FrameData format that Phaser uses for animations.
*
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2013 Photon Storm Ltd.
* @license      https://github.com/photonstorm/phaser/blob/master/license.txt  MIT License
* @module       Phaser.Animation
*/

/**
* Cache
*
* A game only has one instance of a Cache and it is used to store all externally loaded assets such
* as images, sounds and data files as a result of Loader calls. Cache items use string based keys for look-up.
*
* @package    Phaser.Cache
* @author     Richard Davey <rich@photonstorm.com>
* @copyright  2013 Photon Storm Ltd.
* @license    https://github.com/photonstorm/phaser/blob/master/license.txt  MIT License
*/

/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2013 Photon Storm Ltd.
* @license      https://github.com/photonstorm/phaser/blob/master/license.txt  MIT License
* @module       Phaser
*/

/**
* A collection of methods useful for manipulating and comparing colors.
*
* @class 		Color
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2013 Photon Storm Ltd.
* @license      https://github.com/photonstorm/phaser/blob/master/license.txt  MIT License
* @module       Phaser
*/

/*
 * Original HTML5 Rocks Licence:
 *
 * Copyright 2010 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * Original slides: Marcin Wichary (mwichary@google.com)
 * Modifications: Ernest Delgado (ernestd@google.com)
 * Alex Russell (slightlyoff@chromium.org)
 * Brad Neuberg
 *
 * Re-purposed and modified by Peter O'Shaughnessy (see comments)
 */

function HEXtoRGB(e){return[(e>>16&255)/255,(e>>8&255)/255,(e&255)/255]}function determineMatrixArrayType(){return PIXI.Matrix=typeof Float32Array!="undefined"?Float32Array:Array,PIXI.Matrix}function HEXtoRGB(e){return[(e>>16&255)/255,(e>>8&255)/255,(e&255)/255]}(function(e,t){function P(e){var t=e.length,n=b.type(e);return b.isWindow(e)?!1:e.nodeType===1&&t?!0:n==="array"||n!=="function"&&(t===0||typeof t=="number"&&t>0&&t-1 in e)}function B(e){var t=H[e]={};return b.each(e.match(E)||[],function(e,n){t[n]=!0}),t}function I(e,n,r,i){if(!b.acceptData(e))return;var s,o,u=b.expando,a=typeof n=="string",f=e.nodeType,c=f?b.cache:e,h=f?e[u]:e[u]&&u;if((!h||!c[h]||!i&&!c[h].data)&&a&&r===t)return;h||(f?e[u]=h=l.pop()||b.guid++:h=u),c[h]||(c[h]={},f||(c[h].toJSON=b.noop));if(typeof n=="object"||typeof n=="function")i?c[h]=b.extend(c[h],n):c[h].data=b.extend(c[h].data,n);return s=c[h],i||(s.data||(s.data={}),s=s.data),r!==t&&(s[b.camelCase(n)]=r),a?(o=s[n],o==null&&(o=s[b.camelCase(n)])):o=s,o}function q(e,t,n){if(!b.acceptData(e))return;var r,i,s,o=e.nodeType,u=o?b.cache:e,a=o?e[b.expando]:b.expando;if(!u[a])return;if(t){s=n?u[a]:u[a].data;if(s){b.isArray(t)?t=t.concat(b.map(t,b.camelCase)):t in s?t=[t]:(t=b.camelCase(t),t in s?t=[t]:t=t.split(" "));for(r=0,i=t.length;r<i;r++)delete s[t[r]];if(!(n?U:b.isEmptyObject)(s))return}}if(!n){delete u[a].data;if(!U(u[a]))return}o?b.cleanData([e],!0):b.support.deleteExpando||u!=u.window?delete u[a]:u[a]=null}function R(e,n,r){if(r===t&&e.nodeType===1){var i="data-"+n.replace(F,"-$1").toLowerCase();r=e.getAttribute(i);if(typeof r=="string"){try{r=r==="true"?!0:r==="false"?!1:r==="null"?null:+r+""===r?+r:j.test(r)?b.parseJSON(r):r}catch(s){}b.data(e,n,r)}else r=t}return r}function U(e){var t;for(t in e){if(t==="data"&&b.isEmptyObject(e[t]))continue;if(t!=="toJSON")return!1}return!0}function it(){return!0}function st(){return!1}function ct(e,t){do e=e[t];while(e&&e.nodeType!==1);return e}function ht(e,t,n){t=t||0;if(b.isFunction(t))return b.grep(e,function(e,r){var i=!!t.call(e,r,e);return i===n});if(t.nodeType)return b.grep(e,function(e){return e===t===n});if(typeof t=="string"){var r=b.grep(e,function(e){return e.nodeType===1});if(at.test(t))return b.filter(t,r,!n);t=b.filter(t,r)}return b.grep(e,function(e){return b.inArray(e,t)>=0===n})}function pt(e){var t=dt.split("|"),n=e.createDocumentFragment();if(n.createElement)while(t.length)n.createElement(t.pop());return n}function Mt(e,t){return e.getElementsByTagName(t)[0]||e.appendChild(e.ownerDocument.createElement(t))}function _t(e){var t=e.getAttributeNode("type");return e.type=(t&&t.specified)+"/"+e.type,e}function Dt(e){var t=Ct.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function Pt(e,t){var n,r=0;for(;(n=e[r])!=null;r++)b._data(n,"globalEval",!t||b._data(t[r],"globalEval"))}function Ht(e,t){if(t.nodeType!==1||!b.hasData(e))return;var n,r,i,s=b._data(e),o=b._data(t,s),u=s.events;if(u){delete o.handle,o.events={};for(n in u)for(r=0,i=u[n].length;r<i;r++)b.event.add(t,n,u[n][r])}o.data&&(o.data=b.extend({},o.data))}function Bt(e,t){var n,r,i;if(t.nodeType!==1)return;n=t.nodeName.toLowerCase();if(!b.support.noCloneEvent&&t[b.expando]){i=b._data(t);for(r in i.events)b.removeEvent(t,r,i.handle);t.removeAttribute(b.expando)}if(n==="script"&&t.text!==e.text)_t(t).text=e.text,Dt(t);else if(n==="object")t.parentNode&&(t.outerHTML=e.outerHTML),b.support.html5Clone&&e.innerHTML&&!b.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML);else if(n==="input"&&xt.test(e.type))t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value);else if(n==="option")t.defaultSelected=t.selected=e.defaultSelected;else if(n==="input"||n==="textarea")t.defaultValue=e.defaultValue}function jt(e,n){var r,s,o=0,u=typeof e.getElementsByTagName!==i?e.getElementsByTagName(n||"*"):typeof e.querySelectorAll!==i?e.querySelectorAll(n||"*"):t;if(!u)for(u=[],r=e.childNodes||e;(s=r[o])!=null;o++)!n||b.nodeName(s,n)?u.push(s):b.merge(u,jt(s,n));return n===t||n&&b.nodeName(e,n)?b.merge([e],u):u}function Ft(e){xt.test(e.type)&&(e.defaultChecked=e.checked)}function tn(e,t){if(t in e)return t;var n=t.charAt(0).toUpperCase()+t.slice(1),r=t,i=en.length;while(i--){t=en[i]+n;if(t in e)return t}return r}function nn(e,t){return e=t||e,b.css(e,"display")==="none"||!b.contains(e.ownerDocument,e)}function rn(e,t){var n,r,i,s=[],o=0,u=e.length;for(;o<u;o++){r=e[o];if(!r.style)continue;s[o]=b._data(r,"olddisplay"),n=r.style.display,t?(!s[o]&&n==="none"&&(r.style.display=""),r.style.display===""&&nn(r)&&(s[o]=b._data(r,"olddisplay",an(r.nodeName)))):s[o]||(i=nn(r),(n&&n!=="none"||!i)&&b._data(r,"olddisplay",i?n:b.css(r,"display")))}for(o=0;o<u;o++){r=e[o];if(!r.style)continue;if(!t||r.style.display==="none"||r.style.display==="")r.style.display=t?s[o]||"":"none"}return e}function sn(e,t,n){var r=$t.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t}function on(e,t,n,r,i){var s=n===(r?"border":"content")?4:t==="width"?1:0,o=0;for(;s<4;s+=2)n==="margin"&&(o+=b.css(e,n+Zt[s],!0,i)),r?(n==="content"&&(o-=b.css(e,"padding"+Zt[s],!0,i)),n!=="margin"&&(o-=b.css(e,"border"+Zt[s]+"Width",!0,i))):(o+=b.css(e,"padding"+Zt[s],!0,i),n!=="padding"&&(o+=b.css(e,"border"+Zt[s]+"Width",!0,i)));return o}function un(e,t,n){var r=!0,i=t==="width"?e.offsetWidth:e.offsetHeight,s=qt(e),o=b.support.boxSizing&&b.css(e,"boxSizing",!1,s)==="border-box";if(i<=0||i==null){i=Rt(e,t,s);if(i<0||i==null)i=e.style[t];if(Jt.test(i))return i;r=o&&(b.support.boxSizingReliable||i===e.style[t]),i=parseFloat(i)||0}return i+on(e,t,n||(o?"border":"content"),r,s)+"px"}function an(e){var t=s,n=Qt[e];if(!n){n=fn(e,t);if(n==="none"||!n)It=(It||b("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(t.documentElement),t=(It[0].contentWindow||It[0].contentDocument).document,t.write("<!doctype html><html><body>"),t.close(),n=fn(e,t),It.detach();Qt[e]=n}return n}function fn(e,t){var n=b(t.createElement(e)).appendTo(t.body),r=b.css(n[0],"display");return n.remove(),r}function vn(e,t,n,r){var i;if(b.isArray(t))b.each(t,function(t,i){n||cn.test(e)?r(e,i):vn(e+"["+(typeof i=="object"?t:"")+"]",i,n,r)});else if(!n&&b.type(t)==="object")for(i in t)vn(e+"["+i+"]",t[i],n,r);else r(e,t)}function _n(e){return function(t,n){typeof t!="string"&&(n=t,t="*");var r,i=0,s=t.toLowerCase().match(E)||[];if(b.isFunction(n))while(r=s[i++])r[0]==="+"?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function Dn(e,t,n,r){function o(u){var a;return i[u]=!0,b.each(e[u]||[],function(e,u){var f=u(t,n,r);if(typeof f=="string"&&!s&&!i[f])return t.dataTypes.unshift(f),o(f),!1;if(s)return!(a=f)}),a}var i={},s=e===An;return o(t.dataTypes[0])||!i["*"]&&o("*")}function Pn(e,n){var r,i,s=b.ajaxSettings.flatOptions||{};for(i in n)n[i]!==t&&((s[i]?e:r||(r={}))[i]=n[i]);return r&&b.extend(!0,e,r),e}function Hn(e,n,r){var i,s,o,u,a=e.contents,f=e.dataTypes,l=e.responseFields;for(u in l)u in r&&(n[l[u]]=r[u]);while(f[0]==="*")f.shift(),s===t&&(s=e.mimeType||n.getResponseHeader("Content-Type"));if(s)for(u in a)if(a[u]&&a[u].test(s)){f.unshift(u);break}if(f[0]in r)o=f[0];else{for(u in r){if(!f[0]||e.converters[u+" "+f[0]]){o=u;break}i||(i=u)}o=o||i}if(o)return o!==f[0]&&f.unshift(o),r[o]}function Bn(e,t){var n,r,i,s,o={},u=0,a=e.dataTypes.slice(),f=a[0];e.dataFilter&&(t=e.dataFilter(t,e.dataType));if(a[1])for(i in e.converters)o[i.toLowerCase()]=e.converters[i];for(;r=a[++u];)if(r!=="*"){if(f!=="*"&&f!==r){i=o[f+" "+r]||o["* "+r];if(!i)for(n in o){s=n.split(" ");if(s[1]===r){i=o[f+" "+s[0]]||o["* "+s[0]];if(i){i===!0?i=o[n]:o[n]!==!0&&(r=s[0],a.splice(u--,0,r));break}}}if(i!==!0)if(i&&e["throws"])t=i(t);else try{t=i(t)}catch(l){return{state:"parsererror",error:i?l:"No conversion from "+f+" to "+r}}}f=r}return{state:"success",data:t}}function zn(){try{return new e.XMLHttpRequest}catch(t){}}function Wn(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}function Yn(){return setTimeout(function(){Xn=t}),Xn=b.now()}function Zn(e,t){b.each(t,function(t,n){var r=(Gn[t]||[]).concat(Gn["*"]),i=0,s=r.length;for(;i<s;i++)if(r[i].call(e,t,n))return})}function er(e,t,n){var r,i,s=0,o=Qn.length,u=b.Deferred().always(function(){delete a.elem}),a=function(){if(i)return!1;var t=Xn||Yn(),n=Math.max(0,f.startTime+f.duration-t),r=n/f.duration||0,s=1-r,o=0,a=f.tweens.length;for(;o<a;o++)f.tweens[o].run(s);return u.notifyWith(e,[f,s,n]),s<1&&a?n:(u.resolveWith(e,[f]),!1)},f=u.promise({elem:e,props:b.extend({},t),opts:b.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:Xn||Yn(),duration:n.duration,tweens:[],createTween:function(t,n){var r=b.Tween(e,f.opts,t,n,f.opts.specialEasing[t]||f.opts.easing);return f.tweens.push(r),r},stop:function(t){var n=0,r=t?f.tweens.length:0;if(i)return this;i=!0;for(;n<r;n++)f.tweens[n].run(1);return t?u.resolveWith(e,[f,t]):u.rejectWith(e,[f,t]),this}}),l=f.props;tr(l,f.opts.specialEasing);for(;s<o;s++){r=Qn[s].call(f,e,l,f.opts);if(r)return r}return Zn(f,l),b.isFunction(f.opts.start)&&f.opts.start.call(e,f),b.fx.timer(b.extend(a,{elem:e,anim:f,queue:f.opts.queue})),f.progress(f.opts.progress).done(f.opts.done,f.opts.complete).fail(f.opts.fail).always(f.opts.always)}function tr(e,t){var n,r,i,s,o;for(i in e){r=b.camelCase(i),s=t[r],n=e[i],b.isArray(n)&&(s=n[1],n=e[i]=n[0]),i!==r&&(e[r]=n,delete e[i]),o=b.cssHooks[r];if(o&&"expand"in o){n=o.expand(n),delete e[r];for(i in n)i in e||(e[i]=n[i],t[i]=s)}else t[r]=s}}function nr(e,t,n){var r,i,s,o,u,a,f,l,c,h=this,p=e.style,d={},v=[],m=e.nodeType&&nn(e);n.queue||(l=b._queueHooks(e,"fx"),l.unqueued==null&&(l.unqueued=0,c=l.empty.fire,l.empty.fire=function(){l.unqueued||c()}),l.unqueued++,h.always(function(){h.always(function(){l.unqueued--,b.queue(e,"fx").length||l.empty.fire()})})),e.nodeType===1&&("height"in t||"width"in t)&&(n.overflow=[p.overflow,p.overflowX,p.overflowY],b.css(e,"display")==="inline"&&b.css(e,"float")==="none"&&(!b.support.inlineBlockNeedsLayout||an(e.nodeName)==="inline"?p.display="inline-block":p.zoom=1)),n.overflow&&(p.overflow="hidden",b.support.shrinkWrapBlocks||h.always(function(){p.overflow=n.overflow[0],p.overflowX=n.overflow[1],p.overflowY=n.overflow[2]}));for(i in t){o=t[i];if($n.exec(o)){delete t[i],a=a||o==="toggle";if(o===(m?"hide":"show"))continue;v.push(i)}}s=v.length;if(s){u=b._data(e,"fxshow")||b._data(e,"fxshow",{}),"hidden"in u&&(m=u.hidden),a&&(u.hidden=!m),m?b(e).show():h.done(function(){b(e).hide()}),h.done(function(){var t;b._removeData(e,"fxshow");for(t in d)b.style(e,t,d[t])});for(i=0;i<s;i++)r=v[i],f=h.createTween(r,m?u[r]:0),d[r]=u[r]||b.style(e,r),r in u||(u[r]=f.start,m&&(f.end=f.start,f.start=r==="width"||r==="height"?1:0))}}function rr(e,t,n,r,i){return new rr.prototype.init(e,t,n,r,i)}function ir(e,t){var n,r={height:e},i=0;t=t?1:0;for(;i<4;i+=2-t)n=Zt[i],r["margin"+n]=r["padding"+n]=e;return t&&(r.opacity=r.width=e),r}function sr(e){return b.isWindow(e)?e:e.nodeType===9?e.defaultView||e.parentWindow:!1}var n,r,i=typeof t,s=e.document,o=e.location,u=e.jQuery,a=e.$,f={},l=[],c="1.9.1",h=l.concat,p=l.push,d=l.slice,v=l.indexOf,m=f.toString,g=f.hasOwnProperty,y=c.trim,b=function(e,t){return new b.fn.init(e,t,r)},w=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,E=/\S+/g,S=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,x=/^(?:(<[\w\W]+>)[^>]*|#([\w-]*))$/,T=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,N=/^[\],:{}\s]*$/,C=/(?:^|:|,)(?:\s*\[)+/g,k=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,L=/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,A=/^-ms-/,O=/-([\da-z])/gi,M=function(e,t){return t.toUpperCase()},_=function(e){if(s.addEventListener||e.type==="load"||s.readyState==="complete")D(),b.ready()},D=function(){s.addEventListener?(s.removeEventListener("DOMContentLoaded",_,!1),e.removeEventListener("load",_,!1)):(s.detachEvent("onreadystatechange",_),e.detachEvent("onload",_))};b.fn=b.prototype={jquery:c,constructor:b,init:function(e,n,r){var i,o;if(!e)return this;if(typeof e=="string"){e.charAt(0)==="<"&&e.charAt(e.length-1)===">"&&e.length>=3?i=[null,e,null]:i=x.exec(e);if(i&&(i[1]||!n)){if(i[1]){n=n instanceof b?n[0]:n,b.merge(this,b.parseHTML(i[1],n&&n.nodeType?n.ownerDocument||n:s,!0));if(T.test(i[1])&&b.isPlainObject(n))for(i in n)b.isFunction(this[i])?this[i](n[i]):this.attr(i,n[i]);return this}o=s.getElementById(i[2]);if(o&&o.parentNode){if(o.id!==i[2])return r.find(e);this.length=1,this[0]=o}return this.context=s,this.selector=e,this}return!n||n.jquery?(n||r).find(e):this.constructor(n).find(e)}return e.nodeType?(this.context=this[0]=e,this.length=1,this):b.isFunction(e)?r.ready(e):(e.selector!==t&&(this.selector=e.selector,this.context=e.context),b.makeArray(e,this))},selector:"",length:0,size:function(){return this.length},toArray:function(){return d.call(this)},get:function(e){return e==null?this.toArray():e<0?this[this.length+e]:this[e]},pushStack:function(e){var t=b.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return b.each(this,e,t)},ready:function(e){return b.ready.promise().done(e),this},slice:function(){return this.pushStack(d.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(n>=0&&n<t?[this[n]]:[])},map:function(e){return this.pushStack(b.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:p,sort:[].sort,splice:[].splice},b.fn.init.prototype=b.fn,b.extend=b.fn.extend=function(){var e,n,r,i,s,o,u=arguments[0]||{},a=1,f=arguments.length,l=!1;typeof u=="boolean"&&(l=u,u=arguments[1]||{},a=2),typeof u!="object"&&!b.isFunction(u)&&(u={}),f===a&&(u=this,--a);for(;a<f;a++)if((s=arguments[a])!=null)for(i in s){e=u[i],r=s[i];if(u===r)continue;l&&r&&(b.isPlainObject(r)||(n=b.isArray(r)))?(n?(n=!1,o=e&&b.isArray(e)?e:[]):o=e&&b.isPlainObject(e)?e:{},u[i]=b.extend(l,o,r)):r!==t&&(u[i]=r)}return u},b.extend({noConflict:function(t){return e.$===b&&(e.$=a),t&&e.jQuery===b&&(e.jQuery=u),b},isReady:!1,readyWait:1,holdReady:function(e){e?b.readyWait++:b.ready(!0)},ready:function(e){if(e===!0?--b.readyWait:b.isReady)return;if(!s.body)return setTimeout(b.ready);b.isReady=!0;if(e!==!0&&--b.readyWait>0)return;n.resolveWith(s,[b]),b.fn.trigger&&b(s).trigger("ready").off("ready")},isFunction:function(e){return b.type(e)==="function"},isArray:Array.isArray||function(e){return b.type(e)==="array"},isWindow:function(e){return e!=null&&e==e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return e==null?String(e):typeof e=="object"||typeof e=="function"?f[m.call(e)]||"object":typeof e},isPlainObject:function(e){if(!e||b.type(e)!=="object"||e.nodeType||b.isWindow(e))return!1;try{if(e.constructor&&!g.call(e,"constructor")&&!g.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(n){return!1}var r;for(r in e);return r===t||g.call(e,r)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},error:function(e){throw new Error(e)},parseHTML:function(e,t,n){if(!e||typeof e!="string")return null;typeof t=="boolean"&&(n=t,t=!1),t=t||s;var r=T.exec(e),i=!n&&[];return r?[t.createElement(r[1])]:(r=b.buildFragment([e],t,i),i&&b(i).remove(),b.merge([],r.childNodes))},parseJSON:function(t){if(e.JSON&&e.JSON.parse)return e.JSON.parse(t);if(t===null)return t;if(typeof t=="string"){t=b.trim(t);if(t&&N.test(t.replace(k,"@").replace(L,"]").replace(C,"")))return(new Function("return "+t))()}b.error("Invalid JSON: "+t)},parseXML:function(n){var r,i;if(!n||typeof n!="string")return null;try{e.DOMParser?(i=new DOMParser,r=i.parseFromString(n,"text/xml")):(r=new ActiveXObject("Microsoft.XMLDOM"),r.async="false",r.loadXML(n))}catch(s){r=t}return(!r||!r.documentElement||r.getElementsByTagName("parsererror").length)&&b.error("Invalid XML: "+n),r},noop:function(){},globalEval:function(t){t&&b.trim(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(A,"ms-").replace(O,M)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,n){var r,i=0,s=e.length,o=P(e);if(n)if(o)for(;i<s;i++){r=t.apply(e[i],n);if(r===!1)break}else for(i in e){r=t.apply(e[i],n);if(r===!1)break}else if(o)for(;i<s;i++){r=t.call(e[i],i,e[i]);if(r===!1)break}else for(i in e){r=t.call(e[i],i,e[i]);if(r===!1)break}return e},trim:y&&!y.call("ï»¿Â ")?function(e){return e==null?"":y.call(e)}:function(e){return e==null?"":(e+"").replace(S,"")},makeArray:function(e,t){var n=t||[];return e!=null&&(P(Object(e))?b.merge(n,typeof e=="string"?[e]:e):p.call(n,e)),n},inArray:function(e,t,n){var r;if(t){if(v)return v.call(t,e,n);r=t.length,n=n?n<0?Math.max(0,r+n):n:0;for(;n<r;n++)if(n in t&&t[n]===e)return n}return-1},merge:function(e,n){var r=n.length,i=e.length,s=0;if(typeof r=="number")for(;s<r;s++)e[i++]=n[s];else while(n[s]!==t)e[i++]=n[s++];return e.length=i,e},grep:function(e,t,n){var r,i=[],s=0,o=e.length;n=!!n;for(;s<o;s++)r=!!t(e[s],s),n!==r&&i.push(e[s]);return i},map:function(e,t,n){var r,i=0,s=e.length,o=P(e),u=[];if(o)for(;i<s;i++)r=t(e[i],i,n),r!=null&&(u[u.length]=r);else for(i in e)r=t(e[i],i,n),r!=null&&(u[u.length]=r);return h.apply([],u)},guid:1,proxy:function(e,n){var r,i,s;return typeof n=="string"&&(s=e[n],n=e,e=s),b.isFunction(e)?(r=d.call(arguments,2),i=function(){return e.apply(n||this,r.concat(d.call(arguments)))},i.guid=e.guid=e.guid||b.guid++,i):t},access:function(e,n,r,i,s,o,u){var a=0,f=e.length,l=r==null;if(b.type(r)==="object"){s=!0;for(a in r)b.access(e,n,a,r[a],!0,o,u)}else if(i!==t){s=!0,b.isFunction(i)||(u=!0),l&&(u?(n.call(e,i),n=null):(l=n,n=function(e,t,n){return l.call(b(e),n)}));if(n)for(;a<f;a++)n(e[a],r,u?i:i.call(e[a],a,n(e[a],r)))}return s?e:l?n.call(e):f?n(e[0],r):o},now:function(){return(new Date).getTime()}}),b.ready.promise=function(t){if(!n){n=b.Deferred();if(s.readyState==="complete")setTimeout(b.ready);else if(s.addEventListener)s.addEventListener("DOMContentLoaded",_,!1),e.addEventListener("load",_,!1);else{s.attachEvent("onreadystatechange",_),e.attachEvent("onload",_);var r=!1;try{r=e.frameElement==null&&s.documentElement}catch(i){}r&&r.doScroll&&function o(){if(!b.isReady){try{r.doScroll("left")}catch(e){return setTimeout(o,50)}D(),b.ready()}}()}}return n.promise(t)},b.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){f["[object "+t+"]"]=t.toLowerCase()}),r=b(s);var H={};b.Callbacks=function(e){e=typeof e=="string"?H[e]||B(e):b.extend({},e);var n,r,i,s,o,u,a=[],f=!e.once&&[],l=function(t){r=e.memory&&t,i=!0,o=u||0,u=0,s=a.length,n=!0;for(;a&&o<s;o++)if(a[o].apply(t[0],t[1])===!1&&e.stopOnFalse){r=!1;break}n=!1,a&&(f?f.length&&l(f.shift()):r?a=[]:c.disable())},c={add:function(){if(a){var t=a.length;(function i(t){b.each(t,function(t,n){var r=b.type(n);r==="function"?(!e.unique||!c.has(n))&&a.push(n):n&&n.length&&r!=="string"&&i(n)})})(arguments),n?s=a.length:r&&(u=t,l(r))}return this},remove:function(){return a&&b.each(arguments,function(e,t){var r;while((r=b.inArray(t,a,r))>-1)a.splice(r,1),n&&(r<=s&&s--,r<=o&&o--)}),this},has:function(e){return e?b.inArray(e,a)>-1:!!a&&!!a.length},empty:function(){return a=[],this},disable:function(){return a=f=r=t,this},disabled:function(){return!a},lock:function(){return f=t,r||c.disable(),this},locked:function(){return!f},fireWith:function(e,t){return t=t||[],t=[e,t.slice?t.slice():t],a&&(!i||f)&&(n?f.push(t):l(t)),this},fire:function(){return c.fireWith(this,arguments),this},fired:function(){return!!i}};return c},b.extend({Deferred:function(e){var t=[["resolve","done",b.Callbacks("once memory"),"resolved"],["reject","fail",b.Callbacks("once memory"),"rejected"],["notify","progress",b.Callbacks("memory")]],n="pending",r={state:function(){return n},always:function(){return i.done(arguments).fail(arguments),this},then:function(){var e=arguments;return b.Deferred(function(n){b.each(t,function(t,s){var o=s[0],u=b.isFunction(e[t])&&e[t];i[s[1]](function(){var e=u&&u.apply(this,arguments);e&&b.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[o+"With"](this===r?n.promise():this,u?[e]:arguments)})}),e=null}).promise()},promise:function(e){return e!=null?b.extend(e,r):r}},i={};return r.pipe=r.then,b.each(t,function(e,s){var o=s[2],u=s[3];r[s[1]]=o.add,u&&o.add(function(){n=u},t[e^1][2].disable,t[2][2].lock),i[s[0]]=function(){return i[s[0]+"With"](this===i?r:this,arguments),this},i[s[0]+"With"]=o.fireWith}),r.promise(i),e&&e.call(i,i),i},when:function(e){var t=0,n=d.call(arguments),r=n.length,i=r!==1||e&&b.isFunction(e.promise)?r:0,s=i===1?e:b.Deferred(),o=function(e,t,n){return function(r){t[e]=this,n[e]=arguments.length>1?d.call(arguments):r,n===u?s.notifyWith(t,n):--i||s.resolveWith(t,n)}},u,a,f;if(r>1){u=new Array(r),a=new Array(r),f=new Array(r);for(;t<r;t++)n[t]&&b.isFunction(n[t].promise)?n[t].promise().done(o(t,f,n)).fail(s.reject).progress(o(t,a,u)):--i}return i||s.resolveWith(f,n),s.promise()}}),b.support=function(){var t,n,r,o,u,a,f,l,c,h,p=s.createElement("div");p.setAttribute("className","t"),p.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",n=p.getElementsByTagName("*"),r=p.getElementsByTagName("a")[0];if(!n||!r||!n.length)return{};u=s.createElement("select"),f=u.appendChild(s.createElement("option")),o=p.getElementsByTagName("input")[0],r.style.cssText="top:1px;float:left;opacity:.5",t={getSetAttribute:p.className!=="t",leadingWhitespace:p.firstChild.nodeType===3,tbody:!p.getElementsByTagName("tbody").length,htmlSerialize:!!p.getElementsByTagName("link").length,style:/top/.test(r.getAttribute("style")),hrefNormalized:r.getAttribute("href")==="/a",opacity:/^0.5/.test(r.style.opacity),cssFloat:!!r.style.cssFloat,checkOn:!!o.value,optSelected:f.selected,enctype:!!s.createElement("form").enctype,html5Clone:s.createElement("nav").cloneNode(!0).outerHTML!=="<:nav></:nav>",boxModel:s.compatMode==="CSS1Compat",deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1},o.checked=!0,t.noCloneChecked=o.cloneNode(!0).checked,u.disabled=!0,t.optDisabled=!f.disabled;try{delete p.test}catch(d){t.deleteExpando=!1}o=s.createElement("input"),o.setAttribute("value",""),t.input=o.getAttribute("value")==="",o.value="t",o.setAttribute("type","radio"),t.radioValue=o.value==="t",o.setAttribute("checked","t"),o.setAttribute("name","t"),a=s.createDocumentFragment(),a.appendChild(o),t.appendChecked=o.checked,t.checkClone=a.cloneNode(!0).cloneNode(!0).lastChild.checked,p.attachEvent&&(p.attachEvent("onclick",function(){t.noCloneEvent=!1}),p.cloneNode(!0).click());for(h in{submit:!0,change:!0,focusin:!0})p.setAttribute(l="on"+h,"t"),t[h+"Bubbles"]=l in e||p.attributes[l].expando===!1;return p.style.backgroundClip="content-box",p.cloneNode(!0).style.backgroundClip="",t.clearCloneStyle=p.style.backgroundClip==="content-box",b(function(){var n,r,o,u="padding:0;margin:0;border:0;display:block;box-sizing:content-box;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;",a=s.getElementsByTagName("body")[0];if(!a)return;n=s.createElement("div"),n.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",a.appendChild(n).appendChild(p),p.innerHTML="<table><tr><td></td><td>t</td></tr></table>",o=p.getElementsByTagName("td"),o[0].style.cssText="padding:0;margin:0;border:0;display:none",c=o[0].offsetHeight===0,o[0].style.display="",o[1].style.display="none",t.reliableHiddenOffsets=c&&o[0].offsetHeight===0,p.innerHTML="",p.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",t.boxSizing=p.offsetWidth===4,t.doesNotIncludeMarginInBodyOffset=a.offsetTop!==1,e.getComputedStyle&&(t.pixelPosition=(e.getComputedStyle(p,null)||{}).top!=="1%",t.boxSizingReliable=(e.getComputedStyle(p,null)||{width:"4px"}).width==="4px",r=p.appendChild(s.createElement("div")),r.style.cssText=p.style.cssText=u,r.style.marginRight=r.style.width="0",p.style.width="1px",t.reliableMarginRight=!parseFloat((e.getComputedStyle(r,null)||{}).marginRight)),typeof p.style.zoom!==i&&(p.innerHTML="",p.style.cssText=u+"width:1px;padding:1px;display:inline;zoom:1",t.inlineBlockNeedsLayout=p.offsetWidth===3,p.style.display="block",p.innerHTML="<div></div>",p.firstChild.style.width="5px",t.shrinkWrapBlocks=p.offsetWidth!==3,t.inlineBlockNeedsLayout&&(a.style.zoom=1)),a.removeChild(n),n=p=o=r=null}),n=u=a=f=r=o=null,t}();var j=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,F=/([A-Z])/g;b.extend({cache:{},expando:"jQuery"+(c+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(e){return e=e.nodeType?b.cache[e[b.expando]]:e[b.expando],!!e&&!U(e)},data:function(e,t,n){return I(e,t,n)},removeData:function(e,t){return q(e,t)},_data:function(e,t,n){return I(e,t,n,!0)},_removeData:function(e,t){return q(e,t,!0)},acceptData:function(e){if(e.nodeType&&e.nodeType!==1&&e.nodeType!==9)return!1;var t=e.nodeName&&b.noData[e.nodeName.toLowerCase()];return!t||t!==!0&&e.getAttribute("classid")===t}}),b.fn.extend({data:function(e,n){var r,i,s=this[0],o=0,u=null;if(e===t){if(this.length){u=b.data(s);if(s.nodeType===1&&!b._data(s,"parsedAttrs")){r=s.attributes;for(;o<r.length;o++)i=r[o].name,i.indexOf("data-")||(i=b.camelCase(i.slice(5)),R(s,i,u[i]));b._data(s,"parsedAttrs",!0)}}return u}return typeof e=="object"?this.each(function(){b.data(this,e)}):b.access(this,function(n){if(n===t)return s?R(s,e,b.data(s,e)):null;this.each(function(){b.data(this,e,n)})},null,n,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){b.removeData(this,e)})}}),b.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=b._data(e,t),n&&(!r||b.isArray(n)?r=b._data(e,t,b.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=b.queue(e,t),r=n.length,i=n.shift(),s=b._queueHooks(e,t),o=function(){b.dequeue(e,t)};i==="inprogress"&&(i=n.shift(),r--),s.cur=i,i&&(t==="fx"&&n.unshift("inprogress"),delete s.stop,i.call(e,o,s)),!r&&s&&s.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return b._data(e,n)||b._data(e,n,{empty:b.Callbacks("once memory").add(function(){b._removeData(e,t+"queue"),b._removeData(e,n)})})}}),b.fn.extend({queue:function(e,n){var r=2;return typeof e!="string"&&(n=e,e="fx",r--),arguments.length<r?b.queue(this[0],e):n===t?this:this.each(function(){var t=b.queue(this,e,n);b._queueHooks(this,e),e==="fx"&&t[0]!=="inprogress"&&b.dequeue(this,e)})},dequeue:function(e){return this.each(function(){b.dequeue(this,e)})},delay:function(e,t){return e=b.fx?b.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,n){var r,i=1,s=b.Deferred(),o=this,u=this.length,a=function(){--i||s.resolveWith(o,[o])};typeof e!="string"&&(n=e,e=t),e=e||"fx";while(u--)r=b._data(o[u],e+"queueHooks"),r&&r.empty&&(i++,r.empty.add(a));return a(),s.promise(n)}});var z,W,X=/[\t\r\n]/g,V=/\r/g,$=/^(?:input|select|textarea|button|object)$/i,J=/^(?:a|area)$/i,K=/^(?:checked|selected|autofocus|autoplay|async|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped)$/i,Q=/^(?:checked|selected)$/i,G=b.support.getSetAttribute,Y=b.support.input;b.fn.extend({attr:function(e,t){return b.access(this,b.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){b.removeAttr(this,e)})},prop:function(e,t){return b.access(this,b.prop,e,t,arguments.length>1)},removeProp:function(e){return e=b.propFix[e]||e,this.each(function(){try{this[e]=t,delete this[e]}catch(n){}})},addClass:function(e){var t,n,r,i,s,o=0,u=this.length,a=typeof e=="string"&&e;if(b.isFunction(e))return this.each(function(t){b(this).addClass(e.call(this,t,this.className))});if(a){t=(e||"").match(E)||[];for(;o<u;o++){n=this[o],r=n.nodeType===1&&(n.className?(" "+n.className+" ").replace(X," "):" ");if(r){s=0;while(i=t[s++])r.indexOf(" "+i+" ")<0&&(r+=i+" ");n.className=b.trim(r)}}}return this},removeClass:function(e){var t,n,r,i,s,o=0,u=this.length,a=arguments.length===0||typeof e=="string"&&e;if(b.isFunction(e))return this.each(function(t){b(this).removeClass(e.call(this,t,this.className))});if(a){t=(e||"").match(E)||[];for(;o<u;o++){n=this[o],r=n.nodeType===1&&(n.className?(" "+n.className+" ").replace(X," "):"");if(r){s=0;while(i=t[s++])while(r.indexOf(" "+i+" ")>=0)r=r.replace(" "+i+" "," ");n.className=e?b.trim(r):""}}}return this},toggleClass:function(e,t){var n=typeof e,r=typeof t=="boolean";return b.isFunction(e)?this.each(function(n){b(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if(n==="string"){var s,o=0,u=b(this),a=t,f=e.match(E)||[];while(s=f[o++])a=r?a:!u.hasClass(s),u[a?"addClass":"removeClass"](s)}else if(n===i||n==="boolean")this.className&&b._data(this,"__className__",this.className),this.className=this.className||e===!1?"":b._data(this,"__className__")||""})},hasClass:function(e){var t=" "+e+" ",n=0,r=this.length;for(;n<r;n++)if(this[n].nodeType===1&&(" "+this[n].className+" ").replace(X," ").indexOf(t)>=0)return!0;return!1},val:function(e){var n,r,i,s=this[0];if(!arguments.length){if(s)return r=b.valHooks[s.type]||b.valHooks[s.nodeName.toLowerCase()],r&&"get"in r&&(n=r.get(s,"value"))!==t?n:(n=s.value,typeof n=="string"?n.replace(V,""):n==null?"":n);return}return i=b.isFunction(e),this.each(function(n){var s,o=b(this);if(this.nodeType!==1)return;i?s=e.call(this,n,o.val()):s=e,s==null?s="":typeof s=="number"?s+="":b.isArray(s)&&(s=b.map(s,function(e){return e==null?"":e+""})),r=b.valHooks[this.type]||b.valHooks[this.nodeName.toLowerCase()];if(!r||!("set"in r)||r.set(this,s,"value")===t)this.value=s})}}),b.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){var t,n,r=e.options,i=e.selectedIndex,s=e.type==="select-one"||i<0,o=s?null:[],u=s?i+1:r.length,a=i<0?u:s?i:0;for(;a<u;a++){n=r[a];if((n.selected||a===i)&&(b.support.optDisabled?!n.disabled:n.getAttribute("disabled")===null)&&(!n.parentNode.disabled||!b.nodeName(n.parentNode,"optgroup"))){t=b(n).val();if(s)return t;o.push(t)}}return o},set:function(e,t){var n=b.makeArray(t);return b(e).find("option").each(function(){this.selected=b.inArray(b(this).val(),n)>=0}),n.length||(e.selectedIndex=-1),n}}},attr:function(e,n,r){var s,o,u,a=e.nodeType;if(!e||a===3||a===8||a===2)return;if(typeof e.getAttribute===i)return b.prop(e,n,r);o=a!==1||!b.isXMLDoc(e),o&&(n=n.toLowerCase(),s=b.attrHooks[n]||(K.test(n)?W:z));if(r===t)return s&&o&&"get"in s&&(u=s.get(e,n))!==null?u:(typeof e.getAttribute!==i&&(u=e.getAttribute(n)),u==null?t:u);if(r!==null)return s&&o&&"set"in s&&(u=s.set(e,r,n))!==t?u:(e.setAttribute(n,r+""),r);b.removeAttr(e,n)},removeAttr:function(e,t){var n,r,i=0,s=t&&t.match(E);if(s&&e.nodeType===1)while(n=s[i++])r=b.propFix[n]||n,K.test(n)?!G&&Q.test(n)?e[b.camelCase("default-"+n)]=e[r]=!1:e[r]=!1:b.attr(e,n,""),e.removeAttribute(G?n:r)},attrHooks:{type:{set:function(e,t){if(!b.support.radioValue&&t==="radio"&&b.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(e,n,r){var i,s,o,u=e.nodeType;if(!e||u===3||u===8||u===2)return;return o=u!==1||!b.isXMLDoc(e),o&&(n=b.propFix[n]||n,s=b.propHooks[n]),r!==t?s&&"set"in s&&(i=s.set(e,r,n))!==t?i:e[n]=r:s&&"get"in s&&(i=s.get(e,n))!==null?i:e[n]},propHooks:{tabIndex:{get:function(e){var n=e.getAttributeNode("tabindex");return n&&n.specified?parseInt(n.value,10):$.test(e.nodeName)||J.test(e.nodeName)&&e.href?0:t}}}}),W={get:function(e,n){var r=b.prop(e,n),i=typeof r=="boolean"&&e.getAttribute(n),s=typeof r=="boolean"?Y&&G?i!=null:Q.test(n)?e[b.camelCase("default-"+n)]:!!i:e.getAttributeNode(n);return s&&s.value!==!1?n.toLowerCase():t},set:function(e,t,n){return t===!1?b.removeAttr(e,n):Y&&G||!Q.test(n)?e.setAttribute(!G&&b.propFix[n]||n,n):e[b.camelCase("default-"+n)]=e[n]=!0,n}};if(!Y||!G)b.attrHooks.value={get:function(e,n){var r=e.getAttributeNode(n);return b.nodeName(e,"input")?e.defaultValue:r&&r.specified?r.value:t},set:function(e,t,n){if(!b.nodeName(e,"input"))return z&&z.set(e,t,n);e.defaultValue=t}};G||(z=b.valHooks.button={get:function(e,n){var r=e.getAttributeNode(n);return r&&(n==="id"||n==="name"||n==="coords"?r.value!=="":r.specified)?r.value:t},set:function(e,n,r){var i=e.getAttributeNode(r);return i||e.setAttributeNode(i=e.ownerDocument.createAttribute(r)),i.value=n+="",r==="value"||n===e.getAttribute(r)?n:t}},b.attrHooks.contenteditable={get:z.get,set:function(e,t,n){z.set(e,t===""?!1:t,n)}},b.each(["width","height"],function(e,t){b.attrHooks[t]=b.extend(b.attrHooks[t],{set:function(e,n){if(n==="")return e.setAttribute(t,"auto"),n}})})),b.support.hrefNormalized||(b.each(["href","src","width","height"],function(e,n){b.attrHooks[n]=b.extend(b.attrHooks[n],{get:function(e){var r=e.getAttribute(n,2);return r==null?t:r}})}),b.each(["href","src"],function(e,t){b.propHooks[t]={get:function(e){return e.getAttribute(t,4)}}})),b.support.style||(b.attrHooks.style={get:function(e){return e.style.cssText||t},set:function(e,t){return e.style.cssText=t+""}}),b.support.optSelected||(b.propHooks.selected=b.extend(b.propHooks.selected,{get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}})),b.support.enctype||(b.propFix.enctype="encoding"),b.support.checkOn||b.each(["radio","checkbox"],function(){b.valHooks[this]={get:function(e){return e.getAttribute("value")===null?"on":e.value}}}),b.each(["radio","checkbox"],function(){b.valHooks[this]=b.extend(b.valHooks[this],{set:function(e,t){if(b.isArray(t))return e.checked=b.inArray(b(e).val(),t)>=0}})});var Z=/^(?:input|select|textarea)$/i,et=/^key/,tt=/^(?:mouse|contextmenu)|click/,nt=/^(?:focusinfocus|focusoutblur)$/,rt=/^([^.]*)(?:\.(.+)|)$/;b.event={global:{},add:function(e,n,r,s,o){var u,a,f,l,c,h,p,d,v,m,g,y=b._data(e);if(!y)return;r.handler&&(l=r,r=l.handler,o=l.selector),r.guid||(r.guid=b.guid++),(a=y.events)||(a=y.events={}),(h=y.handle)||(h=y.handle=function(e){return typeof b===i||!!e&&b.event.triggered===e.type?t:b.event.dispatch.apply(h.elem,arguments)},h.elem=e),n=(n||"").match(E)||[""],f=n.length;while(f--){u=rt.exec(n[f])||[],v=g=u[1],m=(u[2]||"").split(".").sort(),c=b.event.special[v]||{},v=(o?c.delegateType:c.bindType)||v,c=b.event.special[v]||{},p=b.extend({type:v,origType:g,data:s,handler:r,guid:r.guid,selector:o,needsContext:o&&b.expr.match.needsContext.test(o),namespace:m.join(".")},l);if(!(d=a[v])){d=a[v]=[],d.delegateCount=0;if(!c.setup||c.setup.call(e,s,m,h)===!1)e.addEventListener?e.addEventListener(v,h,!1):e.attachEvent&&e.attachEvent("on"+v,h)}c.add&&(c.add.call(e,p),p.handler.guid||(p.handler.guid=r.guid)),o?d.splice(d.delegateCount++,0,p):d.push(p),b.event.global[v]=!0}e=null},remove:function(e,t,n,r,i){var s,o,u,a,f,l,c,h,p,d,v,m=b.hasData(e)&&b._data(e);if(!m||!(l=m.events))return;t=(t||"").match(E)||[""],f=t.length;while(f--){u=rt.exec(t[f])||[],p=v=u[1],d=(u[2]||"").split(".").sort();if(!p){for(p in l)b.event.remove(e,p+t[f],n,r,!0);continue}c=b.event.special[p]||{},p=(r?c.delegateType:c.bindType)||p,h=l[p]||[],u=u[2]&&new RegExp("(^|\\.)"+d.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=s=h.length;while(s--)o=h[s],(i||v===o.origType)&&(!n||n.guid===o.guid)&&(!u||u.test(o.namespace))&&(!r||r===o.selector||r==="**"&&o.selector)&&(h.splice(s,1),o.selector&&h.delegateCount--,c.remove&&c.remove.call(e,o));a&&!h.length&&((!c.teardown||c.teardown.call(e,d,m.handle)===!1)&&b.removeEvent(e,p,m.handle),delete l[p])}b.isEmptyObject(l)&&(delete m.handle,b._removeData(e,"events"))},trigger:function(n,r,i,o){var u,a,f,l,c,h,p,d=[i||s],v=g.call(n,"type")?n.type:n,m=g.call(n,"namespace")?n.namespace.split("."):[];f=h=i=i||s;if(i.nodeType===3||i.nodeType===8)return;if(nt.test(v+b.event.triggered))return;v.indexOf(".")>=0&&(m=v.split("."),v=m.shift(),m.sort()),a=v.indexOf(":")<0&&"on"+v,n=n[b.expando]?n:new b.Event(v,typeof n=="object"&&n),n.isTrigger=!0,n.namespace=m.join("."),n.namespace_re=n.namespace?new RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,n.result=t,n.target||(n.target=i),r=r==null?[n]:b.makeArray(r,[n]),c=b.event.special[v]||{};if(!o&&c.trigger&&c.trigger.apply(i,r)===!1)return;if(!o&&!c.noBubble&&!b.isWindow(i)){l=c.delegateType||v,nt.test(l+v)||(f=f.parentNode);for(;f;f=f.parentNode)d.push(f),h=f;h===(i.ownerDocument||s)&&d.push(h.defaultView||h.parentWindow||e)}p=0;while((f=d[p++])&&!n.isPropagationStopped())n.type=p>1?l:c.bindType||v,u=(b._data(f,"events")||{})[n.type]&&b._data(f,"handle"),u&&u.apply(f,r),u=a&&f[a],u&&b.acceptData(f)&&u.apply&&u.apply(f,r)===!1&&n.preventDefault();n.type=v;if(!o&&!n.isDefaultPrevented()&&(!c._default||c._default.apply(i.ownerDocument,r)===!1)&&(v!=="click"||!b.nodeName(i,"a"))&&b.acceptData(i)&&a&&i[v]&&!b.isWindow(i)){h=i[a],h&&(i[a]=null),b.event.triggered=v;try{i[v]()}catch(y){}b.event.triggered=t,h&&(i[a]=h)}return n.result},dispatch:function(e){e=b.event.fix(e);var n,r,i,s,o,u=[],a=d.call(arguments),f=(b._data(this,"events")||{})[e.type]||[],l=b.event.special[e.type]||{};a[0]=e,e.delegateTarget=this;if(l.preDispatch&&l.preDispatch.call(this,e)===!1)return;u=b.event.handlers.call(this,e,f),n=0;while((s=u[n++])&&!e.isPropagationStopped()){e.currentTarget=s.elem,o=0;while((i=s.handlers[o++])&&!e.isImmediatePropagationStopped())if(!e.namespace_re||e.namespace_re.test(i.namespace))e.handleObj=i,e.data=i.data,r=((b.event.special[i.origType]||{}).handle||i.handler).apply(s.elem,a),r!==t&&(e.result=r)===!1&&(e.preventDefault(),e.stopPropagation())}return l.postDispatch&&l.postDispatch.call(this,e),e.result},handlers:function(e,n){var r,i,s,o,u=[],a=n.delegateCount,f=e.target;if(a&&f.nodeType&&(!e.button||e.type!=="click"))for(;f!=this;f=f.parentNode||this)if(f.nodeType===1&&(f.disabled!==!0||e.type!=="click")){s=[];for(o=0;o<a;o++)i=n[o],r=i.selector+" ",s[r]===t&&(s[r]=i.needsContext?b(r,this).index(f)>=0:b.find(r,this,null,[f]).length),s[r]&&s.push(i);s.length&&u.push({elem:f,handlers:s})}return a<n.length&&u.push({elem:this,handlers:n.slice(a)}),u},fix:function(e){if(e[b.expando])return e;var t,n,r,i=e.type,o=e,u=this.fixHooks[i];u||(this.fixHooks[i]=u=tt.test(i)?this.mouseHooks:et.test(i)?this.keyHooks:{}),r=u.props?this.props.concat(u.props):this.props,e=new b.Event(o),t=r.length;while(t--)n=r[t],e[n]=o[n];return e.target||(e.target=o.srcElement||s),e.target.nodeType===3&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,u.filter?u.filter(e,o):e},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return e.which==null&&(e.which=t.charCode!=null?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,n){var r,i,o,u=n.button,a=n.fromElement;return e.pageX==null&&n.clientX!=null&&(i=e.target.ownerDocument||s,o=i.documentElement,r=i.body,e.pageX=n.clientX+(o&&o.scrollLeft||r&&r.scrollLeft||0)-(o&&o.clientLeft||r&&r.clientLeft||0),e.pageY=n.clientY+(o&&o.scrollTop||r&&r.scrollTop||0)-(o&&o.clientTop||r&&r.clientTop||0)),!e.relatedTarget&&a&&(e.relatedTarget=a===e.target?n.toElement:a),!e.which&&u!==t&&(e.which=u&1?1:u&2?3:u&4?2:0),e}},special:{load:{noBubble:!0},click:{trigger:function(){if(b.nodeName(this,"input")&&this.type==="checkbox"&&this.click)return this.click(),!1}},focus:{trigger:function(){if(this!==s.activeElement&&this.focus)try{return this.focus(),!1}catch(e){}},delegateType:"focusin"},blur:{trigger:function(){if(this===s.activeElement&&this.blur)return this.blur(),!1},delegateType:"focusout"},beforeunload:{postDispatch:function(e){e.result!==t&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,n,r){var i=b.extend(new b.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?b.event.trigger(i,null,t):b.event.dispatch.call(t,i),i.isDefaultPrevented()&&n.preventDefault()}},b.removeEvent=s.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}:function(e,t,n){var r="on"+t;e.detachEvent&&(typeof e[r]===i&&(e[r]=null),e.detachEvent(r,n))},b.Event=function(e,t){if(!(this instanceof b.Event))return new b.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.returnValue===!1||e.getPreventDefault&&e.getPreventDefault()?it:st):this.type=e,t&&b.extend(this,t),this.timeStamp=e&&e.timeStamp||b.now(),this[b.expando]=!0},b.Event.prototype={isDefaultPrevented:st,isPropagationStopped:st,isImmediatePropagationStopped:st,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=it;if(!e)return;e.preventDefault?e.preventDefault():e.returnValue=!1},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=it;if(!e)return;e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=it,this.stopPropagation()}},b.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){b.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,s=e.handleObj;if(!i||i!==r&&!b.contains(r,i))e.type=s.origType,n=s.handler.apply(this,arguments),e.type=t;return n}}}),b.support.submitBubbles||(b.event.special.submit={setup:function(){if(b.nodeName(this,"form"))return!1;b.event.add(this,"click._submit keypress._submit",function(e){var n=e.target,r=b.nodeName(n,"input")||b.nodeName(n,"button")?n.form:t;r&&!b._data(r,"submitBubbles")&&(b.event.add(r,"submit._submit",function(e){e._submit_bubble=!0}),b._data(r,"submitBubbles",!0))})},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&b.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){if(b.nodeName(this,"form"))return!1;b.event.remove(this,"._submit")}}),b.support.changeBubbles||(b.event.special.change={setup:function(){if(Z.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio")b.event.add(this,"propertychange._change",function(e){e.originalEvent.propertyName==="checked"&&(this._just_changed=!0)}),b.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),b.event.simulate("change",this,e,!0)});return!1}b.event.add(this,"beforeactivate._change",function(e){var t=e.target;Z.test(t.nodeName)&&!b._data(t,"changeBubbles")&&(b.event.add(t,"change._change",function(e){this.parentNode&&!e.isSimulated&&!e.isTrigger&&b.event.simulate("change",this.parentNode,e,!0)}),b._data(t,"changeBubbles",!0))})},handle:function(e){var t=e.target;if(this!==t||e.isSimulated||e.isTrigger||t.type!=="radio"&&t.type!=="checkbox")return e.handleObj.handler.apply(this,arguments)},teardown:function(){return b.event.remove(this,"._change"),!Z.test(this.nodeName)}}),b.support.focusinBubbles||b.each({focus:"focusin",blur:"focusout"},function(e,t){var n=0,r=function(e){b.event.simulate(t,e.target,b.event.fix(e),!0)};b.event.special[t]={setup:function(){n++===0&&s.addEventListener(e,r,!0)},teardown:function(){--n===0&&s.removeEventListener(e,r,!0)}}}),b.fn.extend({on:function(e,n,r,i,s){var o,u;if(typeof e=="object"){typeof n!="string"&&(r=r||n,n=t);for(o in e)this.on(o,n,r,e[o],s);return this}r==null&&i==null?(i=n,r=n=t):i==null&&(typeof n=="string"?(i=r,r=t):(i=r,r=n,n=t));if(i===!1)i=st;else if(!i)return this;return s===1&&(u=i,i=function(e){return b().off(e),u.apply(this,arguments)},i.guid=u.guid||(u.guid=b.guid++)),this.each(function(){b.event.add(this,e,i,r,n)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,n,r){var i,s;if(e&&e.preventDefault&&e.handleObj)return i=e.handleObj,b(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this;if(typeof e=="object"){for(s in e)this.off(s,n,e[s]);return this}if(n===!1||typeof n=="function")r=n,n=t;return r===!1&&(r=st),this.each(function(){b.event.remove(this,e,r,n)})},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return arguments.length===1?this.off(e,"**"):this.off(t,e||"**",n)},trigger:function(e,t){return this.each(function(){b.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return b.event.trigger(e,t,n,!0)}}),function(e,t){function rt(e){return J.test(e+"")}function it(){var e,t=[];return e=function(n,r){return t.push(n+=" ")>i.cacheLength&&delete e[t.shift()],e[n]=r}}function st(e){return e[w]=!0,e}function ot(e){var t=c.createElement("div");try{return e(t)}catch(n){return!1}finally{t=null}}function ut(e,t,n,r){var i,s,o,u,a,f,h,v,m,y;(t?t.ownerDocument||t:E)!==c&&l(t),t=t||c,n=n||[];if(!e||typeof e!="string")return n;if((u=t.nodeType)!==1&&u!==9)return[];if(!p&&!r){if(i=K.exec(e))if(o=i[1]){if(u===9){s=t.getElementById(o);if(!s||!s.parentNode)return n;if(s.id===o)return n.push(s),n}else if(t.ownerDocument&&(s=t.ownerDocument.getElementById(o))&&g(t,s)&&s.id===o)return n.push(s),n}else{if(i[2])return _.apply(n,D.call(t.getElementsByTagName(e),0)),n;if((o=i[3])&&S.getByClassName&&t.getElementsByClassName)return _.apply(n,D.call(t.getElementsByClassName(o),0)),n}if(S.qsa&&!d.test(e)){h=!0,v=w,m=t,y=u===9&&e;if(u===1&&t.nodeName.toLowerCase()!=="object"){f=ht(e),(h=t.getAttribute("id"))?v=h.replace(Y,"\\$&"):t.setAttribute("id",v),v="[id='"+v+"'] ",a=f.length;while(a--)f[a]=v+pt(f[a]);m=$.test(e)&&t.parentNode||t,y=f.join(",")}if(y)try{return _.apply(n,D.call(m.querySelectorAll(y),0)),n}catch(b){}finally{h||t.removeAttribute("id")}}}return Et(e.replace(R,"$1"),t,n,r)}function at(e,t){var n=t&&e,r=n&&(~t.sourceIndex||A)-(~e.sourceIndex||A);if(r)return r;if(n)while(n=n.nextSibling)if(n===t)return-1;return e?1:-1}function ft(e){return function(t){var n=t.nodeName.toLowerCase();return n==="input"&&t.type===e}}function lt(e){return function(t){var n=t.nodeName.toLowerCase();return(n==="input"||n==="button")&&t.type===e}}function ct(e){return st(function(t){return t=+t,st(function(n,r){var i,s=e([],n.length,t),o=s.length;while(o--)n[i=s[o]]&&(n[i]=!(r[i]=n[i]))})})}function ht(e,t){var n,r,s,o,u,a,f,l=C[e+" "];if(l)return t?0:l.slice(0);u=e,a=[],f=i.preFilter;while(u){if(!n||(r=U.exec(u)))r&&(u=u.slice(r[0].length)||u),a.push(s=[]);n=!1;if(r=z.exec(u))n=r.shift(),s.push({value:n,type:r[0].replace(R," ")}),u=u.slice(n.length);for(o in i.filter)(r=V[o].exec(u))&&(!f[o]||(r=f[o](r)))&&(n=r.shift(),s.push({value:n,type:o,matches:r}),u=u.slice(n.length));if(!n)break}return t?u.length:u?ut.error(e):C(e,a).slice(0)}function pt(e){var t=0,n=e.length,r="";for(;t<n;t++)r+=e[t].value;return r}function dt(e,t,n){var i=t.dir,s=n&&i==="parentNode",o=T++;return t.first?function(t,n,r){while(t=t[i])if(t.nodeType===1||s)return e(t,n,r)}:function(t,n,u){var a,f,l,c=x+" "+o;if(u){while(t=t[i])if(t.nodeType===1||s)if(e(t,n,u))return!0}else while(t=t[i])if(t.nodeType===1||s){l=t[w]||(t[w]={});if((f=l[i])&&f[0]===c){if((a=f[1])===!0||a===r)return a===!0}else{f=l[i]=[c],f[1]=e(t,n,u)||r;if(f[1]===!0)return!0}}}}function vt(e){return e.length>1?function(t,n,r){var i=e.length;while(i--)if(!e[i](t,n,r))return!1;return!0}:e[0]}function mt(e,t,n,r,i){var s,o=[],u=0,a=e.length,f=t!=null;for(;u<a;u++)if(s=e[u])if(!n||n(s,r,i))o.push(s),f&&t.push(u);return o}function gt(e,t,n,r,i,s){return r&&!r[w]&&(r=gt(r)),i&&!i[w]&&(i=gt(i,s)),st(function(s,o,u,a){var f,l,c,h=[],p=[],d=o.length,v=s||wt(t||"*",u.nodeType?[u]:u,[]),m=e&&(s||!t)?mt(v,h,e,u,a):v,g=n?i||(s?e:d||r)?[]:o:m;n&&n(m,g,u,a);if(r){f=mt(g,p),r(f,[],u,a),l=f.length;while(l--)if(c=f[l])g[p[l]]=!(m[p[l]]=c)}if(s){if(i||e){if(i){f=[],l=g.length;while(l--)(c=g[l])&&f.push(m[l]=c);i(null,g=[],f,a)}l=g.length;while(l--)(c=g[l])&&(f=i?P.call(s,c):h[l])>-1&&(s[f]=!(o[f]=c))}}else g=mt(g===o?g.splice(d,g.length):g),i?i(null,o,g,a):_.apply(o,g)})}function yt(e){var t,n,r,s=e.length,o=i.relative[e[0].type],u=o||i.relative[" "],a=o?1:0,l=dt(function(e){return e===t},u,!0),c=dt(function(e){return P.call(t,e)>-1},u,!0),h=[function(e,n,r){return!o&&(r||n!==f)||((t=n).nodeType?l(e,n,r):c(e,n,r))}];for(;a<s;a++)if(n=i.relative[e[a].type])h=[dt(vt(h),n)];else{n=i.filter[e[a].type].apply(null,e[a].matches);if(n[w]){r=++a;for(;r<s;r++)if(i.relative[e[r].type])break;return gt(a>1&&vt(h),a>1&&pt(e.slice(0,a-1)).replace(R,"$1"),n,a<r&&yt(e.slice(a,r)),r<s&&yt(e=e.slice(r)),r<s&&pt(e))}h.push(n)}return vt(h)}function bt(e,t){var n=0,s=t.length>0,o=e.length>0,u=function(u,a,l,h,p){var d,v,m,g=[],y=0,b="0",w=u&&[],E=p!=null,S=f,T=u||o&&i.find.TAG("*",p&&a.parentNode||a),N=x+=S==null?1:Math.random()||.1;E&&(f=a!==c&&a,r=n);for(;(d=T[b])!=null;b++){if(o&&d){v=0;while(m=e[v++])if(m(d,a,l)){h.push(d);break}E&&(x=N,r=++n)}s&&((d=!m&&d)&&y--,u&&w.push(d))}y+=b;if(s&&b!==y){v=0;while(m=t[v++])m(w,g,a,l);if(u){if(y>0)while(b--)!w[b]&&!g[b]&&(g[b]=M.call(h));g=mt(g)}_.apply(h,g),E&&!u&&g.length>0&&y+t.length>1&&ut.uniqueSort(h)}return E&&(x=N,f=S),w};return s?st(u):u}function wt(e,t,n){var r=0,i=t.length;for(;r<i;r++)ut(e,t[r],n);return n}function Et(e,t,n,r){var s,o,a,f,l,c=ht(e);if(!r&&c.length===1){o=c[0]=c[0].slice(0);if(o.length>2&&(a=o[0]).type==="ID"&&t.nodeType===9&&!p&&i.relative[o[1].type]){t=i.find.ID(a.matches[0].replace(et,tt),t)[0];if(!t)return n;e=e.slice(o.shift().value.length)}s=V.needsContext.test(e)?0:o.length;while(s--){a=o[s];if(i.relative[f=a.type])break;if(l=i.find[f])if(r=l(a.matches[0].replace(et,tt),$.test(o[0].type)&&t.parentNode||t)){o.splice(s,1),e=r.length&&pt(o);if(!e)return _.apply(n,D.call(r,0)),n;break}}}return u(e,c)(r,t,p,n,$.test(e)),n}function St(){}var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,w="sizzle"+ -(new Date),E=e.document,S={},x=0,T=0,N=it(),C=it(),k=it(),L=typeof t,A=1<<31,O=[],M=O.pop,_=O.push,D=O.slice,P=O.indexOf||function(e){var t=0,n=this.length;for(;t<n;t++)if(this[t]===e)return t;return-1},H="[\\x20\\t\\r\\n\\f]",B="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",j=B.replace("w","w#"),F="([*^$|!~]?=)",I="\\["+H+"*("+B+")"+H+"*(?:"+F+H+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+j+")|)|)"+H+"*\\]",q=":("+B+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+I.replace(3,8)+")*)|.*)\\)|)",R=new RegExp("^"+H+"+|((?:^|[^\\\\])(?:\\\\.)*)"+H+"+$","g"),U=new RegExp("^"+H+"*,"+H+"*"),z=new RegExp("^"+H+"*([\\x20\\t\\r\\n\\f>+~])"+H+"*"),W=new RegExp(q),X=new RegExp("^"+j+"$"),V={ID:new RegExp("^#("+B+")"),CLASS:new RegExp("^\\.("+B+")"),NAME:new RegExp("^\\[name=['\"]?("+B+")['\"]?\\]"),TAG:new RegExp("^("+B.replace("w","w*")+")"),ATTR:new RegExp("^"+I),PSEUDO:new RegExp("^"+q),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+H+"*(even|odd|(([+-]|)(\\d*)n|)"+H+"*(?:([+-]|)"+H+"*(\\d+)|))"+H+"*\\)|)","i"),needsContext:new RegExp("^"+H+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+H+"*((?:-\\d)?\\d*)"+H+"*\\)|)(?=[^-]|$)","i")},$=/[\x20\t\r\n\f]*[+~]/,J=/^[^{]+\{\s*\[native code/,K=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,Q=/^(?:input|select|textarea|button)$/i,G=/^h\d$/i,Y=/'|\\/g,Z=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,et=/\\([\da-fA-F]{1,6}[\x20\t\r\n\f]?|.)/g,tt=function(e,t){var n="0x"+t-65536;return n!==n?t:n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,n&1023|56320)};try{D.call(E.documentElement.childNodes,0)[0].nodeType}catch(nt){D=function(e){var t,n=[];while(t=this[e++])n.push(t);return n}}o=ut.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?t.nodeName!=="HTML":!1},l=ut.setDocument=function(e){var n=e?e.ownerDocument||e:E;if(n===c||n.nodeType!==9||!n.documentElement)return c;c=n,h=n.documentElement,p=o(n),S.tagNameNoComments=ot(function(e){return e.appendChild(n.createComment("")),!e.getElementsByTagName("*").length}),S.attributes=ot(function(e){e.innerHTML="<select></select>";var t=typeof e.lastChild.getAttribute("multiple");return t!=="boolean"&&t!=="string"}),S.getByClassName=ot(function(e){return e.innerHTML="<div class='hidden e'></div><div class='hidden'></div>",!e.getElementsByClassName||!e.getElementsByClassName("e").length?!1:(e.lastChild.className="e",e.getElementsByClassName("e").length===2)}),S.getByName=ot(function(e){e.id=w+0,e.innerHTML="<a name='"+w+"'></a><div name='"+w+"'></div>",h.insertBefore(e,h.firstChild);var t=n.getElementsByName&&n.getElementsByName(w).length===2+n.getElementsByName(w+0).length;return S.getIdNotName=!n.getElementById(w),h.removeChild(e),t}),i.attrHandle=ot(function(e){return e.innerHTML="<a href='#'></a>",e.firstChild&&typeof e.firstChild.getAttribute!==L&&e.firstChild.getAttribute("href")==="#"})?{}:{href:function(e){return e.getAttribute("href",2)},type:function(e){return e.getAttribute("type")}},S.getIdNotName?(i.find.ID=function(e,t){if(typeof t.getElementById!==L&&!p){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},i.filter.ID=function(e){var t=e.replace(et,tt);return function(e){return e.getAttribute("id")===t}}):(i.find.ID=function(e,n){if(typeof n.getElementById!==L&&!p){var r=n.getElementById(e);return r?r.id===e||typeof r.getAttributeNode!==L&&r.getAttributeNode("id").value===e?[r]:t:[]}},i.filter.ID=function(e){var t=e.replace(et,tt);return function(e){var n=typeof e.getAttributeNode!==L&&e.getAttributeNode("id");return n&&n.value===t}}),i.find.TAG=S.tagNameNoComments?function(e,t){if(typeof t.getElementsByTagName!==L)return t.getElementsByTagName(e)}:function(e,t){var n,r=[],i=0,s=t.getElementsByTagName(e);if(e==="*"){while(n=s[i++])n.nodeType===1&&r.push(n);return r}return s},i.find.NAME=S.getByName&&function(e,t){if(typeof t.getElementsByName!==L)return t.getElementsByName(name)},i.find.CLASS=S.getByClassName&&function(e,t){if(typeof t.getElementsByClassName!==L&&!p)return t.getElementsByClassName(e)},v=[],d=[":focus"];if(S.qsa=rt(n.querySelectorAll))ot(function(e){e.innerHTML="<select><option selected=''></option></select>",e.querySelectorAll("[selected]").length||d.push("\\["+H+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)"),e.querySelectorAll(":checked").length||d.push(":checked")}),ot(function(e){e.innerHTML="<input type='hidden' i=''/>",e.querySelectorAll("[i^='']").length&&d.push("[*^$]="+H+"*(?:\"\"|'')"),e.querySelectorAll(":enabled").length||d.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),d.push(",.*:")});return(S.matchesSelector=rt(m=h.matchesSelector||h.mozMatchesSelector||h.webkitMatchesSelector||h.oMatchesSelector||h.msMatchesSelector))&&ot(function(e){S.disconnectedMatch=m.call(e,"div"),m.call(e,"[s!='']:x"),v.push("!=",q)}),d=new RegExp(d.join("|")),v=new RegExp(v.join("|")),g=rt(h.contains)||h.compareDocumentPosition?function(e,t){var n=e.nodeType===9?e.documentElement:e,r=t&&t.parentNode;return e===r||!!r&&r.nodeType===1&&!!(n.contains?n.contains(r):e.compareDocumentPosition&&e.compareDocumentPosition(r)&16)}:function(e,t){if(t)while(t=t.parentNode)if(t===e)return!0;return!1},y=h.compareDocumentPosition?function(e,t){var r;if(e===t)return a=!0,0;if(r=t.compareDocumentPosition&&e.compareDocumentPosition&&e.compareDocumentPosition(t))return r&1||e.parentNode&&e.parentNode.nodeType===11?e===n||g(E,e)?-1:t===n||g(E,t)?1:0:r&4?-1:1;return e.compareDocumentPosition?-1:1}:function(e,t){var r,i=0,s=e.parentNode,o=t.parentNode,u=[e],f=[t];if(e===t)return a=!0,0;if(!s||!o)return e===n?-1:t===n?1:s?-1:o?1:0;if(s===o)return at(e,t);r=e;while(r=r.parentNode)u.unshift(r);r=t;while(r=r.parentNode)f.unshift(r);while(u[i]===f[i])i++;return i?at(u[i],f[i]):u[i]===E?-1:f[i]===E?1:0},a=!1,[0,0].sort(y),S.detectDuplicates=a,c},ut.matches=function(e,t){return ut(e,null,null,t)},ut.matchesSelector=function(e,t){(e.ownerDocument||e)!==c&&l(e),t=t.replace(Z,"='$1']");if(S.matchesSelector&&!p&&(!v||!v.test(t))&&!d.test(t))try{var n=m.call(e,t);if(n||S.disconnectedMatch||e.document&&e.document.nodeType!==11)return n}catch(r){}return ut(t,c,null,[e]).length>0},ut.contains=function(e,t){return(e.ownerDocument||e)!==c&&l(e),g(e,t)},ut.attr=function(e,t){var n;return(e.ownerDocument||e)!==c&&l(e),p||(t=t.toLowerCase()),(n=i.attrHandle[t])?n(e):p||S.attributes?e.getAttribute(t):((n=e.getAttributeNode(t))||e.getAttribute(t))&&e[t]===!0?t:n&&n.specified?n.value:null},ut.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},ut.uniqueSort=function(e){var t,n=[],r=1,i=0;a=!S.detectDuplicates,e.sort(y);if(a){for(;t=e[r];r++)t===e[r-1]&&(i=n.push(r));while(i--)e.splice(n[i],1)}return e},s=ut.getText=function(e){var t,n="",r=0,i=e.nodeType;if(!i)for(;t=e[r];r++)n+=s(t);else if(i===1||i===9||i===11){if(typeof e.textContent=="string")return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=s(e)}else if(i===3||i===4)return e.nodeValue;return n},i=ut.selectors={cacheLength:50,createPseudo:st,match:V,find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(et,tt),e[3]=(e[4]||e[5]||"").replace(et,tt),e[2]==="~="&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),e[1].slice(0,3)==="nth"?(e[3]||ut.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*(e[3]==="even"||e[3]==="odd")),e[5]=+(e[7]+e[8]||e[3]==="odd")):e[3]&&ut.error(e[0]),e},PSEUDO:function(e){var t,n=!e[5]&&e[2];return V.CHILD.test(e[0])?null:(e[4]?e[2]=e[4]:n&&W.test(n)&&(t=ht(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){return e==="*"?function(){return!0}:(e=e.replace(et,tt).toLowerCase(),function(t){return t.nodeName&&t.nodeName.toLowerCase()===e})},CLASS:function(e){var t=N[e+" "];return t||(t=new RegExp("(^|"+H+")"+e+"("+H+"|$)"))&&N(e,function(e){return t.test(e.className||typeof e.getAttribute!==L&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r){var i=ut.attr(r,e);return i==null?t==="!=":t?(i+="",t==="="?i===n:t==="!="?i!==n:t==="^="?n&&i.indexOf(n)===0:t==="*="?n&&i.indexOf(n)>-1:t==="$="?n&&i.slice(-n.length)===n:t==="~="?(" "+i+" ").indexOf(n)>-1:t==="|="?i===n||i.slice(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,n,r,i){var s=e.slice(0,3)!=="nth",o=e.slice(-4)!=="last",u=t==="of-type";return r===1&&i===0?function(e){return!!e.parentNode}:function(t,n,a){var f,l,c,h,p,d,v=s!==o?"nextSibling":"previousSibling",m=t.parentNode,g=u&&t.nodeName.toLowerCase(),y=!a&&!u;if(m){if(s){while(v){c=t;while(c=c[v])if(u?c.nodeName.toLowerCase()===g:c.nodeType===1)return!1;d=v=e==="only"&&!d&&"nextSibling"}return!0}d=[o?m.firstChild:m.lastChild];if(o&&y){l=m[w]||(m[w]={}),f=l[e]||[],p=f[0]===x&&f[1],h=f[0]===x&&f[2],c=p&&m.childNodes[p];while(c=++p&&c&&c[v]||(h=p=0)||d.pop())if(c.nodeType===1&&++h&&c===t){l[e]=[x,p,h];break}}else if(y&&(f=(t[w]||(t[w]={}))[e])&&f[0]===x)h=f[1];else while(c=++p&&c&&c[v]||(h=p=0)||d.pop())if((u?c.nodeName.toLowerCase()===g:c.nodeType===1)&&++h){y&&((c[w]||(c[w]={}))[e]=[x,h]);if(c===t)break}return h-=i,h===r||h%r===0&&h/r>=0}}},PSEUDO:function(e,t){var n,r=i.pseudos[e]||i.setFilters[e.toLowerCase()]||ut.error("unsupported pseudo: "+e);return r[w]?r(t):r.length>1?(n=[e,e,"",t],i.setFilters.hasOwnProperty(e.toLowerCase())?st(function(e,n){var i,s=r(e,t),o=s.length;while(o--)i=P.call(e,s[o]),e[i]=!(n[i]=s[o])}):function(e){return r(e,0,n)}):r}},pseudos:{not:st(function(e){var t=[],n=[],r=u(e.replace(R,"$1"));return r[w]?st(function(e,t,n,i){var s,o=r(e,null,i,[]),u=e.length;while(u--)if(s=o[u])e[u]=!(t[u]=s)}):function(e,i,s){return t[0]=e,r(t,null,s,n),!n.pop()}}),has:st(function(e){return function(t){return ut(e,t).length>0}}),contains:st(function(e){return function(t){return(t.textContent||t.innerText||s(t)).indexOf(e)>-1}}),lang:st(function(e){return X.test(e||"")||ut.error("unsupported lang: "+e),e=e.replace(et,tt).toLowerCase(),function(t){var n;do if(n=p?t.getAttribute("xml:lang")||t.getAttribute("lang"):t.lang)return n=n.toLowerCase(),n===e||n.indexOf(e+"-")===0;while((t=t.parentNode)&&t.nodeType===1);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===h},focus:function(e){return e===c.activeElement&&(!c.hasFocus||c.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&!!e.checked||t==="option"&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeName>"@"||e.nodeType===3||e.nodeType===4)return!1;return!0},parent:function(e){return!i.pseudos.empty(e)},header:function(e){return G.test(e.nodeName)},input:function(e){return Q.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&e.type==="button"||t==="button"},text:function(e){var t;return e.nodeName.toLowerCase()==="input"&&e.type==="text"&&((t=e.getAttribute("type"))==null||t.toLowerCase()===e.type)},first:ct(function(){return[0]}),last:ct(function(e,t){return[t-1]}),eq:ct(function(e,t,n){return[n<0?n+t:n]}),even:ct(function(e,t){var n=0;for(;n<t;n+=2)e.push(n);return e}),odd:ct(function(e,t){var n=1;for(;n<t;n+=2)e.push(n);return e}),lt:ct(function(e,t,n){var r=n<0?n+t:n;for(;--r>=0;)e.push(r);return e}),gt:ct(function(e,t,n){var r=n<0?n+t:n;for(;++r<t;)e.push(r);return e})}};for(n in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})i.pseudos[n]=ft(n);for(n in{submit:!0,reset:!0})i.pseudos[n]=lt(n);u=ut.compile=function(e,t){var n,r=[],i=[],s=k[e+" "];if(!s){t||(t=ht(e)),n=t.length;while(n--)s=yt(t[n]),s[w]?r.push(s):i.push(s);s=k(e,bt(i,r))}return s},i.pseudos.nth=i.pseudos.eq,i.filters=St.prototype=i.pseudos,i.setFilters=new St,l(),ut.attr=b.attr,b.find=ut,b.expr=ut.selectors,b.expr[":"]=b.expr.pseudos,b.unique=ut.uniqueSort,b.text=ut.getText,b.isXMLDoc=ut.isXML,b.contains=ut.contains}(e);var ot=/Until$/,ut=/^(?:parents|prev(?:Until|All))/,at=/^.[^:#\[\.,]*$/,ft=b.expr.match.needsContext,lt={children:!0,contents:!0,next:!0,prev:!0};b.fn.extend({find:function(e){var t,n,r,i=this.length;if(typeof e!="string")return r=this,this.pushStack(b(e).filter(function(){for(t=0;t<i;t++)if(b.contains(r[t],this))return!0}));n=[];for(t=0;t<i;t++)b.find(e,this[t],n);return n=this.pushStack(i>1?b.unique(n):n),n.selector=(this.selector?this.selector+" ":"")+e,n},has:function(e){var t,n=b(e,this),r=n.length;return this.filter(function(){for(t=0;t<r;t++)if(b.contains(this,n[t]))return!0})},not:function(e){return this.pushStack(ht(this,e,!1))},filter:function(e){return this.pushStack(ht(this,e,!0))},is:function(e){return!!e&&(typeof e=="string"?ft.test(e)?b(e,this.context).index(this[0])>=0:b.filter(e,this).length>0:this.filter(e).length>0)},closest:function(e,t){var n,r=0,i=this.length,s=[],o=ft.test(e)||typeof e!="string"?b(e,t||this.context):0;for(;r<i;r++){n=this[r];while(n&&n.ownerDocument&&n!==t&&n.nodeType!==11){if(o?o.index(n)>-1:b.find.matchesSelector(n,e)){s.push(n);break}n=n.parentNode}}return this.pushStack(s.length>1?b.unique(s):s)},index:function(e){return e?typeof e=="string"?b.inArray(this[0],b(e)):b.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){var n=typeof e=="string"?b(e,t):b.makeArray(e&&e.nodeType?[e]:e),r=b.merge(this.get(),n);return this.pushStack(b.unique(r))},addBack:function(e){return this.add(e==null?this.prevObject:this.prevObject.filter(e))}}),b.fn.andSelf=b.fn.addBack,b.each({parent:function(e){var t=e.parentNode;return t&&t.nodeType!==11?t:null},parents:function(e){return b.dir(e,"parentNode")},parentsUntil:function(e,t,n){return b.dir(e,"parentNode",n)},next:function(e){return ct(e,"nextSibling")},prev:function(e){return ct(e,"previousSibling")},nextAll:function(e){return b.dir(e,"nextSibling")},prevAll:function(e){return b.dir(e,"previousSibling")},nextUntil:function(e,t,n){return b.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return b.dir(e,"previousSibling",n)},siblings:function(e){return b.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return b.sibling(e.firstChild)},contents:function(e){return b.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:b.merge([],e.childNodes)}},function(e,t){b.fn[e]=function(n,r){var i=b.map(this,t,n);return ot.test(e)||(r=n),r&&typeof r=="string"&&(i=b.filter(r,i)),i=this.length>1&&!lt[e]?b.unique(i):i,this.length>1&&ut.test(e)&&(i=i.reverse()),this.pushStack(i)}}),b.extend({filter:function(e,t,n){return n&&(e=":not("+e+")"),t.length===1?b.find.matchesSelector(t[0],e)?[t[0]]:[]:b.find.matches(e,t)},dir:function(e,n,r){var i=[],s=e[n];while(s&&s.nodeType!==9&&(r===t||s.nodeType!==1||!b(s).is(r)))s.nodeType===1&&i.push(s),s=s[n];return i},sibling:function(e,t){var n=[];for(;e;e=e.nextSibling)e.nodeType===1&&e!==t&&n.push(e);return n}});var dt="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",vt=/ jQuery\d+="(?:null|\d+)"/g,mt=new RegExp("<(?:"+dt+")[\\s/>]","i"),gt=/^\s+/,yt=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,bt=/<([\w:]+)/,wt=/<tbody/i,Et=/<|&#?\w+;/,St=/<(?:script|style|link)/i,xt=/^(?:checkbox|radio)$/i,Tt=/checked\s*(?:[^=]|=\s*.checked.)/i,Nt=/^$|\/(?:java|ecma)script/i,Ct=/^true\/(.*)/,kt=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Lt={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:b.support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},At=pt(s),Ot=At.appendChild(s.createElement("div"));Lt.optgroup=Lt.option,Lt.tbody=Lt.tfoot=Lt.colgroup=Lt.caption=Lt.thead,Lt.th=Lt.td,b.fn.extend({text:function(e){return b.access(this,function(e){return e===t?b.text(this):this.empty().append((this[0]&&this[0].ownerDocument||s).createTextNode(e))},null,e,arguments.length)},wrapAll:function(e){if(b.isFunction(e))return this.each(function(t){b(this).wrapAll(e.call(this,t))});if(this[0]){var t=b(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstChild&&e.firstChild.nodeType===1)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return b.isFunction(e)?this.each(function(t){b(this).wrapInner(e.call(this,t))}):this.each(function(){var t=b(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=b.isFunction(e);return this.each(function(n){b(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){b.nodeName(this,"body")||b(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(e){(this.nodeType===1||this.nodeType===11||this.nodeType===9)&&this.appendChild(e)})},prepend:function(){return this.domManip(arguments,!0,function(e){(this.nodeType===1||this.nodeType===11||this.nodeType===9)&&this.insertBefore(e,this.firstChild)})},before:function(){return this.domManip(arguments,!1,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,!1,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){var n,r=0;for(;(n=this[r])!=null;r++)if(!e||b.filter(e,[n]).length>0)!t&&n.nodeType===1&&b.cleanData(jt(n)),n.parentNode&&(t&&b.contains(n.ownerDocument,n)&&Pt(jt(n,"script")),n.parentNode.removeChild(n));return this},empty:function(){var e,t=0;for(;(e=this[t])!=null;t++){e.nodeType===1&&b.cleanData(jt(e,!1));while(e.firstChild)e.removeChild(e.firstChild);e.options&&b.nodeName(e,"select")&&(e.options.length=0)}return this},clone:function(e,t){return e=e==null?!1:e,t=t==null?e:t,this.map(function(){return b.clone(this,e,t)})},html:function(e){return b.access(this,function(e){var n=this[0]||{},r=0,i=this.length;if(e===t)return n.nodeType===1?n.innerHTML.replace(vt,""):t;if(typeof e=="string"&&!St.test(e)&&(b.support.htmlSerialize||!mt.test(e))&&(b.support.leadingWhitespace||!gt.test(e))&&!Lt[(bt.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(yt,"<$1></$2>");try{for(;r<i;r++)n=this[r]||{},n.nodeType===1&&(b.cleanData(jt(n,!1)),n.innerHTML=e);n=0}catch(s){}}n&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(e){var t=b.isFunction(e);return!t&&typeof e!="string"&&(e=b(e).not(this).detach()),this.domManip([e],!0,function(e){var t=this.nextSibling,n=this.parentNode;n&&(b(this).remove(),n.insertBefore(e,t))})},detach:function(e){return this.remove(e,!0)},domManip:function(e,n,r){e=h.apply([],e);var i,s,o,u,a,f,l=0,c=this.length,p=this,d=c-1,v=e[0],m=b.isFunction(v);if(m||!(c<=1||typeof v!="string"||b.support.checkClone||!Tt.test(v)))return this.each(function(i){var s=p.eq(i);m&&(e[0]=v.call(this,i,n?s.html():t)),s.domManip(e,n,r)});if(c){f=b.buildFragment(e,this[0].ownerDocument,!1,this),i=f.firstChild,f.childNodes.length===1&&(f=i);if(i){n=n&&b.nodeName(i,"tr"),u=b.map(jt(f,"script"),_t),o=u.length;for(;l<c;l++)s=f,l!==d&&(s=b.clone(s,!0,!0),o&&b.merge(u,jt(s,"script"))),r.call(n&&b.nodeName(this[l],"table")?Mt(this[l],"tbody"):this[l],s,l);if(o){a=u[u.length-1].ownerDocument,b.map(u,Dt);for(l=0;l<o;l++)s=u[l],Nt.test(s.type||"")&&!b._data(s,"globalEval")&&b.contains(a,s)&&(s.src?b.ajax({url:s.src,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0}):b.globalEval((s.text||s.textContent||s.innerHTML||"").replace(kt,"")))}f=i=null}}return this}}),b.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){b.fn[e]=function(e){var n,r=0,i=[],s=b(e),o=s.length-1;for(;r<=o;r++)n=r===o?this:this.clone(!0),b(s[r])[t](n),p.apply(i,n.get());return this.pushStack(i)}}),b.extend({clone:function(e,t,n){var r,i,s,o,u,a=b.contains(e.ownerDocument,e);b.support.html5Clone||b.isXMLDoc(e)||!mt.test("<"+e.nodeName+">")?s=e.cloneNode(!0):(Ot.innerHTML=e.outerHTML,Ot.removeChild(s=Ot.firstChild));if((!b.support.noCloneEvent||!b.support.noCloneChecked)&&(e.nodeType===1||e.nodeType===11)&&!b.isXMLDoc(e)){r=jt(s),u=jt(e);for(o=0;(i=u[o])!=null;++o)r[o]&&Bt(i,r[o])}if(t)if(n){u=u||jt(e),r=r||jt(s);for(o=0;(i=u[o])!=null;o++)Ht(i,r[o])}else Ht(e,s);return r=jt(s,"script"),r.length>0&&Pt(r,!a&&jt(e,"script")),r=u=i=null,s},buildFragment:function(e,t,n,r){var i,s,o,u,a,f,l,c=e.length,h=pt(t),p=[],d=0;for(;d<c;d++){s=e[d];if(s||s===0)if(b.type(s)==="object")b.merge(p,s.nodeType?[s]:s);else if(!Et.test(s))p.push(t.createTextNode(s));else{u=u||h.appendChild(t.createElement("div")),a=(bt.exec(s)||["",""])[1].toLowerCase(),l=Lt[a]||Lt._default,u.innerHTML=l[1]+s.replace(yt,"<$1></$2>")+l[2],i=l[0];while(i--)u=u.lastChild;!b.support.leadingWhitespace&&gt.test(s)&&p.push(t.createTextNode(gt.exec(s)[0]));if(!b.support.tbody){s=a==="table"&&!wt.test(s)?u.firstChild:l[1]==="<table>"&&!wt.test(s)?u:0,i=s&&s.childNodes.length;while(i--)b.nodeName(f=s.childNodes[i],"tbody")&&!f.childNodes.length&&s.removeChild(f)}b.merge(p,u.childNodes),u.textContent="";while(u.firstChild)u.removeChild(u.firstChild);u=h.lastChild}}u&&h.removeChild(u),b.support.appendChecked||b.grep(jt(p,"input"),Ft),d=0;while(s=p[d++]){if(r&&b.inArray(s,r)!==-1)continue;o=b.contains(s.ownerDocument,s),u=jt(h.appendChild(s),"script"),o&&Pt(u);if(n){i=0;while(s=u[i++])Nt.test(s.type||"")&&n.push(s)}}return u=null,h},cleanData:function(e,t){var n,r,s,o,u=0,a=b.expando,f=b.cache,c=b.support.deleteExpando,h=b.event.special;for(;(n=e[u])!=null;u++)if(t||b.acceptData(n)){s=n[a],o=s&&f[s];if(o){if(o.events)for(r in o.events)h[r]?b.event.remove(n,r):b.removeEvent(n,r,o.handle);f[s]&&(delete f[s],c?delete n[a]:typeof n.removeAttribute!==i?n.removeAttribute(a):n[a]=null,l.push(s))}}}});var It,qt,Rt,Ut=/alpha\([^)]*\)/i,zt=/opacity\s*=\s*([^)]*)/,Wt=/^(top|right|bottom|left)$/,Xt=/^(none|table(?!-c[ea]).+)/,Vt=/^margin/,$t=new RegExp("^("+w+")(.*)$","i"),Jt=new RegExp("^("+w+")(?!px)[a-z%]+$","i"),Kt=new RegExp("^([+-])=("+w+")","i"),Qt={BODY:"block"},Gt={position:"absolute",visibility:"hidden",display:"block"},Yt={letterSpacing:0,fontWeight:400},Zt=["Top","Right","Bottom","Left"],en=["Webkit","O","Moz","ms"];b.fn.extend({css:function(e,n){return b.access(this,function(e,n,r){var i,s,o={},u=0;if(b.isArray(n)){s=qt(e),i=n.length;for(;u<i;u++)o[n[u]]=b.css(e,n[u],!1,s);return o}return r!==t?b.style(e,n,r):b.css(e,n)},e,n,arguments.length>1)},show:function(){return rn(this,!0)},hide:function(){return rn(this)},toggle:function(e){var t=typeof e=="boolean";return this.each(function(){(t?e:nn(this))?b(this).show():b(this).hide()})}}),b.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Rt(e,"opacity");return n===""?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":b.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,n,r,i){if(!e||e.nodeType===3||e.nodeType===8||!e.style)return;var s,o,u,a=b.camelCase(n),f=e.style;n=b.cssProps[a]||(b.cssProps[a]=tn(f,a)),u=b.cssHooks[n]||b.cssHooks[a];if(r===t)return u&&"get"in u&&(s=u.get(e,!1,i))!==t?s:f[n];o=typeof r,o==="string"&&(s=Kt.exec(r))&&(r=(s[1]+1)*s[2]+parseFloat(b.css(e,n)),o="number");if(r==null||o==="number"&&isNaN(r))return;o==="number"&&!b.cssNumber[a]&&(r+="px"),!b.support.clearCloneStyle&&r===""&&n.indexOf("background")===0&&(f[n]="inherit");if(!u||!("set"in u)||(r=u.set(e,r,i))!==t)try{f[n]=r}catch(l){}},css:function(e,n,r,i){var s,o,u,a=b.camelCase(n);return n=b.cssProps[a]||(b.cssProps[a]=tn(e.style,a)),u=b.cssHooks[n]||b.cssHooks[a],u&&"get"in u&&(o=u.get(e,!0,r)),o===t&&(o=Rt(e,n,i)),o==="normal"&&n in Yt&&(o=Yt[n]),r===""||r?(s=parseFloat(o),r===!0||b.isNumeric(s)?s||0:o):o},swap:function(e,t,n,r){var i,s,o={};for(s in t)o[s]=e.style[s],e.style[s]=t[s];i=n.apply(e,r||[]);for(s in t)e.style[s]=o[s];return i}}),e.getComputedStyle?(qt=function(t){return e.getComputedStyle(t,null)},Rt=function(e,n,r){var i,s,o,u=r||qt(e),a=u?u.getPropertyValue(n)||u[n]:t,f=e.style;return u&&(a===""&&!b.contains(e.ownerDocument,e)&&(a=b.style(e,n)),Jt.test(a)&&Vt.test(n)&&(i=f.width,s=f.minWidth,o=f.maxWidth,f.minWidth=f.maxWidth=f.width=a,a=u.width,f.width=i,f.minWidth=s,f.maxWidth=o)),a}):s.documentElement.currentStyle&&(qt=function(e){return e.currentStyle},Rt=function(e,n,r){var i,s,o,u=r||qt(e),a=u?u[n]:t,f=e.style;return a==null&&f&&f[n]&&(a=f[n]),Jt.test(a)&&!Wt.test(n)&&(i=f.left,s=e.runtimeStyle,o=s&&s.left,o&&(s.left=e.currentStyle.left),f.left=n==="fontSize"?"1em":a,a=f.pixelLeft+"px",f.left=i,o&&(s.left=o)),a===""?"auto":a}),b.each(["height","width"],function(e,t){b.cssHooks[t]={get:function(e,n,r){if(n)return e.offsetWidth===0&&Xt.test(b.css(e,"display"))?b.swap(e,Gt,function(){return un(e,t,r)}):un(e,t,r)},set:function(e,n,r){var i=r&&qt(e);return sn(e,n,r?on(e,t,r,b.support.boxSizing&&b.css(e,"boxSizing",!1,i)==="border-box",i):0)}}}),b.support.opacity||(b.cssHooks.opacity={get:function(e,t){return zt.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var n=e.style,r=e.currentStyle,i=b.isNumeric(t)?"alpha(opacity="+t*100+")":"",s=r&&r.filter||n.filter||"";n.zoom=1;if((t>=1||t==="")&&b.trim(s.replace(Ut,""))===""&&n.removeAttribute){n.removeAttribute("filter");if(t===""||r&&!r.filter)return}n.filter=Ut.test(s)?s.replace(Ut,i):s+" "+i}}),b(function(){b.support.reliableMarginRight||(b.cssHooks.marginRight={get:function(e,t){if(t)return b.swap(e,{display:"inline-block"},Rt,[e,"marginRight"])}}),!b.support.pixelPosition&&b.fn.position&&b.each(["top","left"],function(e,t){b.cssHooks[t]={get:function(e,n){if(n)return n=Rt(e,t),Jt.test(n)?b(e).position()[t]+"px":n}}})}),b.expr&&b.expr.filters&&(b.expr.filters.hidden=function(e){return e.offsetWidth<=0&&e.offsetHeight<=0||!b.support.reliableHiddenOffsets&&(e.style&&e.style.display||b.css(e,"display"))==="none"},b.expr.filters.visible=function(e){return!b.expr.filters.hidden(e)}),b.each({margin:"",padding:"",border:"Width"},function(e,t){b.cssHooks[e+t]={expand:function(n){var r=0,i={},s=typeof n=="string"?n.split(" "):[n];for(;r<4;r++)i[e+Zt[r]+t]=s[r]||s[r-2]||s[0];return i}},Vt.test(e)||(b.cssHooks[e+t].set=sn)});var ln=/%20/g,cn=/\[\]$/,hn=/\r?\n/g,pn=/^(?:submit|button|image|reset|file)$/i,dn=/^(?:input|select|textarea|keygen)/i;b.fn.extend({serialize:function(){return b.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=b.prop(this,"elements");return e?b.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!b(this).is(":disabled")&&dn.test(this.nodeName)&&!pn.test(e)&&(this.checked||!xt.test(e))}).map(function(e,t){var n=b(this).val();return n==null?null:b.isArray(n)?b.map(n,function(e){return{name:t.name,value:e.replace(hn,"\r\n")}}):{name:t.name,value:n.replace(hn,"\r\n")}}).get()}}),b.param=function(e,n){var r,i=[],s=function(e,t){t=b.isFunction(t)?t():t==null?"":t,i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};n===t&&(n=b.ajaxSettings&&b.ajaxSettings.traditional);if(b.isArray(e)||e.jquery&&!b.isPlainObject(e))b.each(e,function(){s(this.name,this.value)});else for(r in e)vn(r,e[r],n,s);return i.join("&").replace(ln,"+")},b.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){b.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),b.fn.hover=function(e,t){return this.mouseenter(e).mouseleave(t||e)};var mn,gn,yn=b.now(),bn=/\?/,wn=/#.*$/,En=/([?&])_=[^&]*/,Sn=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,xn=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Tn=/^(?:GET|HEAD)$/,Nn=/^\/\//,Cn=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,kn=b.fn.load,Ln={},An={},On="*/".concat("*");try{gn=o.href}catch(Mn){gn=s.createElement("a"),gn.href="",gn=gn.href}mn=Cn.exec(gn.toLowerCase())||[],b.fn.load=function(e,n,r){if(typeof e!="string"&&kn)return kn.apply(this,arguments);var i,s,o,u=this,a=e.indexOf(" ");return a>=0&&(i=e.slice(a,e.length),e=e.slice(0,a)),b.isFunction(n)?(r=n,n=t):n&&typeof n=="object"&&(o="POST"),u.length>0&&b.ajax({url:e,type:o,dataType:"html",data:n}).done(function(e){s=arguments,u.html(i?b("<div>").append(b.parseHTML(e)).find(i):e)}).complete(r&&function(e,t){u.each(r,s||[e.responseText,t,e])}),this},b.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){b.fn[t]=function(e){return this.on(t,e)}}),b.each(["get","post"],function(e,n){b[n]=function(e,r,i,s){return b.isFunction(r)&&(s=s||i,i=r,r=t),b.ajax({url:e,type:n,dataType:s,data:r,success:i})}}),b.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:gn,type:"GET",isLocal:xn.test(mn[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":On,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":e.String,"text html":!0,"text json":b.parseJSON,"text xml":b.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Pn(Pn(e,b.ajaxSettings),t):Pn(b.ajaxSettings,e)},ajaxPrefilter:_n(Ln),ajaxTransport:_n(An),ajax:function(e,n){function N(e,n,r,i){var l,g,y,E,S,T=n;if(w===2)return;w=2,u&&clearTimeout(u),f=t,o=i||"",x.readyState=e>0?4:0,r&&(E=Hn(c,x,r));if(e>=200&&e<300||e===304)c.ifModified&&(S=x.getResponseHeader("Last-Modified"),S&&(b.lastModified[s]=S),S=x.getResponseHeader("etag"),S&&(b.etag[s]=S)),e===204?(l=!0,T="nocontent"):e===304?(l=!0,T="notmodified"):(l=Bn(c,E),T=l.state,g=l.data,y=l.error,l=!y);else{y=T;if(e||!T)T="error",e<0&&(e=0)}x.status=e,x.statusText=(n||T)+"",l?d.resolveWith(h,[g,T,x]):d.rejectWith(h,[x,T,y]),x.statusCode(m),m=t,a&&p.trigger(l?"ajaxSuccess":"ajaxError",[x,c,l?g:y]),v.fireWith(h,[x,T]),a&&(p.trigger("ajaxComplete",[x,c]),--b.active||b.event.trigger("ajaxStop"))}typeof e=="object"&&(n=e,e=t),n=n||{};var r,i,s,o,u,a,f,l,c=b.ajaxSetup({},n),h=c.context||c,p=c.context&&(h.nodeType||h.jquery)?b(h):b.event,d=b.Deferred(),v=b.Callbacks("once memory"),m=c.statusCode||{},g={},y={},w=0,S="canceled",x={readyState:0,getResponseHeader:function(e){var t;if(w===2){if(!l){l={};while(t=Sn.exec(o))l[t[1].toLowerCase()]=t[2]}t=l[e.toLowerCase()]}return t==null?null:t},getAllResponseHeaders:function(){return w===2?o:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return w||(e=y[n]=y[n]||e,g[e]=t),this},overrideMimeType:function(e){return w||(c.mimeType=e),this},statusCode:function(e){var t;if(e)if(w<2)for(t in e)m[t]=[m[t],e[t]];else x.always(e[x.status]);return this},abort:function(e){var t=e||S;return f&&f.abort(t),N(0,t),this}};d.promise(x).complete=v.add,x.success=x.done,x.error=x.fail,c.url=((e||c.url||gn)+"").replace(wn,"").replace(Nn,mn[1]+"//"),c.type=n.method||n.type||c.method||c.type,c.dataTypes=b.trim(c.dataType||"*").toLowerCase().match(E)||[""],c.crossDomain==null&&(r=Cn.exec(c.url.toLowerCase()),c.crossDomain=!(!r||r[1]===mn[1]&&r[2]===mn[2]&&(r[3]||(r[1]==="http:"?80:443))==(mn[3]||(mn[1]==="http:"?80:443)))),c.data&&c.processData&&typeof c.data!="string"&&(c.data=b.param(c.data,c.traditional)),Dn(Ln,c,n,x);if(w===2)return x;a=c.global,a&&b.active++===0&&b.event.trigger("ajaxStart"),c.type=c.type.toUpperCase(),c.hasContent=!Tn.test(c.type),s=c.url,c.hasContent||(c.data&&(s=c.url+=(bn.test(s)?"&":"?")+c.data,delete c.data),c.cache===!1&&(c.url=En.test(s)?s.replace(En,"$1_="+yn++):s+(bn.test(s)?"&":"?")+"_="+yn++)),c.ifModified&&(b.lastModified[s]&&x.setRequestHeader("If-Modified-Since",b.lastModified[s]),b.etag[s]&&x.setRequestHeader("If-None-Match",b.etag[s])),(c.data&&c.hasContent&&c.contentType!==!1||n.contentType)&&x.setRequestHeader("Content-Type",c.contentType),x.setRequestHeader("Accept",c.dataTypes[0]&&c.accepts[c.dataTypes[0]]?c.accepts[c.dataTypes[0]]+(c.dataTypes[0]!=="*"?", "+On+"; q=0.01":""):c.accepts["*"]);for(i in c.headers)x.setRequestHeader(i,c.headers[i]);if(!c.beforeSend||c.beforeSend.call(h,x,c)!==!1&&w!==2){S="abort";for(i in{success:1,error:1,complete:1})x[i](c[i]);f=Dn(An,c,n,x);if(!f)N(-1,"No Transport");else{x.readyState=1,a&&p.trigger("ajaxSend",[x,c]),c.async&&c.timeout>0&&(u=setTimeout(function(){x.abort("timeout")},c.timeout));try{w=1,f.send(g,N)}catch(T){if(!(w<2))throw T;N(-1,T)}}return x}return x.abort()},getScript:function(e,n){return b.get(e,t,n,"script")},getJSON:function(e,t,n){return b.get(e,t,n,"json")}}),b.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return b.globalEval(e),e}}}),b.ajaxPrefilter("script",function(e){e.cache===t&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),b.ajaxTransport("script",function(e){if(e.crossDomain){var n,r=s.head||b("head")[0]||s.documentElement;return{send:function(t,i){n=s.createElement("script"),n.async=!0,e.scriptCharset&&(n.charset=e.scriptCharset),n.src=e.url,n.onload=n.onreadystatechange=function(e,t){if(t||!n.readyState||/loaded|complete/.test(n.readyState))n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),n=null,t||i(200,"success")},r.insertBefore(n,r.firstChild)},abort:function(){n&&n.onload(t,!0)}}}});var jn=[],Fn=/(=)\?(?=&|$)|\?\?/;b.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=jn.pop()||b.expando+"_"+yn++;return this[e]=!0,e}}),b.ajaxPrefilter("json jsonp",function(n,r,i){var s,o,u,a=n.jsonp!==!1&&(Fn.test(n.url)?"url":typeof n.data=="string"&&!(n.contentType||"").indexOf("application/x-www-form-urlencoded")&&Fn.test(n.data)&&"data");if(a||n.dataTypes[0]==="jsonp")return s=n.jsonpCallback=b.isFunction(n.jsonpCallback)?n.jsonpCallback():n.jsonpCallback,a?n[a]=n[a].replace(Fn,"$1"+s):n.jsonp!==!1&&(n.url+=(bn.test(n.url)?"&":"?")+n.jsonp+"="+s),n.converters["script json"]=function(){return u||b.error(s+" was not called"),u[0]},n.dataTypes[0]="json",o=e[s],e[s]=function(){u=arguments},i.always(function(){e[s]=o,n[s]&&(n.jsonpCallback=r.jsonpCallback,jn.push(s)),u&&b.isFunction(o)&&o(u[0]),u=o=t}),"script"});var In,qn,Rn=0,Un=e.ActiveXObject&&function(){var e;for(e in In)In[e](t,!0)};b.ajaxSettings.xhr=e.ActiveXObject?function(){return!this.isLocal&&zn()||Wn()}:zn,qn=b.ajaxSettings.xhr(),b.support.cors=!!qn&&"withCredentials"in qn,qn=b.support.ajax=!!qn,qn&&b.ajaxTransport(function(n){if(!n.crossDomain||b.support.cors){var r;return{send:function(i,s){var o,u,a=n.xhr();n.username?a.open(n.type,n.url,n.async,n.username,n.password):a.open(n.type,n.url,n.async);if(n.xhrFields)for(u in n.xhrFields)a[u]=n.xhrFields[u];n.mimeType&&a.overrideMimeType&&a.overrideMimeType(n.mimeType),!n.crossDomain&&!i["X-Requested-With"]&&(i["X-Requested-With"]="XMLHttpRequest");try{for(u in i)a.setRequestHeader(u,i[u])}catch(f){}a.send(n.hasContent&&n.data||null),r=function(e,i){var u,f,l,c;try{if(r&&(i||a.readyState===4)){r=t,o&&(a.onreadystatechange=b.noop,Un&&delete In[o]);if(i)a.readyState!==4&&a.abort();else{c={},u=a.status,f=a.getAllResponseHeaders(),typeof a.responseText=="string"&&(c.text=a.responseText);try{l=a.statusText}catch(h){l=""}!u&&n.isLocal&&!n.crossDomain?u=c.text?200:404:u===1223&&(u=204)}}}catch(p){i||s(-1,p)}c&&s(u,l,c,f)},n.async?a.readyState===4?setTimeout(r):(o=++Rn,Un&&(In||(In={},b(e).unload(Un)),In[o]=r),a.onreadystatechange=r):r()},abort:function(){r&&r(t,!0)}}}});var Xn,Vn,$n=/^(?:toggle|show|hide)$/,Jn=new RegExp("^(?:([+-])=|)("+w+")([a-z%]*)$","i"),Kn=/queueHooks$/,Qn=[nr],Gn={"*":[function(e,t){var n,r,i=this.createTween(e,t),s=Jn.exec(t),o=i.cur(),u=+o||0,a=1,f=20;if(s){n=+s[2],r=s[3]||(b.cssNumber[e]?"":"px");if(r!=="px"&&u){u=b.css(i.elem,e,!0)||n||1;do a=a||".5",u/=a,b.style(i.elem,e,u+r);while(a!==(a=i.cur()/o)&&a!==1&&--f)}i.unit=r,i.start=u,i.end=s[1]?u+(s[1]+1)*n:n}return i}]};b.Animation=b.extend(er,{tweener:function(e,t){b.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");var n,r=0,i=e.length;for(;r<i;r++)n=e[r],Gn[n]=Gn[n]||[],Gn[n].unshift(t)},prefilter:function(e,t){t?Qn.unshift(e):Qn.push(e)}}),b.Tween=rr,rr.prototype={constructor:rr,init:function(e,t,n,r,i,s){this.elem=e,this.prop=n,this.easing=i||"swing",this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=s||(b.cssNumber[n]?"":"px")},cur:function(){var e=rr.propHooks[this.prop];return e&&e.get?e.get(this):rr.propHooks._default.get(this)},run:function(e){var t,n=rr.propHooks[this.prop];return this.options.duration?this.pos=t=b.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):rr.propHooks._default.set(this),this}},rr.prototype.init.prototype=rr.prototype,rr.propHooks={_default:{get:function(e){var t;return e.elem[e.prop]==null||!!e.elem.style&&e.elem.style[e.prop]!=null?(t=b.css(e.elem,e.prop,""),!t||t==="auto"?0:t):e.elem[e.prop]},set:function(e){b.fx.step[e.prop]?b.fx.step[e.prop](e):e.elem.style&&(e.elem.style[b.cssProps[e.prop]]!=null||b.cssHooks[e.prop])?b.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},rr.propHooks.scrollTop=rr.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},b.each(["toggle","show","hide"],function(e,t){var n=b.fn[t];b.fn[t]=function(e,r,i){return e==null||typeof e=="boolean"?n.apply(this,arguments):this.animate(ir(t,!0),e,r,i)}}),b.fn.extend({fadeTo:function(e,t,n,r){return this.filter(nn).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=b.isEmptyObject(e),s=b.speed(t,n,r),o=function(){var t=er(this,b.extend({},e),s);o.finish=function(){t.stop(!0)},(i||b._data(this,"finish"))&&t.stop(!0)};return o.finish=o,i||s.queue===!1?this.each(o):this.queue(s.queue,o)},stop:function(e,n,r){var i=function(e){var t=e.stop;delete e.stop,t(r)};return typeof e!="string"&&(r=n,n=e,e=t),n&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,n=e!=null&&e+"queueHooks",s=b.timers,o=b._data(this);if(n)o[n]&&o[n].stop&&i(o[n]);else for(n in o)o[n]&&o[n].stop&&Kn.test(n)&&i(o[n]);for(n=s.length;n--;)s[n].elem===this&&(e==null||s[n].queue===e)&&(s[n].anim.stop(r),t=!1,s.splice(n,1));(t||!r)&&b.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,n=b._data(this),r=n[e+"queue"],i=n[e+"queueHooks"],s=b.timers,o=r?r.length:0;n.finish=!0,b.queue(this,e,[]),i&&i.cur&&i.cur.finish&&i.cur.finish.call(this);for(t=s.length;t--;)s[t].elem===this&&s[t].queue===e&&(s[t].anim.stop(!0),s.splice(t,1));for(t=0;t<o;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish})}}),b.each({slideDown:ir("show"),slideUp:ir("hide"),slideToggle:ir("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){b.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),b.speed=function(e,t,n){var r=e&&typeof e=="object"?b.extend({},e):{complete:n||!n&&t||b.isFunction(e)&&e,duration:e,easing:n&&t||t&&!b.isFunction(t)&&t};r.duration=b.fx.off?0:typeof r.duration=="number"?r.duration:r.duration in b.fx.speeds?b.fx.speeds[r.duration]:b.fx.speeds._default;if(r.queue==null||r.queue===!0)r.queue="fx";return r.old=r.complete,r.complete=function(){b.isFunction(r.old)&&r.old.call(this),r.queue&&b.dequeue(this,r.queue)},r},b.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},b.timers=[],b.fx=rr.prototype.init,b.fx.tick=function(){var e,n=b.timers,r=0;Xn=b.now();for(;r<n.length;r++)e=n[r],!e()&&n[r]===e&&n.splice(r--,1);n.length||b.fx.stop(),Xn=t},b.fx.timer=function(e){e()&&b.timers.push(e)&&b.fx.start()},b.fx.interval=13,b.fx.start=function(){Vn||(Vn=setInterval(b.fx.tick,b.fx.interval))},b.fx.stop=function(){clearInterval(Vn),Vn=null},b.fx.speeds={slow:600,fast:200,_default:400},b.fx.step={},b.expr&&b.expr.filters&&(b.expr.filters.animated=function(e){return b.grep(b.timers,function(t){return e===t.elem}).length}),b.fn.offset=function(e){if(arguments.length)return e===t?this:this.each(function(t){b.offset.setOffset(this,e,t)});var n,r,s={top:0,left:0},o=this[0],u=o&&o.ownerDocument;if(!u)return;return n=u.documentElement,b.contains(n,o)?(typeof o.getBoundingClientRect!==i&&(s=o.getBoundingClientRect()),r=sr(u),{top:s.top+(r.pageYOffset||n.scrollTop)-(n.clientTop||0),left:s.left+(r.pageXOffset||n.scrollLeft)-(n.clientLeft||0)}):s},b.offset={setOffset:function(e,t,n){var r=b.css(e,"position");r==="static"&&(e.style.position="relative");var i=b(e),s=i.offset(),o=b.css(e,"top"),u=b.css(e,"left"),a=(r==="absolute"||r==="fixed")&&b.inArray("auto",[o,u])>-1,f={},l={},c,h;a?(l=i.position(),c=l.top,h=l.left):(c=parseFloat(o)||0,h=parseFloat(u)||0),b.isFunction(t)&&(t=t.call(e,n,s)),t.top!=null&&(f.top=t.top-s.top+c),t.left!=null&&(f.left=t.left-s.left+h),"using"in t?t.using.call(e,f):i.css(f)}},b.fn.extend({position:function(){if(!this[0])return;var e,t,n={top:0,left:0},r=this[0];return b.css(r,"position")==="fixed"?t=r.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),b.nodeName(e[0],"html")||(n=e.offset()),n.top+=b.css(e[0],"borderTopWidth",!0),n.left+=b.css(e[0],"borderLeftWidth",!0)),{top:t.top-n.top-b.css(r,"marginTop",!0),left:t.left-n.left-b.css(r,"marginLeft",!0)}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||s.documentElement;while(e&&!b.nodeName(e,"html")&&b.css(e,"position")==="static")e=e.offsetParent;return e||s.documentElement})}}),b.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,n){var r=/Y/.test(n);b.fn[e]=function(i){return b.access(this,function(e,i,s){var o=sr(e);if(s===t)return o?n in o?o[n]:o.document.documentElement[i]:e[i];o?o.scrollTo(r?b(o).scrollLeft():s,r?s:b(o).scrollTop()):e[i]=s},e,i,arguments.length,null)}}),b.each({Height:"height",Width:"width"},function(e,n){b.each({padding:"inner"+e,content:n,"":"outer"+e},function(r,i){b.fn[i]=function(i,s){var o=arguments.length&&(r||typeof i!="boolean"),u=r||(i===!0||s===!0?"margin":"border");return b.access(this,function(n,r,i){var s;return b.isWindow(n)?n.document.documentElement["client"+e]:n.nodeType===9?(s=n.documentElement,Math.max(n.body["scroll"+e],s["scroll"+e],n.body["offset"+e],s["offset"+e],s["client"+e])):i===t?b.css(n,r,u):b.style(n,r,i,u)},n,o?i:t,o,null)}})}),e.jQuery=e.$=b,typeof define=="function"&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return b})})(window);var THREE=THREE||{REVISION:"57"};self.console=self.console||{info:function(){},log:function(){},debug:function(){},warn:function(){},error:function(){}},self.Int32Array=self.Int32Array||Array,self.Float32Array=self.Float32Array||Array,String.prototype.trim=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")},THREE.extend=function(e,t){if(Object.keys)for(var n=Object.keys(t),r=0,i=n.length;r<i;r++){var s=n[r];Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(t,s))}else for(s in n={}.hasOwnProperty,t)n.call(t,s)&&(e[s]=t[s]);return e},function(){for(var e=0,t=["ms","moz","webkit","o"],n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];void 0===window.requestAnimationFrame&&(window.requestAnimationFrame=function(t){var n=Date.now(),r=Math.max(0,16-(n-e)),i=window.setTimeout(function(){t(n+r)},r);return e=n+r,i}),window.cancelAnimationFrame=window.cancelAnimationFrame||function(e){window.clearTimeout(e)}}(),THREE.CullFaceNone=0,THREE.CullFaceBack=1,THREE.CullFaceFront=2,THREE.CullFaceFrontBack=3,THREE.FrontFaceDirectionCW=0,THREE.FrontFaceDirectionCCW=1,THREE.BasicShadowMap=0,THREE.PCFShadowMap=1,THREE.PCFSoftShadowMap=2,THREE.FrontSide=0,THREE.BackSide=1,THREE.DoubleSide=2,THREE.NoShading=0,THREE.FlatShading=1,THREE.SmoothShading=2,THREE.NoColors=0,THREE.FaceColors=1,THREE.VertexColors=2,THREE.NoBlending=0,THREE.NormalBlending=1,THREE.AdditiveBlending=2,THREE.SubtractiveBlending=3,THREE.MultiplyBlending=4,THREE.CustomBlending=5,THREE.AddEquation=100,THREE.SubtractEquation=101,THREE.ReverseSubtractEquation=102,THREE.ZeroFactor=200,THREE.OneFactor=201,THREE.SrcColorFactor=202,THREE.OneMinusSrcColorFactor=203,THREE.SrcAlphaFactor=204,THREE.OneMinusSrcAlphaFactor=205,THREE.DstAlphaFactor=206,THREE.OneMinusDstAlphaFactor=207,THREE.DstColorFactor=208,THREE.OneMinusDstColorFactor=209,THREE.SrcAlphaSaturateFactor=210,THREE.MultiplyOperation=0,THREE.MixOperation=1,THREE.AddOperation=2,THREE.UVMapping=function(){},THREE.CubeReflectionMapping=function(){},THREE.CubeRefractionMapping=function(){},THREE.SphericalReflectionMapping=function(){},THREE.SphericalRefractionMapping=function(){},THREE.RepeatWrapping=1e3,THREE.ClampToEdgeWrapping=1001,THREE.MirroredRepeatWrapping=1002,THREE.NearestFilter=1003,THREE.NearestMipMapNearestFilter=1004,THREE.NearestMipMapLinearFilter=1005,THREE.LinearFilter=1006,THREE.LinearMipMapNearestFilter=1007,THREE.LinearMipMapLinearFilter=1008,THREE.UnsignedByteType=1009,THREE.ByteType=1010,THREE.ShortType=1011,THREE.UnsignedShortType=1012,THREE.IntType=1013,THREE.UnsignedIntType=1014,THREE.FloatType=1015,THREE.UnsignedShort4444Type=1016,THREE.UnsignedShort5551Type=1017,THREE.UnsignedShort565Type=1018,THREE.AlphaFormat=1019,THREE.RGBFormat=1020,THREE.RGBAFormat=1021,THREE.LuminanceFormat=1022,THREE.LuminanceAlphaFormat=1023,THREE.RGB_S3TC_DXT1_Format=2001,THREE.RGBA_S3TC_DXT1_Format=2002,THREE.RGBA_S3TC_DXT3_Format=2003,THREE.RGBA_S3TC_DXT5_Format=2004,THREE.Color=function(e){return void 0!==e&&this.set(e),this},THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,set:function(e){switch(typeof e){case"number":this.setHex(e);break;case"string":this.setStyle(e)}},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,this},setRGB:function(e,t,n){return this.r=e,this.g=t,this.b=n,this},setHSL:function(e,t,n){if(0===t)this.r=this.g=this.b=n;else{var r=function(e,t,n){return 0>n&&(n+=1),1<n&&(n-=1),n<1/6?e+6*(t-e)*n:.5>n?t:n<2/3?e+6*(t-e)*(2/3-n):e},t=.5>=n?n*(1+t):n+t-n*t,n=2*n-t;this.r=r(n,t,e+1/3),this.g=r(n,t,e),this.b=r(n,t,e-1/3)}return this},setStyle:function(e){if(/^rgb\((\d+),(\d+),(\d+)\)$/i.test(e))return e=/^rgb\((\d+),(\d+),(\d+)\)$/i.exec(e),this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,this;if(/^rgb\((\d+)\%,(\d+)\%,(\d+)\%\)$/i.test(e))return e=/^rgb\((\d+)\%,(\d+)\%,(\d+)\%\)$/i.exec(e),this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,this;if(/^\#([0-9a-f]{6})$/i.test(e))return e=/^\#([0-9a-f]{6})$/i.exec(e),this.setHex(parseInt(e[1],16)),this;if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(e))return e=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(e),this.setHex(parseInt(e[1]+e[1]+e[2]+e[2]+e[3]+e[3],16)),this;if(/^(\w+)$/i.test(e))return this.setHex(THREE.ColorKeywords[e]),this},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e){return this.r=e.r*e.r,this.g=e.g*e.g,this.b=e.b*e.b,this},copyLinearToGamma:function(e){return this.r=Math.sqrt(e.r),this.g=Math.sqrt(e.g),this.b=Math.sqrt(e.b),this},convertGammaToLinear:function(){var e=this.r,t=this.g,n=this.b;return this.r=e*e,this.g=t*t,this.b=n*n,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(){var e={h:0,s:0,l:0};return function(){var t=this.r,n=this.g,r=this.b,i=Math.max(t,n,r),s=Math.min(t,n,r),o,u=(s+i)/2;if(s===i)s=o=0;else{var f=i-s,s=.5>=u?f/(i+s):f/(2-i-s);switch(i){case t:o=(n-r)/f+(n<r?6:0);break;case n:o=(r-t)/f+2;break;case r:o=(t-n)/f+4}o/=6}return e.h=o,e.s=s,e.l=u,e}}(),getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(e,t,n){var r=this.getHSL();return r.h+=e,r.s+=t,r.l+=n,this.setHSL(r.h,r.s,r.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},clone:function(){return(new THREE.Color).setRGB(this.r,this.g,this.b)}},THREE.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},THREE.Quaternion=function(e,t,n,r){this.x=e||0,this.y=t||0,this.z=n||0,this.w=void 0!==r?r:1},THREE.Quaternion.prototype={constructor:THREE.Quaternion,set:function(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},setFromEuler:function(e,t){var n=Math.cos(e.x/2),r=Math.cos(e.y/2),i=Math.cos(e.z/2),s=Math.sin(e.x/2),o=Math.sin(e.y/2),u=Math.sin(e.z/2);return void 0===t||"XYZ"===t?(this.x=s*r*i+n*o*u,this.y=n*o*i-s*r*u,this.z=n*r*u+s*o*i,this.w=n*r*i-s*o*u):"YXZ"===t?(this.x=s*r*i+n*o*u,this.y=n*o*i-s*r*u,this.z=n*r*u-s*o*i,this.w=n*r*i+s*o*u):"ZXY"===t?(this.x=s*r*i-n*o*u,this.y=n*o*i+s*r*u,this.z=n*r*u+s*o*i,this.w=n*r*i-s*o*u):"ZYX"===t?(this.x=s*r*i-n*o*u,this.y=n*o*i+s*r*u,this.z=n*r*u-s*o*i,this.w=n*r*i+s*o*u):"YZX"===t?(this.x=s*r*i+n*o*u,this.y=n*o*i+s*r*u,this.z=n*r*u-s*o*i,this.w=n*r*i-s*o*u):"XZY"===t&&(this.x=s*r*i-n*o*u,this.y=n*o*i-s*r*u,this.z=n*r*u+s*o*i,this.w=n*r*i+s*o*u),this},setFromAxisAngle:function(e,t){var n=t/2,r=Math.sin(n);return this.x=e.x*r,this.y=e.y*r,this.z=e.z*r,this.w=Math.cos(n),this},setFromRotationMatrix:function(e){var t=e.elements,n=t[0],e=t[4],r=t[8],i=t[1],s=t[5],o=t[9],u=t[2],a=t[6],t=t[10],f=n+s+t;return 0<f?(n=.5/Math.sqrt(f+1),this.w=.25/n,this.x=(a-o)*n,this.y=(r-u)*n,this.z=(i-e)*n):n>s&&n>t?(n=2*Math.sqrt(1+n-s-t),this.w=(a-o)/n,this.x=.25*n,this.y=(e+i)/n,this.z=(r+u)/n):s>t?(n=2*Math.sqrt(1+s-n-t),this.w=(r-u)/n,this.x=(e+i)/n,this.y=.25*n,this.z=(o+a)/n):(n=2*Math.sqrt(1+t-n-s),this.w=(i-e)/n,this.x=(r+u)/n,this.y=(o+a)/n,this.z=.25*n),this},inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var e=this.length();return 0===e?(this.z=this.y=this.x=0,this.w=1):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this},multiply:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Quaternion's .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var n=e.x,r=e.y,i=e.z,s=e.w,o=t.x,u=t.y,a=t.z,f=t.w;return this.x=n*f+s*o+r*a-i*u,this.y=r*f+s*u+i*o-n*a,this.z=i*f+s*a+n*u-r*o,this.w=s*f-n*o-r*u-i*a,this},multiplyVector3:function(e){return console.warn("DEPRECATED: Quaternion's .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},slerp:function(e,t){var n=this.x,r=this.y,i=this.z,s=this.w,o=s*e.w+n*e.x+r*e.y+i*e.z;0>o?(this.w=-e.w,this.x=-e.x,this.y=-e.y,this.z=-e.z,o=-o):this.copy(e);if(1<=o)return this.w=s,this.x=n,this.y=r,this.z=i,this;var u=Math.acos(o),a=Math.sqrt(1-o*o);return.001>Math.abs(a)?(this.w=.5*(s+this.w),this.x=.5*(n+this.x),this.y=.5*(r+this.y),this.z=.5*(i+this.z),this):(o=Math.sin((1-t)*u)/a,u=Math.sin(t*u)/a,this.w=s*o+this.w*u,this.x=n*o+this.x*u,this.y=r*o+this.y*u,this.z=i*o+this.z*u,this)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},clone:function(){return new THREE.Quaternion(this.x,this.y,this.z,this.w)}},THREE.Quaternion.slerp=function(e,t,n,r){return n.copy(e).slerp(t,r)},THREE.Vector2=function(e,t){this.x=e||0,this.y=t||0},THREE.Vector2.prototype={constructor:THREE.Vector2,set:function(e,t){return this.x=e,this.y=t,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector2's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScalar:function(e){return this.x+=e,this.y+=e,this},sub:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector2's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divideScalar:function(e){return 0!==e?(this.x/=e,this.y/=e):this.set(0,0),this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,e=this.y-e.y;return t*t+e*e},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y},toArray:function(){return[this.x,this.y]},clone:function(){return new THREE.Vector2(this.x,this.y)}},THREE.Vector3=function(e,t,n){this.x=e||0,this.y=t||0,this.z=n||0},THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(e,t,n){return this.x=e,this.y=t,this.z=n,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},sub:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyMatrix3:function(e){var t=this.x,n=this.y,r=this.z,e=e.elements;return this.x=e[0]*t+e[3]*n+e[6]*r,this.y=e[1]*t+e[4]*n+e[7]*r,this.z=e[2]*t+e[5]*n+e[8]*r,this},applyMatrix4:function(e){var t=this.x,n=this.y,r=this.z,e=e.elements;return this.x=e[0]*t+e[4]*n+e[8]*r+e[12],this.y=e[1]*t+e[5]*n+e[9]*r+e[13],this.z=e[2]*t+e[6]*n+e[10]*r+e[14],this},applyProjection:function(e){var t=this.x,n=this.y,r=this.z,e=e.elements,i=1/(e[3]*t+e[7]*n+e[11]*r+e[15]);return this.x=(e[0]*t+e[4]*n+e[8]*r+e[12])*i,this.y=(e[1]*t+e[5]*n+e[9]*r+e[13])*i,this.z=(e[2]*t+e[6]*n+e[10]*r+e[14])*i,this},applyQuaternion:function(e){var t=this.x,n=this.y,r=this.z,i=e.x,s=e.y,o=e.z,e=e.w,u=e*t+s*r-o*n,a=e*n+o*t-i*r,f=e*r+i*n-s*t,t=-i*t-s*n-o*r;return this.x=u*e+t*-i+a*-o-f*-s,this.y=a*e+t*-s+f*-i-u*-o,this.z=f*e+t*-o+u*-s-a*-i,this},transformDirection:function(e){var t=this.x,n=this.y,r=this.z,e=e.elements;return this.x=e[0]*t+e[4]*n+e[8]*r,this.y=e[1]*t+e[5]*n+e[9]*r,this.z=e[2]*t+e[6]*n+e[10]*r,this.normalize(),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return 0!==e?(this.x/=e,this.y/=e,this.z/=e):this.z=this.y=this.x=0,this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},cross:function(e,t){if(void 0!==t)return console.warn("DEPRECATED: Vector3's .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var n=this.x,r=this.y,i=this.z;return this.x=r*e.z-i*e.y,this.y=i*e.x-n*e.z,this.z=n*e.y-r*e.x,this},crossVectors:function(e,t){return this.x=e.y*t.z-e.z*t.y,this.y=e.z*t.x-e.x*t.z,this.z=e.x*t.y-e.y*t.x,this},angleTo:function(e){return e=this.dot(e)/(this.length()*e.length()),Math.acos(THREE.Math.clamp(e,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y,e=this.z-e.z;return t*t+n*n+e*e},setEulerFromRotationMatrix:function(e,t){function n(e){return Math.min(Math.max(e,-1),1)}var r=e.elements,i=r[0],s=r[4],o=r[8],u=r[1],a=r[5],f=r[9],l=r[2],c=r[6],r=r[10];return void 0===t||"XYZ"===t?(this.y=Math.asin(n(o)),.99999>Math.abs(o)?(this.x=Math.atan2(-f,r),this.z=Math.atan2(-s,i)):(this.x=Math.atan2(c,a),this.z=0)):"YXZ"===t?(this.x=Math.asin(-n(f)),.99999>Math.abs(f)?(this.y=Math.atan2(o,r),this.z=Math.atan2(u,a)):(this.y=Math.atan2(-l,i),this.z=0)):"ZXY"===t?(this.x=Math.asin(n(c)),.99999>Math.abs(c)?(this.y=Math.atan2(-l,r),this.z=Math.atan2(-s,a)):(this.y=0,this.z=Math.atan2(u,i))):"ZYX"===t?(this.y=Math.asin(-n(l)),.99999>Math.abs(l)?(this.x=Math.atan2(c,r),this.z=Math.atan2(u,i)):(this.x=0,this.z=Math.atan2(-s,a))):"YZX"===t?(this.z=Math.asin(n(u)),.99999>Math.abs(u)?(this.x=Math.atan2(-f,a),this.y=Math.atan2(-l,i)):(this.x=0,this.y=Math.atan2(o,r))):"XZY"===t&&(this.z=Math.asin(-n(s)),.99999>Math.abs(s)?(this.x=Math.atan2(c,a),this.y=Math.atan2(o,i)):(this.x=Math.atan2(-f,r),this.y=0)),this},setEulerFromQuaternion:function(e,t){function n(e){return Math.min(Math.max(e,-1),1)}var r=e.x*e.x,i=e.y*e.y,s=e.z*e.z,o=e.w*e.w;return void 0===t||"XYZ"===t?(this.x=Math.atan2(2*(e.x*e.w-e.y*e.z),o-r-i+s),this.y=Math.asin(n(2*(e.x*e.z+e.y*e.w))),this.z=Math.atan2(2*(e.z*e.w-e.x*e.y),o+r-i-s)):"YXZ"===t?(this.x=Math.asin(n(2*(e.x*e.w-e.y*e.z))),this.y=Math.atan2(2*(e.x*e.z+e.y*e.w),o-r-i+s),this.z=Math.atan2(2*(e.x*e.y+e.z*e.w),o-r+i-s)):"ZXY"===t?(this.x=Math.asin(n(2*(e.x*e.w+e.y*e.z))),this.y=Math.atan2(2*(e.y*e.w-e.z*e.x),o-r-i+s),this.z=Math.atan2(2*(e.z*e.w-e.x*e.y),o-r+i-s)):"ZYX"===t?(this.x=Math.atan2(2*(e.x*e.w+e.z*e.y),o-r-i+s),this.y=Math.asin(n(2*(e.y*e.w-e.x*e.z))),this.z=Math.atan2(2*(e.x*e.y+e.z*e.w),o+r-i-s)):"YZX"===t?(this.x=Math.atan2(2*(e.x*e.w-e.z*e.y),o-r+i-s),this.y=Math.atan2(2*(e.y*e.w-e.x*e.z),o+r-i-s),this.z=Math.asin(n(2*(e.x*e.y+e.z*e.w)))):"XZY"===t&&(this.x=Math.atan2(2*(e.x*e.w+e.y*e.z),o-r+i-s),this.y=Math.atan2(2*(e.x*e.z+e.y*e.w),o+r-i-s),this.z=Math.asin(n(2*(e.z*e.w-e.x*e.y)))),this},getPositionFromMatrix:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},getScaleFromMatrix:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),n=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),e=this.set(e.elements[8],e.elements[9],e.elements[10]).length();return this.x=t,this.y=n,this.z=e,this},getColumnFromMatrix:function(e,t){var n=4*e,r=t.elements;return this.x=r[n],this.y=r[n+1],this.z=r[n+2],this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},toArray:function(){return[this.x,this.y,this.z]},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)}},THREE.extend(THREE.Vector3.prototype,{applyEuler:function(){var e=new THREE.Quaternion;return function(t,n){var r=e.setFromEuler(t,n);return this.applyQuaternion(r),this}}(),applyAxisAngle:function(){var e=new THREE.Quaternion;return function(t,n){var r=e.setFromAxisAngle(t,n);return this.applyQuaternion(r),this}}(),projectOnVector:function(){var e=new THREE.Vector3;return function(t){return e.copy(t).normalize(),t=this.dot(e),this.copy(e).multiplyScalar(t)}}(),projectOnPlane:function(){var e=new THREE.Vector3;return function(t){return e.copy(this).projectOnVector(t),this.sub(e)}}(),reflect:function(){var e=new THREE.Vector3;return function(t){return e.copy(this).projectOnVector(t).multiplyScalar(2),this.subVectors(e,this)}}()}),THREE.Vector4=function(e,t,n,r){this.x=e||0,this.y=t||0,this.z=n||0,this.w=void 0!==r?r:1},THREE.Vector4.prototype={constructor:THREE.Vector4,set:function(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector4's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},sub:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector4's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,n=this.y,r=this.z,i=this.w,e=e.elements;return this.x=e[0]*t+e[4]*n+e[8]*r+e[12]*i,this.y=e[1]*t+e[5]*n+e[9]*r+e[13]*i,this.z=e[2]*t+e[6]*n+e[10]*r+e[14]*i,this.w=e[3]*t+e[7]*n+e[11]*r+e[15]*i,this},divideScalar:function(e){return 0!==e?(this.x/=e,this.y/=e,this.z/=e,this.w/=e):(this.z=this.y=this.x=0,this.w=1),this},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return 1e-4>t?(this.x=1,this.z=this.y=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,n,r,e=e.elements,i=e[0];r=e[4];var s=e[8],o=e[1],u=e[5],a=e[9];n=e[2],t=e[6];var f=e[10];return.01>Math.abs(r-o)&&.01>Math.abs(s-n)&&.01>Math.abs(a-t)?.1>Math.abs(r+o)&&.1>Math.abs(s+n)&&.1>Math.abs(a+t)&&.1>Math.abs(i+u+f-3)?(this.set(1,0,0,0),this):(e=Math.PI,i=(i+1)/2,u=(u+1)/2,f=(f+1)/2,r=(r+o)/4,s=(s+n)/4,a=(a+t)/4,i>u&&i>f?.01>i?(t=0,r=n=.707106781):(t=Math.sqrt(i),n=r/t,r=s/t):u>f?.01>u?(t=.707106781,n=0,r=.707106781):(n=Math.sqrt(u),t=r/n,r=a/n):.01>f?(n=t=.707106781,r=0):(r=Math.sqrt(f),t=s/r,n=a/r),this.set(t,n,r,e),this):(e=Math.sqrt((t-a)*(t-a)+(s-n)*(s-n)+(o-r)*(o-r)),.001>Math.abs(e)&&(e=1),this.x=(t-a)/e,this.y=(s-n)/e,this.z=(o-r)/e,this.w=Math.acos((i+u+f-1)/2),this)},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this.w>e.w&&(this.w=e.w),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this.w<e.w&&(this.w=e.w),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this.w<e.w?this.w=e.w:this.w>t.w&&(this.w=t.w),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},toArray:function(){return[this.x,this.y,this.z,this.w]},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)}},THREE.Line3=function(e,t){this.start=void 0!==e?e:new THREE.Vector3,this.end=void 0!==t?t:new THREE.Vector3},THREE.Line3.prototype={constructor:THREE.Line3,set:function(e,t){return this.start.copy(e),this.end.copy(t),this},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},center:function(e){return(e||new THREE.Vector3).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return(e||new THREE.Vector3).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){var n=t||new THREE.Vector3;return this.delta(n).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(n,r){e.subVectors(n,this.start),t.subVectors(this.end,this.start);var i=t.dot(t),i=t.dot(e)/i;return r&&(i=THREE.Math.clamp(i,0,1)),i}}(),closestPointToPoint:function(e,t,n){return e=this.closestPointToPointParameter(e,t),n=n||new THREE.Vector3,this.delta(n).multiplyScalar(e).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)},clone:function(){return(new THREE.Line3).copy(this)}},THREE.Box2=function(e,t){this.min=void 0!==e?e:new THREE.Vector2(Infinity,Infinity),this.max=void 0!==t?t:new THREE.Vector2(-Infinity,-Infinity)},THREE.Box2.prototype={constructor:THREE.Box2,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){if(0<e.length){var t=e[0];this.min.copy(t),this.max.copy(t);for(var n=1,r=e.length;n<r;n++)t=e[n],t.x<this.min.x?this.min.x=t.x:t.x>this.max.x&&(this.max.x=t.x),t.y<this.min.y?this.min.y=t.y:t.y>this.max.y&&(this.max.y=t.y)}else this.makeEmpty();return this},setFromCenterAndSize:function(){var e=new THREE.Vector2;return function(t,n){var r=e.copy(n).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=Infinity,this.max.x=this.max.y=-Infinity,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(e){return(e||new THREE.Vector2).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){return(e||new THREE.Vector2).subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y?!1:!0},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y?!0:!1},getParameter:function(e){return new THREE.Vector2((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(e){return e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y?!1:!0},clampPoint:function(e,t){return(t||new THREE.Vector2).copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new THREE.Vector2;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new THREE.Box2).copy(this)}},THREE.Box3=function(e,t){this.min=void 0!==e?e:new THREE.Vector3(Infinity,Infinity,Infinity),this.max=void 0!==t?t:new THREE.Vector3(-Infinity,-Infinity,-Infinity)},THREE.Box3.prototype={constructor:THREE.Box3,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){if(0<e.length){var t=e[0];this.min.copy(t),this.max.copy(t);for(var n=1,r=e.length;n<r;n++)t=e[n],t.x<this.min.x?this.min.x=t.x:t.x>this.max.x&&(this.max.x=t.x),t.y<this.min.y?this.min.y=t.y:t.y>this.max.y&&(this.max.y=t.y),t.z<this.min.z?this.min.z=t.z:t.z>this.max.z&&(this.max.z=t.z)}else this.makeEmpty();return this},setFromCenterAndSize:function(){var e=new THREE.Vector3;return function(t,n){var r=e.copy(n).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=Infinity,this.max.x=this.max.y=this.max.z=-Infinity,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(e){return(e||new THREE.Vector3).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){return(e||new THREE.Vector3).subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z?!1:!0},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z?!0:!1},getParameter:function(e){return new THREE.Vector3((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(e){return e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z?!1:!0},clampPoint:function(e,t){return(t||new THREE.Vector3).copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new THREE.Vector3;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),getBoundingSphere:function(){var e=new THREE.Vector3;return function(t){return t=t||new THREE.Sphere,t.center=this.center(),t.radius=.5*this.size(e).length(),t}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(){var e=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];return function(t){return e[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),e[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),e[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),e[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),e[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),e[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),e[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),e[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.makeEmpty(),this.setFromPoints(e),this}}(),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new THREE.Box3).copy(this)}},THREE.Matrix3=function(e,t,n,r,i,s,o,u,a){this.elements=new Float32Array(9),this.set(void 0!==e?e:1,t||0,n||0,r||0,void 0!==i?i:1,s||0,o||0,u||0,void 0!==a?a:1)},THREE.Matrix3.prototype={constructor:THREE.Matrix3,set:function(e,t,n,r,i,s,o,u,a){var f=this.elements;return f[0]=e,f[3]=t,f[6]=n,f[1]=r,f[4]=i,f[7]=s,f[2]=o,f[5]=u,f[8]=a,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},copy:function(e){return e=e.elements,this.set(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8]),this},multiplyVector3:function(e){return console.warn("DEPRECATED: Matrix3's .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){var e=new THREE.Vector3;return function(t){for(var n=0,r=t.length;n<r;n+=3)e.x=t[n],e.y=t[n+1],e.z=t[n+2],e.applyMatrix3(this),t[n]=e.x,t[n+1]=e.y,t[n+2]=e.z;return t}}(),multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5],u=e[6],a=e[7],e=e[8];return t*s*e-t*o*a-n*i*e+n*o*u+r*i*a-r*s*u},getInverse:function(e,t){var n=e.elements,r=this.elements;r[0]=n[10]*n[5]-n[6]*n[9],r[1]=-n[10]*n[1]+n[2]*n[9],r[2]=n[6]*n[1]-n[2]*n[5],r[3]=-n[10]*n[4]+n[6]*n[8],r[4]=n[10]*n[0]-n[2]*n[8],r[5]=-n[6]*n[0]+n[2]*n[4],r[6]=n[9]*n[4]-n[5]*n[8],r[7]=-n[9]*n[0]+n[1]*n[8],r[8]=n[5]*n[0]-n[1]*n[4],n=n[0]*r[0]+n[1]*r[3]+n[2]*r[6];if(0===n){if(t)throw Error("Matrix3.getInverse(): can't invert matrix, determinant is 0");return console.warn("Matrix3.getInverse(): can't invert matrix, determinant is 0"),this.identity(),this}return this.multiplyScalar(1/n),this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.getInverse(e).transpose(),this},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},clone:function(){var e=this.elements;return new THREE.Matrix3(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8])}},THREE.Matrix4=function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){var m=this.elements=new Float32Array(16);m[0]=void 0!==e?e:1,m[4]=t||0,m[8]=n||0,m[12]=r||0,m[1]=i||0,m[5]=void 0!==s?s:1,m[9]=o||0,m[13]=u||0,m[2]=a||0,m[6]=f||0,m[10]=void 0!==l?l:1,m[14]=c||0,m[3]=h||0,m[7]=p||0,m[11]=d||0,m[15]=void 0!==v?v:1},THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){var m=this.elements;return m[0]=e,m[4]=t,m[8]=n,m[12]=r,m[1]=i,m[5]=s,m[9]=o,m[13]=u,m[2]=a,m[6]=f,m[10]=l,m[14]=c,m[3]=h,m[7]=p,m[11]=d,m[15]=v,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){return e=e.elements,this.set(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]),this},setRotationFromEuler:function(e,t){var n=this.elements,r=e.x,i=e.y,s=e.z,o=Math.cos(r),r=Math.sin(r),u=Math.cos(i),i=Math.sin(i),a=Math.cos(s),s=Math.sin(s);if(void 0===t||"XYZ"===t){var f=o*a,l=o*s,c=r*a,h=r*s;n[0]=u*a,n[4]=-u*s,n[8]=i,n[1]=l+c*i,n[5]=f-h*i,n[9]=-r*u,n[2]=h-f*i,n[6]=c+l*i,n[10]=o*u}else"YXZ"===t?(f=u*a,l=u*s,c=i*a,h=i*s,n[0]=f+h*r,n[4]=c*r-l,n[8]=o*i,n[1]=o*s,n[5]=o*a,n[9]=-r,n[2]=l*r-c,n[6]=h+f*r,n[10]=o*u):"ZXY"===t?(f=u*a,l=u*s,c=i*a,h=i*s,n[0]=f-h*r,n[4]=-o*s,n[8]=c+l*r,n[1]=l+c*r,n[5]=o*a,n[9]=h-f*r,n[2]=-o*i,n[6]=r,n[10]=o*u):"ZYX"===t?(f=o*a,l=o*s,c=r*a,h=r*s,n[0]=u*a,n[4]=c*i-l,n[8]=f*i+h,n[1]=u*s,n[5]=h*i+f,n[9]=l*i-c,n[2]=-i,n[6]=r*u,n[10]=o*u):"YZX"===t?(f=o*u,l=o*i,c=r*u,h=r*i,n[0]=u*a,n[4]=h-f*s,n[8]=c*s+l,n[1]=s,n[5]=o*a,n[9]=-r*a,n[2]=-i*a,n[6]=l*s+c,n[10]=f-h*s):"XZY"===t&&(f=o*u,l=o*i,c=r*u,h=r*i,n[0]=u*a,n[4]=-s,n[8]=i*a,n[1]=f*s+h,n[5]=o*a,n[9]=l*s-c,n[2]=c*s-l,n[6]=r*a,n[10]=h*s+f);return this},setRotationFromQuaternion:function(e){var t=this.elements,n=e.x,r=e.y,i=e.z,s=e.w,o=n+n,u=r+r,a=i+i,e=n*o,f=n*u,n=n*a,l=r*u,r=r*a,i=i*a,o=s*o,u=s*u,s=s*a;return t[0]=1-(l+i),t[4]=f-s,t[8]=n+u,t[1]=f+s,t[5]=1-(e+i),t[9]=r-o,t[2]=n-u,t[6]=r+o,t[10]=1-(e+l),this},lookAt:function(){var e=new THREE.Vector3,t=new THREE.Vector3,n=new THREE.Vector3;return function(r,i,s){var o=this.elements;return n.subVectors(r,i).normalize(),0===n.length()&&(n.z=1),e.crossVectors(s,n).normalize(),0===e.length()&&(n.x+=1e-4,e.crossVectors(s,n).normalize()),t.crossVectors(n,e),o[0]=e.x,o[4]=t.x,o[8]=n.x,o[1]=e.y,o[5]=t.y,o[9]=n.y,o[2]=e.z,o[6]=t.z,o[10]=n.z,this}}(),multiply:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Matrix4's .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},multiplyMatrices:function(e,t){var n=e.elements,r=t.elements,i=this.elements,s=n[0],o=n[4],u=n[8],a=n[12],f=n[1],l=n[5],c=n[9],h=n[13],p=n[2],d=n[6],v=n[10],m=n[14],g=n[3],y=n[7],b=n[11],n=n[15],w=r[0],E=r[4],S=r[8],x=r[12],T=r[1],N=r[5],C=r[9],k=r[13],L=r[2],A=r[6],O=r[10],M=r[14],_=r[3],D=r[7],P=r[11],r=r[15];return i[0]=s*w+o*T+u*L+a*_,i[4]=s*E+o*N+u*A+a*D,i[8]=s*S+o*C+u*O+a*P,i[12]=s*x+o*k+u*M+a*r,i[1]=f*w+l*T+c*L+h*_,i[5]=f*E+l*N+c*A+h*D,i[9]=f*S+l*C+c*O+h*P,i[13]=f*x+l*k+c*M+h*r,i[2]=p*w+d*T+v*L+m*_,i[6]=p*E+d*N+v*A+m*D,i[10]=p*S+d*C+v*O+m*P,i[14]=p*x+d*k+v*M+m*r,i[3]=g*w+y*T+b*L+n*_,i[7]=g*E+y*N+b*A+n*D,i[11]=g*S+y*C+b*O+n*P,i[15]=g*x+y*k+b*M+n*r,this},multiplyToArray:function(e,t,n){var r=this.elements;return this.multiplyMatrices(e,t),n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],n[9]=r[9],n[10]=r[10],n[11]=r[11],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15],this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},multiplyVector3:function(e){return console.warn("DEPRECATED: Matrix4's .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead."),e.applyProjection(this)},multiplyVector4:function(e){return console.warn("DEPRECATED: Matrix4's .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){var e=new THREE.Vector3;return function(t){for(var n=0,r=t.length;n<r;n+=3)e.x=t[n],e.y=t[n+1],e.z=t[n+2],e.applyProjection(this),t[n]=e.x,t[n+1]=e.y,t[n+2]=e.z;return t}}(),rotateAxis:function(e){console.warn("DEPRECATED: Matrix4's .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){var t=this.elements,n=new THREE.Vector4;return n.x=t[0]*e.x+t[4]*e.y+t[8]*e.z+t[12]*e.w,n.y=t[1]*e.x+t[5]*e.y+t[9]*e.z+t[13]*e.w,n.z=t[2]*e.x+t[6]*e.y+t[10]*e.z+t[14]*e.w,n.w=e.w?t[3]*e.x+t[7]*e.y+t[11]*e.z+t[15]*e.w:1,n},determinant:function(){var e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],s=e[1],o=e[5],u=e[9],a=e[13],f=e[2],l=e[6],c=e[10],h=e[14];return e[3]*(+i*u*l-r*a*l-i*o*c+n*a*c+r*o*h-n*u*h)+e[7]*(+t*u*h-t*a*c+i*s*c-r*s*h+r*a*f-i*u*f)+e[11]*(+t*a*l-t*o*h-i*s*l+n*s*h+i*o*f-n*a*f)+e[15]*(-r*o*f-t*u*l+t*o*c+r*s*l-n*s*c+n*u*f)},transpose:function(){var e=this.elements,t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},flattenToArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},flattenToArrayOffset:function(e,t){var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e},getPosition:function(){var e=new THREE.Vector3;return function(){console.warn("DEPRECATED: Matrix4's .getPosition() has been removed. Use Vector3.getPositionFromMatrix( matrix ) instead.");var t=this.elements;return e.set(t[12],t[13],t[14])}}(),setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var n=this.elements,r=e.elements,i=r[0],s=r[4],o=r[8],u=r[12],a=r[1],f=r[5],l=r[9],c=r[13],h=r[2],p=r[6],d=r[10],v=r[14],m=r[3],g=r[7],y=r[11],b=r[15];n[0]=l*v*g-c*d*g+c*p*y-f*v*y-l*p*b+f*d*b,n[4]=u*d*g-o*v*g-u*p*y+s*v*y+o*p*b-s*d*b,n[8]=o*c*g-u*l*g+u*f*y-s*c*y-o*f*b+s*l*b,n[12]=u*l*p-o*c*p-u*f*d+s*c*d+o*f*v-s*l*v,n[1]=c*d*m-l*v*m-c*h*y+a*v*y+l*h*b-a*d*b,n[5]=o*v*m-u*d*m+u*h*y-i*v*y-o*h*b+i*d*b,n[9]=u*l*m-o*c*m-u*a*y+i*c*y+o*a*b-i*l*b,n[13]=o*c*h-u*l*h+u*a*d-i*c*d-o*a*v+i*l*v,n[2]=f*v*m-c*p*m+c*h*g-a*v*g-f*h*b+a*p*b,n[6]=u*p*m-s*v*m-u*h*g+i*v*g+s*h*b-i*p*b,n[10]=s*c*m-u*f*m+u*a*g-i*c*g-s*a*b+i*f*b,n[14]=u*f*h-s*c*h-u*a*p+i*c*p+s*a*v-i*f*v,n[3]=l*p*m-f*d*m-l*h*g+a*d*g+f*h*y-a*p*y,n[7]=s*d*m-o*p*m+o*h*g-i*d*g-s*h*y+i*p*y,n[11]=o*f*m-s*l*m-o*a*g+i*l*g+s*a*y-i*f*y,n[15]=s*l*h-o*f*h+o*a*p-i*l*p-s*a*d+i*f*d,n=r[0]*n[0]+r[1]*n[4]+r[2]*n[8]+r[3]*n[12];if(0==n){if(t)throw Error("Matrix4.getInverse(): can't invert matrix, determinant is 0");return console.warn("Matrix4.getInverse(): can't invert matrix, determinant is 0"),this.identity(),this}return this.multiplyScalar(1/n),this},extractPosition:function(e){var t=this.elements,e=e.elements;return t[12]=e[12],t[13]=e[13],t[14]=e[14],this},extractRotation:function(){var e=new THREE.Vector3;return function(t){var n=this.elements,t=t.elements,r=1/e.set(t[0],t[1],t[2]).length(),i=1/e.set(t[4],t[5],t[6]).length(),s=1/e.set(t[8],t[9],t[10]).length();return n[0]=t[0]*r,n[1]=t[1]*r,n[2]=t[2]*r,n[4]=t[4]*i,n[5]=t[5]*i,n[6]=t[6]*i,n[8]=t[8]*s,n[9]=t[9]*s,n[10]=t[10]*s,this}}(),translate:function(e){var t=this.elements,n=e.x,r=e.y,e=e.z;return t[12]=t[0]*n+t[4]*r+t[8]*e+t[12],t[13]=t[1]*n+t[5]*r+t[9]*e+t[13],t[14]=t[2]*n+t[6]*r+t[10]*e+t[14],t[15]=t[3]*n+t[7]*r+t[11]*e+t[15],this},rotateX:function(e){var t=this.elements,n=t[4],r=t[5],i=t[6],s=t[7],o=t[8],u=t[9],a=t[10],f=t[11],l=Math.cos(e),e=Math.sin(e);return t[4]=l*n+e*o,t[5]=l*r+e*u,t[6]=l*i+e*a,t[7]=l*s+e*f,t[8]=l*o-e*n,t[9]=l*u-e*r,t[10]=l*a-e*i,t[11]=l*f-e*s,this},rotateY:function(e){var t=this.elements,n=t[0],r=t[1],i=t[2],s=t[3],o=t[8],u=t[9],a=t[10],f=t[11],l=Math.cos(e),e=Math.sin(e);return t[0]=l*n-e*o,t[1]=l*r-e*u,t[2]=l*i-e*a,t[3]=l*s-e*f,t[8]=l*o+e*n,t[9]=l*u+e*r,t[10]=l*a+e*i,t[11]=l*f+e*s,this},rotateZ:function(e){var t=this.elements,n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5],a=t[6],f=t[7],l=Math.cos(e),e=Math.sin(e);return t[0]=l*n+e*o,t[1]=l*r+e*u,t[2]=l*i+e*a,t[3]=l*s+e*f,t[4]=l*o-e*n,t[5]=l*u-e*r,t[6]=l*a-e*i,t[7]=l*f-e*s,this},rotateByAxis:function(e,t){var n=this.elements;if(1===e.x&&0===e.y&&0===e.z)return this.rotateX(t);if(0===e.x&&1===e.y&&0===e.z)return this.rotateY(t);if(0===e.x&&0===e.y&&1===e.z)return this.rotateZ(t);var r=e.x,i=e.y,s=e.z,o=Math.sqrt(r*r+i*i+s*s),r=r/o,i=i/o,s=s/o,o=r*r,u=i*i,a=s*s,f=Math.cos(t),l=Math.sin(t),c=1-f,h=r*i*c,p=r*s*c,c=i*s*c,r=r*l,d=i*l,l=s*l,s=o+(1-o)*f,o=h+l,i=p-d,h=h-l,u=u+(1-u)*f,l=c+r,p=p+d,c=c-r,a=a+(1-a)*f,f=n[0],r=n[1],d=n[2],v=n[3],m=n[4],g=n[5],y=n[6],b=n[7],w=n[8],E=n[9],S=n[10],x=n[11];return n[0]=s*f+o*m+i*w,n[1]=s*r+o*g+i*E,n[2]=s*d+o*y+i*S,n[3]=s*v+o*b+i*x,n[4]=h*f+u*m+l*w,n[5]=h*r+u*g+l*E,n[6]=h*d+u*y+l*S,n[7]=h*v+u*b+l*x,n[8]=p*f+c*m+a*w,n[9]=p*r+c*g+a*E,n[10]=p*d+c*y+a*S,n[11]=p*v+c*b+a*x,this},scale:function(e){var t=this.elements,n=e.x,r=e.y,e=e.z;return t[0]*=n,t[4]*=r,t[8]*=e,t[1]*=n,t[5]*=r,t[9]*=e,t[2]*=n,t[6]*=r,t[10]*=e,t[3]*=n,t[7]*=r,t[11]*=e,this},getMaxScaleOnAxis:function(){var e=this.elements;return Math.sqrt(Math.max(e[0]*e[0]+e[1]*e[1]+e[2]*e[2],Math.max(e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10])))},makeTranslation:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),e=Math.sin(e);return this.set(1,0,0,0,0,t,-e,0,0,e,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),e=Math.sin(e);return this.set(t,0,e,0,0,1,0,0,-e,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),e=Math.sin(e);return this.set(t,-e,0,0,e,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var n=Math.cos(t),r=Math.sin(t),i=1-n,s=e.x,o=e.y,u=e.z,a=i*s,f=i*o;return this.set(a*s+n,a*o-r*u,a*u+r*o,0,a*o+r*u,f*o+n,f*u-r*s,0,a*u-r*o,f*u+r*s,i*u*u+n,0,0,0,0,1),this},makeScale:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this},makeFrustum:function(e,t,n,r,i,s){var o=this.elements;return o[0]=2*i/(t-e),o[4]=0,o[8]=(t+e)/(t-e),o[12]=0,o[1]=0,o[5]=2*i/(r-n),o[9]=(r+n)/(r-n),o[13]=0,o[2]=0,o[6]=0,o[10]=-(s+i)/(s-i),o[14]=-2*s*i/(s-i),o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makePerspective:function(e,t,n,r){var e=n*Math.tan(THREE.Math.degToRad(.5*e)),i=-e;return this.makeFrustum(i*t,e*t,i,e,n,r)},makeOrthographic:function(e,t,n,r,i,s){var o=this.elements,u=t-e,a=n-r,f=s-i;return o[0]=2/u,o[4]=0,o[8]=0,o[12]=-((t+e)/u),o[1]=0,o[5]=2/a,o[9]=0,o[13]=-((n+r)/a),o[2]=0,o[6]=0,o[10]=-2/f,o[14]=-((s+i)/f),o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},clone:function(){var e=this.elements;return new THREE.Matrix4(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15])}},THREE.extend(THREE.Matrix4.prototype,{compose:function(){var e=new THREE.Matrix4,t=new THREE.Matrix4;return function(n,r,i){var s=this.elements;return e.identity(),e.setRotationFromQuaternion(r),t.makeScale(i.x,i.y,i.z),this.multiplyMatrices(e,t),s[12]=n.x,s[13]=n.y,s[14]=n.z,this}}(),decompose:function(){var e=new THREE.Vector3,t=new THREE.Vector3,n=new THREE.Vector3,r=new THREE.Matrix4;return function(i,s,o){var u=this.elements;return e.set(u[0],u[1],u[2]),t.set(u[4],u[5],u[6]),n.set(u[8],u[9],u[10]),i=i instanceof THREE.Vector3?i:new THREE.Vector3,s=s instanceof THREE.Quaternion?s:new THREE.Quaternion,o=o instanceof THREE.Vector3?o:new THREE.Vector3,o.x=e.length(),o.y=t.length(),o.z=n.length(),i.x=u[12],i.y=u[13],i.z=u[14],r.copy(this),r.elements[0]/=o.x,r.elements[1]/=o.x,r.elements[2]/=o.x,r.elements[4]/=o.y,r.elements[5]/=o.y,r.elements[6]/=o.y,r.elements[8]/=o.z,r.elements[9]/=o.z,r.elements[10]/=o.z,s.setFromRotationMatrix(r),[i,s,o]}}()}),THREE.Ray=function(e,t){this.origin=void 0!==e?e:new THREE.Vector3,this.direction=void 0!==t?t:new THREE.Vector3},THREE.Ray.prototype={constructor:THREE.Ray,set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return(t||new THREE.Vector3).copy(this.direction).multiplyScalar(e).add(this.origin)},recast:function(){var e=new THREE.Vector3;return function(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){var n=t||new THREE.Vector3;n.subVectors(e,this.origin);var r=n.dot(this.direction);return n.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(){var e=new THREE.Vector3;return function(t){var n=e.subVectors(t,this.origin).dot(this.direction);return e.copy(this.direction).multiplyScalar(n).add(this.origin),e.distanceTo(t)}}(),isIntersectionSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},isIntersectionPlane:function(e){return 0!=e.normal.dot(this.direction)||0==e.distanceToPoint(this.origin)?!0:!1},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0!=t)return-(this.origin.dot(e.normal)+e.constant)/t;if(0==e.distanceToPoint(this.origin))return 0},intersectPlane:function(e,t){var n=this.distanceToPlane(e);return void 0===n?void 0:this.at(n,t)},applyMatrix4:function(e){return this.direction.add(this.origin).applyMatrix4(e),this.origin.applyMatrix4(e),this.direction.sub(this.origin),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)},clone:function(){return(new THREE.Ray).copy(this)}},THREE.Sphere=function(e,t){this.center=void 0!==e?e:new THREE.Vector3,this.radius=void 0!==t?t:0},THREE.Sphere.prototype={constructor:THREE.Sphere,set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromCenterAndPoints:function(e,t){for(var n=0,r=0,i=t.length;r<i;r++)var s=e.distanceToSquared(t[r]),n=Math.max(n,s);return this.center=e,this.radius=Math.sqrt(n),this},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return 0>=this.radius},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},clampPoint:function(e,t){var n=this.center.distanceToSquared(e),r=t||new THREE.Vector3;return r.copy(e),n>this.radius*this.radius&&(r.sub(this.center).normalize(),r.multiplyScalar(this.radius).add(this.center)),r},getBoundingBox:function(e){return e=e||new THREE.Box3,e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius*=e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius},clone:function(){return(new THREE.Sphere).copy(this)}},THREE.Frustum=function(e,t,n,r,i,s){this.planes=[void 0!==e?e:new THREE.Plane,void 0!==t?t:new THREE.Plane,void 0!==n?n:new THREE.Plane,void 0!==r?r:new THREE.Plane,void 0!==i?i:new THREE.Plane,void 0!==s?s:new THREE.Plane]},THREE.Frustum.prototype={constructor:THREE.Frustum,set:function(e,t,n,r,i,s){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(r),o[4].copy(i),o[5].copy(s),this},copy:function(e){for(var t=this.planes,n=0;6>n;n++)t[n].copy(e.planes[n]);return this},setFromMatrix:function(e){var t=this.planes,n=e.elements,e=n[0],r=n[1],i=n[2],s=n[3],o=n[4],u=n[5],a=n[6],f=n[7],l=n[8],c=n[9],h=n[10],p=n[11],d=n[12],v=n[13],m=n[14],n=n[15];return t[0].setComponents(s-e,f-o,p-l,n-d).normalize(),t[1].setComponents(s+e,f+o,p+l,n+d).normalize(),t[2].setComponents(s+r,f+u,p+c,n+v).normalize(),t[3].setComponents(s-r,f-u,p-c,n-v).normalize(),t[4].setComponents(s-i,f-a,p-h,n-m).normalize(),t[5].setComponents(s+i,f+a,p+h,n+m).normalize(),this},intersectsObject:function(){var e=new THREE.Vector3;return function(t){var n=t.matrixWorld,r=this.planes,t=-t.geometry.boundingSphere.radius*n.getMaxScaleOnAxis();e.getPositionFromMatrix(n);for(n=0;6>n;n++)if(r[n].distanceToPoint(e)<t)return!1;return!0}}(),intersectsSphere:function(e){for(var t=this.planes,n=e.center,e=-e.radius,r=0;6>r;r++)if(t[r].distanceToPoint(n)<e)return!1;return!0},containsPoint:function(e){for(var t=this.planes,n=0;6>n;n++)if(0>t[n].distanceToPoint(e))return!1;return!0},clone:function(){return(new THREE.Frustum).copy(this)}},THREE.Plane=function(e,t){this.normal=void 0!==e?e:new THREE.Vector3(1,0,0),this.constant=void 0!==t?t:0},THREE.Plane.prototype={constructor:THREE.Plane,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(n,r,i){return r=e.subVectors(i,r).cross(t.subVectors(n,r)).normalize(),this.setFromNormalAndCoplanarPoint(r,n),this}}(),copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return this.orthoPoint(e,t).sub(e).negate()},orthoPoint:function(e,t){var n=this.distanceToPoint(e);return(t||new THREE.Vector3).copy(this.normal).multiplyScalar(n)},isIntersectionLine:function(e){var t=this.distanceToPoint(e.start),e=this.distanceToPoint(e.end);return 0>t&&0<e||0>e&&0<t},intersectLine:function(){var e=new THREE.Vector3;return function(t,n){var r=n||new THREE.Vector3,i=t.delta(e),s=this.normal.dot(i);if(0!=s)return s=-(t.start.dot(this.normal)+this.constant)/s,0>s||1<s?void 0:r.copy(i).multiplyScalar(s).add(t.start);if(0==this.distanceToPoint(t.start))return r.copy(t.start)}}(),coplanarPoint:function(e){return(e||new THREE.Vector3).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(n,r){var r=r||(new THREE.Matrix3).getInverse(n).transpose(),i=e.copy(this.normal).applyMatrix3(r),s=this.coplanarPoint(t);return s.applyMatrix4(n),this.setFromNormalAndCoplanarPoint(i,s),this}}(),translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant==this.constant},clone:function(){return(new THREE.Plane).copy(this)}},THREE.Math={clamp:function(e,t,n){return e<t?t:e>n?n:e},clampBottom:function(e,t){return e<t?t:e},mapLinear:function(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t),e*e*(3-2*e))},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t),e*e*e*(e*(6*e-15)+10))},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},sign:function(e){return 0>e?-1:0<e?1:0},degToRad:function(){var e=Math.PI/180;return function(t){return t*e}}(),radToDeg:function(){var e=180/Math.PI;return function(t){return t*e}}()},THREE.Spline=function(e){function t(e,t,n,r,i,s,o){return e=.5*(n-e),r=.5*(r-t),(2*(t-n)+e+r)*o+(-3*(t-n)-2*e-r)*s+e*i+t}this.points=e;var n=[],r={x:0,y:0,z:0},i,s,o,u,a,f,l,c,h;this.initFromArray=function(e){this.points=[];for(var t=0;t<e.length;t++)this.points[t]={x:e[t][0],y:e[t][1],z:e[t][2]}},this.getPoint=function(e){return i=(this.points.length-1)*e,s=Math.floor(i),o=i-s,n[0]=0===s?s:s-1,n[1]=s,n[2]=s>this.points.length-2?this.points.length-1:s+1,n[3]=s>this.points.length-3?this.points.length-1:s+2,f=this.points[n[0]],l=this.points[n[1]],c=this.points[n[2]],h=this.points[n[3]],u=o*o,a=o*u,r.x=t(f.x,l.x,c.x,h.x,o,u,a),r.y=t(f.y,l.y,c.y,h.y,o,u,a),r.z=t(f.z,l.z,c.z,h.z,o,u,a),r},this.getControlPointsArray=function(){var e,t,n=this.points.length,r=[];for(e=0;e<n;e++)t=this.points[e],r[e]=[t.x,t.y,t.z];return r},this.getLength=function(e){var t,n,r,i=t=t=0,s=new THREE.Vector3,o=new THREE.Vector3,u=[],a=0;u[0]=0,e||(e=100),n=this.points.length*e,s.copy(this.points[0]);for(e=1;e<n;e++)t=e/n,r=this.getPoint(t),o.copy(r),a+=o.distanceTo(s),s.copy(r),t*=this.points.length-1,t=Math.floor(t),t!=i&&(u[t]=a,i=t);return u[u.length]=a,{chunks:u,total:a}},this.reparametrizeByArcLength=function(e){var t,n,r,i,s,o,u=[],a=new THREE.Vector3,f=this.getLength();u.push(a.copy(this.points[0]).clone());for(t=1;t<this.points.length;t++){n=f.chunks[t]-f.chunks[t-1],o=Math.ceil(e*n/f.total),i=(t-1)/(this.points.length-1),s=t/(this.points.length-1);for(n=1;n<o-1;n++)r=i+n*(1/o)*(s-i),r=this.getPoint(r),u.push(a.copy(r).clone());u.push(a.copy(this.points[t]).clone())}this.points=u}},THREE.Triangle=function(e,t,n){this.a=void 0!==e?e:new THREE.Vector3,this.b=void 0!==t?t:new THREE.Vector3,this.c=void 0!==n?n:new THREE.Vector3},THREE.Triangle.normal=function(){var e=new THREE.Vector3;return function(t,n,r,i){return i=i||new THREE.Vector3,i.subVectors(r,n),e.subVectors(t,n),i.cross(e),t=i.lengthSq(),0<t?i.multiplyScalar(1/Math.sqrt(t)):i.set(0,0,0)}}(),THREE.Triangle.barycoordFromPoint=function(){var e=new THREE.Vector3,t=new THREE.Vector3,n=new THREE.Vector3;return function(r,i,s,o,u){e.subVectors(o,i),t.subVectors(s,i),n.subVectors(r,i);var r=e.dot(e),i=e.dot(t),s=e.dot(n),f=t.dot(t),o=t.dot(n),l=r*f-i*i,u=u||new THREE.Vector3;return 0==l?u.set(-2,-1,-1):(l=1/l,f=(f*s-i*o)*l,r=(r*o-i*s)*l,u.set(1-f-r,r,f))}}(),THREE.Triangle.containsPoint=function(){var e=new THREE.Vector3;return function(t,n,r,i){return t=THREE.Triangle.barycoordFromPoint(t,n,r,i,e),0<=t.x&&0<=t.y&&1>=t.x+t.y}}(),THREE.Triangle.prototype={constructor:THREE.Triangle,set:function(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this},setFromPointsAndIndices:function(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},area:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*e.cross(t).length()}}(),midpoint:function(e){return(e||new THREE.Vector3).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(e){return THREE.Triangle.normal(this.a,this.b,this.c,e)},plane:function(e){return(e||new THREE.Plane).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(e,t){return THREE.Triangle.barycoordFromPoint(e,this.a,this.b,this.c,t)},containsPoint:function(e){return THREE.Triangle.containsPoint(e,this.a,this.b,this.c)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)},clone:function(){return(new THREE.Triangle).copy(this)}},THREE.Vertex=function(e){return console.warn("THREE.Vertex has been DEPRECATED. Use THREE.Vector3 instead."),e},THREE.UV=function(e,t){return console.warn("THREE.UV has been DEPRECATED. Use THREE.Vector2 instead."),new THREE.Vector2(e,t)},THREE.Clock=function(e){this.autoStart=void 0!==e?e:!0,this.elapsedTime=this.oldTime=this.startTime=0,this.running=!1},THREE.extend(THREE.Clock.prototype,{start:function(){this.oldTime=this.startTime=void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now(),this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;this.autoStart&&!this.running&&this.start();if(this.running){var t=void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now(),e=.001*(t-this.oldTime);this.oldTime=t,this.elapsedTime+=e}return e}}),THREE.EventDispatcher=function(){var e={};this.addEventListener=function(t,n){void 0===e[t]&&(e[t]=[]),-1===e[t].indexOf(n)&&e[t].push(n)},this.removeEventListener=function(t,n){var r=e[t].indexOf(n);-1!==r&&e[t].splice(r,1)},this.dispatchEvent=function(t){var n=e[t.type];if(void 0!==n){t.target=this;for(var r=0,i=n.length;r<i;r++)n[r].call(this,t)}}},function(e){e.Raycaster=function(t,n,r,i){this.ray=new e.Ray(t,n),0<this.ray.direction.lengthSq()&&this.ray.direction.normalize(),this.near=r||0,this.far=i||Infinity};var t=new e.Sphere,n=new e.Ray,r=new e.Plane,i=new e.Vector3,s=new e.Vector3,o=new e.Matrix4,u=function(e,t){return e.distance-t.distance},a=function(u,a,f){if(u instanceof e.Particle){s.getPositionFromMatrix(u.matrixWorld),a=a.ray.distanceToPoint(s);if(a>u.scale.x)return f;f.push({distance:a,point:u.position,face:null,object:u})}else if(u instanceof e.Mesh){s.getPositionFromMatrix(u.matrixWorld),t.set(s,u.geometry.boundingSphere.radius*u.matrixWorld.getMaxScaleOnAxis());if(!a.ray.isIntersectionSphere(t))return f;var l=u.geometry,h=l.vertices,p=u.material instanceof e.MeshFaceMaterial,v=!0===p?u.material.materials:null,m=u.material.side,y,w,E,S=a.precision;u.matrixRotationWorld.extractRotation(u.matrixWorld),o.getInverse(u.matrixWorld),n.copy(a.ray).applyMatrix4(o);for(var x=0,T=l.faces.length;x<T;x++){var N=l.faces[x],m=!0===p?v[N.materialIndex]:u.material;if(void 0!==m){r.setFromNormalAndCoplanarPoint(N.normal,h[N.a]);var C=n.distanceToPlane(r);if(!(Math.abs(C)<S)&&!(0>C)){m=m.side;if(!(m===e.DoubleSide||(y=n.direction.dot(r.normal),m===e.FrontSide?0>y:0<y)))continue;if(!(C<a.near||C>a.far)){i=n.at(C,i);if(N instanceof e.Face3){if(m=h[N.a],y=h[N.b],w=h[N.c],!e.Triangle.containsPoint(i,m,y,w))continue}else{if(!(N instanceof e.Face4))throw Error("face type not supported");if(m=h[N.a],y=h[N.b],w=h[N.c],E=h[N.d],!e.Triangle.containsPoint(i,m,y,E)&&!e.Triangle.containsPoint(i,y,w,E))continue}f.push({distance:C,point:a.ray.at(C),face:N,faceIndex:x,object:u})}}}}}},f=function(e,t,n){for(var e=e.getDescendants(),r=0,i=e.length;r<i;r++)a(e[r],t,n)};e.Raycaster.prototype.precision=1e-4,e.Raycaster.prototype.set=function(e,t){this.ray.set(e,t),0<this.ray.direction.length()&&this.ray.direction.normalize()},e.Raycaster.prototype.intersectObject=function(e,t){var n=[];return!0===t&&f(e,this,n),a(e,this,n),n.sort(u),n},e.Raycaster.prototype.intersectObjects=function(e,t){for(var n=[],r=0,i=e.length;r<i;r++)a(e[r],this,n),!0===t&&f(e[r],this,n);return n.sort(u),n}}(THREE),THREE.Object3D=function(){this.id=THREE.Object3DIdCount++,this.name="",this.parent=void 0,this.children=[],this.up=new THREE.Vector3(0,1,0),this.position=new THREE.Vector3,this.rotation=new THREE.Vector3,this.eulerOrder=THREE.Object3D.defaultEulerOrder,this.scale=new THREE.Vector3(1,1,1),this.renderDepth=null,this.rotationAutoUpdate=!0,this.matrix=new THREE.Matrix4,this.matrixWorld=new THREE.Matrix4,this.matrixRotationWorld=new THREE.Matrix4,this.matrixWorldNeedsUpdate=this.matrixAutoUpdate=!0,this.quaternion=new THREE.Quaternion,this.useQuaternion=!1,this.visible=!0,this.receiveShadow=this.castShadow=!1,this.frustumCulled=!0,this.userData={}},THREE.Object3D.prototype={constructor:THREE.Object3D,applyMatrix:function(){var e=new THREE.Matrix4;return function(t){this.matrix.multiplyMatrices(t,this.matrix),this.position.getPositionFromMatrix(this.matrix),this.scale.getScaleFromMatrix(this.matrix),e.extractRotation(this.matrix),!0===this.useQuaternion?this.quaternion.setFromRotationMatrix(e):this.rotation.setEulerFromRotationMatrix(e,this.eulerOrder)}}(),translate:function(){var e=new THREE.Vector3;return function(t,n){return e.copy(n),!0===this.useQuaternion?e.applyQuaternion(this.quaternion):e.applyEuler(this.rotation,this.eulerOrder),e.multiplyScalar(t),this.position.add(e),this}}(),translateX:function(){var e=new THREE.Vector3(1,0,0);return function(t){return this.translate(t,e)}}(),translateY:function(){var e=new THREE.Vector3(0,1,0);return function(t){return this.translate(t,e)}}(),translateZ:function(){var e=new THREE.Vector3(0,0,1);return function(t){return this.translate(t,e)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var e=new THREE.Matrix4;return function(t){return t.applyMatrix4(e.getInverse(this.matrixWorld))}}(),lookAt:function(){var e=new THREE.Matrix4;return function(t){e.lookAt(t,this.position,this.up),!0===this.useQuaternion?this.quaternion.setFromRotationMatrix(e):this.rotation.setEulerFromRotationMatrix(e,this.eulerOrder)}}(),add:function(e){if(e===this)console.warn("THREE.Object3D.add: An object can't be added as a child of itself.");else if(e instanceof THREE.Object3D){void 0!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e);for(var t=this;void 0!==t.parent;)t=t.parent;void 0!==t&&t instanceof THREE.Scene&&t.__addObject(e)}},remove:function(e){var t=this.children.indexOf(e);if(-1!==t){e.parent=void 0,this.children.splice(t,1);for(t=this;void 0!==t.parent;)t=t.parent;void 0!==t&&t instanceof THREE.Scene&&t.__removeObject(e)}},traverse:function(e){e(this);for(var t=0,n=this.children.length;t<n;t++)this.children[t].traverse(e)},getChildByName:function(e,t){for(var n=0,r=this.children.length;n<r;n++){var i=this.children[n];if(i.name===e||!0===t&&(i=i.getChildByName(e,t),void 0!==i))return i}},getDescendants:function(e){void 0===e&&(e=[]),Array.prototype.push.apply(e,this.children);for(var t=0,n=this.children.length;t<n;t++)this.children[t].getDescendants(e);return e},updateMatrix:function(){this.matrix.setPosition(this.position),!1===this.useQuaternion?this.matrix.setRotationFromEuler(this.rotation,this.eulerOrder):this.matrix.setRotationFromQuaternion(this.quaternion),(1!==this.scale.x||1!==this.scale.y||1!==this.scale.z)&&this.matrix.scale(this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){!0===this.matrixAutoUpdate&&this.updateMatrix();if(!0===this.matrixWorldNeedsUpdate||!0===e)void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0;for(var t=0,n=this.children.length;t<n;t++)this.children[t].updateMatrixWorld(e)},clone:function(e){void 0===e&&(e=new THREE.Object3D),e.name=this.name,e.up.copy(this.up),e.position.copy(this.position),e.rotation instanceof THREE.Vector3&&e.rotation.copy(this.rotation),e.eulerOrder=this.eulerOrder,e.scale.copy(this.scale),e.renderDepth=this.renderDepth,e.rotationAutoUpdate=this.rotationAutoUpdate,e.matrix.copy(this.matrix),e.matrixWorld.copy(this.matrixWorld),e.matrixRotationWorld.copy(this.matrixRotationWorld),e.matrixAutoUpdate=this.matrixAutoUpdate,e.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,e.quaternion.copy(this.quaternion),e.useQuaternion=this.useQuaternion,e.visible=this.visible,e.castShadow=this.castShadow,e.receiveShadow=this.receiveShadow,e.frustumCulled=this.frustumCulled;for(var t=0;t<this.children.length;t++)e.add(this.children[t].clone());return e}},THREE.Object3D.defaultEulerOrder="XYZ",THREE.Object3DIdCount=0,THREE.Projector=function(){function e(){if(s===u){var e=new THREE.RenderableObject;return o.push(e),u++,s++,e}return o[s++]}function t(){if(f===c){var e=new THREE.RenderableVertex;return l.push(e),c++,f++,e}return l[f++]}function n(e,t){return t.z-e.z}function r(e,t){var n=0,r=1,i=e.z+e.w,s=t.z+t.w,o=-e.z+e.w,u=-t.z+t.w;return 0<=i&&0<=s&&0<=o&&0<=u?!0:0>i&&0>s||0>o&&0>u?!1:(0>i?n=Math.max(n,i/(i-s)):0>s&&(r=Math.min(r,i/(i-s))),0>o?n=Math.max(n,o/(o-u)):0>u&&(r=Math.min(r,o/(o-u))),r<n?!1:(e.lerp(t,n),t.lerp(e,1-r),!0))}var i,s,o=[],u=0,a,f,l=[],c=0,h,p,d=[],v=0,m,g=[],y=0,b,w,E=[],S=0,x,T,N=[],C=0,k={objects:[],sprites:[],lights:[],elements:[]},L=new THREE.Vector3,A=new THREE.Vector4,O=new THREE.Box3(new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,1,1)),M=new THREE.Box3,_=Array(3),D=Array(4),P=new THREE.Matrix4,H=new THREE.Matrix4,B,j=new THREE.Matrix4,F=new THREE.Matrix3,I=new THREE.Matrix3,q=new THREE.Vector3,R=new THREE.Frustum,U=new THREE.Vector4,z=new THREE.Vector4;this.projectVector=function(e,t){return t.matrixWorldInverse.getInverse(t.matrixWorld),H.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),e.applyProjection(H)},this.unprojectVector=function(e,t){return t.projectionMatrixInverse.getInverse(t.projectionMatrix),H.multiplyMatrices(t.matrixWorld,t.projectionMatrixInverse),e.applyProjection(H)},this.pickingRay=function(e,t){e.z=-1;var n=new THREE.Vector3(e.x,e.y,1);return this.unprojectVector(e,t),this.unprojectVector(n,t),n.sub(e).normalize(),new THREE.Raycaster(e,n)},this.projectScene=function(o,u,c,W){var X=!1,V,$,Q,Y,et,tt,nt,rt,it,st,ot,ut,at;T=w=m=p=0,k.elements.length=0,o.updateMatrixWorld(),void 0===u.parent&&u.updateMatrixWorld(),P.copy(u.matrixWorldInverse.getInverse(u.matrixWorld)),H.multiplyMatrices(u.projectionMatrix,P),I.getInverse(P),I.transpose(),R.setFromMatrix(H),s=0,k.objects.length=0,k.sprites.length=0,k.lights.length=0;var ft=function(t){for(var n=0,r=t.children.length;n<r;n++){var s=t.children[n];if(!1!==s.visible){if(s instanceof THREE.Light)k.lights.push(s);else if(s instanceof THREE.Mesh||s instanceof THREE.Line){if(!1===s.frustumCulled||!0===R.intersectsObject(s))i=e(),i.object=s,null!==s.renderDepth?i.z=s.renderDepth:(L.getPositionFromMatrix(s.matrixWorld),L.applyProjection(H),i.z=L.z),k.objects.push(i)}else s instanceof THREE.Sprite||s instanceof THREE.Particle?(i=e(),i.object=s,null!==s.renderDepth?i.z=s.renderDepth:(L.getPositionFromMatrix(s.matrixWorld),L.applyProjection(H),i.z=L.z),k.sprites.push(i)):(i=e(),i.object=s,null!==s.renderDepth?i.z=s.renderDepth:(L.getPositionFromMatrix(s.matrixWorld),L.applyProjection(H),i.z=L.z),k.objects.push(i));ft(s)}}};ft(o),!0===c&&k.objects.sort(n),o=0;for(c=k.objects.length;o<c;o++)if(rt=k.objects[o].object,B=rt.matrixWorld,f=0,rt instanceof THREE.Mesh){it=rt.geometry,Q=it.vertices,st=it.faces,it=it.faceVertexUvs,F.getInverse(B),F.transpose(),ut=rt.material instanceof THREE.MeshFaceMaterial,at=!0===ut?rt.material:null,V=0;for($=Q.length;V<$;V++)a=t(),a.positionWorld.copy(Q[V]).applyMatrix4(B),a.positionScreen.copy(a.positionWorld).applyMatrix4(H),a.positionScreen.x/=a.positionScreen.w,a.positionScreen.y/=a.positionScreen.w,a.positionScreen.z/=a.positionScreen.w,a.visible=!(-1>a.positionScreen.x||1<a.positionScreen.x||-1>a.positionScreen.y||1<a.positionScreen.y||-1>a.positionScreen.z||1<a.positionScreen.z);Q=0;for(V=st.length;Q<V;Q++){$=st[Q];var lt=!0===ut?at.materials[$.materialIndex]:rt.material;if(void 0!==lt){tt=lt.side;if($ instanceof THREE.Face3){if(Y=l[$.a],et=l[$.b],nt=l[$.c],_[0]=Y.positionScreen,_[1]=et.positionScreen,_[2]=nt.positionScreen,!0!==Y.visible&&!0!==et.visible&&!0!==nt.visible&&!O.isIntersectionBox(M.setFromPoints(_)))continue;if(X=0>(nt.positionScreen.x-Y.positionScreen.x)*(et.positionScreen.y-Y.positionScreen.y)-(nt.positionScreen.y-Y.positionScreen.y)*(et.positionScreen.x-Y.positionScreen.x),tt!==THREE.DoubleSide&&X!==(tt===THREE.FrontSide))continue;p===v?(ot=new THREE.RenderableFace3,d.push(ot),v++,p++,h=ot):h=d[p++],h.v1.copy(Y),h.v2.copy(et),h.v3.copy(nt)}else if($ instanceof THREE.Face4){if(Y=l[$.a],et=l[$.b],nt=l[$.c],ot=l[$.d],D[0]=Y.positionScreen,D[1]=et.positionScreen,D[2]=nt.positionScreen,D[3]=ot.positionScreen,!0!==Y.visible&&!0!==et.visible&&!0!==nt.visible&&!0!==ot.visible&&!O.isIntersectionBox(M.setFromPoints(D)))continue;if(X=0>(ot.positionScreen.x-Y.positionScreen.x)*(et.positionScreen.y-Y.positionScreen.y)-(ot.positionScreen.y-Y.positionScreen.y)*(et.positionScreen.x-Y.positionScreen.x)||0>(et.positionScreen.x-nt.positionScreen.x)*(ot.positionScreen.y-nt.positionScreen.y)-(et.positionScreen.y-nt.positionScreen.y)*(ot.positionScreen.x-nt.positionScreen.x),tt!==THREE.DoubleSide&&X!==(tt===THREE.FrontSide))continue;if(m===y){var ct=new THREE.RenderableFace4;g.push(ct),y++,m++,h=ct}else h=g[m++];h.v1.copy(Y),h.v2.copy(et),h.v3.copy(nt),h.v4.copy(ot)}h.normalModel.copy($.normal),!1===X&&(tt===THREE.BackSide||tt===THREE.DoubleSide)&&h.normalModel.negate(),h.normalModel.applyMatrix3(F).normalize(),h.normalModelView.copy(h.normalModel).applyMatrix3(I),h.centroidModel.copy($.centroid).applyMatrix4(B),nt=$.vertexNormals,Y=0;for(et=nt.length;Y<et;Y++)ot=h.vertexNormalsModel[Y],ot.copy(nt[Y]),!1===X&&(tt===THREE.BackSide||tt===THREE.DoubleSide)&&ot.negate(),ot.applyMatrix3(F).normalize(),h.vertexNormalsModelView[Y].copy(ot).applyMatrix3(I);h.vertexNormalsLength=nt.length,Y=0;for(et=it.length;Y<et;Y++)if(ot=it[Y][Q],void 0!==ot){tt=0;for(nt=ot.length;tt<nt;tt++)h.uvs[Y][tt]=ot[tt]}h.color=$.color,h.material=lt,q.copy(h.centroidModel).applyProjection(H),h.z=q.z,k.elements.push(h)}}}else if(rt instanceof THREE.Line){j.multiplyMatrices(H,B),Q=rt.geometry.vertices,Y=t(),Y.positionScreen.copy(Q[0]).applyMatrix4(j),st=rt.type===THREE.LinePieces?2:1,V=1;for($=Q.length;V<$;V++)Y=t(),Y.positionScreen.copy(Q[V]).applyMatrix4(j),0<(V+1)%st||(et=l[f-2],U.copy(Y.positionScreen),z.copy(et.positionScreen),!0===r(U,z)&&(U.multiplyScalar(1/U.w),z.multiplyScalar(1/z.w),w===S?(it=new THREE.RenderableLine,E.push(it),S++,w++,b=it):b=E[w++],b.v1.positionScreen.copy(U),b.v2.positionScreen.copy(z),b.z=Math.max(U.z,z.z),b.material=rt.material,k.elements.push(b)))}o=0;for(c=k.sprites.length;o<c;o++)rt=k.sprites[o].object,B=rt.matrixWorld,rt instanceof THREE.Particle&&(A.set(B.elements[12],B.elements[13],B.elements[14],1),A.applyMatrix4(H),A.z/=A.w,0<A.z&&1>A.z&&(T===C?(X=new THREE.RenderableParticle,N.push(X),C++,T++,x=X):x=N[T++],x.object=rt,x.x=A.x/A.w,x.y=A.y/A.w,x.z=A.z,x.rotation=rt.rotation.z,x.scale.x=rt.scale.x*Math.abs(x.x-(A.x+u.projectionMatrix.elements[0])/(A.w+u.projectionMatrix.elements[12])),x.scale.y=rt.scale.y*Math.abs(x.y-(A.y+u.projectionMatrix.elements[5])/(A.w+u.projectionMatrix.elements[13])),x.material=rt.material,k.elements.push(x)));return!0===W&&k.elements.sort(n),k}},THREE.Face3=function(e,t,n,r,i,s){this.a=e,this.b=t,this.c=n,this.normal=r instanceof THREE.Vector3?r:new THREE.Vector3,this.vertexNormals=r instanceof Array?r:[],this.color=i instanceof THREE.Color?i:new THREE.Color,this.vertexColors=i instanceof Array?i:[],this.vertexTangents=[],this.materialIndex=void 0!==s?s:0,this.centroid=new THREE.Vector3},THREE.Face3.prototype={constructor:THREE.Face3,clone:function(){var e=new THREE.Face3(this.a,this.b,this.c);e.normal.copy(this.normal),e.color.copy(this.color),e.centroid.copy(this.centroid),e.materialIndex=this.materialIndex;var t,n;t=0;for(n=this.vertexNormals.length;t<n;t++)e.vertexNormals[t]=this.vertexNormals[t].clone();t=0;for(n=this.vertexColors.length;t<n;t++)e.vertexColors[t]=this.vertexColors[t].clone();t=0;for(n=this.vertexTangents.length;t<n;t++)e.vertexTangents[t]=this.vertexTangents[t].clone();return e}},THREE.Face4=function(e,t,n,r,i,s,o){this.a=e,this.b=t,this.c=n,this.d=r,this.normal=i instanceof THREE.Vector3?i:new THREE.Vector3,this.vertexNormals=i instanceof Array?i:[],this.color=s instanceof THREE.Color?s:new THREE.Color,this.vertexColors=s instanceof Array?s:[],this.vertexTangents=[],this.materialIndex=void 0!==o?o:0,this.centroid=new THREE.Vector3},THREE.Face4.prototype={constructor:THREE.Face4,clone:function(){var e=new THREE.Face4(this.a,this.b,this.c,this.d);e.normal.copy(this.normal),e.color.copy(this.color),e.centroid.copy(this.centroid),e.materialIndex=this.materialIndex;var t,n;t=0;for(n=this.vertexNormals.length;t<n;t++)e.vertexNormals[t]=this.vertexNormals[t].clone();t=0;for(n=this.vertexColors.length;t<n;t++)e.vertexColors[t]=this.vertexColors[t].clone();t=0;for(n=this.vertexTangents.length;t<n;t++)e.vertexTangents[t]=this.vertexTangents[t].clone();return e}},THREE.Geometry=function(){THREE.EventDispatcher.call(this),this.id=THREE.GeometryIdCount++,this.name="",this.vertices=[],this.colors=[],this.normals=[],this.faces=[],this.faceUvs=[[]],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphColors=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingSphere=this.boundingBox=null,this.hasTangents=!1,this.dynamic=!0,this.buffersNeedUpdate=this.lineDistancesNeedUpdate=this.colorsNeedUpdate=this.tangentsNeedUpdate=this.normalsNeedUpdate=this.uvsNeedUpdate=this.elementsNeedUpdate=this.verticesNeedUpdate=!1},THREE.Geometry.prototype={constructor:THREE.Geometry,applyMatrix:function(e){for(var t=(new THREE.Matrix3).getInverse(e).transpose(),n=0,r=this.vertices.length;n<r;n++)this.vertices[n].applyMatrix4(e);n=0;for(r=this.faces.length;n<r;n++){var i=this.faces[n];i.normal.applyMatrix3(t).normalize();for(var s=0,o=i.vertexNormals.length;s<o;s++)i.vertexNormals[s].applyMatrix3(t).normalize();i.centroid.applyMatrix4(e)}},computeCentroids:function(){var e,t,n;e=0;for(t=this.faces.length;e<t;e++)n=this.faces[e],n.centroid.set(0,0,0),n instanceof THREE.Face3?(n.centroid.add(this.vertices[n.a]),n.centroid.add(this.vertices[n.b]),n.centroid.add(this.vertices[n.c]),n.centroid.divideScalar(3)):n instanceof THREE.Face4&&(n.centroid.add(this.vertices[n.a]),n.centroid.add(this.vertices[n.b]),n.centroid.add(this.vertices[n.c]),n.centroid.add(this.vertices[n.d]),n.centroid.divideScalar(4))},computeFaceNormals:function(){for(var e=new THREE.Vector3,t=new THREE.Vector3,n=0,r=this.faces.length;n<r;n++){var i=this.faces[n],s=this.vertices[i.a],o=this.vertices[i.b];e.subVectors(this.vertices[i.c],o),t.subVectors(s,o),e.cross(t),e.normalize(),i.normal.copy(e)}},computeVertexNormals:function(e){var t,n,r,i;if(void 0===this.__tmpVertices){i=this.__tmpVertices=Array(this.vertices.length),t=0;for(n=this.vertices.length;t<n;t++)i[t]=new THREE.Vector3;t=0;for(n=this.faces.length;t<n;t++)r=this.faces[t],r instanceof THREE.Face3?r.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3]:r instanceof THREE.Face4&&(r.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3])}else{i=this.__tmpVertices,t=0;for(n=this.vertices.length;t<n;t++)i[t].set(0,0,0)}if(e){var s,o,u,a=new THREE.Vector3,f=new THREE.Vector3,l=new THREE.Vector3,c=new THREE.Vector3,h=new THREE.Vector3;t=0;for(n=this.faces.length;t<n;t++)r=this.faces[t],r instanceof THREE.Face3?(e=this.vertices[r.a],s=this.vertices[r.b],o=this.vertices[r.c],a.subVectors(o,s),f.subVectors(e,s),a.cross(f),i[r.a].add(a),i[r.b].add(a),i[r.c].add(a)):r instanceof THREE.Face4&&(e=this.vertices[r.a],s=this.vertices[r.b],o=this.vertices[r.c],u=this.vertices[r.d],l.subVectors(u,s),f.subVectors(e,s),l.cross(f),i[r.a].add(l),i[r.b].add(l),i[r.d].add(l),c.subVectors(u,o),h.subVectors(s,o),c.cross(h),i[r.b].add(c),i[r.c].add(c),i[r.d].add(c))}else{t=0;for(n=this.faces.length;t<n;t++)r=this.faces[t],r instanceof THREE.Face3?(i[r.a].add(r.normal),i[r.b].add(r.normal),i[r.c].add(r.normal)):r instanceof THREE.Face4&&(i[r.a].add(r.normal),i[r.b].add(r.normal),i[r.c].add(r.normal),i[r.d].add(r.normal))}t=0;for(n=this.vertices.length;t<n;t++)i[t].normalize();t=0;for(n=this.faces.length;t<n;t++)r=this.faces[t],r instanceof THREE.Face3?(r.vertexNormals[0].copy(i[r.a]),r.vertexNormals[1].copy(i[r.b]),r.vertexNormals[2].copy(i[r.c])):r instanceof THREE.Face4&&(r.vertexNormals[0].copy(i[r.a]),r.vertexNormals[1].copy(i[r.b]),r.vertexNormals[2].copy(i[r.c]),r.vertexNormals[3].copy(i[r.d]))},computeMorphNormals:function(){var e,t,n,r,i;n=0;for(r=this.faces.length;n<r;n++){i=this.faces[n],i.__originalFaceNormal?i.__originalFaceNormal.copy(i.normal):i.__originalFaceNormal=i.normal.clone(),i.__originalVertexNormals||(i.__originalVertexNormals=[]),e=0;for(t=i.vertexNormals.length;e<t;e++)i.__originalVertexNormals[e]?i.__originalVertexNormals[e].copy(i.vertexNormals[e]):i.__originalVertexNormals[e]=i.vertexNormals[e].clone()}var s=new THREE.Geometry;s.faces=this.faces,e=0;for(t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var o=this.morphNormals[e].faceNormals,u=this.morphNormals[e].vertexNormals,a,f;n=0;for(r=this.faces.length;n<r;n++)i=this.faces[n],a=new THREE.Vector3,f=i instanceof THREE.Face3?{a:new THREE.Vector3,b:new THREE.Vector3,c:new THREE.Vector3}:{a:new THREE.Vector3,b:new THREE.Vector3,c:new THREE.Vector3,d:new THREE.Vector3},o.push(a),u.push(f)}o=this.morphNormals[e],s.vertices=this.morphTargets[e].vertices,s.computeFaceNormals(),s.computeVertexNormals(),n=0;for(r=this.faces.length;n<r;n++)i=this.faces[n],a=o.faceNormals[n],f=o.vertexNormals[n],a.copy(i.normal),i instanceof THREE.Face3?(f.a.copy(i.vertexNormals[0]),f.b.copy(i.vertexNormals[1]),f.c.copy(i.vertexNormals[2])):(f.a.copy(i.vertexNormals[0]),f.b.copy(i.vertexNormals[1]),f.c.copy(i.vertexNormals[2]),f.d.copy(i.vertexNormals[3]))}n=0;for(r=this.faces.length;n<r;n++)i=this.faces[n],i.normal=i.__originalFaceNormal,i.vertexNormals=i.__originalVertexNormals},computeTangents:function(){function e(e,t,n,r,i,s,T){u=e.vertices[t],a=e.vertices[n],f=e.vertices[r],l=o[i],c=o[s],h=o[T],p=a.x-u.x,d=f.x-u.x,v=a.y-u.y,m=f.y-u.y,g=a.z-u.z,y=f.z-u.z,b=c.x-l.x,w=h.x-l.x,E=c.y-l.y,S=h.y-l.y,x=1/(b*S-w*E),k.set((S*p-E*d)*x,(S*v-E*m)*x,(S*g-E*y)*x),L.set((b*d-w*p)*x,(b*m-w*v)*x,(b*y-w*g)*x),N[t].add(k),N[n].add(k),N[r].add(k),C[t].add(L),C[n].add(L),C[r].add(L)}var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N=[],C=[],k=new THREE.Vector3,L=new THREE.Vector3,A=new THREE.Vector3,O=new THREE.Vector3,M=new THREE.Vector3;t=0;for(n=this.vertices.length;t<n;t++)N[t]=new THREE.Vector3,C[t]=new THREE.Vector3;t=0;for(n=this.faces.length;t<n;t++)s=this.faces[t],o=this.faceVertexUvs[0][t],s instanceof THREE.Face3?e(this,s.a,s.b,s.c,0,1,2):s instanceof THREE.Face4&&(e(this,s.a,s.b,s.d,0,1,3),e(this,s.b,s.c,s.d,1,2,3));var _=["a","b","c","d"];t=0;for(n=this.faces.length;t<n;t++){s=this.faces[t];for(r=0;r<s.vertexNormals.length;r++)M.copy(s.vertexNormals[r]),i=s[_[r]],T=N[i],A.copy(T),A.sub(M.multiplyScalar(M.dot(T))).normalize(),O.crossVectors(s.vertexNormals[r],T),i=O.dot(C[i]),i=0>i?-1:1,s.vertexTangents[r]=new THREE.Vector4(A.x,A.y,A.z,i)}this.hasTangents=!0},computeLineDistances:function(){for(var e=0,t=this.vertices,n=0,r=t.length;n<r;n++)0<n&&(e+=t[n].distanceTo(t[n-1])),this.lineDistances[n]=e},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere),this.boundingSphere.setFromCenterAndPoints(this.boundingSphere.center,this.vertices)},mergeVertices:function(){var e={},t=[],n=[],r,i=Math.pow(10,4),s,o,u,a,f;this.__tmpVertices=void 0,s=0;for(o=this.vertices.length;s<o;s++)r=this.vertices[s],r=[Math.round(r.x*i),Math.round(r.y*i),Math.round(r.z*i)].join("_"),void 0===e[r]?(e[r]=s,t.push(this.vertices[s]),n[s]=t.length-1):n[s]=n[e[r]];i=[],s=0;for(o=this.faces.length;s<o;s++)if(e=this.faces[s],e instanceof THREE.Face3){e.a=n[e.a],e.b=n[e.b],e.c=n[e.c],u=[e.a,e.b,e.c],r=-1;for(a=0;3>a;a++)if(u[a]==u[(a+1)%3]){i.push(s);break}}else if(e instanceof THREE.Face4){e.a=n[e.a],e.b=n[e.b],e.c=n[e.c],e.d=n[e.d],u=[e.a,e.b,e.c,e.d],r=-1;for(a=0;4>a;a++)u[a]==u[(a+1)%4]&&(0<=r&&i.push(s),r=a);if(0<=r){u.splice(r,1);var l=new THREE.Face3(u[0],u[1],u[2],e.normal,e.color,e.materialIndex);u=0;for(a=this.faceVertexUvs.length;u<a;u++)(f=this.faceVertexUvs[u][s])&&f.splice(r,1);e.vertexNormals&&0<e.vertexNormals.length&&(l.vertexNormals=e.vertexNormals,l.vertexNormals.splice(r,1)),e.vertexColors&&0<e.vertexColors.length&&(l.vertexColors=e.vertexColors,l.vertexColors.splice(r,1)),this.faces[s]=l}}for(s=i.length-1;0<=s;s--){this.faces.splice(s,1),u=0;for(a=this.faceVertexUvs.length;u<a;u++)this.faceVertexUvs[u].splice(s,1)}return n=this.vertices.length-t.length,this.vertices=t,n},clone:function(){for(var e=new THREE.Geometry,t=this.vertices,n=0,r=t.length;n<r;n++)e.vertices.push(t[n].clone());t=this.faces,n=0;for(r=t.length;n<r;n++)e.faces.push(t[n].clone());t=this.faceVertexUvs[0],n=0;for(r=t.length;n<r;n++){for(var i=t[n],s=[],o=0,u=i.length;o<u;o++)s.push(new THREE.Vector2(i[o].x,i[o].y));e.faceVertexUvs[0].push(s)}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.GeometryIdCount=0,THREE.BufferGeometry=function(){THREE.EventDispatcher.call(this),this.id=THREE.GeometryIdCount++,this.attributes={},this.dynamic=!1,this.offsets=[],this.boundingSphere=this.boundingBox=null,this.hasTangents=!1,this.morphTargets=[]},THREE.BufferGeometry.prototype={constructor:THREE.BufferGeometry,applyMatrix:function(e){var t,n;this.attributes.position&&(t=this.attributes.position.array),this.attributes.normal&&(n=this.attributes.normal.array),void 0!==t&&(e.multiplyVector3Array(t),this.verticesNeedUpdate=!0),void 0!==n&&(t=new THREE.Matrix3,t.getInverse(e).transpose(),t.multiplyVector3Array(n),this.normalizeNormals(),this.normalsNeedUpdate=!0)},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3);var e=this.attributes.position.array;if(e){var t=this.boundingBox,n,r,i;3<=e.length&&(t.min.x=t.max.x=e[0],t.min.y=t.max.y=e[1],t.min.z=t.max.z=e[2]);for(var s=3,o=e.length;s<o;s+=3)n=e[s],r=e[s+1],i=e[s+2],n<t.min.x?t.min.x=n:n>t.max.x&&(t.max.x=n),r<t.min.y?t.min.y=r:r>t.max.y&&(t.max.y=r),i<t.min.z?t.min.z=i:i>t.max.z&&(t.max.z=i)}if(void 0===e||0===e.length)this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere);var e=this.attributes.position.array;if(e){for(var t,n=0,r,i,s=0,o=e.length;s<o;s+=3)t=e[s],r=e[s+1],i=e[s+2],t=t*t+r*r+i*i,t>n&&(n=t);this.boundingSphere.radius=Math.sqrt(n)}},computeVertexNormals:function(){if(this.attributes.position){var e,t,n,r;e=this.attributes.position.array.length;if(void 0===this.attributes.normal)this.attributes.normal={itemSize:3,array:new Float32Array(e),numItems:e};else{e=0;for(t=this.attributes.normal.array.length;e<t;e++)this.attributes.normal.array[e]=0}var i=this.attributes.position.array,s=this.attributes.normal.array,o,u,a,f,l,c,h=new THREE.Vector3,p=new THREE.Vector3,d=new THREE.Vector3,v=new THREE.Vector3,m=new THREE.Vector3;if(this.attributes.index){var g=this.attributes.index.array,y=this.offsets;n=0;for(r=y.length;n<r;++n){t=y[n].start,o=y[n].count;var b=y[n].index;e=t;for(t+=o;e<t;e+=3)o=b+g[e],u=b+g[e+1],a=b+g[e+2],f=i[3*o],l=i[3*o+1],c=i[3*o+2],h.set(f,l,c),f=i[3*u],l=i[3*u+1],c=i[3*u+2],p.set(f,l,c),f=i[3*a],l=i[3*a+1],c=i[3*a+2],d.set(f,l,c),v.subVectors(d,p),m.subVectors(h,p),v.cross(m),s[3*o]+=v.x,s[3*o+1]+=v.y,s[3*o+2]+=v.z,s[3*u]+=v.x,s[3*u+1]+=v.y,s[3*u+2]+=v.z,s[3*a]+=v.x,s[3*a+1]+=v.y,s[3*a+2]+=v.z}}else{e=0;for(t=i.length;e<t;e+=9)f=i[e],l=i[e+1],c=i[e+2],h.set(f,l,c),f=i[e+3],l=i[e+4],c=i[e+5],p.set(f,l,c),f=i[e+6],l=i[e+7],c=i[e+8],d.set(f,l,c),v.subVectors(d,p),m.subVectors(h,p),v.cross(m),s[e]=v.x,s[e+1]=v.y,s[e+2]=v.z,s[e+3]=v.x,s[e+4]=v.y,s[e+5]=v.z,s[e+6]=v.x,s[e+7]=v.y,s[e+8]=v.z}this.normalizeNormals(),this.normalsNeedUpdate=!0}},normalizeNormals:function(){for(var e=this.attributes.normal.array,t,n,r,i=0,s=e.length;i<s;i+=3)t=e[i],n=e[i+1],r=e[i+2],t=1/Math.sqrt(t*t+n*n+r*r),e[i]*=t,e[i+1]*=t,e[i+2]*=t},computeTangents:function(){function e(e){B.x=r[3*e],B.y=r[3*e+1],B.z=r[3*e+2],j.copy(B),I=a[e],P.copy(I),P.sub(B.multiplyScalar(B.dot(I))).normalize(),H.crossVectors(j,I),q=H.dot(f[e]),F=0>q?-1:1,u[4*e]=P.x,u[4*e+1]=P.y,u[4*e+2]=P.z,u[4*e+3]=F}if(void 0===this.attributes.index||void 0===this.attributes.position||void 0===this.attributes.normal||void 0===this.attributes.uv)console.warn("Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");else{var t=this.attributes.index.array,n=this.attributes.position.array,r=this.attributes.normal.array,i=this.attributes.uv.array,s=n.length/3;if(void 0===this.attributes.tangent){var o=4*s;this.attributes.tangent={itemSize:4,array:new Float32Array(o),numItems:o}}for(var u=this.attributes.tangent.array,a=[],f=[],o=0;o<s;o++)a[o]=new THREE.Vector3,f[o]=new THREE.Vector3;var l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,s=new THREE.Vector3,o=new THREE.Vector3,N,C,k,L,A,O,M,_=this.offsets;k=0;for(L=_.length;k<L;++k){C=_[k].start,A=_[k].count;var D=_[k].index;N=C;for(C+=A;N<C;N+=3)A=D+t[N],O=D+t[N+1],M=D+t[N+2],l=n[3*A],c=n[3*A+1],h=n[3*A+2],p=n[3*O],d=n[3*O+1],v=n[3*O+2],m=n[3*M],g=n[3*M+1],y=n[3*M+2],b=i[2*A],w=i[2*A+1],E=i[2*O],S=i[2*O+1],x=i[2*M],T=i[2*M+1],p-=l,l=m-l,d-=c,c=g-c,v-=h,h=y-h,E-=b,b=x-b,S-=w,w=T-w,T=1/(E*w-b*S),s.set((w*p-S*l)*T,(w*d-S*c)*T,(w*v-S*h)*T),o.set((E*l-b*p)*T,(E*c-b*d)*T,(E*h-b*v)*T),a[A].add(s),a[O].add(s),a[M].add(s),f[A].add(o),f[O].add(o),f[M].add(o)}var P=new THREE.Vector3,H=new THREE.Vector3,B=new THREE.Vector3,j=new THREE.Vector3,F,I,q;k=0;for(L=_.length;k<L;++k){C=_[k].start,A=_[k].count,D=_[k].index,N=C;for(C+=A;N<C;N+=3)A=D+t[N],O=D+t[N+1],M=D+t[N+2],e(A),e(O),e(M)}this.tangentsNeedUpdate=this.hasTangents=!0}},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.Camera=function(){THREE.Object3D.call(this),this.matrixWorldInverse=new THREE.Matrix4,this.projectionMatrix=new THREE.Matrix4,this.projectionMatrixInverse=new THREE.Matrix4},THREE.Camera.prototype=Object.create(THREE.Object3D.prototype),THREE.Camera.prototype.lookAt=function(){var e=new THREE.Matrix4;return function(t){e.lookAt(this.position,t,this.up),!0===this.useQuaternion?this.quaternion.setFromRotationMatrix(e):this.rotation.setEulerFromRotationMatrix(e,this.eulerOrder)}}(),THREE.OrthographicCamera=function(e,t,n,r,i,s){THREE.Camera.call(this),this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=void 0!==i?i:.1,this.far=void 0!==s?s:2e3,this.updateProjectionMatrix()},THREE.OrthographicCamera.prototype=Object.create(THREE.Camera.prototype),THREE.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far)},THREE.PerspectiveCamera=function(e,t,n,r){THREE.Camera.call(this),this.fov=void 0!==e?e:50,this.aspect=void 0!==t?t:1,this.near=void 0!==n?n:.1,this.far=void 0!==r?r:2e3,this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype=Object.create(THREE.Camera.prototype),THREE.PerspectiveCamera.prototype.setLens=function(e,t){void 0===t&&(t=24),this.fov=2*THREE.Math.radToDeg(Math.atan(t/(2*e))),this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype.setViewOffset=function(e,t,n,r,i,s){this.fullWidth=e,this.fullHeight=t,this.x=n,this.y=r,this.width=i,this.height=s,this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var e=this.fullWidth/this.fullHeight,t=Math.tan(THREE.Math.degToRad(.5*this.fov))*this.near,n=-t,r=e*n,e=Math.abs(e*t-r),n=Math.abs(t-n);this.projectionMatrix.makeFrustum(r+this.x*e/this.fullWidth,r+(this.x+this.width)*e/this.fullWidth,t-(this.y+this.height)*n/this.fullHeight,t-this.y*n/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far)},THREE.Light=function(e){THREE.Object3D.call(this),this.color=new THREE.Color(e)},THREE.Light.prototype=Object.create(THREE.Object3D.prototype),THREE.Light.prototype.clone=function(e){return void 0===e&&(e=new THREE.Light),THREE.Object3D.prototype.clone.call(this,e),e.color.copy(this.color),e},THREE.AmbientLight=function(e){THREE.Light.call(this,e)},THREE.AmbientLight.prototype=Object.create(THREE.Light.prototype),THREE.AmbientLight.prototype.clone=function(){var e=new THREE.AmbientLight;return THREE.Light.prototype.clone.call(this,e),e},THREE.AreaLight=function(e,t){THREE.Light.call(this,e),this.normal=new THREE.Vector3(0,-1,0),this.right=new THREE.Vector3(1,0,0),this.intensity=void 0!==t?t:1,this.height=this.width=1,this.constantAttenuation=1.5,this.linearAttenuation=.5,this.quadraticAttenuation=.1},THREE.AreaLight.prototype=Object.create(THREE.Light.prototype),THREE.DirectionalLight=function(e,t){THREE.Light.call(this,e),this.position.set(0,1,0),this.target=new THREE.Object3D,this.intensity=void 0!==t?t:1,this.onlyShadow=this.castShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,this.shadowCameraTop=this.shadowCameraRight=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapHeight=this.shadowMapWidth=512,this.shadowCascade=!1,this.shadowCascadeOffset=new THREE.Vector3(0,0,-1e3),this.shadowCascadeCount=2,this.shadowCascadeBias=[0,0,0],this.shadowCascadeWidth=[512,512,512],this.shadowCascadeHeight=[512,512,512],this.shadowCascadeNearZ=[-1,.99,.998],this.shadowCascadeFarZ=[.99,.998,1],this.shadowCascadeArray=[],this.shadowMatrix=this.shadowCamera=this.shadowMapSize=this.shadowMap=null},THREE.DirectionalLight.prototype=Object.create(THREE.Light.prototype),THREE.DirectionalLight.prototype.clone=function(){var e=new THREE.DirectionalLight;return THREE.Light.prototype.clone.call(this,e),e.target=this.target.clone(),e.intensity=this.intensity,e.castShadow=this.castShadow,e.onlyShadow=this.onlyShadow,e},THREE.HemisphereLight=function(e,t,n){THREE.Light.call(this,e),this.position.set(0,100,0),this.groundColor=new THREE.Color(t),this.intensity=void 0!==n?n:1},THREE.HemisphereLight.prototype=Object.create(THREE.Light.prototype),THREE.HemisphereLight.prototype.clone=function(){var e=new THREE.PointLight;return THREE.Light.prototype.clone.call(this,e),e.groundColor.copy(this.groundColor),e.intensity=this.intensity,e},THREE.PointLight=function(e,t,n){THREE.Light.call(this,e),this.intensity=void 0!==t?t:1,this.distance=void 0!==n?n:0},THREE.PointLight.prototype=Object.create(THREE.Light.prototype),THREE.PointLight.prototype.clone=function(){var e=new THREE.PointLight;return THREE.Light.prototype.clone.call(this,e),e.intensity=this.intensity,e.distance=this.distance,e},THREE.SpotLight=function(e,t,n,r,i){THREE.Light.call(this,e),this.position.set(0,1,0),this.target=new THREE.Object3D,this.intensity=void 0!==t?t:1,this.distance=void 0!==n?n:0,this.angle=void 0!==r?r:Math.PI/2,this.exponent=void 0!==i?i:10,this.onlyShadow=this.castShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapHeight=this.shadowMapWidth=512,this.shadowMatrix=this.shadowCamera=this.shadowMapSize=this.shadowMap=null},THREE.SpotLight.prototype=Object.create(THREE.Light.prototype),THREE.SpotLight.prototype.clone=function(){var e=new THREE.SpotLight;return THREE.Light.prototype.clone.call(this,e),e.target=this.target.clone(),e.intensity=this.intensity,e.distance=this.distance,e.angle=this.angle,e.exponent=this.exponent,e.castShadow=this.castShadow,e.onlyShadow=this.onlyShadow,e},THREE.Loader=function(e){this.statusDomElement=(this.showStatus=e)?THREE.Loader.prototype.addStatusElement():null,this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},THREE.Loader.prototype={constructor:THREE.Loader,crossOrigin:"anonymous",addStatusElement:function(){var e=document.createElement("div");return e.style.position="absolute",e.style.right="0px",e.style.top="0px",e.style.fontSize="0.8em",e.style.textAlign="left",e.style.background="rgba(0,0,0,0.25)",e.style.color="#fff",e.style.width="120px",e.style.padding="0.5em 0.5em 0.5em 0.5em",e.style.zIndex=1e3,e.innerHTML="Loading ...",e},updateProgress:function(e){var t="Loaded ",t=e.total?t+((100*e.loaded/e.total).toFixed(0)+"%"):t+((e.loaded/1e3).toFixed(2)+" KB");this.statusDomElement.innerHTML=t},extractUrlBase:function(e){return e=e.split("/"),e.pop(),(1>e.length?".":e.join("/"))+"/"},initMaterials:function(e,t){for(var n=[],r=0;r<e.length;++r)n[r]=THREE.Loader.prototype.createMaterial(e[r],t);return n},needsTangents:function(e){for(var t=0,n=e.length;t<n;t++)if(e[t]instanceof THREE.ShaderMaterial)return!0;return!1},createMaterial:function(e,t){function n(e){return e=Math.log(e)/Math.LN2,Math.floor(e)==e}function r(e){return e=Math.log(e)/Math.LN2,Math.pow(2,Math.round(e))}function i(e,i,s,u,a,f,l){var h=/\.dds$/i.test(s),p=t+"/"+s;if(h){var v=THREE.ImageUtils.loadCompressedTexture(p);e[i]=v}else v=document.createElement("canvas"),e[i]=new THREE.Texture(v);e[i].sourceFile=s,u&&(e[i].repeat.set(u[0],u[1]),1!==u[0]&&(e[i].wrapS=THREE.RepeatWrapping),1!==u[1]&&(e[i].wrapT=THREE.RepeatWrapping)),a&&e[i].offset.set(a[0],a[1]),f&&(s={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping},void 0!==s[f[0]]&&(e[i].wrapS=s[f[0]]),void 0!==s[f[1]]&&(e[i].wrapT=s[f[1]])),l&&(e[i].anisotropy=l);if(!h){var m=e[i],e=new Image;e.onload=function(){if(!n(this.width)||!n(this.height)){var e=r(this.width),t=r(this.height);m.image.width=e,m.image.height=t,m.image.getContext("2d").drawImage(this,0,0,e,t)}else m.image=this;m.needsUpdate=!0},e.crossOrigin=o.crossOrigin,e.src=p}}function s(e){return(255*e[0]<<16)+(255*e[1]<<8)+255*e[2]}var o=this,u="MeshLambertMaterial",a={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:!1};if(e.shading){var f=e.shading.toLowerCase();"phong"===f?u="MeshPhongMaterial":"basic"===f&&(u="MeshBasicMaterial")}void 0!==e.blending&&void 0!==THREE[e.blending]&&(a.blending=THREE[e.blending]);if(void 0!==e.transparent||1>e.opacity)a.transparent=e.transparent;return void 0!==e.depthTest&&(a.depthTest=e.depthTest),void 0!==e.depthWrite&&(a.depthWrite=e.depthWrite),void 0!==e.visible&&(a.visible=e.visible),void 0!==e.flipSided&&(a.side=THREE.BackSide),void 0!==e.doubleSided&&(a.side=THREE.DoubleSide),void 0!==e.wireframe&&(a.wireframe=e.wireframe),void 0!==e.vertexColors&&("face"===e.vertexColors?a.vertexColors=THREE.FaceColors:e.vertexColors&&(a.vertexColors=THREE.VertexColors)),e.colorDiffuse?a.color=s(e.colorDiffuse):e.DbgColor&&(a.color=e.DbgColor),e.colorSpecular&&(a.specular=s(e.colorSpecular)),e.colorAmbient&&(a.ambient=s(e.colorAmbient)),e.transparency&&(a.opacity=e.transparency),e.specularCoef&&(a.shininess=e.specularCoef),e.mapDiffuse&&t&&i(a,"map",e.mapDiffuse,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap,e.mapDiffuseAnisotropy),e.mapLight&&t&&i(a,"lightMap",e.mapLight,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap,e.mapLightAnisotropy),e.mapBump&&t&&i(a,"bumpMap",e.mapBump,e.mapBumpRepeat,e.mapBumpOffset,e.mapBumpWrap,e.mapBumpAnisotropy),e.mapNormal&&t&&i(a,"normalMap",e.mapNormal,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap,e.mapNormalAnisotropy),e.mapSpecular&&t&&i(a,"specularMap",e.mapSpecular,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap,e.mapSpecularAnisotropy),e.mapBumpScale&&(a.bumpScale=e.mapBumpScale),e.mapNormal?(u=THREE.ShaderLib.normalmap,f=THREE.UniformsUtils.clone(u.uniforms),f.tNormal.value=a.normalMap,e.mapNormalFactor&&f.uNormalScale.value.set(e.mapNormalFactor,e.mapNormalFactor),a.map&&(f.tDiffuse.value=a.map,f.enableDiffuse.value=!0),a.specularMap&&(f.tSpecular.value=a.specularMap,f.enableSpecular.value=!0),a.lightMap&&(f.tAO.value=a.lightMap,f.enableAO.value=!0),f.uDiffuseColor.value.setHex(a.color),f.uSpecularColor.value.setHex(a.specular),f.uAmbientColor.value.setHex(a.ambient),f.uShininess.value=a.shininess,void 0!==a.opacity&&(f.uOpacity.value=a.opacity),u=new THREE.ShaderMaterial({fragmentShader:u.fragmentShader,vertexShader:u.vertexShader,uniforms:f,lights:!0,fog:!0}),a.transparent&&(u.transparent=!0)):u=new THREE[u](a),void 0!==e.DbgName&&(u.name=e.DbgName),u}},THREE.ImageLoader=function(){THREE.EventDispatcher.call(this),this.crossOrigin=null},THREE.ImageLoader.prototype={constructor:THREE.ImageLoader,load:function(e,t){var n=this;void 0===t&&(t=new Image),t.addEventListener("load",function(){n.dispatchEvent({type:"load",content:t})},!1),t.addEventListener("error",function(){n.dispatchEvent({type:"error",message:"Couldn't load URL ["+e+"]"})},!1),n.crossOrigin&&(t.crossOrigin=n.crossOrigin),t.src=e}},THREE.JSONLoader=function(e){THREE.Loader.call(this,e),this.withCredentials=!1},THREE.JSONLoader.prototype=Object.create(THREE.Loader.prototype),THREE.JSONLoader.prototype.load=function(e,t,n){n=n&&"string"==typeof n?n:this.extractUrlBase(e),this.onLoadStart(),this.loadAjaxJSON(this,e,t,n)},THREE.JSONLoader.prototype.loadAjaxJSON=function(e,t,n,r,i){var s=new XMLHttpRequest,o=0;s.onreadystatechange=function(){if(s.readyState===s.DONE)if(200===s.status||0===s.status){if(s.responseText){var u=JSON.parse(s.responseText),u=e.parse(u,r);n(u.geometry,u.materials)}else console.warn("THREE.JSONLoader: ["+t+"] seems to be unreachable or file there is empty");e.onLoadComplete()}else console.error("THREE.JSONLoader: Couldn't load ["+t+"] ["+s.status+"]");else s.readyState===s.LOADING?i&&(0===o&&(o=s.getResponseHeader("Content-Length")),i({total:o,loaded:s.responseText.length})):s.readyState===s.HEADERS_RECEIVED&&(o=s.getResponseHeader("Content-Length"))},s.open("GET",t,!0),s.withCredentials=this.withCredentials,s.send(null)},THREE.JSONLoader.prototype.parse=function(e,t){var n=new THREE.Geometry,r=void 0!==e.scale?1/e.scale:1,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b=e.faces;p=e.vertices;var w=e.normals,E=e.colors,S=0;for(i=0;i<e.uvs.length;i++)e.uvs[i].length&&S++;for(i=0;i<S;i++)n.faceUvs[i]=[],n.faceVertexUvs[i]=[];u=0;for(a=p.length;u<a;)f=new THREE.Vector3,f.x=p[u++]*r,f.y=p[u++]*r,f.z=p[u++]*r,n.vertices.push(f);u=0;for(a=b.length;u<a;){p=b[u++],f=p&1,o=p&2,i=p&4,s=p&8,c=p&16,l=p&32,d=p&64,p&=128,f?(v=new THREE.Face4,v.a=b[u++],v.b=b[u++],v.c=b[u++],v.d=b[u++],f=4):(v=new THREE.Face3,v.a=b[u++],v.b=b[u++],v.c=b[u++],f=3),o&&(o=b[u++],v.materialIndex=o),o=n.faces.length;if(i)for(i=0;i<S;i++)m=e.uvs[i],h=b[u++],y=m[2*h],h=m[2*h+1],n.faceUvs[i][o]=new THREE.Vector2(y,h);if(s)for(i=0;i<S;i++){m=e.uvs[i],g=[];for(s=0;s<f;s++)h=b[u++],y=m[2*h],h=m[2*h+1],g[s]=new THREE.Vector2(y,h);n.faceVertexUvs[i][o]=g}c&&(c=3*b[u++],s=new THREE.Vector3,s.x=w[c++],s.y=w[c++],s.z=w[c],v.normal=s);if(l)for(i=0;i<f;i++)c=3*b[u++],s=new THREE.Vector3,s.x=w[c++],s.y=w[c++],s.z=w[c],v.vertexNormals.push(s);d&&(l=b[u++],l=new THREE.Color(E[l]),v.color=l);if(p)for(i=0;i<f;i++)l=b[u++],l=new THREE.Color(E[l]),v.vertexColors.push(l);n.faces.push(v)}if(e.skinWeights){u=0;for(a=e.skinWeights.length;u<a;u+=2)b=e.skinWeights[u],w=e.skinWeights[u+1],n.skinWeights.push(new THREE.Vector4(b,w,0,0))}if(e.skinIndices){u=0;for(a=e.skinIndices.length;u<a;u+=2)b=e.skinIndices[u],w=e.skinIndices[u+1],n.skinIndices.push(new THREE.Vector4(b,w,0,0))}n.bones=e.bones,n.animation=e.animation;if(void 0!==e.morphTargets){u=0;for(a=e.morphTargets.length;u<a;u++){n.morphTargets[u]={},n.morphTargets[u].name=e.morphTargets[u].name,n.morphTargets[u].vertices=[],E=n.morphTargets[u].vertices,S=e.morphTargets[u].vertices,b=0;for(w=S.length;b<w;b+=3)p=new THREE.Vector3,p.x=S[b]*r,p.y=S[b+1]*r,p.z=S[b+2]*r,E.push(p)}}if(void 0!==e.morphColors){u=0;for(a=e.morphColors.length;u<a;u++){n.morphColors[u]={},n.morphColors[u].name=e.morphColors[u].name,n.morphColors[u].colors=[],w=n.morphColors[u].colors,E=e.morphColors[u].colors,r=0;for(b=E.length;r<b;r+=3)S=new THREE.Color(16755200),S.setRGB(E[r],E[r+1],E[r+2]),w.push(S)}}return n.computeCentroids(),n.computeFaceNormals(),r=this.initMaterials(e.materials,t),this.needsTangents(r)&&n.computeTangents(),{geometry:n,materials:r}},THREE.LoadingMonitor=function(){THREE.EventDispatcher.call(this);var e=this,t=0,n=0,r=function(){t++,e.dispatchEvent({type:"progress",loaded:t,total:n}),t===n&&e.dispatchEvent({type:"load"})};this.add=function(e){n++,e.addEventListener("load",r,!1)}},THREE.SceneLoader=function(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){},this.callbackSync=function(){},this.callbackProgress=function(){},this.geometryHandlerMap={},this.hierarchyHandlerMap={},this.addGeometryHandler("ascii",THREE.JSONLoader)},THREE.SceneLoader.prototype.constructor=THREE.SceneLoader,THREE.SceneLoader.prototype.load=function(e,t){var n=this,r=new XMLHttpRequest;r.onreadystatechange=function(){if(4===r.readyState)if(200===r.status||0===r.status){var i=JSON.parse(r.responseText);n.parse(i,t,e)}else console.error("THREE.SceneLoader: Couldn't load ["+e+"] ["+r.status+"]")},r.open("GET",e,!0),r.send(null)},THREE.SceneLoader.prototype.addGeometryHandler=function(e,t){this.geometryHandlerMap[e]={loaderClass:t}},THREE.SceneLoader.prototype.addHierarchyHandler=function(e,t){this.hierarchyHandlerMap[e]={loaderClass:t}},THREE.SceneLoader.prototype.parse=function(e,t,n){function r(e,t){return"relativeToHTML"==t?e:c+"/"+e}function i(){s(T.scene,C.objects)}function s(e,t){var n,i,o,a,f,c,v;for(v in t)if(void 0===T.objects[v]){var m=t[v],w=null;if(m.type&&m.type in l.hierarchyHandlerMap){if(void 0===m.loading){i={type:1,url:1,material:1,position:1,rotation:1,scale:1,visible:1,children:1,userData:1,skin:1,morph:1,mirroredLoop:1,duration:1},o={};for(var E in m)E in i||(o[E]=m[E]);p=T.materials[m.material],m.loading=!0,i=l.hierarchyHandlerMap[m.type].loaderObject,i.options?i.load(r(m.url,C.urlBaseType),u(v,e,p,m)):i.load(r(m.url,C.urlBaseType),u(v,e,p,m),o)}}else if(void 0!==m.geometry){if(h=T.geometries[m.geometry]){w=!1,p=T.materials[m.material],w=p instanceof THREE.ShaderMaterial,o=m.position,a=m.rotation,f=m.scale,n=m.matrix,c=m.quaternion,m.material||(p=new THREE.MeshFaceMaterial(T.face_materials[m.geometry])),p instanceof THREE.MeshFaceMaterial&&0===p.materials.length&&(p=new THREE.MeshFaceMaterial(T.face_materials[m.geometry]));if(p instanceof THREE.MeshFaceMaterial)for(i=0;i<p.materials.length;i++)w=w||p.materials[i]instanceof THREE.ShaderMaterial;w&&h.computeTangents(),m.skin?w=new THREE.SkinnedMesh(h,p):m.morph?(w=new THREE.MorphAnimMesh(h,p),void 0!==m.duration&&(w.duration=m.duration),void 0!==m.time&&(w.time=m.time),void 0!==m.mirroredLoop&&(w.mirroredLoop=m.mirroredLoop),p.morphNormals&&h.computeMorphNormals()):w=new THREE.Mesh(h,p),w.name=v,n?(w.matrixAutoUpdate=!1,w.matrix.set(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15])):(w.position.set(o[0],o[1],o[2]),c?(w.quaternion.set(c[0],c[1],c[2],c[3]),w.useQuaternion=!0):w.rotation.set(a[0],a[1],a[2]),w.scale.set(f[0],f[1],f[2])),w.visible=m.visible,w.castShadow=m.castShadow,w.receiveShadow=m.receiveShadow,e.add(w),T.objects[v]=w}}else"DirectionalLight"===m.type||"PointLight"===m.type||"AmbientLight"===m.type?(y=void 0!==m.color?m.color:16777215,b=void 0!==m.intensity?m.intensity:1,"DirectionalLight"===m.type?(o=m.direction,g=new THREE.DirectionalLight(y,b),g.position.set(o[0],o[1],o[2]),m.target&&(N.push({object:g,targetName:m.target}),g.target=null)):"PointLight"===m.type?(o=m.position,i=m.distance,g=new THREE.PointLight(y,b,i),g.position.set(o[0],o[1],o[2])):"AmbientLight"===m.type&&(g=new THREE.AmbientLight(y)),e.add(g),g.name=v,T.lights[v]=g,T.objects[v]=g):"PerspectiveCamera"===m.type||"OrthographicCamera"===m.type?("PerspectiveCamera"===m.type?d=new THREE.PerspectiveCamera(m.fov,m.aspect,m.near,m.far):"OrthographicCamera"===m.type&&(d=new THREE.OrthographicCamera(m.left,m.right,m.top,m.bottom,m.near,m.far)),o=m.position,d.position.set(o[0],o[1],o[2]),e.add(d),d.name=v,T.cameras[v]=d,T.objects[v]=d):(o=m.position,a=m.rotation,f=m.scale,c=m.quaternion,w=new THREE.Object3D,w.name=v,w.position.set(o[0],o[1],o[2]),c?(w.quaternion.set(c[0],c[1],c[2],c[3]),w.useQuaternion=!0):w.rotation.set(a[0],a[1],a[2]),w.scale.set(f[0],f[1],f[2]),w.visible=void 0!==m.visible?m.visible:!1,e.add(w),T.objects[v]=w,T.empties[v]=w);if(w){if(void 0!==m.userData)for(var S in m.userData)w.userData[S]=m.userData[S];if(void 0!==m.groups)for(i=0;i<m.groups.length;i++)o=m.groups[i],void 0===T.groups[o]&&(T.groups[o]=[]),T.groups[o].push(v);void 0!==m.children&&s(w,m.children)}}}function o(e){return function(t,n){T.geometries[e]=t,T.face_materials[e]=n,i(),w-=1,l.onLoadComplete(),f()}}function u(e,t,n,r){return function(s){var s=s.content?s.content:s.dae?s.scene:s,o=r.position,u=r.rotation,a=r.quaternion,c=r.scale;s.position.set(o[0],o[1],o[2]),a?(s.quaternion.set(a[0],a[1],a[2],a[3]),s.useQuaternion=!0):s.rotation.set(u[0],u[1],u[2]),s.scale.set(c[0],c[1],c[2]),n&&s.traverse(function(e){e.material=n});var h=void 0!==r.visible?r.visible:!0;s.traverse(function(e){e.visible=h}),t.add(s),s.name=e,T.objects[e]=s,i(),w-=1,l.onLoadComplete(),f()}}function a(e){return function(t,n){T.geometries[e]=t,T.face_materials[e]=n}}function f(){l.callbackProgress({totalModels:S,totalTextures:x,loadedModels:S-w,loadedTextures:x-E},T),l.onLoadProgress();if(0===w&&0===E){for(var e=0;e<N.length;e++){var n=N[e],r=T.objects[n.targetName];r?n.object.target=r:(n.object.target=new THREE.Object3D,T.scene.add(n.object.target)),n.object.target.userData.targetInverse=n.object}t(T)}}var l=this,c=THREE.Loader.prototype.extractUrlBase(n),h,p,d,v,m,g,y,b,w,E,S,x,T,N=[],C=e,k;for(k in this.geometryHandlerMap)e=this.geometryHandlerMap[k].loaderClass,this.geometryHandlerMap[k].loaderObject=new e;for(k in this.hierarchyHandlerMap)e=this.hierarchyHandlerMap[k].loaderClass,this.hierarchyHandlerMap[k].loaderObject=new e;E=w=0,T={scene:new THREE.Scene,geometries:{},face_materials:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},empties:{},groups:{}},C.transform&&(k=C.transform.position,e=C.transform.rotation,n=C.transform.scale,k&&T.scene.position.set(k[0],k[1],k[2]),e&&T.scene.rotation.set(e[0],e[1],e[2]),n&&T.scene.scale.set(n[0],n[1],n[2]),k||e||n)&&(T.scene.updateMatrix(),T.scene.updateMatrixWorld()),k=function(e){return function(){E-=e,f(),l.onLoadComplete()}};for(var L in C.fogs)e=C.fogs[L],"linear"===e.type?v=new THREE.Fog(0,e.near,e.far):"exp2"===e.type&&(v=new THREE.FogExp2(0,e.density)),e=e.color,v.color.setRGB(e[0],e[1],e[2]),T.fogs[L]=v;for(var A in C.geometries)v=C.geometries[A],v.type in this.geometryHandlerMap&&(w+=1,l.onLoadStart());for(var O in C.objects)v=C.objects[O],v.type&&v.type in this.hierarchyHandlerMap&&(w+=1,l.onLoadStart());S=w;for(A in C.geometries)if(v=C.geometries[A],"cube"===v.type)h=new THREE.CubeGeometry(v.width,v.height,v.depth,v.widthSegments,v.heightSegments,v.depthSegments),T.geometries[A]=h;else if("plane"===v.type)h=new THREE.PlaneGeometry(v.width,v.height,v.widthSegments,v.heightSegments),T.geometries[A]=h;else if("sphere"===v.type)h=new THREE.SphereGeometry(v.radius,v.widthSegments,v.heightSegments),T.geometries[A]=h;else if("cylinder"===v.type)h=new THREE.CylinderGeometry(v.topRad,v.botRad,v.height,v.radSegs,v.heightSegs),T.geometries[A]=h;else if("torus"===v.type)h=new THREE.TorusGeometry(v.radius,v.tube,v.segmentsR,v.segmentsT),T.geometries[A]=h;else if("icosahedron"===v.type)h=new THREE.IcosahedronGeometry(v.radius,v.subdivisions),T.geometries[A]=h;else if(v.type in this.geometryHandlerMap){O={};for(m in v)"type"!==m&&"url"!==m&&(O[m]=v[m]);this.geometryHandlerMap[v.type].loaderObject.load(r(v.url,C.urlBaseType),o(A),O)}else"embedded"===v.type&&(O=C.embeds[v.id],O.metadata=C.metadata,O&&(O=this.geometryHandlerMap.ascii.loaderObject.parse(O,""),a(A)(O.geometry,O.materials)));for(var M in C.textures)if(A=C.textures[M],A.url instanceof Array){E+=A.url.length;for(m=0;m<A.url.length;m++)l.onLoadStart()}else E+=1,l.onLoadStart();x=E;for(M in C.textures){A=C.textures[M],void 0!==A.mapping&&void 0!==THREE[A.mapping]&&(A.mapping=new THREE[A.mapping]);if(A.url instanceof Array){O=A.url.length,v=[];for(m=0;m<O;m++)v[m]=r(A.url[m],C.urlBaseType);m=(m=/\.dds$/i.test(v[0]))?THREE.ImageUtils.loadCompressedTextureCube(v,A.mapping,k(O)):THREE.ImageUtils.loadTextureCube(v,A.mapping,k(O))}else m=/\.dds$/i.test(A.url),O=r(A.url,C.urlBaseType),v=k(1),m=m?THREE.ImageUtils.loadCompressedTexture(O,A.mapping,v):THREE.ImageUtils.loadTexture(O,A.mapping,v),void 0!==THREE[A.minFilter]&&(m.minFilter=THREE[A.minFilter]),void 0!==THREE[A.magFilter]&&(m.magFilter=THREE[A.magFilter]),A.anisotropy&&(m.anisotropy=A.anisotropy),A.repeat&&(m.repeat.set(A.repeat[0],A.repeat[1]),1!==A.repeat[0]&&(m.wrapS=THREE.RepeatWrapping),1!==A.repeat[1]&&(m.wrapT=THREE.RepeatWrapping)),A.offset&&m.offset.set(A.offset[0],A.offset[1]),A.wrap&&(O={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping},void 0!==O[A.wrap[0]]&&(m.wrapS=O[A.wrap[0]]),void 0!==O[A.wrap[1]]&&(m.wrapT=O[A.wrap[1]]));T.textures[M]=m}var _,D;for(_ in C.materials){M=C.materials[_];for(D in M.parameters)"envMap"===D||"map"===D||"lightMap"===D||"bumpMap"===D?M.parameters[D]=T.textures[M.parameters[D]]:"shading"===D?M.parameters[D]="flat"===M.parameters[D]?THREE.FlatShading:THREE.SmoothShading:"side"===D?M.parameters[D]="double"==M.parameters[D]?THREE.DoubleSide:"back"==M.parameters[D]?THREE.BackSide:THREE.FrontSide:"blending"===D?M.parameters[D]=M.parameters[D]in THREE?THREE[M.parameters[D]]:THREE.NormalBlending:"combine"===D?M.parameters[D]=M.parameters[D]in THREE?THREE[M.parameters[D]]:THREE.MultiplyOperation:"vertexColors"===D?"face"==M.parameters[D]?M.parameters[D]=THREE.FaceColors:M.parameters[D]&&(M.parameters[D]=THREE.VertexColors):"wrapRGB"===D&&(k=M.parameters[D],M.parameters[D]=new THREE.Vector3(k[0],k[1],k[2]));void 0!==M.parameters.opacity&&1>M.parameters.opacity&&(M.parameters.transparent=!0),M.parameters.normalMap?(k=THREE.ShaderLib.normalmap,A=THREE.UniformsUtils.clone(k.uniforms),m=M.parameters.color,O=M.parameters.specular,v=M.parameters.ambient,L=M.parameters.shininess,A.tNormal.value=T.textures[M.parameters.normalMap],M.parameters.normalScale&&A.uNormalScale.value.set(M.parameters.normalScale[0],M.parameters.normalScale[1]),M.parameters.map&&(A.tDiffuse.value=M.parameters.map,A.enableDiffuse.value=!0),M.parameters.envMap&&(A.tCube.value=M.parameters.envMap,A.enableReflection.value=!0,A.uReflectivity.value=M.parameters.reflectivity),M.parameters.lightMap&&(A.tAO.value=M.parameters.lightMap,A.enableAO.value=!0),M.parameters.specularMap&&(A.tSpecular.value=T.textures[M.parameters.specularMap],A.enableSpecular.value=!0),M.parameters.displacementMap&&(A.tDisplacement.value=T.textures[M.parameters.displacementMap],A.enableDisplacement.value=!0,A.uDisplacementBias.value=M.parameters.displacementBias,A.uDisplacementScale.value=M.parameters.displacementScale),A.uDiffuseColor.value.setHex(m),A.uSpecularColor.value.setHex(O),A.uAmbientColor.value.setHex(v),A.uShininess.value=L,M.parameters.opacity&&(A.uOpacity.value=M.parameters.opacity),p=new THREE.ShaderMaterial({fragmentShader:k.fragmentShader,vertexShader:k.vertexShader,uniforms:A,lights:!0,fog:!0})):p=new THREE[M.type](M.parameters),T.materials[_]=p}for(_ in C.materials)if(M=C.materials[_],M.parameters.materials){D=[];for(m=0;m<M.parameters.materials.length;m++)D.push(T.materials[M.parameters.materials[m]]);T.materials[_].materials=D}i(),T.cameras&&C.defaults.camera&&(T.currentCamera=T.cameras[C.defaults.camera]),T.fogs&&C.defaults.fog&&(T.scene.fog=T.fogs[C.defaults.fog]),l.callbackSync(T),f()},THREE.TextureLoader=function(){THREE.EventDispatcher.call(this),this.crossOrigin=null},THREE.TextureLoader.prototype={constructor:THREE.TextureLoader,load:function(e){var t=this,n=new Image;n.addEventListener("load",function(){var e=new THREE.Texture(n);e.needsUpdate=!0,t.dispatchEvent({type:"load",content:e})},!1),n.addEventListener("error",function(){t.dispatchEvent({type:"error",message:"Couldn't load URL ["+e+"]"})},!1),t.crossOrigin&&(n.crossOrigin=t.crossOrigin),n.src=e}},THREE.Material=function(){THREE.EventDispatcher.call(this),this.id=THREE.MaterialIdCount++,this.name="",this.side=THREE.FrontSide,this.opacity=1,this.transparent=!1,this.blending=THREE.NormalBlending,this.blendSrc=THREE.SrcAlphaFactor,this.blendDst=THREE.OneMinusSrcAlphaFactor,this.blendEquation=THREE.AddEquation,this.depthWrite=this.depthTest=!0,this.polygonOffset=!1,this.alphaTest=this.polygonOffsetUnits=this.polygonOffsetFactor=0,this.overdraw=!1,this.needsUpdate=this.visible=!0},THREE.Material.prototype.setValues=function(e){if(void 0!==e)for(var t in e){var n=e[t];if(void 0===n)console.warn("THREE.Material: '"+t+"' parameter is undefined.");else if(t in this){var r=this[t];r instanceof THREE.Color&&n instanceof THREE.Color?r.copy(n):r instanceof THREE.Color?r.set(n):r instanceof THREE.Vector3&&n instanceof THREE.Vector3?r.copy(n):this[t]=n}}},THREE.Material.prototype.clone=function(e){return void 0===e&&(e=new THREE.Material),e.name=this.name,e.side=this.side,e.opacity=this.opacity,e.transparent=this.transparent,e.blending=this.blending,e.blendSrc=this.blendSrc,e.blendDst=this.blendDst,e.blendEquation=this.blendEquation,e.depthTest=this.depthTest,e.depthWrite=this.depthWrite,e.polygonOffset=this.polygonOffset,e.polygonOffsetFactor=this.polygonOffsetFactor,e.polygonOffsetUnits=this.polygonOffsetUnits,e.alphaTest=this.alphaTest,e.overdraw=this.overdraw,e.visible=this.visible,e},THREE.Material.prototype.dispose=function(){this.dispatchEvent({type:"dispose"})},THREE.MaterialIdCount=0,THREE.LineBasicMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.linewidth=1,this.linejoin=this.linecap="round",this.vertexColors=!1,this.fog=!0,this.setValues(e)},THREE.LineBasicMaterial.prototype=Object.create(THREE.Material.prototype),THREE.LineBasicMaterial.prototype.clone=function(){var e=new THREE.LineBasicMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.linecap=this.linecap,e.linejoin=this.linejoin,e.vertexColors=this.vertexColors,e.fog=this.fog,e},THREE.LineDashedMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.scale=this.linewidth=1,this.dashSize=3,this.gapSize=1,this.vertexColors=!1,this.fog=!0,this.setValues(e)},THREE.LineDashedMaterial.prototype=Object.create(THREE.Material.prototype),THREE.LineDashedMaterial.prototype.clone=function(){var e=new THREE.LineDashedMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.scale=this.scale,e.dashSize=this.dashSize,e.gapSize=this.gapSize,e.vertexColors=this.vertexColors,e.fog=this.fog,e},THREE.MeshBasicMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.envMap=this.specularMap=this.lightMap=this.map=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=THREE.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.vertexColors=THREE.NoColors,this.morphTargets=this.skinning=!1,this.setValues(e)},THREE.MeshBasicMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshBasicMaterial.prototype.clone=function(){var e=new THREE.MeshBasicMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e},THREE.MeshLambertMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.ambient=new THREE.Color(16777215),this.emissive=new THREE.Color(0),this.wrapAround=!1,this.wrapRGB=new THREE.Vector3(1,1,1),this.envMap=this.specularMap=this.lightMap=this.map=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=THREE.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.vertexColors=THREE.NoColors,this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(e)},THREE.MeshLambertMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshLambertMaterial.prototype.clone=function(){var e=new THREE.MeshLambertMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},THREE.MeshPhongMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.ambient=new THREE.Color(16777215),this.emissive=new THREE.Color(0),this.specular=new THREE.Color(1118481),this.shininess=30,this.metal=!1,this.perPixel=!0,this.wrapAround=!1,this.wrapRGB=new THREE.Vector3(1,1,1),this.bumpMap=this.lightMap=this.map=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new THREE.Vector2(1,1),this.envMap=this.specularMap=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=THREE.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.vertexColors=THREE.NoColors,this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(e)},THREE.MeshPhongMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshPhongMaterial.prototype.clone=function(){var e=new THREE.MeshPhongMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.specular.copy(this.specular),e.shininess=this.shininess,e.metal=this.metal,e.perPixel=this.perPixel,e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.bumpMap=this.bumpMap,e.bumpScale=this.bumpScale,e.normalMap=this.normalMap,e.normalScale.copy(this.normalScale),e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},THREE.MeshDepthMaterial=function(e){THREE.Material.call(this),this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)},THREE.MeshDepthMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshDepthMaterial.prototype.clone=function(){var e=new THREE.MeshDepthMaterial;return THREE.Material.prototype.clone.call(this,e),e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},THREE.MeshNormalMaterial=function(e){THREE.Material.call(this,e),this.shading=THREE.FlatShading,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)},THREE.MeshNormalMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshNormalMaterial.prototype.clone=function(){var e=new THREE.MeshNormalMaterial;return THREE.Material.prototype.clone.call(this,e),e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},THREE.MeshFaceMaterial=function(e){this.materials=e instanceof Array?e:[]},THREE.MeshFaceMaterial.prototype.clone=function(){return new THREE.MeshFaceMaterial(this.materials.slice(0))},THREE.ParticleBasicMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.vertexColors=!1,this.fog=!0,this.setValues(e)},THREE.ParticleBasicMaterial.prototype=Object.create(THREE.Material.prototype),THREE.ParticleBasicMaterial.prototype.clone=function(){var e=new THREE.ParticleBasicMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.size=this.size,e.sizeAttenuation=this.sizeAttenuation,e.vertexColors=this.vertexColors,e.fog=this.fog,e},THREE.ParticleCanvasMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.program=function(){},this.setValues(e)},THREE.ParticleCanvasMaterial.prototype=Object.create(THREE.Material.prototype),THREE.ParticleCanvasMaterial.prototype.clone=function(){var e=new THREE.ParticleCanvasMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.program=this.program,e},THREE.ShaderMaterial=function(e){THREE.Material.call(this),this.vertexShader=this.fragmentShader="void main() {}",this.uniforms={},this.defines={},this.attributes=null,this.shading=THREE.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.lights=this.fog=!1,this.vertexColors=THREE.NoColors,this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(e)},THREE.ShaderMaterial.prototype=Object.create(THREE.Material.prototype),THREE.ShaderMaterial.prototype.clone=function(){var e=new THREE.ShaderMaterial;return THREE.Material.prototype.clone.call(this,e),e.fragmentShader=this.fragmentShader,e.vertexShader=this.vertexShader,e.uniforms=THREE.UniformsUtils.clone(this.uniforms),e.attributes=this.attributes,e.defines=this.defines,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.fog=this.fog,e.lights=this.lights,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},THREE.SpriteMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.map=new THREE.Texture,this.useScreenCoordinates=!0,this.depthTest=!this.useScreenCoordinates,this.sizeAttenuation=!this.useScreenCoordinates,this.scaleByViewport=!this.sizeAttenuation,this.alignment=THREE.SpriteAlignment.center.clone(),this.fog=!1,this.uvOffset=new THREE.Vector2(0,0),this.uvScale=new THREE.Vector2(1,1),this.setValues(e),e=e||{},void 0===e.depthTest&&(this.depthTest=!this.useScreenCoordinates),void 0===e.sizeAttenuation&&(this.sizeAttenuation=!this.useScreenCoordinates),void 0===e.scaleByViewport&&(this.scaleByViewport=!this.sizeAttenuation)},THREE.SpriteMaterial.prototype=Object.create(THREE.Material.prototype),THREE.SpriteMaterial.prototype.clone=function(){var e=new THREE.SpriteMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.useScreenCoordinates=this.useScreenCoordinates,e.sizeAttenuation=this.sizeAttenuation,e.scaleByViewport=this.scaleByViewport,e.alignment.copy(this.alignment),e.uvOffset.copy(this.uvOffset),e.uvScale.copy(this.uvScale),e.fog=this.fog,e},THREE.SpriteAlignment={},THREE.SpriteAlignment.topLeft=new THREE.Vector2(1,-1),THREE.SpriteAlignment.topCenter=new THREE.Vector2(0,-1),THREE.SpriteAlignment.topRight=new THREE.Vector2(-1,-1),THREE.SpriteAlignment.centerLeft=new THREE.Vector2(1,0),THREE.SpriteAlignment.center=new THREE.Vector2(0,0),THREE.SpriteAlignment.centerRight=new THREE.Vector2(-1,0),THREE.SpriteAlignment.bottomLeft=new THREE.Vector2(1,1),THREE.SpriteAlignment.bottomCenter=new THREE.Vector2(0,1),THREE.SpriteAlignment.bottomRight=new THREE.Vector2(-1,1),THREE.Texture=function(e,t,n,r,i,s,o,u,a){THREE.EventDispatcher.call(this),this.id=THREE.TextureIdCount++,this.name="",this.image=e,this.mipmaps=[],this.mapping=void 0!==t?t:new THREE.UVMapping,this.wrapS=void 0!==n?n:THREE.ClampToEdgeWrapping,this.wrapT=void 0!==r?r:THREE.ClampToEdgeWrapping,this.magFilter=void 0!==i?i:THREE.LinearFilter,this.minFilter=void 0!==s?s:THREE.LinearMipMapLinearFilter,this.anisotropy=void 0!==a?a:1,this.format=void 0!==o?o:THREE.RGBAFormat,this.type=void 0!==u?u:THREE.UnsignedByteType,this.offset=new THREE.Vector2(0,0),this.repeat=new THREE.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.needsUpdate=!1,this.onUpdate=null},THREE.Texture.prototype={constructor:THREE.Texture,clone:function(e){return void 0===e&&(e=new THREE.Texture),e.image=this.image,e.mipmaps=this.mipmaps.slice(0),e.mapping=this.mapping,e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.format=this.format,e.type=this.type,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.generateMipmaps=this.generateMipmaps,e.premultiplyAlpha=this.premultiplyAlpha,e.flipY=this.flipY,e.unpackAlignment=this.unpackAlignment,e},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.TextureIdCount=0,THREE.CompressedTexture=function(e,t,n,r,i,s,o,u,a,f,l){THREE.Texture.call(this,null,s,o,u,a,f,r,i,l),this.image={width:t,height:n},this.mipmaps=e,this.generateMipmaps=!1},THREE.CompressedTexture.prototype=Object.create(THREE.Texture.prototype),THREE.CompressedTexture.prototype.clone=function(){var e=new THREE.CompressedTexture;return THREE.Texture.prototype.clone.call(this,e),e},THREE.DataTexture=function(e,t,n,r,i,s,o,u,a,f,l){THREE.Texture.call(this,null,s,o,u,a,f,r,i,l),this.image={data:e,width:t,height:n}},THREE.DataTexture.prototype=Object.create(THREE.Texture.prototype),THREE.DataTexture.prototype.clone=function(){var e=new THREE.DataTexture;return THREE.Texture.prototype.clone.call(this,e),e},THREE.Particle=function(e){THREE.Object3D.call(this),this.material=e},THREE.Particle.prototype=Object.create(THREE.Object3D.prototype),THREE.Particle.prototype.clone=function(e){return void 0===e&&(e=new THREE.Particle(this.material)),THREE.Object3D.prototype.clone.call(this,e),e},THREE.ParticleSystem=function(e,t){THREE.Object3D.call(this),this.geometry=e,this.material=void 0!==t?t:new THREE.ParticleBasicMaterial({color:16777215*Math.random()}),this.sortParticles=!1,this.geometry&&null===this.geometry.boundingSphere&&this.geometry.computeBoundingSphere(),this.frustumCulled=!1},THREE.ParticleSystem.prototype=Object.create(THREE.Object3D.prototype),THREE.ParticleSystem.prototype.clone=function(e){return void 0===e&&(e=new THREE.ParticleSystem(this.geometry,this.material)),e.sortParticles=this.sortParticles,THREE.Object3D.prototype.clone.call(this,e),e},THREE.Line=function(e,t,n){THREE.Object3D.call(this),this.geometry=e,this.material=void 0!==t?t:new THREE.LineBasicMaterial({color:16777215*Math.random()}),this.type=void 0!==n?n:THREE.LineStrip,this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere())},THREE.LineStrip=0,THREE.LinePieces=1,THREE.Line.prototype=Object.create(THREE.Object3D.prototype),THREE.Line.prototype.clone=function(e){return void 0===e&&(e=new THREE.Line(this.geometry,this.material,this.type)),THREE.Object3D.prototype.clone.call(this,e),e},THREE.Mesh=function(e,t){THREE.Object3D.call(this),this.geometry=e,this.material=void 0!==t?t:new THREE.MeshBasicMaterial({color:16777215*Math.random(),wireframe:!0}),void 0!==this.geometry&&(null===this.geometry.boundingSphere&&this.geometry.computeBoundingSphere(),this.updateMorphTargets())},THREE.Mesh.prototype=Object.create(THREE.Object3D.prototype),THREE.Mesh.prototype.updateMorphTargets=function(){if(0<this.geometry.morphTargets.length){this.morphTargetBase=-1,this.morphTargetForcedOrder=[],this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var e=0,t=this.geometry.morphTargets.length;e<t;e++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[e].name]=e}},THREE.Mesh.prototype.getMorphTargetIndexByName=function(e){return void 0!==this.morphTargetDictionary[e]?this.morphTargetDictionary[e]:(console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0."),0)},THREE.Mesh.prototype.clone=function(e){return void 0===e&&(e=new THREE.Mesh(this.geometry,this.material)),THREE.Object3D.prototype.clone.call(this,e),e},THREE.Bone=function(e){THREE.Object3D.call(this),this.skin=e,this.skinMatrix=new THREE.Matrix4},THREE.Bone.prototype=Object.create(THREE.Object3D.prototype),THREE.Bone.prototype.update=function(e,t){this.matrixAutoUpdate&&(t|=this.updateMatrix());if(t||this.matrixWorldNeedsUpdate)e?this.skinMatrix.multiplyMatrices(e,this.matrix):this.skinMatrix.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0;var n,r=this.children.length;for(n=0;n<r;n++)this.children[n].update(this.skinMatrix,t)},THREE.SkinnedMesh=function(e,t,n){THREE.Mesh.call(this,e,t),this.useVertexTexture=void 0!==n?n:!0,this.identityMatrix=new THREE.Matrix4,this.bones=[],this.boneMatrices=[];var r,i,s;if(this.geometry&&void 0!==this.geometry.bones){for(e=0;e<this.geometry.bones.length;e++)n=this.geometry.bones[e],r=n.pos,i=n.rotq,s=n.scl,t=this.addBone(),t.name=n.name,t.position.set(r[0],r[1],r[2]),t.quaternion.set(i[0],i[1],i[2],i[3]),t.useQuaternion=!0,void 0!==s?t.scale.set(s[0],s[1],s[2]):t.scale.set(1,1,1);for(e=0;e<this.bones.length;e++)n=this.geometry.bones[e],t=this.bones[e],-1===n.parent?this.add(t):this.bones[n.parent].add(t);e=this.bones.length,this.useVertexTexture?(this.boneTextureHeight=this.boneTextureWidth=e=256<e?64:64<e?32:16<e?16:8,this.boneMatrices=new Float32Array(4*this.boneTextureWidth*this.boneTextureHeight),this.boneTexture=new THREE.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,THREE.RGBAFormat,THREE.FloatType),this.boneTexture.minFilter=THREE.NearestFilter,this.boneTexture.magFilter=THREE.NearestFilter,this.boneTexture.generateMipmaps=!1,this.boneTexture.flipY=!1):this.boneMatrices=new Float32Array(16*e),this.pose()}},THREE.SkinnedMesh.prototype=Object.create(THREE.Mesh.prototype),THREE.SkinnedMesh.prototype.addBone=function(e){return void 0===e&&(e=new THREE.Bone(this)),this.bones.push(e),e},THREE.SkinnedMesh.prototype.updateMatrixWorld=function(e){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||e)this.parent?this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1;for(var e=0,t=this.children.length;e<t;e++){var n=this.children[e];n instanceof THREE.Bone?n.update(this.identityMatrix,!1):n.updateMatrixWorld(!0)}if(void 0==this.boneInverses){this.boneInverses=[],e=0;for(t=this.bones.length;e<t;e++)n=new THREE.Matrix4,n.getInverse(this.bones[e].skinMatrix),this.boneInverses.push(n)}e=0;for(t=this.bones.length;e<t;e++)THREE.SkinnedMesh.offsetMatrix.multiplyMatrices(this.bones[e].skinMatrix,this.boneInverses[e]),THREE.SkinnedMesh.offsetMatrix.flattenToArrayOffset(this.boneMatrices,16*e);this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)},THREE.SkinnedMesh.prototype.pose=function(){this.updateMatrixWorld(!0);for(var e=0;e<this.geometry.skinIndices.length;e++){var t=this.geometry.skinWeights[e],n=1/t.lengthManhattan();Infinity!==n?t.multiplyScalar(n):t.set(1)}},THREE.SkinnedMesh.prototype.clone=function(e){return void 0===e&&(e=new THREE.SkinnedMesh(this.geometry,this.material,this.useVertexTexture)),THREE.Mesh.prototype.clone.call(this,e),e},THREE.SkinnedMesh.offsetMatrix=new THREE.Matrix4,THREE.MorphAnimMesh=function(e,t){THREE.Mesh.call(this,e,t),this.duration=1e3,this.mirroredLoop=!1,this.currentKeyframe=this.lastKeyframe=this.time=0,this.direction=1,this.directionBackwards=!1,this.setFrameRange(0,this.geometry.morphTargets.length-1)},THREE.MorphAnimMesh.prototype=Object.create(THREE.Mesh.prototype),THREE.MorphAnimMesh.prototype.setFrameRange=function(e,t){this.startKeyframe=e,this.endKeyframe=t,this.length=this.endKeyframe-this.startKeyframe+1},THREE.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1,this.directionBackwards=!1},THREE.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1,this.directionBackwards=!0},THREE.MorphAnimMesh.prototype.parseAnimations=function(){var e=this.geometry;e.animations||(e.animations={});for(var t,n=e.animations,r=/([a-z]+)(\d+)/,i=0,s=e.morphTargets.length;i<s;i++){var o=e.morphTargets[i].name.match(r);if(o&&1<o.length){o=o[1],n[o]||(n[o]={start:Infinity,end:-Infinity});var u=n[o];i<u.start&&(u.start=i),i>u.end&&(u.end=i),t||(t=o)}}e.firstAnimation=t},THREE.MorphAnimMesh.prototype.setAnimationLabel=function(e,t,n){this.geometry.animations||(this.geometry.animations={}),this.geometry.animations[e]={start:t,end:n}},THREE.MorphAnimMesh.prototype.playAnimation=function(e,t){var n=this.geometry.animations[e];n?(this.setFrameRange(n.start,n.end),this.duration=1e3*((n.end-n.start)/t),this.time=0):console.warn("animation["+e+"] undefined")},THREE.MorphAnimMesh.prototype.updateAnimation=function(e){var t=this.duration/this.length;this.time+=this.direction*e;if(this.mirroredLoop){if(this.time>this.duration||0>this.time)this.direction*=-1,this.time>this.duration&&(this.time=this.duration,this.directionBackwards=!0),0>this.time&&(this.time=0,this.directionBackwards=!1)}else this.time%=this.duration,0>this.time&&(this.time+=this.duration);e=this.startKeyframe+THREE.Math.clamp(Math.floor(this.time/t),0,this.length-1),e!==this.currentKeyframe&&(this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[e]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=e),t=this.time%t/t,this.directionBackwards&&(t=1-t),this.morphTargetInfluences[this.currentKeyframe]=t,this.morphTargetInfluences[this.lastKeyframe]=1-t},THREE.MorphAnimMesh.prototype.clone=function(e){return void 0===e&&(e=new THREE.MorphAnimMesh(this.geometry,this.material)),e.duration=this.duration,e.mirroredLoop=this.mirroredLoop,e.time=this.time,e.lastKeyframe=this.lastKeyframe,e.currentKeyframe=this.currentKeyframe,e.direction=this.direction,e.directionBackwards=this.directionBackwards,THREE.Mesh.prototype.clone.call(this,e),e},THREE.Ribbon=function(e,t){THREE.Object3D.call(this),this.geometry=e,this.material=t},THREE.Ribbon.prototype=Object.create(THREE.Object3D.prototype),THREE.Ribbon.prototype.clone=function(e){return void 0===e&&(e=new THREE.Ribbon(this.geometry,this.material)),THREE.Object3D.prototype.clone.call(this,e),e},THREE.LOD=function(){THREE.Object3D.call(this),this.LODs=[]},THREE.LOD.prototype=Object.create(THREE.Object3D.prototype),THREE.LOD.prototype.addLevel=function(e,t){void 0===t&&(t=0);for(var t=Math.abs(t),n=0;n<this.LODs.length&&!(t<this.LODs[n].visibleAtDistance);n++);this.LODs.splice(n,0,{visibleAtDistance:t,object3D:e}),this.add(e)},THREE.LOD.prototype.update=function(e){if(1<this.LODs.length){e.matrixWorldInverse.getInverse(e.matrixWorld),e=e.matrixWorldInverse,e=-(e.elements[2]*this.matrixWorld.elements[12]+e.elements[6]*this.matrixWorld.elements[13]+e.elements[10]*this.matrixWorld.elements[14]+e.elements[14]),this.LODs[0].object3D.visible=!0;for(var t=1;t<this.LODs.length;t++){if(!(e>=this.LODs[t].visibleAtDistance))break;this.LODs[t-1].object3D.visible=!1,this.LODs[t].object3D.visible=!0}for(;t<this.LODs.length;t++)this.LODs[t].object3D.visible=!1}},THREE.LOD.prototype.clone=function(){},THREE.Sprite=function(e){THREE.Object3D.call(this),this.material=void 0!==e?e:new THREE.SpriteMaterial,this.rotation3d=this.rotation,this.rotation=0},THREE.Sprite.prototype=Object.create(THREE.Object3D.prototype),THREE.Sprite.prototype.updateMatrix=function(){this.matrix.setPosition(this.position),this.rotation3d.set(0,0,this.rotation),this.matrix.setRotationFromEuler(this.rotation3d),(1!==this.scale.x||1!==this.scale.y)&&this.matrix.scale(this.scale),this.matrixWorldNeedsUpdate=!0},THREE.Sprite.prototype.clone=function(e){return void 0===e&&(e=new THREE.Sprite(this.material)),THREE.Object3D.prototype.clone.call(this,e),e},THREE.Scene=function(){THREE.Object3D.call(this),this.overrideMaterial=this.fog=null,this.matrixAutoUpdate=!1,this.__objects=[],this.__lights=[],this.__objectsAdded=[],this.__objectsRemoved=[]},THREE.Scene.prototype=Object.create(THREE.Object3D.prototype),THREE.Scene.prototype.__addObject=function(e){if(e instanceof THREE.Light)-1===this.__lights.indexOf(e)&&this.__lights.push(e),e.target&&void 0===e.target.parent&&this.add(e.target);else if(!(e instanceof THREE.Camera||e instanceof THREE.Bone)&&-1===this.__objects.indexOf(e)){this.__objects.push(e),this.__objectsAdded.push(e);var t=this.__objectsRemoved.indexOf(e);-1!==t&&this.__objectsRemoved.splice(t,1)}for(t=0;t<e.children.length;t++)this.__addObject(e.children[t])},THREE.Scene.prototype.__removeObject=function(e){if(e instanceof THREE.Light){var t=this.__lights.indexOf(e);-1!==t&&this.__lights.splice(t,1)}else e instanceof THREE.Camera||(t=this.__objects.indexOf(e),-1!==t&&(this.__objects.splice(t,1),this.__objectsRemoved.push(e),t=this.__objectsAdded.indexOf(e),-1!==t&&this.__objectsAdded.splice(t,1)));for(t=0;t<e.children.length;t++)this.__removeObject(e.children[t])},THREE.Fog=function(e,t,n){this.name="",this.color=new THREE.Color(e),this.near=void 0!==t?t:1,this.far=void 0!==n?n:1e3},THREE.Fog.prototype.clone=function(){return new THREE.Fog(this.color.getHex(),this.near,this.far)},THREE.FogExp2=function(e,t){this.name="",this.color=new THREE.Color(e),this.density=void 0!==t?t:25e-5},THREE.FogExp2.prototype.clone=function(){return new THREE.FogExp2(this.color.getHex(),this.density)},THREE.CanvasRenderer=function(e){function t(e){x!==e&&(x=w.globalAlpha=e)}function n(e){T!==e&&(e===THREE.NormalBlending?w.globalCompositeOperation="source-over":e===THREE.AdditiveBlending?w.globalCompositeOperation="lighter":e===THREE.SubtractiveBlending&&(w.globalCompositeOperation="darker"),T=e)}function r(e){k!==e&&(k=w.lineWidth=e)}function i(e){L!==e&&(L=w.lineCap=e)}function s(e){A!==e&&(A=w.lineJoin=e)}function o(e){N!==e&&(N=w.strokeStyle=e)}function u(e){C!==e&&(C=w.fillStyle=e)}function a(e,t){if(O!==e||M!==t)w.setLineDash([e,t]),O=e,M=t}console.log("THREE.CanvasRenderer",THREE.REVISION);var f=THREE.Math.smoothstep,e=e||{},l=this,c,h,p,d=new THREE.Projector,v=void 0!==e.canvas?e.canvas:document.createElement("canvas"),m,g,y,b,w=v.getContext("2d"),E=new THREE.Color(0),S=0,x=1,T=0,N=null,C=null,k=null,L=null,A=null,O=null,M=0,_,D,P,H,B=new THREE.RenderableVertex,j=new THREE.RenderableVertex,F,I,q,R,U,z,W,X,V,$,J,K,Q=new THREE.Color,G=new THREE.Color,Y=new THREE.Color,Z=new THREE.Color,et=new THREE.Color,tt=new THREE.Color,nt=new THREE.Color,rt=new THREE.Color,it={},st={},ot,ut,at,ft,lt,ct,ht,pt,dt,vt,mt=new THREE.Box2,gt=new THREE.Box2,yt=new THREE.Box2,bt=new THREE.Color,wt=new THREE.Color,Et=new THREE.Color,St=new THREE.Vector3,xt,Tt,Nt,Ct,kt,Lt,At=16;xt=document.createElement("canvas"),xt.width=xt.height=2,Tt=xt.getContext("2d"),Tt.fillStyle="rgba(0,0,0,1)",Tt.fillRect(0,0,2,2),Nt=Tt.getImageData(0,0,2,2),Ct=Nt.data,kt=document.createElement("canvas"),kt.width=kt.height=At,Lt=kt.getContext("2d"),Lt.translate(-At/2,-At/2),Lt.scale(At,At),At--,void 0===w.setLineDash&&(w.setLineDash=void 0!==w.mozDash?function(e){w.mozDash=null!==e[0]?e:null}:function(){}),this.domElement=v,this.devicePixelRatio=void 0!==e.devicePixelRatio?e.devicePixelRatio:void 0!==window.devicePixelRatio?window.devicePixelRatio:1,this.sortElements=this.sortObjects=this.autoClear=!0,this.info={render:{vertices:0,faces:0}},this.supportsVertexTextures=function(){},this.setFaceCulling=function(){},this.setSize=function(e,t){m=e*this.devicePixelRatio,g=t*this.devicePixelRatio,y=Math.floor(m/2),b=Math.floor(g/2),v.width=m,v.height=g,v.style.width=e+"px",v.style.height=t+"px",mt.set(new THREE.Vector2(-y,-b),new THREE.Vector2(y,b)),gt.set(new THREE.Vector2(-y,-b),new THREE.Vector2(y,b)),x=1,T=0,A=L=k=C=N=null},this.setClearColor=function(e,t){E.copy(e),S=void 0!==t?t:1,gt.set(new THREE.Vector2(-y,-b),new THREE.Vector2(y,b))},this.setClearColorHex=function(e,t){E.setHex(e),S=void 0!==t?t:1,gt.set(new THREE.Vector2(-y,-b),new THREE.Vector2(y,b))},this.getMaxAnisotropy=function(){return 0},this.clear=function(){w.setTransform(1,0,0,-1,y,b),!1===gt.empty()&&(gt.intersect(mt),gt.expandByScalar(2),1>S&&w.clearRect(gt.min.x|0,gt.min.y|0,gt.max.x-gt.min.x|0,gt.max.y-gt.min.y|0),0<S&&(n(THREE.NormalBlending),t(1),u("rgba("+Math.floor(255*E.r)+","+Math.floor(255*E.g)+","+Math.floor(255*E.b)+","+S+")"),w.fillRect(gt.min.x|0,gt.min.y|0,gt.max.x-gt.min.x|0,gt.max.y-gt.min.y|0)),gt.makeEmpty())},this.render=function(e,v){function m(e,t,n){for(var r=0,i=p.length;r<i;r++){var s=p[r];rt.copy(s.color);if(s instanceof THREE.DirectionalLight){var o=St.getPositionFromMatrix(s.matrixWorld).normalize(),u=t.dot(o);0>=u||(u*=s.intensity,n.add(rt.multiplyScalar(u)))}else s instanceof THREE.PointLight&&(o=St.getPositionFromMatrix(s.matrixWorld),u=t.dot(St.subVectors(o,e).normalize()),0>=u||(u*=0==s.distance?1:1-Math.min(e.distanceTo(o)/s.distance,1),0!=u&&(u*=s.intensity,n.add(rt.multiplyScalar(u)))))}}function g(e,r,i,s,o,u,a,c){l.info.render.vertices+=3,l.info.render.faces++,t(c.opacity),n(c.blending),F=e.positionScreen.x,I=e.positionScreen.y,q=r.positionScreen.x,R=r.positionScreen.y,U=i.positionScreen.x,z=i.positionScreen.y,E(F,I,q,R,U,z),(c instanceof THREE.MeshLambertMaterial||c instanceof THREE.MeshPhongMaterial)&&null===c.map?(tt.copy(c.color),nt.copy(c.emissive),c.vertexColors===THREE.FaceColors&&tt.multiply(a.color),!1===c.wireframe&&c.shading==THREE.SmoothShading&&3==a.vertexNormalsLength?(G.copy(bt),Y.copy(bt),Z.copy(bt),m(a.v1.positionWorld,a.vertexNormalsModel[0],G),m(a.v2.positionWorld,a.vertexNormalsModel[1],Y),m(a.v3.positionWorld,a.vertexNormalsModel[2],Z),G.multiply(tt).add(nt),Y.multiply(tt).add(nt),Z.multiply(tt).add(nt),et.addColors(Y,Z).multiplyScalar(.5),at=k(G,Y,Z,et),C(F,I,q,R,U,z,0,0,1,0,0,1,at)):(Q.copy(bt),m(a.centroidModel,a.normalModel,Q),Q.multiply(tt).add(nt),!0===c.wireframe?x(Q,c.wireframeLinewidth,c.wireframeLinecap,c.wireframeLinejoin):T(Q))):c instanceof THREE.MeshBasicMaterial||c instanceof THREE.MeshLambertMaterial||c instanceof THREE.MeshPhongMaterial?null!==c.map?c.map.mapping instanceof THREE.UVMapping&&(ft=a.uvs[0],N(F,I,q,R,U,z,ft[s].x,ft[s].y,ft[o].x,ft[o].y,ft[u].x,ft[u].y,c.map)):null!==c.envMap?c.envMap.mapping instanceof THREE.SphericalReflectionMapping&&(St.copy(a.vertexNormalsModelView[s]),lt=.5*St.x+.5,ct=.5*St.y+.5,St.copy(a.vertexNormalsModelView[o]),ht=.5*St.x+.5,pt=.5*St.y+.5,St.copy(a.vertexNormalsModelView[u]),dt=.5*St.x+.5,vt=.5*St.y+.5,N(F,I,q,R,U,z,lt,ct,ht,pt,dt,vt,c.envMap)):(Q.copy(c.color),c.vertexColors===THREE.FaceColors&&Q.multiply(a.color),!0===c.wireframe?x(Q,c.wireframeLinewidth,c.wireframeLinecap,c.wireframeLinejoin):T(Q)):c instanceof THREE.MeshDepthMaterial?(ot=v.near,ut=v.far,G.r=G.g=G.b=1-f(e.positionScreen.z*e.positionScreen.w,ot,ut),Y.r=Y.g=Y.b=1-f(r.positionScreen.z*r.positionScreen.w,ot,ut),Z.r=Z.g=Z.b=1-f(i.positionScreen.z*i.positionScreen.w,ot,ut),et.addColors(Y,Z).multiplyScalar(.5),at=k(G,Y,Z,et),C(F,I,q,R,U,z,0,0,1,0,0,1,at)):c instanceof THREE.MeshNormalMaterial&&(c.shading==THREE.FlatShading?(e=a.normalModelView,Q.setRGB(e.x,e.y,e.z).multiplyScalar(.5).addScalar(.5),!0===c.wireframe?x(Q,c.wireframeLinewidth,c.wireframeLinecap,c.wireframeLinejoin):T(Q)):c.shading==THREE.SmoothShading&&(e=a.vertexNormalsModelView[s],G.setRGB(e.x,e.y,e.z).multiplyScalar(.5).addScalar(.5),e=a.vertexNormalsModelView[o],Y.setRGB(e.x,e.y,e.z).multiplyScalar(.5).addScalar(.5),e=a.vertexNormalsModelView[u],Z.setRGB(e.x,e.y,e.z).multiplyScalar(.5).addScalar(.5),et.addColors(Y,Z).multiplyScalar(.5),at=k(G,Y,Z,et),C(F,I,q,R,U,z,0,0,1,0,0,1,at)))}function E(e,t,n,r,i,s){w.beginPath(),w.moveTo(e,t),w.lineTo(n,r),w.lineTo(i,s),w.closePath()}function S(e,t,n,r,i,s,o,u){w.beginPath(),w.moveTo(e,t),w.lineTo(n,r),w.lineTo(i,s),w.lineTo(o,u),w.closePath()}function x(e,t,n,u){r(t),i(n),s(u),o(e.getStyle()),w.stroke(),yt.expandByScalar(2*t)}function T(e){u(e.getStyle()),w.fill()}function N(e,t,n,r,i,s,o,a,f,l,c,h,p){if(!(p instanceof THREE.DataTexture||void 0===p.image||0==p.image.width)){if(!0===p.needsUpdate){var d=p.wrapS==THREE.RepeatWrapping,v=p.wrapT==THREE.RepeatWrapping;it[p.id]=w.createPattern(p.image,!0===d&&!0===v?"repeat":!0===d&&!1===v?"repeat-x":!1===d&&!0===v?"repeat-y":"no-repeat"),p.needsUpdate=!1}void 0===it[p.id]?u("rgba(0,0,0,1)"):u(it[p.id]);var d=p.offset.x/p.repeat.x,v=p.offset.y/p.repeat.y,m=p.image.width*p.repeat.x,g=p.image.height*p.repeat.y,o=(o+d)*m,a=(1-a+v)*g,n=n-e,r=r-t,i=i-e,s=s-t,f=(f+d)*m-o,l=(1-l+v)*g-a,c=(c+d)*m-o,h=(1-h+v)*g-a,d=f*h-c*l;0===d?(void 0===st[p.id]&&(t=document.createElement("canvas"),t.width=p.image.width,t.height=p.image.height,t=t.getContext("2d"),t.drawImage(p.image,0,0),st[p.id]=t.getImageData(0,0,p.image.width,p.image.height).data),t=st[p.id],o=4*(Math.floor(o)+Math.floor(a)*p.image.width),Q.setRGB(t[o]/255,t[o+1]/255,t[o+2]/255),T(Q)):(d=1/d,p=(h*n-l*i)*d,l=(h*r-l*s)*d,n=(f*i-c*n)*d,r=(f*s-c*r)*d,e=e-p*o-n*a,o=t-l*o-r*a,w.save(),w.transform(p,l,n,r,e,o),w.fill(),w.restore())}}function C(e,t,n,r,i,s,o,u,a,f,l,c,h){var p,d;p=h.width-1,d=h.height-1,o*=p,u*=d,n-=e,r-=t,i-=e,s-=t,a=a*p-o,f=f*d-u,l=l*p-o,c=c*d-u,d=1/(a*c-l*f),p=(c*n-f*i)*d,f=(c*r-f*s)*d,n=(a*i-l*n)*d,r=(a*s-l*r)*d,e=e-p*o-n*u,t=t-f*o-r*u,w.save(),w.transform(p,f,n,r,e,t),w.clip(),w.drawImage(h,0,0),w.restore()}function k(e,t,n,r){return Ct[0]=255*e.r|0,Ct[1]=255*e.g|0,Ct[2]=255*e.b|0,Ct[4]=255*t.r|0,Ct[5]=255*t.g|0,Ct[6]=255*t.b|0,Ct[8]=255*n.r|0,Ct[9]=255*n.g|0,Ct[10]=255*n.b|0,Ct[12]=255*r.r|0,Ct[13]=255*r.g|0,Ct[14]=255*r.b|0,Tt.putImageData(Nt,0,0),Lt.drawImage(xt,0,0),kt}function L(e,t){var n=t.x-e.x,r=t.y-e.y,i=n*n+r*r;0!==i&&(i=1/Math.sqrt(i),n*=i,r*=i,t.x+=n,t.y+=r,e.x-=n,e.y-=r)}if(0==v instanceof THREE.Camera)console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");else{!0===this.autoClear&&this.clear(),w.setTransform(1,0,0,-1,y,b),l.info.render.vertices=0,l.info.render.faces=0,c=d.projectScene(e,v,this.sortObjects,this.sortElements),h=c.elements,p=c.lights,bt.setRGB(0,0,0),wt.setRGB(0,0,0),Et.setRGB(0,0,0);for(var A=0,O=p.length;A<O;A++){var M=p[A],At=M.color;M instanceof THREE.AmbientLight?bt.add(At):M instanceof THREE.DirectionalLight?wt.add(At):M instanceof THREE.PointLight&&Et.add(At)}A=0;for(O=h.length;A<O;A++){var Ot=h[A],M=Ot.material;if(void 0!==M&&!1!==M.visible){yt.makeEmpty();if(Ot instanceof THREE.RenderableParticle){_=Ot,_.x*=y,_.y*=b;var At=_,Mt=Ot;t(M.opacity),n(M.blending);var _t=void 0,Dt=void 0,Pt=void 0,Ht=void 0,Bt=Ot=void 0,jt=void 0;M instanceof THREE.ParticleBasicMaterial?null===M.map?(Pt=Mt.object.scale.x,Ht=Mt.object.scale.y,Pt*=Mt.scale.x*y,Ht*=Mt.scale.y*b,yt.min.set(At.x-Pt,At.y-Ht),yt.max.set(At.x+Pt,At.y+Ht),!1!==mt.isIntersectionBox(yt)&&(u(M.color.getStyle()),w.save(),w.translate(At.x,At.y),w.rotate(-Mt.rotation),w.scale(Pt,Ht),w.fillRect(-1,-1,2,2),w.restore())):(Ot=M.map.image,Bt=Ot.width>>1,jt=Ot.height>>1,Pt=Mt.scale.x*y,Ht=Mt.scale.y*b,_t=Pt*Bt,Dt=Ht*jt,yt.min.set(At.x-_t,At.y-Dt),yt.max.set(At.x+_t,At.y+Dt),!1!==mt.isIntersectionBox(yt)&&(w.save(),w.translate(At.x,At.y),w.rotate(-Mt.rotation),w.scale(Pt,-Ht),w.translate(-Bt,-jt),w.drawImage(Ot,0,0),w.restore())):M instanceof THREE.ParticleCanvasMaterial&&(_t=Mt.scale.x*y,Dt=Mt.scale.y*b,yt.min.set(At.x-_t,At.y-Dt),yt.max.set(At.x+_t,At.y+Dt),!1!==mt.isIntersectionBox(yt)&&(o(M.color.getStyle()),u(M.color.getStyle()),w.save(),w.translate(At.x,At.y),w.rotate(-Mt.rotation),w.scale(_t,Dt),M.program(w),w.restore()))}else if(Ot instanceof THREE.RenderableLine)_=Ot.v1,D=Ot.v2,_.positionScreen.x*=y,_.positionScreen.y*=b,D.positionScreen.x*=y,D.positionScreen.y*=b,yt.setFromPoints([_.positionScreen,D.positionScreen]),!0===mt.isIntersectionBox(yt)&&(At=_,Mt=D,t(M.opacity),n(M.blending),w.beginPath(),w.moveTo(At.positionScreen.x,At.positionScreen.y),w.lineTo(Mt.positionScreen.x,Mt.positionScreen.y),M instanceof THREE.LineBasicMaterial?(r(M.linewidth),i(M.linecap),s(M.linejoin),o(M.color.getStyle()),w.stroke(),yt.expandByScalar(2*M.linewidth)):M instanceof THREE.LineDashedMaterial&&(r(M.linewidth),i(M.linecap),s(M.linejoin),o(M.color.getStyle()),a(M.dashSize,M.gapSize),w.stroke(),yt.expandByScalar(2*M.linewidth),a(null,null)));else if(Ot instanceof THREE.RenderableFace3){_=Ot.v1,D=Ot.v2,P=Ot.v3;if(-1>_.positionScreen.z||1<_.positionScreen.z)continue;if(-1>D.positionScreen.z||1<D.positionScreen.z)continue;if(-1>P.positionScreen.z||1<P.positionScreen.z)continue;_.positionScreen.x*=y,_.positionScreen.y*=b,D.positionScreen.x*=y,D.positionScreen.y*=b,P.positionScreen.x*=y,P.positionScreen.y*=b,!0===M.overdraw&&(L(_.positionScreen,D.positionScreen),L(D.positionScreen,P.positionScreen),L(P.positionScreen,_.positionScreen)),yt.setFromPoints([_.positionScreen,D.positionScreen,P.positionScreen]),g(_,D,P,0,1,2,Ot,M)}else if(Ot instanceof THREE.RenderableFace4){_=Ot.v1,D=Ot.v2,P=Ot.v3,H=Ot.v4;if(-1>_.positionScreen.z||1<_.positionScreen.z)continue;if(-1>D.positionScreen.z||1<D.positionScreen.z)continue;if(-1>P.positionScreen.z||1<P.positionScreen.z)continue;if(-1>H.positionScreen.z||1<H.positionScreen.z)continue;_.positionScreen.x*=y,_.positionScreen.y*=b,D.positionScreen.x*=y,D.positionScreen.y*=b,P.positionScreen.x*=y,P.positionScreen.y*=b,H.positionScreen.x*=y,H.positionScreen.y*=b,B.positionScreen.copy(D.positionScreen),j.positionScreen.copy(H.positionScreen),!0===M.overdraw&&(L(_.positionScreen,D.positionScreen),L(D.positionScreen,H.positionScreen),L(H.positionScreen,_.positionScreen),L(P.positionScreen,B.positionScreen),L(P.positionScreen,j.positionScreen)),yt.setFromPoints([_.positionScreen,D.positionScreen,P.positionScreen,H.positionScreen]),At=_,Mt=D,_t=P,Dt=H,Pt=B,Ht=j,l.info.render.vertices+=4,l.info.render.faces++,t(M.opacity),n(M.blending),void 0!==M.map&&null!==M.map||void 0!==M.envMap&&null!==M.envMap?(g(At,Mt,Dt,0,1,3,Ot,M),g(Pt,_t,Ht,1,2,3,Ot,M)):(F=At.positionScreen.x,I=At.positionScreen.y,q=Mt.positionScreen.x,R=Mt.positionScreen.y,U=_t.positionScreen.x,z=_t.positionScreen.y,W=Dt.positionScreen.x,X=Dt.positionScreen.y,V=Pt.positionScreen.x,$=Pt.positionScreen.y,J=Ht.positionScreen.x,K=Ht.positionScreen.y,M instanceof THREE.MeshLambertMaterial||M instanceof THREE.MeshPhongMaterial?(tt.copy(M.color),nt.copy(M.emissive),M.vertexColors===THREE.FaceColors&&tt.multiply(Ot.color),!1===M.wireframe&&M.shading==THREE.SmoothShading&&4==Ot.vertexNormalsLength?(G.copy(bt),Y.copy(bt),Z.copy(bt),et.copy(bt),m(Ot.v1.positionWorld,Ot.vertexNormalsModel[0],G),m(Ot.v2.positionWorld,Ot.vertexNormalsModel[1],Y),m(Ot.v4.positionWorld,Ot.vertexNormalsModel[3],Z),m(Ot.v3.positionWorld,Ot.vertexNormalsModel[2],et),G.multiply(tt).add(nt),Y.multiply(tt).add(nt),Z.multiply(tt).add(nt),et.multiply(tt).add(nt),at=k(G,Y,Z,et),E(F,I,q,R,W,X),C(F,I,q,R,W,X,0,0,1,0,0,1,at),E(V,$,U,z,J,K),C(V,$,U,z,J,K,1,0,1,1,0,1,at)):(Q.copy(bt),m(Ot.centroidModel,Ot.normalModel,Q),Q.multiply(tt).add(nt),S(F,I,q,R,U,z,W,X),!0===M.wireframe?x(Q,M.wireframeLinewidth,M.wireframeLinecap,M.wireframeLinejoin):T(Q))):M instanceof THREE.MeshBasicMaterial?(Q.copy(M.color),M.vertexColors===THREE.FaceColors&&Q.multiply(Ot.color),S(F,I,q,R,U,z,W,X),!0===M.wireframe?x(Q,M.wireframeLinewidth,M.wireframeLinecap,M.wireframeLinejoin):T(Q)):M instanceof THREE.MeshNormalMaterial?(At=void 0,M.shading==THREE.FlatShading?(At=Ot.normalModelView,Q.setRGB(At.x,At.y,At.z).multiplyScalar(.5).addScalar(.5),S(F,I,q,R,U,z,W,X),!0===M.wireframe?x(Q,M.wireframeLinewidth,M.wireframeLinecap,M.wireframeLinejoin):T(Q)):M.shading==THREE.SmoothShading&&(At=Ot.vertexNormalsModelView[0],G.setRGB(At.x,At.y,At.z).multiplyScalar(.5).addScalar(.5),At=Ot.vertexNormalsModelView[1],Y.setRGB(At.x,At.y,At.z).multiplyScalar(.5).addScalar(.5),At=Ot.vertexNormalsModelView[3],Z.setRGB(At.x,At.y,At.z).multiplyScalar(.5).addScalar(.5),At=Ot.vertexNormalsModelView[2],et.setRGB(At.x,At.y,At.z).multiplyScalar(.5).addScalar(.5),at=k(G,Y,Z,et),E(F,I,q,R,W,X),C(F,I,q,R,W,X,0,0,1,0,0,1,at),E(V,$,U,z,J,K),C(V,$,U,z,J,K,1,0,1,1,0,1,at))):M instanceof THREE.MeshDepthMaterial&&(ot=v.near,ut=v.far,G.r=G.g=G.b=1-f(At.positionScreen.z*At.positionScreen.w,ot,ut),Y.r=Y.g=Y.b=1-f(Mt.positionScreen.z*Mt.positionScreen.w,ot,ut),Z.r=Z.g=Z.b=1-f(Dt.positionScreen.z*Dt.positionScreen.w,ot,ut),et.r=et.g=et.b=1-f(_t.positionScreen.z*_t.positionScreen.w,ot,ut),at=k(G,Y,Z,et),E(F,I,q,R,W,X),C(F,I,q,R,W,X,0,0,1,0,0,1,at),E(V,$,U,z,J,K),C(V,$,U,z,J,K,1,0,1,1,0,1,at)))}gt.union(yt)}}w.setTransform(1,0,0,1,0,0)}}},THREE.ShaderChunk={fog_pars_fragment:"#ifdef USE_FOG\nuniform vec3 fogColor;\n#ifdef FOG_EXP2\nuniform float fogDensity;\n#else\nuniform float fogNear;\nuniform float fogFar;\n#endif\n#endif",fog_fragment:"#ifdef USE_FOG\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n#ifdef FOG_EXP2\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n#else\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n#endif\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\nuniform float reflectivity;\nuniform samplerCube envMap;\nuniform float flipEnvMap;\nuniform int combine;\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\nuniform bool useRefract;\nuniform float refractionRatio;\n#else\nvarying vec3 vReflect;\n#endif\n#endif",envmap_fragment:"#ifdef USE_ENVMAP\nvec3 reflectVec;\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\nvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\nif ( useRefract ) {\nreflectVec = refract( cameraToVertex, normal, refractionRatio );\n} else { \nreflectVec = reflect( cameraToVertex, normal );\n}\n#else\nreflectVec = vReflect;\n#endif\n#ifdef DOUBLE_SIDED\nfloat flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );\nvec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n#else\nvec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n#endif\n#ifdef GAMMA_INPUT\ncubeColor.xyz *= cubeColor.xyz;\n#endif\nif ( combine == 1 ) {\ngl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularStrength * reflectivity );\n} else if ( combine == 2 ) {\ngl_FragColor.xyz += cubeColor.xyz * specularStrength * reflectivity;\n} else {\ngl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, specularStrength * reflectivity );\n}\n#endif",envmap_pars_vertex:"#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )\nvarying vec3 vReflect;\nuniform float refractionRatio;\nuniform bool useRefract;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n#ifdef USE_SKINNING\nvec4 worldPosition = modelMatrix * skinned;\n#endif\n#if defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )\nvec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );\n#endif\n#if ! defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )\nvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n#endif\n#endif",envmap_vertex:"#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )\nvec3 worldNormal = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;\nworldNormal = normalize( worldNormal );\nvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\nif ( useRefract ) {\nvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n} else {\nvReflect = reflect( cameraToVertex, worldNormal );\n}\n#endif",map_particle_pars_fragment:"#ifdef USE_MAP\nuniform sampler2D map;\n#endif",map_particle_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );\n#endif",map_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )\nvarying vec2 vUv;\nuniform vec4 offsetRepeat;\n#endif",map_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )\nvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\nuniform sampler2D map;\n#endif",map_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )\nvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif",map_fragment:"#ifdef USE_MAP\nvec4 texelColor = texture2D( map, vUv );\n#ifdef GAMMA_INPUT\ntexelColor.xyz *= texelColor.xyz;\n#endif\ngl_FragColor = gl_FragColor * texelColor;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\nuniform sampler2D lightMap;\n#endif",lightmap_pars_vertex:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\ngl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n#endif",lightmap_vertex:"#ifdef USE_LIGHTMAP\nvUv2 = uv2;\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\nuniform sampler2D bumpMap;\nuniform float bumpScale;\nvec2 dHdxy_fwd() {\nvec2 dSTdx = dFdx( vUv );\nvec2 dSTdy = dFdy( vUv );\nfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\nfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\nfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\nreturn vec2( dBx, dBy );\n}\nvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\nvec3 vSigmaX = dFdx( surf_pos );\nvec3 vSigmaY = dFdy( surf_pos );\nvec3 vN = surf_norm;\nvec3 R1 = cross( vSigmaY, vN );\nvec3 R2 = cross( vN, vSigmaX );\nfloat fDet = dot( vSigmaX, R1 );\nvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\nreturn normalize( abs( fDet ) * surf_norm - vGrad );\n}\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\nuniform sampler2D normalMap;\nuniform vec2 normalScale;\nvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\nvec3 q0 = dFdx( eye_pos.xyz );\nvec3 q1 = dFdy( eye_pos.xyz );\nvec2 st0 = dFdx( vUv.st );\nvec2 st1 = dFdy( vUv.st );\nvec3 S = normalize(  q0 * st1.t - q1 * st0.t );\nvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\nvec3 N = normalize( surf_norm );\nvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\nmapN.xy = normalScale * mapN.xy;\nmat3 tsn = mat3( S, T, N );\nreturn normalize( tsn * mapN );\n}\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\nuniform sampler2D specularMap;\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\nvec4 texelSpecular = texture2D( specularMap, vUv );\nspecularStrength = texelSpecular.r;\n#else\nspecularStrength = 1.0;\n#endif",lights_lambert_pars_vertex:"uniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_HEMI_LIGHTS > 0\nuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\nuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n#endif\n#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif",lights_lambert_vertex:"vLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\nvLightBack = vec3( 0.0 );\n#endif\ntransformedNormal = normalize( transformedNormal );\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( transformedNormal, dirVector );\nvec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\n#ifdef DOUBLE_SIDED\nvec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n#ifdef WRAP_AROUND\nvec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n#endif\n#endif\n#ifdef WRAP_AROUND\nvec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\ndirectionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );\n#ifdef DOUBLE_SIDED\ndirectionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );\n#endif\n#endif\nvLightFront += directionalLightColor[ i ] * directionalLightWeighting;\n#ifdef DOUBLE_SIDED\nvLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;\n#endif\n}\n#endif\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nfloat dotProduct = dot( transformedNormal, lVector );\nvec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );\n#ifdef DOUBLE_SIDED\nvec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n#ifdef WRAP_AROUND\nvec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n#endif\n#endif\n#ifdef WRAP_AROUND\nvec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\npointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );\n#ifdef DOUBLE_SIDED\npointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );\n#endif\n#endif\nvLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;\n#ifdef DOUBLE_SIDED\nvLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;\n#endif\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );\nif ( spotEffect > spotLightAngleCos[ i ] ) {\nspotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );\nfloat lDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nfloat dotProduct = dot( transformedNormal, lVector );\nvec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );\n#ifdef DOUBLE_SIDED\nvec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n#ifdef WRAP_AROUND\nvec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n#endif\n#endif\n#ifdef WRAP_AROUND\nvec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\nspotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );\n#ifdef DOUBLE_SIDED\nspotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );\n#endif\n#endif\nvLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;\n#ifdef DOUBLE_SIDED\nvLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;\n#endif\n}\n}\n#endif\n#if MAX_HEMI_LIGHTS > 0\nfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\nvec3 lVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( transformedNormal, lVector );\nfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\nfloat hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;\nvLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n#ifdef DOUBLE_SIDED\nvLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );\n#endif\n}\n#endif\nvLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;\n#ifdef DOUBLE_SIDED\nvLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;\n#endif",lights_phong_pars_vertex:"#ifndef PHONG_PER_PIXEL\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\nvarying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )\nvarying vec3 vWorldPosition;\n#endif",lights_phong_vertex:"#ifndef PHONG_PER_PIXEL\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nvPointLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\nvSpotLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )\nvWorldPosition = worldPosition.xyz;\n#endif",lights_phong_pars_fragment:"uniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_HEMI_LIGHTS > 0\nuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n#ifdef PHONG_PER_PIXEL\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#else\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\nuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n#ifdef PHONG_PER_PIXEL\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n#else\nvarying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )\nvarying vec3 vWorldPosition;\n#endif\n#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",lights_phong_fragment:"vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#ifdef DOUBLE_SIDED\nnormal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n#endif\n#ifdef USE_NORMALMAP\nnormal = perturbNormal2Arb( -viewPosition, normal );\n#elif defined( USE_BUMPMAP )\nnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse  = vec3( 0.0 );\nvec3 pointSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n#ifdef PHONG_PER_PIXEL\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz + vViewPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\n#else\nvec3 lVector = normalize( vPointLight[ i ].xyz );\nfloat lDistance = vPointLight[ i ].w;\n#endif\nfloat dotProduct = dot( normal, lVector );\n#ifdef WRAP_AROUND\nfloat pointDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n#else\nfloat pointDiffuseWeight = max( dotProduct, 0.0 );\n#endif\npointDiffuse  += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;\nvec3 pointHalfVector = normalize( lVector + viewPosition );\nfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\nfloat pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, pointHalfVector ), 5.0 );\npointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;\n#else\npointSpecular += specular * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance;\n#endif\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nvec3 spotDiffuse  = vec3( 0.0 );\nvec3 spotSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n#ifdef PHONG_PER_PIXEL\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz + vViewPosition.xyz;\nfloat lDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\n#else\nvec3 lVector = normalize( vSpotLight[ i ].xyz );\nfloat lDistance = vSpotLight[ i ].w;\n#endif\nfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\nif ( spotEffect > spotLightAngleCos[ i ] ) {\nspotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );\nfloat dotProduct = dot( normal, lVector );\n#ifdef WRAP_AROUND\nfloat spotDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n#else\nfloat spotDiffuseWeight = max( dotProduct, 0.0 );\n#endif\nspotDiffuse += diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;\nvec3 spotHalfVector = normalize( lVector + viewPosition );\nfloat spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\nfloat spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, spotHalfVector ), 5.0 );\nspotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;\n#else\nspotSpecular += specular * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * spotEffect;\n#endif\n}\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec3 dirDiffuse  = vec3( 0.0 );\nvec3 dirSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( normal, dirVector );\n#ifdef WRAP_AROUND\nfloat dirDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\n#else\nfloat dirDiffuseWeight = max( dotProduct, 0.0 );\n#endif\ndirDiffuse  += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;\nvec3 dirHalfVector = normalize( dirVector + viewPosition );\nfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\nfloat dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );\ndirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n#else\ndirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;\n#endif\n}\n#endif\n#if MAX_HEMI_LIGHTS > 0\nvec3 hemiDiffuse  = vec3( 0.0 );\nvec3 hemiSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\nvec3 lVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( normal, lVector );\nfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\nvec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\nhemiDiffuse += diffuse * hemiColor;\nvec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\nfloat hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\nfloat hemiSpecularWeightSky = specularStrength * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );\nvec3 lVectorGround = -lVector;\nvec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\nfloat hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\nfloat hemiSpecularWeightGround = specularStrength * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat dotProductGround = dot( normal, lVectorGround );\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );\nvec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );\nhemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n#else\nhemiSpecular += specular * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;\n#endif\n}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#if MAX_HEMI_LIGHTS > 0\ntotalDiffuse += hemiDiffuse;\ntotalSpecular += hemiSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\n#if MAX_SPOT_LIGHTS > 0\ntotalDiffuse += spotDiffuse;\ntotalSpecular += spotSpecular;\n#endif\n#ifdef METAL\ngl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_fragment:"#ifdef USE_COLOR\ngl_FragColor = gl_FragColor * vec4( vColor, opacity );\n#endif",color_pars_vertex:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n#ifdef GAMMA_INPUT\nvColor = color * color;\n#else\nvColor = color;\n#endif\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n#ifdef BONE_TEXTURE\nuniform sampler2D boneTexture;\nmat4 getBoneMatrix( const in float i ) {\nfloat j = i * 4.0;\nfloat x = mod( j, N_BONE_PIXEL_X );\nfloat y = floor( j / N_BONE_PIXEL_X );\nconst float dx = 1.0 / N_BONE_PIXEL_X;\nconst float dy = 1.0 / N_BONE_PIXEL_Y;\ny = dy * ( y + 0.5 );\nvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\nvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\nvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\nvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\nmat4 bone = mat4( v1, v2, v3, v4 );\nreturn bone;\n}\n#else\nuniform mat4 boneGlobalMatrices[ MAX_BONES ];\nmat4 getBoneMatrix( const in float i ) {\nmat4 bone = boneGlobalMatrices[ int(i) ];\nreturn bone;\n}\n#endif\n#endif",skinbase_vertex:"#ifdef USE_SKINNING\nmat4 boneMatX = getBoneMatrix( skinIndex.x );\nmat4 boneMatY = getBoneMatrix( skinIndex.y );\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n#ifdef USE_MORPHTARGETS\nvec4 skinVertex = vec4( morphed, 1.0 );\n#else\nvec4 skinVertex = vec4( position, 1.0 );\n#endif\nvec4 skinned  = boneMatX * skinVertex * skinWeight.x;\nskinned 	  += boneMatY * skinVertex * skinWeight.y;\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n#ifndef USE_MORPHNORMALS\nuniform float morphTargetInfluences[ 8 ];\n#else\nuniform float morphTargetInfluences[ 4 ];\n#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\nvec3 morphed = vec3( 0.0 );\nmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\nmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\nmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\nmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n#ifndef USE_MORPHNORMALS\nmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\nmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\nmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\nmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n#endif\nmorphed += position;\n#endif",default_vertex:"vec4 mvPosition;\n#ifdef USE_SKINNING\nmvPosition = modelViewMatrix * skinned;\n#endif\n#if !defined( USE_SKINNING ) && defined( USE_MORPHTARGETS )\nmvPosition = modelViewMatrix * vec4( morphed, 1.0 );\n#endif\n#if !defined( USE_SKINNING ) && ! defined( USE_MORPHTARGETS )\nmvPosition = modelViewMatrix * vec4( position, 1.0 );\n#endif\ngl_Position = projectionMatrix * mvPosition;",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\nvec3 morphedNormal = vec3( 0.0 );\nmorphedNormal +=  ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\nmorphedNormal +=  ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\nmorphedNormal +=  ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\nmorphedNormal +=  ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\nmorphedNormal += normal;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\nmat4 skinMatrix = skinWeight.x * boneMatX;\nskinMatrix 	+= skinWeight.y * boneMatY;\n#ifdef USE_MORPHNORMALS\nvec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );\n#else\nvec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );\n#endif\n#endif",defaultnormal_vertex:"vec3 objectNormal;\n#ifdef USE_SKINNING\nobjectNormal = skinnedNormal.xyz;\n#endif\n#if !defined( USE_SKINNING ) && defined( USE_MORPHNORMALS )\nobjectNormal = morphedNormal;\n#endif\n#if !defined( USE_SKINNING ) && ! defined( USE_MORPHNORMALS )\nobjectNormal = normal;\n#endif\n#ifdef FLIP_SIDED\nobjectNormal = -objectNormal;\n#endif\nvec3 transformedNormal = normalMatrix * objectNormal;",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\nuniform sampler2D shadowMap[ MAX_SHADOWS ];\nuniform vec2 shadowMapSize[ MAX_SHADOWS ];\nuniform float shadowDarkness[ MAX_SHADOWS ];\nuniform float shadowBias[ MAX_SHADOWS ];\nvarying vec4 vShadowCoord[ MAX_SHADOWS ];\nfloat unpackDepth( const in vec4 rgba_depth ) {\nconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\nfloat depth = dot( rgba_depth, bit_shift );\nreturn depth;\n}\n#endif",shadowmap_fragment:"#ifdef USE_SHADOWMAP\n#ifdef SHADOWMAP_DEBUG\nvec3 frustumColors[3];\nfrustumColors[0] = vec3( 1.0, 0.5, 0.0 );\nfrustumColors[1] = vec3( 0.0, 1.0, 0.8 );\nfrustumColors[2] = vec3( 0.0, 0.5, 1.0 );\n#endif\n#ifdef SHADOWMAP_CASCADE\nint inFrustumCount = 0;\n#endif\nfloat fDepth;\nvec3 shadowColor = vec3( 1.0 );\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\nbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\nbool inFrustum = all( inFrustumVec );\n#ifdef SHADOWMAP_CASCADE\ninFrustumCount += int( inFrustum );\nbvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );\n#else\nbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n#endif\nbool frustumTest = all( frustumTestVec );\nif ( frustumTest ) {\nshadowCoord.z += shadowBias[ i ];\n#if defined( SHADOWMAP_TYPE_PCF )\nfloat shadow = 0.0;\nconst float shadowDelta = 1.0 / 9.0;\nfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\nfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\nfloat dx0 = -1.25 * xPixelOffset;\nfloat dy0 = -1.25 * yPixelOffset;\nfloat dx1 = 1.25 * xPixelOffset;\nfloat dy1 = 1.25 * yPixelOffset;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\nfloat shadow = 0.0;\nfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\nfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\nfloat dx0 = -1.0 * xPixelOffset;\nfloat dy0 = -1.0 * yPixelOffset;\nfloat dx1 = 1.0 * xPixelOffset;\nfloat dy1 = 1.0 * yPixelOffset;\nmat3 shadowKernel;\nmat3 depthKernel;\ndepthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\nif ( depthKernel[0][0] < shadowCoord.z ) shadowKernel[0][0] = 0.25;\nelse shadowKernel[0][0] = 0.0;\ndepthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\nif ( depthKernel[0][1] < shadowCoord.z ) shadowKernel[0][1] = 0.25;\nelse shadowKernel[0][1] = 0.0;\ndepthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i], shadowCoord.xy + vec2( dx0, dy1 ) ) );\nif ( depthKernel[0][2] < shadowCoord.z ) shadowKernel[0][2] = 0.25;\nelse shadowKernel[0][2] = 0.0;\ndepthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\nif ( depthKernel[1][0] < shadowCoord.z ) shadowKernel[1][0] = 0.25;\nelse shadowKernel[1][0] = 0.0;\ndepthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\nif ( depthKernel[1][1] < shadowCoord.z ) shadowKernel[1][1] = 0.25;\nelse shadowKernel[1][1] = 0.0;\ndepthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\nif ( depthKernel[1][2] < shadowCoord.z ) shadowKernel[1][2] = 0.25;\nelse shadowKernel[1][2] = 0.0;\ndepthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\nif ( depthKernel[2][0] < shadowCoord.z ) shadowKernel[2][0] = 0.25;\nelse shadowKernel[2][0] = 0.0;\ndepthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\nif ( depthKernel[2][1] < shadowCoord.z ) shadowKernel[2][1] = 0.25;\nelse shadowKernel[2][1] = 0.0;\ndepthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\nif ( depthKernel[2][2] < shadowCoord.z ) shadowKernel[2][2] = 0.25;\nelse shadowKernel[2][2] = 0.0;\nvec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );\nshadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );\nshadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );\nvec4 shadowValues;\nshadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );\nshadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );\nshadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );\nshadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );\nshadow = dot( shadowValues, vec4( 1.0 ) );\nshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n#else\nvec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\nfloat fDepth = unpackDepth( rgbaDepth );\nif ( fDepth < shadowCoord.z )\nshadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\n#endif\n}\n#ifdef SHADOWMAP_DEBUG\n#ifdef SHADOWMAP_CASCADE\nif ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];\n#else\nif ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];\n#endif\n#endif\n}\n#ifdef GAMMA_OUTPUT\nshadowColor *= shadowColor;\n#endif\ngl_FragColor.xyz = gl_FragColor.xyz * shadowColor;\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\nvarying vec4 vShadowCoord[ MAX_SHADOWS ];\nuniform mat4 shadowMatrix[ MAX_SHADOWS ];\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n}\n#endif",alphatest_fragment:"#ifdef ALPHATEST\nif ( gl_FragColor.a < ALPHATEST ) discard;\n#endif",linear_to_gamma_fragment:"#ifdef GAMMA_OUTPUT\ngl_FragColor.xyz = sqrt( gl_FragColor.xyz );\n#endif"},THREE.UniformsUtils={merge:function(e){var t,n,r,i={};for(t=0;t<e.length;t++)for(n in r=this.clone(e[t]),r)i[n]=r[n];return i},clone:function(e){var t,n,r,i={};for(t in e)for(n in i[t]={},e[t])r=e[t][n],i[t][n]=r instanceof THREE.Color||r instanceof THREE.Vector2||r instanceof THREE.Vector3||r instanceof THREE.Vector4||r instanceof THREE.Matrix4||r instanceof THREE.Texture?r.clone():r instanceof Array?r.slice():r;return i}},THREE.UniformsLib={common:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new THREE.Vector2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}},THREE.ShaderLib={basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.shadowmap]),vertexShader:[THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.skinbase_vertex,"#ifdef USE_ENVMAP",THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"#endif",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\nvarying vec3 vLightBack;\n#endif",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_lambert_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.lights_lambert_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\nvarying vec3 vLightBack;\n#endif",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3 ( 1.0 ), opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,"#ifdef DOUBLE_SIDED\nif ( gl_FrontFacing )\ngl_FragColor.xyz *= vLightFront;\nelse\ngl_FragColor.xyz *= vLightBack;\n#else\ngl_FragColor.xyz *= vLightFront;\n#endif",THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.bump,THREE.UniformsLib.normalmap,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define PHONG\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_phong_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"vNormal = normalize( transformedNormal );",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,"vViewPosition = -mvPosition.xyz;",THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.lights_phong_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform vec3 ambient;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_phong_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.bumpmap_pars_fragment,THREE.ShaderChunk.normalmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3 ( 1.0 ), opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.lights_phong_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},particle_basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.particle,THREE.UniformsLib.shadowmap]),vertexShader:["uniform float size;\nuniform float scale;",THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n#ifdef USE_SIZEATTENUATION\ngl_PointSize = size * ( scale / length( mvPosition.xyz ) );\n#else\ngl_PointSize = size;\n#endif\ngl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_particle_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( psColor, opacity );",THREE.ShaderChunk.map_particle_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},dashed:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;",THREE.ShaderChunk.color_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"vLineDistance = scale * lineDistance;\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\ngl_Position = projectionMatrix * mvPosition;\n}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\nif ( mod( vLineDistance, totalSize ) > dashSize ) {\ndiscard;\n}\ngl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float mNear;\nuniform float mFar;\nuniform float opacity;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat color = 1.0 - smoothstep( mNear, mFar, depth );\ngl_FragColor = vec4( vec3( color ), opacity );\n}"},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:"varying vec3 vNormal;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvNormal = normalize( normalMatrix * normal );\ngl_Position = projectionMatrix * mvPosition;\n}",fragmentShader:"uniform float opacity;\nvarying vec3 vNormal;\nvoid main() {\ngl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );\n}"},normalmap:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},enableDisplacement:{type:"i",value:0},tDisplacement:{type:"t",value:null},tDiffuse:{type:"t",value:null},tCube:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tAO:{type:"t",value:null},uNormalScale:{type:"v2",value:new THREE.Vector2(1,1)},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},uDiffuseColor:{type:"c",value:new THREE.Color(16777215)},uSpecularColor:{type:"c",value:new THREE.Color(1118481)},uAmbientColor:{type:"c",value:new THREE.Color(16777215)},uShininess:{type:"f",value:30},uOpacity:{type:"f",value:1},useRefract:{type:"i",value:0},uRefractionRatio:{type:"f",value:.98},uReflectivity:{type:"f",value:.5},uOffset:{type:"v2",value:new THREE.Vector2(0,0)},uRepeat:{type:"v2",value:new THREE.Vector2(1,1)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),fragmentShader:["uniform vec3 uAmbientColor;\nuniform vec3 uDiffuseColor;\nuniform vec3 uSpecularColor;\nuniform float uShininess;\nuniform float uOpacity;\nuniform bool enableDiffuse;\nuniform bool enableSpecular;\nuniform bool enableAO;\nuniform bool enableReflection;\nuniform sampler2D tDiffuse;\nuniform sampler2D tNormal;\nuniform sampler2D tSpecular;\nuniform sampler2D tAO;\nuniform samplerCube tCube;\nuniform vec2 uNormalScale;\nuniform bool useRefract;\nuniform float uRefractionRatio;\nuniform float uReflectivity;\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_HEMI_LIGHTS > 0\nuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\nuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n#endif\n#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif\nvarying vec3 vWorldPosition;\nvarying vec3 vViewPosition;",THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3( 1.0 ), uOpacity );\nvec3 specularTex = vec3( 1.0 );\nvec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;\nnormalTex.xy *= uNormalScale;\nnormalTex = normalize( normalTex );\nif( enableDiffuse ) {\n#ifdef GAMMA_INPUT\nvec4 texelColor = texture2D( tDiffuse, vUv );\ntexelColor.xyz *= texelColor.xyz;\ngl_FragColor = gl_FragColor * texelColor;\n#else\ngl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );\n#endif\n}\nif( enableAO ) {\n#ifdef GAMMA_INPUT\nvec4 aoColor = texture2D( tAO, vUv );\naoColor.xyz *= aoColor.xyz;\ngl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;\n#endif\n}\nif( enableSpecular )\nspecularTex = texture2D( tSpecular, vUv ).xyz;\nmat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );\nvec3 finalNormal = tsb * normalTex;\n#ifdef FLIP_SIDED\nfinalNormal = -finalNormal;\n#endif\nvec3 normal = normalize( finalNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse = vec3( 0.0 );\nvec3 pointSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 pointVector = lPosition.xyz + vViewPosition.xyz;\nfloat pointDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\npointDistance = 1.0 - min( ( length( pointVector ) / pointLightDistance[ i ] ), 1.0 );\npointVector = normalize( pointVector );\n#ifdef WRAP_AROUND\nfloat pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );\nfloat pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );\nvec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n#else\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\n#endif\npointDiffuse += pointDistance * pointLightColor[ i ] * uDiffuseColor * pointDiffuseWeight;\nvec3 pointHalfVector = normalize( pointVector + viewPosition );\nfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\nfloat pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, uShininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( uShininess + 2.0001 ) / 8.0;\nvec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( pointVector, pointHalfVector ), 5.0 );\npointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;\n#else\npointSpecular += pointDistance * pointLightColor[ i ] * uSpecularColor * pointSpecularWeight * pointDiffuseWeight;\n#endif\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nvec3 spotDiffuse = vec3( 0.0 );\nvec3 spotSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 spotVector = lPosition.xyz + vViewPosition.xyz;\nfloat spotDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nspotDistance = 1.0 - min( ( length( spotVector ) / spotLightDistance[ i ] ), 1.0 );\nspotVector = normalize( spotVector );\nfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\nif ( spotEffect > spotLightAngleCos[ i ] ) {\nspotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );\n#ifdef WRAP_AROUND\nfloat spotDiffuseWeightFull = max( dot( normal, spotVector ), 0.0 );\nfloat spotDiffuseWeightHalf = max( 0.5 * dot( normal, spotVector ) + 0.5, 0.0 );\nvec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n#else\nfloat spotDiffuseWeight = max( dot( normal, spotVector ), 0.0 );\n#endif\nspotDiffuse += spotDistance * spotLightColor[ i ] * uDiffuseColor * spotDiffuseWeight * spotEffect;\nvec3 spotHalfVector = normalize( spotVector + viewPosition );\nfloat spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\nfloat spotSpecularWeight = specularTex.r * max( pow( spotDotNormalHalf, uShininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( uShininess + 2.0001 ) / 8.0;\nvec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( spotVector, spotHalfVector ), 5.0 );\nspotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * spotDistance * specularNormalization * spotEffect;\n#else\nspotSpecular += spotDistance * spotLightColor[ i ] * uSpecularColor * spotSpecularWeight * spotDiffuseWeight * spotEffect;\n#endif\n}\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec3 dirDiffuse = vec3( 0.0 );\nvec3 dirSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\n#ifdef WRAP_AROUND\nfloat directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );\nfloat directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );\nvec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );\n#else\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\n#endif\ndirDiffuse += directionalLightColor[ i ] * uDiffuseColor * dirDiffuseWeight;\nvec3 dirHalfVector = normalize( dirVector + viewPosition );\nfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\nfloat dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, uShininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( uShininess + 2.0001 ) / 8.0;\nvec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );\ndirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n#else\ndirSpecular += directionalLightColor[ i ] * uSpecularColor * dirSpecularWeight * dirDiffuseWeight;\n#endif\n}\n#endif\n#if MAX_HEMI_LIGHTS > 0\nvec3 hemiDiffuse  = vec3( 0.0 );\nvec3 hemiSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\nvec3 lVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( normal, lVector );\nfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\nvec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\nhemiDiffuse += uDiffuseColor * hemiColor;\nvec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\nfloat hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\nfloat hemiSpecularWeightSky = specularTex.r * max( pow( hemiDotNormalHalfSky, uShininess ), 0.0 );\nvec3 lVectorGround = -lVector;\nvec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\nfloat hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\nfloat hemiSpecularWeightGround = specularTex.r * max( pow( hemiDotNormalHalfGround, uShininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat dotProductGround = dot( normal, lVectorGround );\nfloat specularNormalization = ( uShininess + 2.0001 ) / 8.0;\nvec3 schlickSky = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );\nvec3 schlickGround = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );\nhemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n#else\nhemiSpecular += uSpecularColor * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;\n#endif\n}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#if MAX_HEMI_LIGHTS > 0\ntotalDiffuse += hemiDiffuse;\ntotalSpecular += hemiSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\n#if MAX_SPOT_LIGHTS > 0\ntotalDiffuse += spotDiffuse;\ntotalSpecular += spotSpecular;\n#endif\n#ifdef METAL\ngl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor + totalSpecular );\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor ) + totalSpecular;\n#endif\nif ( enableReflection ) {\nvec3 vReflect;\nvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\nif ( useRefract ) {\nvReflect = refract( cameraToVertex, normal, uRefractionRatio );\n} else {\nvReflect = reflect( cameraToVertex, normal );\n}\nvec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\n#ifdef GAMMA_INPUT\ncubeColor.xyz *= cubeColor.xyz;\n#endif\ngl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * uReflectivity );\n}",THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;\nuniform vec2 uOffset;\nuniform vec2 uRepeat;\nuniform bool enableDisplacement;\n#ifdef VERTEX_TEXTURES\nuniform sampler2D tDisplacement;\nuniform float uDisplacementScale;\nuniform float uDisplacementBias;\n#endif\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vWorldPosition;\nvarying vec3 vViewPosition;",THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,"#ifdef USE_SKINNING\nvNormal = normalize( normalMatrix * skinnedNormal.xyz );\nvec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );\nvTangent = normalize( normalMatrix * skinnedTangent.xyz );\n#else\nvNormal = normalize( normalMatrix * normal );\nvTangent = normalize( normalMatrix * tangent.xyz );\n#endif\nvBinormal = normalize( cross( vNormal, vTangent ) * tangent.w );\nvUv = uv * uRepeat + uOffset;\nvec3 displacedPosition;\n#ifdef VERTEX_TEXTURES\nif ( enableDisplacement ) {\nvec3 dv = texture2D( tDisplacement, uv ).xyz;\nfloat df = uDisplacementScale * dv.x + uDisplacementBias;\ndisplacedPosition = position + normalize( normal ) * df;\n} else {\n#ifdef USE_SKINNING\nvec4 skinVertex = vec4( position, 1.0 );\nvec4 skinned  = boneMatX * skinVertex * skinWeight.x;\nskinned 	  += boneMatY * skinVertex * skinWeight.y;\ndisplacedPosition  = skinned.xyz;\n#else\ndisplacedPosition = position;\n#endif\n}\n#else\n#ifdef USE_SKINNING\nvec4 skinVertex = vec4( position, 1.0 );\nvec4 skinned  = boneMatX * skinVertex * skinWeight.x;\nskinned 	  += boneMatY * skinVertex * skinWeight.y;\ndisplacedPosition  = skinned.xyz;\n#else\ndisplacedPosition = position;\n#endif\n#endif\nvec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );\nvec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );\ngl_Position = projectionMatrix * mvPosition;\nvWorldPosition = worldPosition.xyz;\nvViewPosition = -mvPosition.xyz;\n#ifdef USE_SHADOWMAP\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n}\n#endif\n}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:"varying vec3 vWorldPosition;\nvoid main() {\nvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\nvWorldPosition = worldPosition.xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform samplerCube tCube;\nuniform float tFlip;\nvarying vec3 vWorldPosition;\nvoid main() {\ngl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n}"},depthRGBA:{uniforms:{},vertexShader:[THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,"void main() {",THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:"vec4 pack_depth( const in float depth ) {\nconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\nconst vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\nvec4 res = fract( depth * bit_shift );\nres -= res.xxyz * bit_mask;\nreturn res;\n}\nvoid main() {\ngl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );\n}"}},THREE.WebGLRenderer=function(e){function t(e){if(e.__webglCustomAttributesList)for(var t in e.__webglCustomAttributesList)xt.deleteBuffer(e.__webglCustomAttributesList[t].buffer)}function n(e,t){var n=e.vertices.length,r=t.material;if(r.attributes){void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]);for(var i in r.attributes){var s=r.attributes[i];if(!s.__webglInitialized||s.createUniqueBuffers){s.__webglInitialized=!0;var o=1;"v2"===s.type?o=2:"v3"===s.type?o=3:"v4"===s.type?o=4:"c"===s.type&&(o=3),s.size=o,s.array=new Float32Array(n*o),s.buffer=xt.createBuffer(),s.buffer.belongsToAttribute=i,s.needsUpdate=!0}e.__webglCustomAttributesList.push(s)}}}function r(e,t){var n=t.geometry,r=e.faces3,u=e.faces4,a=3*r.length+4*u.length,f=1*r.length+2*u.length,u=3*r.length+4*u.length,r=i(t,e),l=o(r),c=s(r),h=r.vertexColors?r.vertexColors:!1;e.__vertexArray=new Float32Array(3*a),c&&(e.__normalArray=new Float32Array(3*a)),n.hasTangents&&(e.__tangentArray=new Float32Array(4*a)),h&&(e.__colorArray=new Float32Array(3*a));if(l){if(0<n.faceUvs.length||0<n.faceVertexUvs.length)e.__uvArray=new Float32Array(2*a);if(1<n.faceUvs.length||1<n.faceVertexUvs.length)e.__uv2Array=new Float32Array(2*a)}t.geometry.skinWeights.length&&t.geometry.skinIndices.length&&(e.__skinIndexArray=new Float32Array(4*a),e.__skinWeightArray=new Float32Array(4*a)),e.__faceArray=new Uint16Array(3*f),e.__lineArray=new Uint16Array(2*u);if(e.numMorphTargets){e.__morphTargetsArrays=[],n=0;for(l=e.numMorphTargets;n<l;n++)e.__morphTargetsArrays.push(new Float32Array(3*a))}if(e.numMorphNormals){e.__morphNormalsArrays=[],n=0;for(l=e.numMorphNormals;n<l;n++)e.__morphNormalsArrays.push(new Float32Array(3*a))}e.__webglFaceCount=3*f,e.__webglLineCount=2*u;if(r.attributes){void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]);for(var p in r.attributes){var f=r.attributes[p],n={},d;for(d in f)n[d]=f[d];if(!n.__webglInitialized||n.createUniqueBuffers)n.__webglInitialized=!0,u=1,"v2"===n.type?u=2:"v3"===n.type?u=3:"v4"===n.type?u=4:"c"===n.type&&(u=3),n.size=u,n.array=new Float32Array(a*u),n.buffer=xt.createBuffer(),n.buffer.belongsToAttribute=p,f.needsUpdate=!0,n.__original=f;e.__webglCustomAttributesList.push(n)}}e.__inittedArrays=!0}function i(e,t){return e.material instanceof THREE.MeshFaceMaterial?e.material.materials[t.materialIndex]:e.material}function s(e){return e instanceof THREE.MeshBasicMaterial&&!e.envMap||e instanceof THREE.MeshDepthMaterial?!1:e&&void 0!==e.shading&&e.shading===THREE.SmoothShading?THREE.SmoothShading:THREE.FlatShading}function o(e){return e.map||e.lightMap||e.bumpMap||e.normalMap||e.specularMap||e instanceof THREE.ShaderMaterial?!0:!1}function u(e){vt[e]||(xt.enableVertexAttribArray(e),vt[e]=!0)}function a(){for(var e in vt)vt[e]&&(xt.disableVertexAttribArray(e),vt[e]=!1)}function f(e,t){return e.z!==t.z?t.z-e.z:t.id-e.id}function l(e,t){return t[0]-e[0]}function c(e,t,n){if(e.length)for(var r=0,i=e.length;r<i;r++)J=W=null,V=$=Y=G=it=rt=Z=-1,Et=!0,e[r].render(t,n,pt,dt),J=W=null,V=$=Y=G=it=rt=Z=-1,Et=!0}function h(e,t,n,r,i,s,o,u){var a,f,l,c;t?(f=e.length-1,c=t=-1):(f=0,t=e.length,c=1);for(var h=f;h!==t;h+=c)if(a=e[h],a.render){f=a.object,l=a.buffer;if(u)a=u;else{a=a[n];if(!a)continue;o&&R.setBlending(a.blending,a.blendEquation,a.blendSrc,a.blendDst),R.setDepthTest(a.depthTest),R.setDepthWrite(a.depthWrite),N(a.polygonOffset,a.polygonOffsetFactor,a.polygonOffsetUnits)}R.setMaterialFaces(a),l instanceof THREE.BufferGeometry?R.renderBufferDirect(r,i,s,a,l,f):R.renderBuffer(r,i,s,a,l,f)}}function p(e,t,n,r,i,s,o){for(var u,a,f=0,l=e.length;f<l;f++)if(u=e[f],a=u.object,a.visible){if(o)u=o;else{u=u[t];if(!u)continue;s&&R.setBlending(u.blending,u.blendEquation,u.blendSrc,u.blendDst),R.setDepthTest(u.depthTest),R.setDepthWrite(u.depthWrite),N(u.polygonOffset,u.polygonOffsetFactor,u.polygonOffsetUnits)}R.renderImmediateObject(n,r,i,u,a)}}function d(e,t,n){e.push({buffer:t,object:n,opaque:null,transparent:null})}function v(e){for(var t in e.attributes)if(e.attributes[t].needsUpdate)return!0;return!1}function m(e){for(var t in e.attributes)e.attributes[t].needsUpdate=!1}function g(e,t){for(var n=e.length-1;0<=n;n--)e[n].object===t&&e.splice(n,1)}function y(e,t){for(var n=e.length-1;0<=n;n--)e[n]===t&&e.splice(n,1)}function b(e,t,n,r,i){Q=0,r.needsUpdate&&(r.program&&Ft(r),R.initMaterial(r,t,n,i),r.needsUpdate=!1),r.morphTargets&&!i.__webglMorphTargetInfluences&&(i.__webglMorphTargetInfluences=new Float32Array(R.maxMorphTargets));var s=!1,o=r.program,u=o.uniforms,a=r.uniforms;o!==W&&(xt.useProgram(o),W=o,s=!0),r.id!==V&&(V=r.id,s=!0);if(s||e!==J)xt.uniformMatrix4fv(u.projectionMatrix,!1,e.projectionMatrix.elements),e!==J&&(J=e);if(r.skinning)if(Dt&&i.useVertexTexture){if(null!==u.boneTexture){var f=w();xt.uniform1i(u.boneTexture,f),R.setTexture(i.boneTexture,f)}}else null!==u.boneGlobalMatrices&&xt.uniformMatrix4fv(u.boneGlobalMatrices,!1,i.boneMatrices);if(s){n&&r.fog&&(a.fogColor.value=n.color,n instanceof THREE.Fog?(a.fogNear.value=n.near,a.fogFar.value=n.far):n instanceof THREE.FogExp2&&(a.fogDensity.value=n.density));if(r instanceof THREE.MeshPhongMaterial||r instanceof THREE.MeshLambertMaterial||r.lights){if(Et){for(var l,c=f=0,h=0,p,d,v,m=St,g=m.directional.colors,y=m.directional.positions,b=m.point.colors,E=m.point.positions,T=m.point.distances,N=m.spot.colors,C=m.spot.positions,k=m.spot.distances,A=m.spot.directions,O=m.spot.anglesCos,D=m.spot.exponents,P=m.hemi.skyColors,H=m.hemi.groundColors,B=m.hemi.positions,j=0,F=0,I=0,q=0,U=0,z=0,X=0,$=0,K=l=0,n=v=K=0,s=t.length;n<s;n++)l=t[n],l.onlyShadow||(p=l.color,d=l.intensity,v=l.distance,l instanceof THREE.AmbientLight?l.visible&&(R.gammaInput?(f+=p.r*p.r,c+=p.g*p.g,h+=p.b*p.b):(f+=p.r,c+=p.g,h+=p.b)):l instanceof THREE.DirectionalLight?(U+=1,l.visible&&(wt.getPositionFromMatrix(l.matrixWorld),bt.getPositionFromMatrix(l.target.matrixWorld),wt.sub(bt),wt.normalize(),0===wt.x&&0===wt.y&&0===wt.z||(l=3*j,y[l]=wt.x,y[l+1]=wt.y,y[l+2]=wt.z,R.gammaInput?S(g,l,p,d*d):x(g,l,p,d),j+=1))):l instanceof THREE.PointLight?(z+=1,l.visible&&(K=3*F,R.gammaInput?S(b,K,p,d*d):x(b,K,p,d),bt.getPositionFromMatrix(l.matrixWorld),E[K]=bt.x,E[K+1]=bt.y,E[K+2]=bt.z,T[F]=v,F+=1)):l instanceof THREE.SpotLight?(X+=1,l.visible&&(K=3*I,R.gammaInput?S(N,K,p,d*d):x(N,K,p,d),bt.getPositionFromMatrix(l.matrixWorld),C[K]=bt.x,C[K+1]=bt.y,C[K+2]=bt.z,k[I]=v,wt.copy(bt),bt.getPositionFromMatrix(l.target.matrixWorld),wt.sub(bt),wt.normalize(),A[K]=wt.x,A[K+1]=wt.y,A[K+2]=wt.z,O[I]=Math.cos(l.angle),D[I]=l.exponent,I+=1)):l instanceof THREE.HemisphereLight&&($+=1,l.visible&&(wt.getPositionFromMatrix(l.matrixWorld),wt.normalize(),0===wt.x&&0===wt.y&&0===wt.z||(v=3*q,B[v]=wt.x,B[v+1]=wt.y,B[v+2]=wt.z,p=l.color,l=l.groundColor,R.gammaInput?(d*=d,S(P,v,p,d),S(H,v,l,d)):(x(P,v,p,d),x(H,v,l,d)),q+=1))));n=3*j;for(s=Math.max(g.length,3*U);n<s;n++)g[n]=0;n=3*F;for(s=Math.max(b.length,3*z);n<s;n++)b[n]=0;n=3*I;for(s=Math.max(N.length,3*X);n<s;n++)N[n]=0;n=3*q;for(s=Math.max(P.length,3*$);n<s;n++)P[n]=0;n=3*q;for(s=Math.max(H.length,3*$);n<s;n++)H[n]=0;m.directional.length=j,m.point.length=F,m.spot.length=I,m.hemi.length=q,m.ambient[0]=f,m.ambient[1]=c,m.ambient[2]=h,Et=!1}n=St,a.ambientLightColor.value=n.ambient,a.directionalLightColor.value=n.directional.colors,a.directionalLightDirection.value=n.directional.positions,a.pointLightColor.value=n.point.colors,a.pointLightPosition.value=n.point.positions,a.pointLightDistance.value=n.point.distances,a.spotLightColor.value=n.spot.colors,a.spotLightPosition.value=n.spot.positions,a.spotLightDistance.value=n.spot.distances,a.spotLightDirection.value=n.spot.directions,a.spotLightAngleCos.value=n.spot.anglesCos,a.spotLightExponent.value=n.spot.exponents,a.hemisphereLightSkyColor.value=n.hemi.skyColors,a.hemisphereLightGroundColor.value=n.hemi.groundColors,a.hemisphereLightDirection.value=n.hemi.positions}if(r instanceof THREE.MeshBasicMaterial||r instanceof THREE.MeshLambertMaterial||r instanceof THREE.MeshPhongMaterial){a.opacity.value=r.opacity,R.gammaInput?a.diffuse.value.copyGammaToLinear(r.color):a.diffuse.value=r.color,a.map.value=r.map,a.lightMap.value=r.lightMap,a.specularMap.value=r.specularMap,r.bumpMap&&(a.bumpMap.value=r.bumpMap,a.bumpScale.value=r.bumpScale),r.normalMap&&(a.normalMap.value=r.normalMap,a.normalScale.value.copy(r.normalScale));var G;r.map?G=r.map:r.specularMap?G=r.specularMap:r.normalMap?G=r.normalMap:r.bumpMap&&(G=r.bumpMap),void 0!==G&&(n=G.offset,G=G.repeat,a.offsetRepeat.value.set(n.x,n.y,G.x,G.y)),a.envMap.value=r.envMap,a.flipEnvMap.value=r.envMap instanceof THREE.WebGLRenderTargetCube?1:-1,a.reflectivity.value=r.reflectivity,a.refractionRatio.value=r.refractionRatio,a.combine.value=r.combine,a.useRefract.value=r.envMap&&r.envMap.mapping instanceof THREE.CubeRefractionMapping}r instanceof THREE.LineBasicMaterial?(a.diffuse.value=r.color,a.opacity.value=r.opacity):r instanceof THREE.LineDashedMaterial?(a.diffuse.value=r.color,a.opacity.value=r.opacity,a.dashSize.value=r.dashSize,a.totalSize.value=r.dashSize+r.gapSize,a.scale.value=r.scale):r instanceof THREE.ParticleBasicMaterial?(a.psColor.value=r.color,a.opacity.value=r.opacity,a.size.value=r.size,a.scale.value=_.height/2,a.map.value=r.map):r instanceof THREE.MeshPhongMaterial?(a.shininess.value=r.shininess,R.gammaInput?(a.ambient.value.copyGammaToLinear(r.ambient),a.emissive.value.copyGammaToLinear(r.emissive),a.specular.value.copyGammaToLinear(r.specular)):(a.ambient.value=r.ambient,a.emissive.value=r.emissive,a.specular.value=r.specular),r.wrapAround&&a.wrapRGB.value.copy(r.wrapRGB)):r instanceof THREE.MeshLambertMaterial?(R.gammaInput?(a.ambient.value.copyGammaToLinear(r.ambient),a.emissive.value.copyGammaToLinear(r.emissive)):(a.ambient.value=r.ambient,a.emissive.value=r.emissive),r.wrapAround&&a.wrapRGB.value.copy(r.wrapRGB)):r instanceof THREE.MeshDepthMaterial?(a.mNear.value=e.near,a.mFar.value=e.far,a.opacity.value=r.opacity):r instanceof THREE.MeshNormalMaterial&&(a.opacity.value=r.opacity);if(i.receiveShadow&&!r._shadowPass&&a.shadowMatrix){n=G=0;for(s=t.length;n<s;n++)if(f=t[n],f.castShadow&&(f instanceof THREE.SpotLight||f instanceof THREE.DirectionalLight&&!f.shadowCascade))a.shadowMap.value[G]=f.shadowMap,a.shadowMapSize.value[G]=f.shadowMapSize,a.shadowMatrix.value[G]=f.shadowMatrix,a.shadowDarkness.value[G]=f.shadowDarkness,a.shadowBias.value[G]=f.shadowBias,G++}t=r.uniformsList,a=0;for(G=t.length;a<G;a++)if(s=o.uniforms[t[a][1]])if(n=t[a][0],c=n.type,f=n.value,"i"===c)xt.uniform1i(s,f);else if("f"===c)xt.uniform1f(s,f);else if("v2"===c)xt.uniform2f(s,f.x,f.y);else if("v3"===c)xt.uniform3f(s,f.x,f.y,f.z);else if("v4"===c)xt.uniform4f(s,f.x,f.y,f.z,f.w);else if("c"===c)xt.uniform3f(s,f.r,f.g,f.b);else if("iv1"===c)xt.uniform1iv(s,f);else if("iv"===c)xt.uniform3iv(s,f);else if("fv1"===c)xt.uniform1fv(s,f);else if("fv"===c)xt.uniform3fv(s,f);else if("v2v"===c){void 0===n._array&&(n._array=new Float32Array(2*f.length)),c=0;for(h=f.length;c<h;c++)m=2*c,n._array[m]=f[c].x,n._array[m+1]=f[c].y;xt.uniform2fv(s,n._array)}else if("v3v"===c){void 0===n._array&&(n._array=new Float32Array(3*f.length)),c=0;for(h=f.length;c<h;c++)m=3*c,n._array[m]=f[c].x,n._array[m+1]=f[c].y,n._array[m+2]=f[c].z;xt.uniform3fv(s,n._array)}else if("v4v"===c){void 0===n._array&&(n._array=new Float32Array(4*f.length)),c=0;for(h=f.length;c<h;c++)m=4*c,n._array[m]=f[c].x,n._array[m+1]=f[c].y,n._array[m+2]=f[c].z,n._array[m+3]=f[c].w;xt.uniform4fv(s,n._array)}else if("m4"===c)void 0===n._array&&(n._array=new Float32Array(16)),f.flattenToArray(n._array),xt.uniformMatrix4fv(s,!1,n._array);else if("m4v"===c){void 0===n._array&&(n._array=new Float32Array(16*f.length)),c=0;for(h=f.length;c<h;c++)f[c].flattenToArrayOffset(n._array,16*c);xt.uniformMatrix4fv(s,!1,n._array)}else if("t"===c){if(m=f,f=w(),xt.uniform1i(s,f),m)if(m.image instanceof Array&&6===m.image.length){if(n=m,s=f,6===n.image.length)if(n.needsUpdate){n.image.__webglTextureCube||(n.image.__webglTextureCube=xt.createTexture(),R.info.memory.textures++),xt.activeTexture(xt.TEXTURE0+s),xt.bindTexture(xt.TEXTURE_CUBE_MAP,n.image.__webglTextureCube),xt.pixelStorei(xt.UNPACK_FLIP_Y_WEBGL,n.flipY),s=n instanceof THREE.CompressedTexture,f=[];for(c=0;6>c;c++)R.autoScaleCubemaps&&!s?(h=f,m=c,g=n.image[c],b=Ot,g.width<=b&&g.height<=b||(E=Math.max(g.width,g.height),y=Math.floor(g.width*b/E),b=Math.floor(g.height*b/E),E=document.createElement("canvas"),E.width=y,E.height=b,E.getContext("2d").drawImage(g,0,0,g.width,g.height,0,0,y,b),g=E),h[m]=g):f[c]=n.image[c];c=f[0],h=0===(c.width&c.width-1)&&0===(c.height&c.height-1),m=M(n.format),g=M(n.type),L(xt.TEXTURE_CUBE_MAP,n,h);for(c=0;6>c;c++)if(s){b=f[c].mipmaps,E=0;for(T=b.length;E<T;E++)y=b[E],xt.compressedTexImage2D(xt.TEXTURE_CUBE_MAP_POSITIVE_X+c,E,m,y.width,y.height,0,y.data)}else xt.texImage2D(xt.TEXTURE_CUBE_MAP_POSITIVE_X+c,0,m,m,g,f[c]);n.generateMipmaps&&h&&xt.generateMipmap(xt.TEXTURE_CUBE_MAP),n.needsUpdate=!1,n.onUpdate&&n.onUpdate()}else xt.activeTexture(xt.TEXTURE0+s),xt.bindTexture(xt.TEXTURE_CUBE_MAP,n.image.__webglTextureCube)}else m instanceof THREE.WebGLRenderTargetCube?(n=m,xt.activeTexture(xt.TEXTURE0+f),xt.bindTexture(xt.TEXTURE_CUBE_MAP,n.__webglTexture)):R.setTexture(m,f)}else if("tv"===c){void 0===n._array&&(n._array=[]),c=0;for(h=n.value.length;c<h;c++)n._array[c]=w();xt.uniform1iv(s,n._array),c=0;for(h=n.value.length;c<h;c++)m=n.value[c],f=n._array[c],m&&R.setTexture(m,f)}(r instanceof THREE.ShaderMaterial||r instanceof THREE.MeshPhongMaterial||r.envMap)&&null!==u.cameraPosition&&(bt.getPositionFromMatrix(e.matrixWorld),xt.uniform3f(u.cameraPosition,bt.x,bt.y,bt.z)),(r instanceof THREE.MeshPhongMaterial||r instanceof THREE.MeshLambertMaterial||r instanceof THREE.ShaderMaterial||r.skinning)&&null!==u.viewMatrix&&xt.uniformMatrix4fv(u.viewMatrix,!1,e.matrixWorldInverse.elements)}return xt.uniformMatrix4fv(u.modelViewMatrix,!1,i._modelViewMatrix.elements),u.normalMatrix&&xt.uniformMatrix3fv(u.normalMatrix,!1,i._normalMatrix.elements),null!==u.modelMatrix&&xt.uniformMatrix4fv(u.modelMatrix,!1,i.matrixWorld.elements),o}function w(){var e=Q;return e>=At&&console.warn("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+At),Q+=1,e}function E(e,t){e._modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld),e._normalMatrix.getInverse(e._modelViewMatrix),e._normalMatrix.transpose()}function S(e,t,n,r){e[t]=n.r*n.r*r,e[t+1]=n.g*n.g*r,e[t+2]=n.b*n.b*r}function x(e,t,n,r){e[t]=n.r*r,e[t+1]=n.g*r,e[t+2]=n.b*r}function T(e){e!==at&&(xt.lineWidth(e),at=e)}function N(e,t,n){st!==e&&(e?xt.enable(xt.POLYGON_OFFSET_FILL):xt.disable(xt.POLYGON_OFFSET_FILL),st=e),e&&(ot!==t||ut!==n)&&(xt.polygonOffset(t,n),ot=t,ut=n)}function C(e){for(var e=e.split("\n"),t=0,n=e.length;t<n;t++)e[t]=t+1+": "+e[t];return e.join("\n")}function k(e,t){var n;return"fragment"===e?n=xt.createShader(xt.FRAGMENT_SHADER):"vertex"===e&&(n=xt.createShader(xt.VERTEX_SHADER)),xt.shaderSource(n,t),xt.compileShader(n),xt.getShaderParameter(n,xt.COMPILE_STATUS)?n:(console.error(xt.getShaderInfoLog(n)),console.error(C(t)),null)}function L(e,t,n){n?(xt.texParameteri(e,xt.TEXTURE_WRAP_S,M(t.wrapS)),xt.texParameteri(e,xt.TEXTURE_WRAP_T,M(t.wrapT)),xt.texParameteri(e,xt.TEXTURE_MAG_FILTER,M(t.magFilter)),xt.texParameteri(e,xt.TEXTURE_MIN_FILTER,M(t.minFilter))):(xt.texParameteri(e,xt.TEXTURE_WRAP_S,xt.CLAMP_TO_EDGE),xt.texParameteri(e,xt.TEXTURE_WRAP_T,xt.CLAMP_TO_EDGE),xt.texParameteri(e,xt.TEXTURE_MAG_FILTER,O(t.magFilter)),xt.texParameteri(e,xt.TEXTURE_MIN_FILTER,O(t.minFilter))),Ct&&t.type!==THREE.FloatType&&(1<t.anisotropy||t.__oldAnisotropy)&&(xt.texParameterf(e,Ct.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,Mt)),t.__oldAnisotropy=t.anisotropy)}function A(e,t){xt.bindRenderbuffer(xt.RENDERBUFFER,e),t.depthBuffer&&!t.stencilBuffer?(xt.renderbufferStorage(xt.RENDERBUFFER,xt.DEPTH_COMPONENT16,t.width,t.height),xt.framebufferRenderbuffer(xt.FRAMEBUFFER,xt.DEPTH_ATTACHMENT,xt.RENDERBUFFER,e)):t.depthBuffer&&t.stencilBuffer?(xt.renderbufferStorage(xt.RENDERBUFFER,xt.DEPTH_STENCIL,t.width,t.height),xt.framebufferRenderbuffer(xt.FRAMEBUFFER,xt.DEPTH_STENCIL_ATTACHMENT,xt.RENDERBUFFER,e)):xt.renderbufferStorage(xt.RENDERBUFFER,xt.RGBA4,t.width,t.height)}function O(e){return e===THREE.NearestFilter||e===THREE.NearestMipMapNearestFilter||e===THREE.NearestMipMapLinearFilter?xt.NEAREST:xt.LINEAR}function M(e){if(e===THREE.RepeatWrapping)return xt.REPEAT;if(e===THREE.ClampToEdgeWrapping)return xt.CLAMP_TO_EDGE;if(e===THREE.MirroredRepeatWrapping)return xt.MIRRORED_REPEAT;if(e===THREE.NearestFilter)return xt.NEAREST;if(e===THREE.NearestMipMapNearestFilter)return xt.NEAREST_MIPMAP_NEAREST;if(e===THREE.NearestMipMapLinearFilter)return xt.NEAREST_MIPMAP_LINEAR;if(e===THREE.LinearFilter)return xt.LINEAR;if(e===THREE.LinearMipMapNearestFilter)return xt.LINEAR_MIPMAP_NEAREST;if(e===THREE.LinearMipMapLinearFilter)return xt.LINEAR_MIPMAP_LINEAR;if(e===THREE.UnsignedByteType)return xt.UNSIGNED_BYTE;if(e===THREE.UnsignedShort4444Type)return xt.UNSIGNED_SHORT_4_4_4_4;if(e===THREE.UnsignedShort5551Type)return xt.UNSIGNED_SHORT_5_5_5_1;if(e===THREE.UnsignedShort565Type)return xt.UNSIGNED_SHORT_5_6_5;if(e===THREE.ByteType)return xt.BYTE;if(e===THREE.ShortType)return xt.SHORT;if(e===THREE.UnsignedShortType)return xt.UNSIGNED_SHORT;if(e===THREE.IntType)return xt.INT;if(e===THREE.UnsignedIntType)return xt.UNSIGNED_INT;if(e===THREE.FloatType)return xt.FLOAT;if(e===THREE.AlphaFormat)return xt.ALPHA;if(e===THREE.RGBFormat)return xt.RGB;if(e===THREE.RGBAFormat)return xt.RGBA;if(e===THREE.LuminanceFormat)return xt.LUMINANCE;if(e===THREE.LuminanceAlphaFormat)return xt.LUMINANCE_ALPHA;if(e===THREE.AddEquation)return xt.FUNC_ADD;if(e===THREE.SubtractEquation)return xt.FUNC_SUBTRACT;if(e===THREE.ReverseSubtractEquation)return xt.FUNC_REVERSE_SUBTRACT;if(e===THREE.ZeroFactor)return xt.ZERO;if(e===THREE.OneFactor)return xt.ONE;if(e===THREE.SrcColorFactor)return xt.SRC_COLOR;if(e===THREE.OneMinusSrcColorFactor)return xt.ONE_MINUS_SRC_COLOR;if(e===THREE.SrcAlphaFactor)return xt.SRC_ALPHA;if(e===THREE.OneMinusSrcAlphaFactor)return xt.ONE_MINUS_SRC_ALPHA;if(e===THREE.DstAlphaFactor)return xt.DST_ALPHA;if(e===THREE.OneMinusDstAlphaFactor)return xt.ONE_MINUS_DST_ALPHA;if(e===THREE.DstColorFactor)return xt.DST_COLOR;if(e===THREE.OneMinusDstColorFactor)return xt.ONE_MINUS_DST_COLOR;if(e===THREE.SrcAlphaSaturateFactor)return xt.SRC_ALPHA_SATURATE;if(void 0!==kt){if(e===THREE.RGB_S3TC_DXT1_Format)return kt.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===THREE.RGBA_S3TC_DXT1_Format)return kt.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===THREE.RGBA_S3TC_DXT3_Format)return kt.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===THREE.RGBA_S3TC_DXT5_Format)return kt.COMPRESSED_RGBA_S3TC_DXT5_EXT}return 0}console.log("THREE.WebGLRenderer",THREE.REVISION);var e=e||{},_=void 0!==e.canvas?e.canvas:document.createElement("canvas"),D=void 0!==e.precision?e.precision:"highp",P=void 0!==e.alpha?e.alpha:!0,H=void 0!==e.premultipliedAlpha?e.premultipliedAlpha:!0,B=void 0!==e.antialias?e.antialias:!1,j=void 0!==e.stencil?e.stencil:!0,F=void 0!==e.preserveDrawingBuffer?e.preserveDrawingBuffer:!1,I=void 0!==e.clearColor?new THREE.Color(e.clearColor):new THREE.Color(0),q=void 0!==e.clearAlpha?e.clearAlpha:0;this.domElement=_,this.context=null,this.devicePixelRatio=void 0!==e.devicePixelRatio?e.devicePixelRatio:void 0!==window.devicePixelRatio?window.devicePixelRatio:1,this.autoUpdateScene=this.autoUpdateObjects=this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0,this.shadowMapEnabled=this.physicallyBasedShading=this.gammaOutput=this.gammaInput=!1,this.shadowMapAutoUpdate=!0,this.shadowMapType=THREE.PCFShadowMap,this.shadowMapCullFace=THREE.CullFaceFront,this.shadowMapCascade=this.shadowMapDebug=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0,this.renderPluginsPre=[],this.renderPluginsPost=[],this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var R=this,U=[],z=0,W=null,X=null,V=-1,$=null,J=null,K=0,Q=0,G=-1,Y=-1,Z=-1,et=-1,tt=-1,nt=-1,rt=-1,it=-1,st=null,ot=null,ut=null,at=null,ft=0,lt=0,ct=0,ht=0,pt=0,dt=0,vt={},mt=new THREE.Frustum,gt=new THREE.Matrix4,yt=new THREE.Matrix4,bt=new THREE.Vector3,wt=new THREE.Vector3,Et=!0,St={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}},xt,Tt,Nt,Ct,kt;try{if(!(xt=_.getContext("experimental-webgl",{alpha:P,premultipliedAlpha:H,antialias:B,stencil:j,preserveDrawingBuffer:F})))throw"Error creating WebGL context."}catch(Lt){console.error(Lt)}Tt=xt.getExtension("OES_texture_float"),Nt=xt.getExtension("OES_standard_derivatives"),Ct=xt.getExtension("EXT_texture_filter_anisotropic")||xt.getExtension("MOZ_EXT_texture_filter_anisotropic")||xt.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),kt=xt.getExtension("WEBGL_compressed_texture_s3tc")||xt.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||xt.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),Tt||console.log("THREE.WebGLRenderer: Float textures not supported."),Nt||console.log("THREE.WebGLRenderer: Standard derivatives not supported."),Ct||console.log("THREE.WebGLRenderer: Anisotropic texture filtering not supported."),kt||console.log("THREE.WebGLRenderer: S3TC compressed textures not supported."),void 0===xt.getShaderPrecisionFormat&&(xt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}),xt.clearColor(0,0,0,1),xt.clearDepth(1),xt.clearStencil(0),xt.enable(xt.DEPTH_TEST),xt.depthFunc(xt.LEQUAL),xt.frontFace(xt.CCW),xt.cullFace(xt.BACK),xt.enable(xt.CULL_FACE),xt.enable(xt.BLEND),xt.blendEquation(xt.FUNC_ADD),xt.blendFunc(xt.SRC_ALPHA,xt.ONE_MINUS_SRC_ALPHA),xt.clearColor(I.r,I.g,I.b,q),this.context=xt;var At=xt.getParameter(xt.MAX_TEXTURE_IMAGE_UNITS),e=xt.getParameter(xt.MAX_VERTEX_TEXTURE_IMAGE_UNITS);xt.getParameter(xt.MAX_TEXTURE_SIZE);var Ot=xt.getParameter(xt.MAX_CUBE_MAP_TEXTURE_SIZE),Mt=Ct?xt.getParameter(Ct.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,_t=0<e,Dt=_t&&Tt;kt&&xt.getParameter(xt.COMPRESSED_TEXTURE_FORMATS),H=xt.getShaderPrecisionFormat(xt.VERTEX_SHADER,xt.HIGH_FLOAT),e=xt.getShaderPrecisionFormat(xt.VERTEX_SHADER,xt.MEDIUM_FLOAT),xt.getShaderPrecisionFormat(xt.VERTEX_SHADER,xt.LOW_FLOAT),B=xt.getShaderPrecisionFormat(xt.FRAGMENT_SHADER,xt.HIGH_FLOAT),P=xt.getShaderPrecisionFormat(xt.FRAGMENT_SHADER,xt.MEDIUM_FLOAT),xt.getShaderPrecisionFormat(xt.FRAGMENT_SHADER,xt.LOW_FLOAT),xt.getShaderPrecisionFormat(xt.VERTEX_SHADER,xt.HIGH_INT),xt.getShaderPrecisionFormat(xt.VERTEX_SHADER,xt.MEDIUM_INT),xt.getShaderPrecisionFormat(xt.VERTEX_SHADER,xt.LOW_INT),xt.getShaderPrecisionFormat(xt.FRAGMENT_SHADER,xt.HIGH_INT),xt.getShaderPrecisionFormat(xt.FRAGMENT_SHADER,xt.MEDIUM_INT),xt.getShaderPrecisionFormat(xt.FRAGMENT_SHADER,xt.LOW_INT),H=0<H.precision&&0<B.precision,e=0<e.precision&&0<P.precision,"highp"===D&&!H&&(e?(D="mediump",console.warn("WebGLRenderer: highp not supported, using mediump")):(D="lowp",console.warn("WebGLRenderer: highp and mediump not supported, using lowp"))),"mediump"===D&&!e&&(D="lowp",console.warn("WebGLRenderer: mediump not supported, using lowp")),this.getContext=function(){return xt},this.supportsVertexTextures=function(){return _t},this.supportsFloatTextures=function(){return Tt},this.supportsStandardDerivatives=function(){return Nt},this.supportsCompressedTextureS3TC=function(){return kt},this.getMaxAnisotropy=function(){return Mt},this.getPrecision=function(){return D},this.setSize=function(e,t){_.width=e*this.devicePixelRatio,_.height=t*this.devicePixelRatio,_.style.width=e+"px",_.style.height=t+"px",this.setViewport(0,0,_.width,_.height)},this.setViewport=function(e,t,n,r){ft=void 0!==e?e:0,lt=void 0!==t?t:0,ct=void 0!==n?n:_.width,ht=void 0!==r?r:_.height,xt.viewport(ft,lt,ct,ht)},this.setScissor=function(e,t,n,r){xt.scissor(e,t,n,r)},this.enableScissorTest=function(e){e?xt.enable(xt.SCISSOR_TEST):xt.disable(xt.SCISSOR_TEST)},this.setClearColorHex=function(e,t){I.setHex(e),q=t,xt.clearColor(I.r,I.g,I.b,q)},this.setClearColor=function(e,t){I.copy(e),q=t,xt.clearColor(I.r,I.g,I.b,q)},this.getClearColor=function(){return I},this.getClearAlpha=function(){return q},this.clear=function(e,t,n){var r=0;if(void 0===e||e)r|=xt.COLOR_BUFFER_BIT;if(void 0===t||t)r|=xt.DEPTH_BUFFER_BIT;if(void 0===n||n)r|=xt.STENCIL_BUFFER_BIT;xt.clear(r)},this.clearTarget=function(e,t,n,r){this.setRenderTarget(e),this.clear(t,n,r)},this.addPostPlugin=function(e){e.init(this),this.renderPluginsPost.push(e)},this.addPrePlugin=function(e){e.init(this),this.renderPluginsPre.push(e)},this.updateShadowMap=function(e,t){W=null,V=$=it=rt=Z=-1,Et=!0,Y=G=-1,this.shadowMapPlugin.update(e,t)};var Pt=function(e){e=e.target,e.removeEventListener("dispose",Pt),e.__webglInit=void 0,void 0!==e.__webglVertexBuffer&&xt.deleteBuffer(e.__webglVertexBuffer),void 0!==e.__webglNormalBuffer&&xt.deleteBuffer(e.__webglNormalBuffer),void 0!==e.__webglTangentBuffer&&xt.deleteBuffer(e.__webglTangentBuffer),void 0!==e.__webglColorBuffer&&xt.deleteBuffer(e.__webglColorBuffer),void 0!==e.__webglUVBuffer&&xt.deleteBuffer(e.__webglUVBuffer),void 0!==e.__webglUV2Buffer&&xt.deleteBuffer(e.__webglUV2Buffer),void 0!==e.__webglSkinIndicesBuffer&&xt.deleteBuffer(e.__webglSkinIndicesBuffer),void 0!==e.__webglSkinWeightsBuffer&&xt.deleteBuffer(e.__webglSkinWeightsBuffer),void 0!==e.__webglFaceBuffer&&xt.deleteBuffer(e.__webglFaceBuffer),void 0!==e.__webglLineBuffer&&xt.deleteBuffer(e.__webglLineBuffer),void 0!==e.__webglLineDistanceBuffer&&xt.deleteBuffer(e.__webglLineDistanceBuffer);if(void 0!==e.geometryGroups)for(var n in e.geometryGroups){var r=e.geometryGroups[n];if(void 0!==r.numMorphTargets)for(var i=0,s=r.numMorphTargets;i<s;i++)xt.deleteBuffer(r.__webglMorphTargetsBuffers[i]);if(void 0!==r.numMorphNormals){i=0;for(s=r.numMorphNormals;i<s;i++)xt.deleteBuffer(r.__webglMorphNormalsBuffers[i])}t(r)}t(e),R.info.memory.geometries--},Ht=function(e){e=e.target,e.removeEventListener("dispose",Ht),e.image&&e.image.__webglTextureCube?xt.deleteTexture(e.image.__webglTextureCube):e.__webglInit&&(e.__webglInit=!1,xt.deleteTexture(e.__webglTexture)),R.info.memory.textures--},Bt=function(e){e=e.target,e.removeEventListener("dispose",Bt);if(e&&e.__webglTexture)if(xt.deleteTexture(e.__webglTexture),e instanceof THREE.WebGLRenderTargetCube)for(var t=0;6>t;t++)xt.deleteFramebuffer(e.__webglFramebuffer[t]),xt.deleteRenderbuffer(e.__webglRenderbuffer[t]);else xt.deleteFramebuffer(e.__webglFramebuffer),xt.deleteRenderbuffer(e.__webglRenderbuffer);R.info.memory.textures--},jt=function(e){e=e.target,e.removeEventListener("dispose",jt),Ft(e)},Ft=function(e){var t=e.program;if(void 0!==t){e.program=void 0;var n,r,i=!1,e=0;for(n=U.length;e<n;e++)if(r=U[e],r.program===t){r.usedTimes--,0===r.usedTimes&&(i=!0);break}if(!0===i){i=[],e=0;for(n=U.length;e<n;e++)r=U[e],r.program!==t&&i.push(r);U=i,xt.deleteProgram(t),R.info.memory.programs--}}};this.renderBufferImmediate=function(e,t,n){e.hasPositions&&!e.__webglVertexBuffer&&(e.__webglVertexBuffer=xt.createBuffer()),e.hasNormals&&!e.__webglNormalBuffer&&(e.__webglNormalBuffer=xt.createBuffer()),e.hasUvs&&!e.__webglUvBuffer&&(e.__webglUvBuffer=xt.createBuffer()),e.hasColors&&!e.__webglColorBuffer&&(e.__webglColorBuffer=xt.createBuffer()),e.hasPositions&&(xt.bindBuffer(xt.ARRAY_BUFFER,e.__webglVertexBuffer),xt.bufferData(xt.ARRAY_BUFFER,e.positionArray,xt.DYNAMIC_DRAW),xt.enableVertexAttribArray(t.attributes.position),xt.vertexAttribPointer(t.attributes.position,3,xt.FLOAT,!1,0,0));if(e.hasNormals){xt.bindBuffer(xt.ARRAY_BUFFER,e.__webglNormalBuffer);if(n.shading===THREE.FlatShading){var r,i,s,o,u,a,f,l,c,h,p,d=3*e.count;for(p=0;p<d;p+=9)h=e.normalArray,r=h[p],i=h[p+1],s=h[p+2],o=h[p+3],a=h[p+4],l=h[p+5],u=h[p+6],f=h[p+7],c=h[p+8],r=(r+o+u)/3,i=(i+a+f)/3,s=(s+l+c)/3,h[p]=r,h[p+1]=i,h[p+2]=s,h[p+3]=r,h[p+4]=i,h[p+5]=s,h[p+6]=r,h[p+7]=i,h[p+8]=s}xt.bufferData(xt.ARRAY_BUFFER,e.normalArray,xt.DYNAMIC_DRAW),xt.enableVertexAttribArray(t.attributes.normal),xt.vertexAttribPointer(t.attributes.normal,3,xt.FLOAT,!1,0,0)}e.hasUvs&&n.map&&(xt.bindBuffer(xt.ARRAY_BUFFER,e.__webglUvBuffer),xt.bufferData(xt.ARRAY_BUFFER,e.uvArray,xt.DYNAMIC_DRAW),xt.enableVertexAttribArray(t.attributes.uv),xt.vertexAttribPointer(t.attributes.uv,2,xt.FLOAT,!1,0,0)),e.hasColors&&n.vertexColors!==THREE.NoColors&&(xt.bindBuffer(xt.ARRAY_BUFFER,e.__webglColorBuffer),xt.bufferData(xt.ARRAY_BUFFER,e.colorArray,xt.DYNAMIC_DRAW),xt.enableVertexAttribArray(t.attributes.color),xt.vertexAttribPointer(t.attributes.color,3,xt.FLOAT,!1,0,0)),xt.drawArrays(xt.TRIANGLES,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,n,r,i,s){if(!1!==r.visible){var o,f,l;o=b(e,t,n,r,s),e=o.attributes,t=i.attributes,n=!1,o=16777215*i.id+2*o.id+(r.wireframe?1:0),o!==$&&($=o,n=!0),n&&a();if(s instanceof THREE.Mesh)if(r=t.index){i=i.offsets,1<i.length&&(n=!0);for(var c=0,h=i.length;c<h;c++){var p=i[c].index;if(n){for(f in t)"index"!==f&&(o=e[f],s=t[f],l=s.itemSize,0<=o&&(xt.bindBuffer(xt.ARRAY_BUFFER,s.buffer),u(o),xt.vertexAttribPointer(o,l,xt.FLOAT,!1,0,4*p*l)));xt.bindBuffer(xt.ELEMENT_ARRAY_BUFFER,r.buffer)}xt.drawElements(xt.TRIANGLES,i[c].count,xt.UNSIGNED_SHORT,2*i[c].start),R.info.render.calls++,R.info.render.vertices+=i[c].count,R.info.render.faces+=i[c].count/3}}else{if(n)for(f in t)"index"!==f&&(o=e[f],s=t[f],l=s.itemSize,0<=o&&(xt.bindBuffer(xt.ARRAY_BUFFER,s.buffer),u(o),xt.vertexAttribPointer(o,l,xt.FLOAT,!1,0,0)));f=i.attributes.position,xt.drawArrays(xt.TRIANGLES,0,f.numItems/3),R.info.render.calls++,R.info.render.vertices+=f.numItems/3,R.info.render.faces+=f.numItems/3/3}else if(s instanceof THREE.ParticleSystem){if(n){for(f in t)o=e[f],s=t[f],l=s.itemSize,0<=o&&(xt.bindBuffer(xt.ARRAY_BUFFER,s.buffer),u(o),xt.vertexAttribPointer(o,l,xt.FLOAT,!1,0,0));f=t.position,xt.drawArrays(xt.POINTS,0,f.numItems/3),R.info.render.calls++,R.info.render.points+=f.numItems/3}}else if(s instanceof THREE.Line&&n){for(f in t)o=e[f],s=t[f],l=s.itemSize,0<=o&&(xt.bindBuffer(xt.ARRAY_BUFFER,s.buffer),u(o),xt.vertexAttribPointer(o,l,xt.FLOAT,!1,0,0));T(r.linewidth),f=t.position,xt.drawArrays(xt.LINE_STRIP,0,f.numItems/3),R.info.render.calls++,R.info.render.points+=f.numItems}}},this.renderBuffer=function(e,t,n,r,i,s){if(!1!==r.visible){var o,f,n=b(e,t,n,r,s),e=n.attributes,t=!1,n=16777215*i.id+2*n.id+(r.wireframe?1:0);n!==$&&($=n,t=!0),t&&a();if(!r.morphTargets&&0<=e.position)t&&(xt.bindBuffer(xt.ARRAY_BUFFER,i.__webglVertexBuffer),u(e.position),xt.vertexAttribPointer(e.position,3,xt.FLOAT,!1,0,0));else if(s.morphTargetBase){n=r.program.attributes,-1!==s.morphTargetBase&&0<=n.position?(xt.bindBuffer(xt.ARRAY_BUFFER,i.__webglMorphTargetsBuffers[s.morphTargetBase]),u(n.position),xt.vertexAttribPointer(n.position,3,xt.FLOAT,!1,0,0)):0<=n.position&&(xt.bindBuffer(xt.ARRAY_BUFFER,i.__webglVertexBuffer),u(n.position),xt.vertexAttribPointer(n.position,3,xt.FLOAT,!1,0,0));if(s.morphTargetForcedOrder.length){var c=0;f=s.morphTargetForcedOrder;for(o=s.morphTargetInfluences;c<r.numSupportedMorphTargets&&c<f.length;)0<=n["morphTarget"+c]&&(xt.bindBuffer(xt.ARRAY_BUFFER,i.__webglMorphTargetsBuffers[f[c]]),u(n["morphTarget"+c]),xt.vertexAttribPointer(n["morphTarget"+c],3,xt.FLOAT,!1,0,0)),0<=n["morphNormal"+c]&&r.morphNormals&&(xt.bindBuffer(xt.ARRAY_BUFFER,i.__webglMorphNormalsBuffers[f[c]]),u(n["morphNormal"+c]),xt.vertexAttribPointer(n["morphNormal"+c],3,xt.FLOAT,!1,0,0)),s.__webglMorphTargetInfluences[c]=o[f[c]],c++}else{f=[],o=s.morphTargetInfluences;var h,p=o.length;for(h=0;h<p;h++)c=o[h],0<c&&f.push([c,h]);f.length>r.numSupportedMorphTargets?(f.sort(l),f.length=r.numSupportedMorphTargets):f.length>r.numSupportedMorphNormals?f.sort(l):0===f.length&&f.push([0,0]);for(c=0;c<r.numSupportedMorphTargets;)f[c]?(h=f[c][1],0<=n["morphTarget"+c]&&(xt.bindBuffer(xt.ARRAY_BUFFER,i.__webglMorphTargetsBuffers[h]),u(n["morphTarget"+c]),xt.vertexAttribPointer(n["morphTarget"+c],3,xt.FLOAT,!1,0,0)),0<=n["morphNormal"+c]&&r.morphNormals&&(xt.bindBuffer(xt.ARRAY_BUFFER,i.__webglMorphNormalsBuffers[h]),u(n["morphNormal"+c]),xt.vertexAttribPointer(n["morphNormal"+c],3,xt.FLOAT,!1,0,0)),s.__webglMorphTargetInfluences[c]=o[h]):s.__webglMorphTargetInfluences[c]=0,c++}null!==r.program.uniforms.morphTargetInfluences&&xt.uniform1fv(r.program.uniforms.morphTargetInfluences,s.__webglMorphTargetInfluences)}if(t){if(i.__webglCustomAttributesList){o=0;for(f=i.__webglCustomAttributesList.length;o<f;o++)n=i.__webglCustomAttributesList[o],0<=e[n.buffer.belongsToAttribute]&&(xt.bindBuffer(xt.ARRAY_BUFFER,n.buffer),u(e[n.buffer.belongsToAttribute]),xt.vertexAttribPointer(e[n.buffer.belongsToAttribute],n.size,xt.FLOAT,!1,0,0))}0<=e.color&&(xt.bindBuffer(xt.ARRAY_BUFFER,i.__webglColorBuffer),u(e.color),xt.vertexAttribPointer(e.color,3,xt.FLOAT,!1,0,0)),0<=e.normal&&(xt.bindBuffer(xt.ARRAY_BUFFER,i.__webglNormalBuffer),u(e.normal),xt.vertexAttribPointer(e.normal,3,xt.FLOAT,!1,0,0)),0<=e.tangent&&(xt.bindBuffer(xt.ARRAY_BUFFER,i.__webglTangentBuffer),u(e.tangent),xt.vertexAttribPointer(e.tangent,4,xt.FLOAT,!1,0,0)),0<=e.uv&&(xt.bindBuffer(xt.ARRAY_BUFFER,i.__webglUVBuffer),u(e.uv),xt.vertexAttribPointer(e.uv,2,xt.FLOAT,!1,0,0)),0<=e.uv2&&(xt.bindBuffer(xt.ARRAY_BUFFER,i.__webglUV2Buffer),u(e.uv2),xt.vertexAttribPointer(e.uv2,2,xt.FLOAT,!1,0,0)),r.skinning&&0<=e.skinIndex&&0<=e.skinWeight&&(xt.bindBuffer(xt.ARRAY_BUFFER,i.__webglSkinIndicesBuffer),u(e.skinIndex),xt.vertexAttribPointer(e.skinIndex,4,xt.FLOAT,!1,0,0),xt.bindBuffer(xt.ARRAY_BUFFER,i.__webglSkinWeightsBuffer),u(e.skinWeight),xt.vertexAttribPointer(e.skinWeight,4,xt.FLOAT,!1,0,0)),0<=e.lineDistance&&(xt.bindBuffer(xt.ARRAY_BUFFER,i.__webglLineDistanceBuffer),u(e.lineDistance),xt.vertexAttribPointer(e.lineDistance,1,xt.FLOAT,!1,0,0))}s instanceof THREE.Mesh?(r.wireframe?(T(r.wireframeLinewidth),t&&xt.bindBuffer(xt.ELEMENT_ARRAY_BUFFER,i.__webglLineBuffer),xt.drawElements(xt.LINES,i.__webglLineCount,xt.UNSIGNED_SHORT,0)):(t&&xt.bindBuffer(xt.ELEMENT_ARRAY_BUFFER,i.__webglFaceBuffer),xt.drawElements(xt.TRIANGLES,i.__webglFaceCount,xt.UNSIGNED_SHORT,0)),R.info.render.calls++,R.info.render.vertices+=i.__webglFaceCount,R.info.render.faces+=i.__webglFaceCount/3):s instanceof THREE.Line?(s=s.type===THREE.LineStrip?xt.LINE_STRIP:xt.LINES,T(r.linewidth),xt.drawArrays(s,0,i.__webglLineCount),R.info.render.calls++):s instanceof THREE.ParticleSystem?(xt.drawArrays(xt.POINTS,0,i.__webglParticleCount),R.info.render.calls++,R.info.render.points+=i.__webglParticleCount):s instanceof THREE.Ribbon&&(xt.drawArrays(xt.TRIANGLE_STRIP,0,i.__webglVertexCount),R.info.render.calls++)}},this.render=function(e,t,n,r){if(0==t instanceof THREE.Camera)console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");else{var i,s,o,u,a=e.__lights,l=e.fog;V=-1,Et=!0,this.autoUpdateScene&&e.updateMatrixWorld(),void 0===t.parent&&t.updateMatrixWorld(),t.matrixWorldInverse.getInverse(t.matrixWorld),gt.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),mt.setFromMatrix(gt),this.autoUpdateObjects&&this.initWebGLObjects(e),c(this.renderPluginsPre,e,t),R.info.render.calls=0,R.info.render.vertices=0,R.info.render.faces=0,R.info.render.points=0,this.setRenderTarget(n),(this.autoClear||r)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),u=e.__webglObjects,r=0;for(i=u.length;r<i;r++)if(s=u[r],o=s.object,s.render=!1,o.visible&&(!(o instanceof THREE.Mesh||o instanceof THREE.ParticleSystem)||!o.frustumCulled||mt.intersectsObject(o))){E(o,t);var d=s,v=d.buffer,m=void 0,g=m=void 0,g=d.object.material;if(g instanceof THREE.MeshFaceMaterial)m=v.materialIndex,m=g.materials[m],m.transparent?(d.transparent=m,d.opaque=null):(d.opaque=m,d.transparent=null);else if(m=g)m.transparent?(d.transparent=m,d.opaque=null):(d.opaque=m,d.transparent=null);s.render=!0,!0===this.sortObjects&&(null!==o.renderDepth?s.z=o.renderDepth:(bt.getPositionFromMatrix(o.matrixWorld),bt.applyProjection(gt),s.z=bt.z),s.id=o.id)}this.sortObjects&&u.sort(f),u=e.__webglObjectsImmediate,r=0;for(i=u.length;r<i;r++)s=u[r],o=s.object,o.visible&&(E(o,t),o=s.object.material,o.transparent?(s.transparent=o,s.opaque=null):(s.opaque=o,s.transparent=null));e.overrideMaterial?(r=e.overrideMaterial,this.setBlending(r.blending,r.blendEquation,r.blendSrc,r.blendDst),this.setDepthTest(r.depthTest),this.setDepthWrite(r.depthWrite),N(r.polygonOffset,r.polygonOffsetFactor,r.polygonOffsetUnits),h(e.__webglObjects,!1,"",t,a,l,!0,r),p(e.__webglObjectsImmediate,"",t,a,l,!1,r)):(r=null,this.setBlending(THREE.NoBlending),h(e.__webglObjects,!0,"opaque",t,a,l,!1,r),p(e.__webglObjectsImmediate,"opaque",t,a,l,!1,r),h(e.__webglObjects,!1,"transparent",t,a,l,!0,r),p(e.__webglObjectsImmediate,"transparent",t,a,l,!0,r)),c(this.renderPluginsPost,e,t),n&&n.generateMipmaps&&n.minFilter!==THREE.NearestFilter&&n.minFilter!==THREE.LinearFilter&&(n instanceof THREE.WebGLRenderTargetCube?(xt.bindTexture(xt.TEXTURE_CUBE_MAP,n.__webglTexture),xt.generateMipmap(xt.TEXTURE_CUBE_MAP),xt.bindTexture(xt.TEXTURE_CUBE_MAP,null)):(xt.bindTexture(xt.TEXTURE_2D,n.__webglTexture),xt.generateMipmap(xt.TEXTURE_2D),xt.bindTexture(xt.TEXTURE_2D,null))),this.setDepthTest(!0),this.setDepthWrite(!0)}},this.renderImmediateObject=function(e,t,n,r,i){var s=b(e,t,n,r,i);$=-1,R.setMaterialFaces(r),i.immediateRenderCallback?i.immediateRenderCallback(s,xt,mt):i.render(function(e){R.renderBufferImmediate(e,s,r)})},this.initWebGLObjects=function(e){e.__webglObjects||(e.__webglObjects=[],e.__webglObjectsImmediate=[],e.__webglSprites=[],e.__webglFlares=[]);for(;e.__objectsAdded.length;){var t=e.__objectsAdded[0],u=e,a=void 0,f=void 0,c=void 0,h=void 0;if(!t.__webglInit&&(t.__webglInit=!0,t._modelViewMatrix=new THREE.Matrix4,t._normalMatrix=new THREE.Matrix3,void 0!==t.geometry&&void 0===t.geometry.__webglInit&&(t.geometry.__webglInit=!0,t.geometry.addEventListener("dispose",Pt)),f=t.geometry,void 0!==f))if(f instanceof THREE.BufferGeometry){var p=f,b=void 0,w=void 0,E=void 0;for(b in p.attributes)E="index"===b?xt.ELEMENT_ARRAY_BUFFER:xt.ARRAY_BUFFER,w=p.attributes[b],w.buffer=xt.createBuffer(),xt.bindBuffer(E,w.buffer),xt.bufferData(E,w.array,xt.STATIC_DRAW)}else if(t instanceof THREE.Mesh){c=t.material;if(void 0===f.geometryGroups){var S=f,x=void 0,T=void 0,N=void 0,C=void 0,k=void 0,L=void 0,A={},O=S.morphTargets.length,M=S.morphNormals.length,_=c instanceof THREE.MeshFaceMaterial;S.geometryGroups={},x=0;for(T=S.faces.length;x<T;x++)N=S.faces[x],C=_?N.materialIndex:0,void 0===A[C]&&(A[C]={hash:C,counter:0}),L=A[C].hash+"_"+A[C].counter,void 0===S.geometryGroups[L]&&(S.geometryGroups[L]={faces3:[],faces4:[],materialIndex:C,vertices:0,numMorphTargets:O,numMorphNormals:M}),k=N instanceof THREE.Face3?3:4,65535<S.geometryGroups[L].vertices+k&&(A[C].counter+=1,L=A[C].hash+"_"+A[C].counter,void 0===S.geometryGroups[L]&&(S.geometryGroups[L]={faces3:[],faces4:[],materialIndex:C,vertices:0,numMorphTargets:O,numMorphNormals:M})),N instanceof THREE.Face3?S.geometryGroups[L].faces3.push(x):S.geometryGroups[L].faces4.push(x),S.geometryGroups[L].vertices+=k;S.geometryGroupsList=[];var D=void 0;for(D in S.geometryGroups)S.geometryGroups[D].id=K++,S.geometryGroupsList.push(S.geometryGroups[D])}for(a in f.geometryGroups)if(h=f.geometryGroups[a],!h.__webglVertexBuffer){var P=h;P.__webglVertexBuffer=xt.createBuffer(),P.__webglNormalBuffer=xt.createBuffer(),P.__webglTangentBuffer=xt.createBuffer(),P.__webglColorBuffer=xt.createBuffer(),P.__webglUVBuffer=xt.createBuffer(),P.__webglUV2Buffer=xt.createBuffer(),P.__webglSkinIndicesBuffer=xt.createBuffer(),P.__webglSkinWeightsBuffer=xt.createBuffer(),P.__webglFaceBuffer=xt.createBuffer(),P.__webglLineBuffer=xt.createBuffer();var H=void 0,B=void 0;if(P.numMorphTargets){P.__webglMorphTargetsBuffers=[],H=0;for(B=P.numMorphTargets;H<B;H++)P.__webglMorphTargetsBuffers.push(xt.createBuffer())}if(P.numMorphNormals){P.__webglMorphNormalsBuffers=[],H=0;for(B=P.numMorphNormals;H<B;H++)P.__webglMorphNormalsBuffers.push(xt.createBuffer())}R.info.memory.geometries++,r(h,t),f.verticesNeedUpdate=!0,f.morphTargetsNeedUpdate=!0,f.elementsNeedUpdate=!0,f.uvsNeedUpdate=!0,f.normalsNeedUpdate=!0,f.tangentsNeedUpdate=!0,f.colorsNeedUpdate=!0}}else if(t instanceof THREE.Ribbon){if(!f.__webglVertexBuffer){var j=f;j.__webglVertexBuffer=xt.createBuffer(),j.__webglColorBuffer=xt.createBuffer(),j.__webglNormalBuffer=xt.createBuffer(),R.info.memory.geometries++;var F=f,I=t,q=F.vertices.length;F.__vertexArray=new Float32Array(3*q),F.__colorArray=new Float32Array(3*q),F.__normalArray=new Float32Array(3*q),F.__webglVertexCount=q,n(F,I),f.verticesNeedUpdate=!0,f.colorsNeedUpdate=!0,f.normalsNeedUpdate=!0}}else if(t instanceof THREE.Line){if(!f.__webglVertexBuffer){var U=f;U.__webglVertexBuffer=xt.createBuffer(),U.__webglColorBuffer=xt.createBuffer(),U.__webglLineDistanceBuffer=xt.createBuffer(),R.info.memory.geometries++;var z=f,W=t,X=z.vertices.length;z.__vertexArray=new Float32Array(3*X),z.__colorArray=new Float32Array(3*X),z.__lineDistanceArray=new Float32Array(1*X),z.__webglLineCount=X,n(z,W),f.verticesNeedUpdate=!0,f.colorsNeedUpdate=!0,f.lineDistancesNeedUpdate=!0}}else if(t instanceof THREE.ParticleSystem&&!f.__webglVertexBuffer){var V=f;V.__webglVertexBuffer=xt.createBuffer(),V.__webglColorBuffer=xt.createBuffer(),R.info.memory.geometries++;var $=f,J=t,Q=$.vertices.length;$.__vertexArray=new Float32Array(3*Q),$.__colorArray=new Float32Array(3*Q),$.__sortArray=[],$.__webglParticleCount=Q,n($,J),f.verticesNeedUpdate=!0,f.colorsNeedUpdate=!0}if(!t.__webglActive){if(t instanceof THREE.Mesh){if(f=t.geometry,f instanceof THREE.BufferGeometry)d(u.__webglObjects,f,t);else if(f instanceof THREE.Geometry)for(a in f.geometryGroups)h=f.geometryGroups[a],d(u.__webglObjects,h,t)}else t instanceof THREE.Ribbon||t instanceof THREE.Line||t instanceof THREE.ParticleSystem?(f=t.geometry,d(u.__webglObjects,f,t)):t instanceof THREE.ImmediateRenderObject||t.immediateRenderCallback?u.__webglObjectsImmediate.push({object:t,opaque:null,transparent:null}):t instanceof THREE.Sprite?u.__webglSprites.push(t):t instanceof THREE.LensFlare&&u.__webglFlares.push(t);t.__webglActive=!0}e.__objectsAdded.splice(0,1)}for(;e.__objectsRemoved.length;){var G=e.__objectsRemoved[0],Y=e;G instanceof THREE.Mesh||G instanceof THREE.ParticleSystem||G instanceof THREE.Ribbon||G instanceof THREE.Line?g(Y.__webglObjects,G):G instanceof THREE.Sprite?y(Y.__webglSprites,G):G instanceof THREE.LensFlare?y(Y.__webglFlares,G):(G instanceof THREE.ImmediateRenderObject||G.immediateRenderCallback)&&g(Y.__webglObjectsImmediate,G),G.__webglActive=!1,e.__objectsRemoved.splice(0,1)}for(var Z=0,et=e.__webglObjects.length;Z<et;Z++){var tt=e.__webglObjects[Z].object,nt=tt.geometry,rt=void 0,it=void 0,st=void 0;if(nt instanceof THREE.BufferGeometry){var ot=xt.DYNAMIC_DRAW,ut=!nt.dynamic,at=nt.attributes,ft=void 0,lt=void 0;for(ft in at)lt=at[ft],lt.needsUpdate&&("index"===ft?(xt.bindBuffer(xt.ELEMENT_ARRAY_BUFFER,lt.buffer),xt.bufferData(xt.ELEMENT_ARRAY_BUFFER,lt.array,ot)):(xt.bindBuffer(xt.ARRAY_BUFFER,lt.buffer),xt.bufferData(xt.ARRAY_BUFFER,lt.array,ot)),lt.needsUpdate=!1),ut&&!lt.dynamic&&delete lt.array}else if(tt instanceof THREE.Mesh){for(var ct=0,ht=nt.geometryGroupsList.length;ct<ht;ct++)if(rt=nt.geometryGroupsList[ct],st=i(tt,rt),nt.buffersNeedUpdate&&r(rt,tt),it=st.attributes&&v(st),nt.verticesNeedUpdate||nt.morphTargetsNeedUpdate||nt.elementsNeedUpdate||nt.uvsNeedUpdate||nt.normalsNeedUpdate||nt.colorsNeedUpdate||nt.tangentsNeedUpdate||it){var pt=rt,dt=tt,vt=xt.DYNAMIC_DRAW,mt=!nt.dynamic,wt=st;if(pt.__inittedArrays){var Et=s(wt),St=wt.vertexColors?wt.vertexColors:!1,Tt=o(wt),Nt=Et===THREE.SmoothShading,Ct=void 0,kt=void 0,Lt=void 0,At=void 0,Ot=void 0,Mt=void 0,_t=void 0,Dt=void 0,Ht=void 0,Bt=void 0,jt=void 0,Ft=void 0,It=void 0,qt=void 0,Rt=void 0,Ut=void 0,zt=void 0,Wt=void 0,Xt=void 0,Vt=void 0,$t=void 0,Jt=void 0,Kt=void 0,Qt=void 0,Gt=void 0,Yt=void 0,Zt=void 0,en=void 0,tn=void 0,nn=void 0,rn=void 0,sn=void 0,on=void 0,un=void 0,an=void 0,fn=void 0,ln=void 0,cn=void 0,hn=void 0,pn=void 0,dn=void 0,vn=void 0,mn=void 0,gn=void 0,yn=void 0,bn=void 0,wn=0,En=0,Sn=0,xn=0,Tn=0,Nn=0,Cn=0,kn=0,Ln=0,An=0,On=0,Mn=0,_n=void 0,Dn=pt.__vertexArray,Pn=pt.__uvArray,Hn=pt.__uv2Array,Bn=pt.__normalArray,jn=pt.__tangentArray,Fn=pt.__colorArray,In=pt.__skinIndexArray,qn=pt.__skinWeightArray,Rn=pt.__morphTargetsArrays,Un=pt.__morphNormalsArrays,zn=pt.__webglCustomAttributesList,Wn=void 0,Xn=pt.__faceArray,Vn=pt.__lineArray,$n=dt.geometry,Jn=$n.elementsNeedUpdate,Kn=$n.uvsNeedUpdate,Qn=$n.normalsNeedUpdate,Gn=$n.tangentsNeedUpdate,Yn=$n.colorsNeedUpdate,Zn=$n.morphTargetsNeedUpdate,er=$n.vertices,tr=pt.faces3,nr=pt.faces4,rr=$n.faces,ir=$n.faceVertexUvs[0],sr=$n.faceVertexUvs[1],or=$n.skinIndices,ur=$n.skinWeights,ar=$n.morphTargets,fr=$n.morphNormals;if($n.verticesNeedUpdate){Ct=0;for(kt=tr.length;Ct<kt;Ct++)At=rr[tr[Ct]],Ft=er[At.a],It=er[At.b],qt=er[At.c],Dn[En]=Ft.x,Dn[En+1]=Ft.y,Dn[En+2]=Ft.z,Dn[En+3]=It.x,Dn[En+4]=It.y,Dn[En+5]=It.z,Dn[En+6]=qt.x,Dn[En+7]=qt.y,Dn[En+8]=qt.z,En+=9;Ct=0;for(kt=nr.length;Ct<kt;Ct++)At=rr[nr[Ct]],Ft=er[At.a],It=er[At.b],qt=er[At.c],Rt=er[At.d],Dn[En]=Ft.x,Dn[En+1]=Ft.y,Dn[En+2]=Ft.z,Dn[En+3]=It.x,Dn[En+4]=It.y,Dn[En+5]=It.z,Dn[En+6]=qt.x,Dn[En+7]=qt.y,Dn[En+8]=qt.z,Dn[En+9]=Rt.x,Dn[En+10]=Rt.y,Dn[En+11]=Rt.z,En+=12;xt.bindBuffer(xt.ARRAY_BUFFER,pt.__webglVertexBuffer),xt.bufferData(xt.ARRAY_BUFFER,Dn,vt)}if(Zn){dn=0;for(vn=ar.length;dn<vn;dn++){Ct=On=0;for(kt=tr.length;Ct<kt;Ct++)yn=tr[Ct],At=rr[yn],Ft=ar[dn].vertices[At.a],It=ar[dn].vertices[At.b],qt=ar[dn].vertices[At.c],mn=Rn[dn],mn[On]=Ft.x,mn[On+1]=Ft.y,mn[On+2]=Ft.z,mn[On+3]=It.x,mn[On+4]=It.y,mn[On+5]=It.z,mn[On+6]=qt.x,mn[On+7]=qt.y,mn[On+8]=qt.z,wt.morphNormals&&(Nt?(bn=fr[dn].vertexNormals[yn],Vt=bn.a,$t=bn.b,Jt=bn.c):Jt=$t=Vt=fr[dn].faceNormals[yn],gn=Un[dn],gn[On]=Vt.x,gn[On+1]=Vt.y,gn[On+2]=Vt.z,gn[On+3]=$t.x,gn[On+4]=$t.y,gn[On+5]=$t.z,gn[On+6]=Jt.x,gn[On+7]=Jt.y,gn[On+8]=Jt.z),On+=9;Ct=0;for(kt=nr.length;Ct<kt;Ct++)yn=nr[Ct],At=rr[yn],Ft=ar[dn].vertices[At.a],It=ar[dn].vertices[At.b],qt=ar[dn].vertices[At.c],Rt=ar[dn].vertices[At.d],mn=Rn[dn],mn[On]=Ft.x,mn[On+1]=Ft.y,mn[On+2]=Ft.z,mn[On+3]=It.x,mn[On+4]=It.y,mn[On+5]=It.z,mn[On+6]=qt.x,mn[On+7]=qt.y,mn[On+8]=qt.z,mn[On+9]=Rt.x,mn[On+10]=Rt.y,mn[On+11]=Rt.z,wt.morphNormals&&(Nt?(bn=fr[dn].vertexNormals[yn],Vt=bn.a,$t=bn.b,Jt=bn.c,Kt=bn.d):Kt=Jt=$t=Vt=fr[dn].faceNormals[yn],gn=Un[dn],gn[On]=Vt.x,gn[On+1]=Vt.y,gn[On+2]=Vt.z,gn[On+3]=$t.x,gn[On+4]=$t.y,gn[On+5]=$t.z,gn[On+6]=Jt.x,gn[On+7]=Jt.y,gn[On+8]=Jt.z,gn[On+9]=Kt.x,gn[On+10]=Kt.y,gn[On+11]=Kt.z),On+=12;xt.bindBuffer(xt.ARRAY_BUFFER,pt.__webglMorphTargetsBuffers[dn]),xt.bufferData(xt.ARRAY_BUFFER,Rn[dn],vt),wt.morphNormals&&(xt.bindBuffer(xt.ARRAY_BUFFER,pt.__webglMorphNormalsBuffers[dn]),xt.bufferData(xt.ARRAY_BUFFER,Un[dn],vt))}}if(ur.length){Ct=0;for(kt=tr.length;Ct<kt;Ct++)At=rr[tr[Ct]],en=ur[At.a],tn=ur[At.b],nn=ur[At.c],qn[An]=en.x,qn[An+1]=en.y,qn[An+2]=en.z,qn[An+3]=en.w,qn[An+4]=tn.x,qn[An+5]=tn.y,qn[An+6]=tn.z,qn[An+7]=tn.w,qn[An+8]=nn.x,qn[An+9]=nn.y,qn[An+10]=nn.z,qn[An+11]=nn.w,sn=or[At.a],on=or[At.b],un=or[At.c],In[An]=sn.x,In[An+1]=sn.y,In[An+2]=sn.z,In[An+3]=sn.w,In[An+4]=on.x,In[An+5]=on.y,In[An+6]=on.z,In[An+7]=on.w,In[An+8]=un.x,In[An+9]=un.y,In[An+10]=un.z,In[An+11]=un.w,An+=12;Ct=0;for(kt=nr.length;Ct<kt;Ct++)At=rr[nr[Ct]],en=ur[At.a],tn=ur[At.b],nn=ur[At.c],rn=ur[At.d],qn[An]=en.x,qn[An+1]=en.y,qn[An+2]=en.z,qn[An+3]=en.w,qn[An+4]=tn.x,qn[An+5]=tn.y,qn[An+6]=tn.z,qn[An+7]=tn.w,qn[An+8]=nn.x,qn[An+9]=nn.y,qn[An+10]=nn.z,qn[An+11]=nn.w,qn[An+12]=rn.x,qn[An+13]=rn.y,qn[An+14]=rn.z,qn[An+15]=rn.w,sn=or[At.a],on=or[At.b],un=or[At.c],an=or[At.d],In[An]=sn.x,In[An+1]=sn.y,In[An+2]=sn.z,In[An+3]=sn.w,In[An+4]=on.x,In[An+5]=on.y,In[An+6]=on.z,In[An+7]=on.w,In[An+8]=un.x,In[An+9]=un.y,In[An+10]=un.z,In[An+11]=un.w,In[An+12]=an.x,In[An+13]=an.y,In[An+14]=an.z,In[An+15]=an.w,An+=16;0<An&&(xt.bindBuffer(xt.ARRAY_BUFFER,pt.__webglSkinIndicesBuffer),xt.bufferData(xt.ARRAY_BUFFER,In,vt),xt.bindBuffer(xt.ARRAY_BUFFER,pt.__webglSkinWeightsBuffer),xt.bufferData(xt.ARRAY_BUFFER,qn,vt))}if(Yn&&St){Ct=0;for(kt=tr.length;Ct<kt;Ct++)At=rr[tr[Ct]],_t=At.vertexColors,Dt=At.color,3===_t.length&&St===THREE.VertexColors?(Qt=_t[0],Gt=_t[1],Yt=_t[2]):Yt=Gt=Qt=Dt,Fn[Ln]=Qt.r,Fn[Ln+1]=Qt.g,Fn[Ln+2]=Qt.b,Fn[Ln+3]=Gt.r,Fn[Ln+4]=Gt.g,Fn[Ln+5]=Gt.b,Fn[Ln+6]=Yt.r,Fn[Ln+7]=Yt.g,Fn[Ln+8]=Yt.b,Ln+=9;Ct=0;for(kt=nr.length;Ct<kt;Ct++)At=rr[nr[Ct]],_t=At.vertexColors,Dt=At.color,4===_t.length&&St===THREE.VertexColors?(Qt=_t[0],Gt=_t[1],Yt=_t[2],Zt=_t[3]):Zt=Yt=Gt=Qt=Dt,Fn[Ln]=Qt.r,Fn[Ln+1]=Qt.g,Fn[Ln+2]=Qt.b,Fn[Ln+3]=Gt.r,Fn[Ln+4]=Gt.g,Fn[Ln+5]=Gt.b,Fn[Ln+6]=Yt.r,Fn[Ln+7]=Yt.g,Fn[Ln+8]=Yt.b,Fn[Ln+9]=Zt.r,Fn[Ln+10]=Zt.g,Fn[Ln+11]=Zt.b,Ln+=12;0<Ln&&(xt.bindBuffer(xt.ARRAY_BUFFER,pt.__webglColorBuffer),xt.bufferData(xt.ARRAY_BUFFER,Fn,vt))}if(Gn&&$n.hasTangents){Ct=0;for(kt=tr.length;Ct<kt;Ct++)At=rr[tr[Ct]],Ht=At.vertexTangents,Ut=Ht[0],zt=Ht[1],Wt=Ht[2],jn[Cn]=Ut.x,jn[Cn+1]=Ut.y,jn[Cn+2]=Ut.z,jn[Cn+3]=Ut.w,jn[Cn+4]=zt.x,jn[Cn+5]=zt.y,jn[Cn+6]=zt.z,jn[Cn+7]=zt.w,jn[Cn+8]=Wt.x,jn[Cn+9]=Wt.y,jn[Cn+10]=Wt.z,jn[Cn+11]=Wt.w,Cn+=12;Ct=0;for(kt=nr.length;Ct<kt;Ct++)At=rr[nr[Ct]],Ht=At.vertexTangents,Ut=Ht[0],zt=Ht[1],Wt=Ht[2],Xt=Ht[3],jn[Cn]=Ut.x,jn[Cn+1]=Ut.y,jn[Cn+2]=Ut.z,jn[Cn+3]=Ut.w,jn[Cn+4]=zt.x,jn[Cn+5]=zt.y,jn[Cn+6]=zt.z,jn[Cn+7]=zt.w,jn[Cn+8]=Wt.x,jn[Cn+9]=Wt.y,jn[Cn+10]=Wt.z,jn[Cn+11]=Wt.w,jn[Cn+12]=Xt.x,jn[Cn+13]=Xt.y,jn[Cn+14]=Xt.z,jn[Cn+15]=Xt.w,Cn+=16;xt.bindBuffer(xt.ARRAY_BUFFER,pt.__webglTangentBuffer),xt.bufferData(xt.ARRAY_BUFFER,jn,vt)}if(Qn&&Et){Ct=0;for(kt=tr.length;Ct<kt;Ct++)if(At=rr[tr[Ct]],Ot=At.vertexNormals,Mt=At.normal,3===Ot.length&&Nt)for(fn=0;3>fn;fn++)cn=Ot[fn],Bn[Nn]=cn.x,Bn[Nn+1]=cn.y,Bn[Nn+2]=cn.z,Nn+=3;else for(fn=0;3>fn;fn++)Bn[Nn]=Mt.x,Bn[Nn+1]=Mt.y,Bn[Nn+2]=Mt.z,Nn+=3;Ct=0;for(kt=nr.length;Ct<kt;Ct++)if(At=rr[nr[Ct]],Ot=At.vertexNormals,Mt=At.normal,4===Ot.length&&Nt)for(fn=0;4>fn;fn++)cn=Ot[fn],Bn[Nn]=cn.x,Bn[Nn+1]=cn.y,Bn[Nn+2]=cn.z,Nn+=3;else for(fn=0;4>fn;fn++)Bn[Nn]=Mt.x,Bn[Nn+1]=Mt.y,Bn[Nn+2]=Mt.z,Nn+=3;xt.bindBuffer(xt.ARRAY_BUFFER,pt.__webglNormalBuffer),xt.bufferData(xt.ARRAY_BUFFER,Bn,vt)}if(Kn&&ir&&Tt){Ct=0;for(kt=tr.length;Ct<kt;Ct++)if(Lt=tr[Ct],Bt=ir[Lt],void 0!==Bt)for(fn=0;3>fn;fn++)hn=Bt[fn],Pn[Sn]=hn.x,Pn[Sn+1]=hn.y,Sn+=2;Ct=0;for(kt=nr.length;Ct<kt;Ct++)if(Lt=nr[Ct],Bt=ir[Lt],void 0!==Bt)for(fn=0;4>fn;fn++)hn=Bt[fn],Pn[Sn]=hn.x,Pn[Sn+1]=hn.y,Sn+=2;0<Sn&&(xt.bindBuffer(xt.ARRAY_BUFFER,pt.__webglUVBuffer),xt.bufferData(xt.ARRAY_BUFFER,Pn,vt))}if(Kn&&sr&&Tt){Ct=0;for(kt=tr.length;Ct<kt;Ct++)if(Lt=tr[Ct],jt=sr[Lt],void 0!==jt)for(fn=0;3>fn;fn++)pn=jt[fn],Hn[xn]=pn.x,Hn[xn+1]=pn.y,xn+=2;Ct=0;for(kt=nr.length;Ct<kt;Ct++)if(Lt=nr[Ct],jt=sr[Lt],void 0!==jt)for(fn=0;4>fn;fn++)pn=jt[fn],Hn[xn]=pn.x,Hn[xn+1]=pn.y,xn+=2;0<xn&&(xt.bindBuffer(xt.ARRAY_BUFFER,pt.__webglUV2Buffer),xt.bufferData(xt.ARRAY_BUFFER,Hn,vt))}if(Jn){Ct=0;for(kt=tr.length;Ct<kt;Ct++)Xn[Tn]=wn,Xn[Tn+1]=wn+1,Xn[Tn+2]=wn+2,Tn+=3,Vn[kn]=wn,Vn[kn+1]=wn+1,Vn[kn+2]=wn,Vn[kn+3]=wn+2,Vn[kn+4]=wn+1,Vn[kn+5]=wn+2,kn+=6,wn+=3;Ct=0;for(kt=nr.length;Ct<kt;Ct++)Xn[Tn]=wn,Xn[Tn+1]=wn+1,Xn[Tn+2]=wn+3,Xn[Tn+3]=wn+1,Xn[Tn+4]=wn+2,Xn[Tn+5]=wn+3,Tn+=6,Vn[kn]=wn,Vn[kn+1]=wn+1,Vn[kn+2]=wn,Vn[kn+3]=wn+3,Vn[kn+4]=wn+1,Vn[kn+5]=wn+2,Vn[kn+6]=wn+2,Vn[kn+7]=wn+3,kn+=8,wn+=4;xt.bindBuffer(xt.ELEMENT_ARRAY_BUFFER,pt.__webglFaceBuffer),xt.bufferData(xt.ELEMENT_ARRAY_BUFFER,Xn,vt),xt.bindBuffer(xt.ELEMENT_ARRAY_BUFFER,pt.__webglLineBuffer),xt.bufferData(xt.ELEMENT_ARRAY_BUFFER,Vn,vt)}if(zn){fn=0;for(ln=zn.length;fn<ln;fn++)if(Wn=zn[fn],Wn.__original.needsUpdate){Mn=0;if(1===Wn.size){if(void 0===Wn.boundTo||"vertices"===Wn.boundTo){Ct=0;for(kt=tr.length;Ct<kt;Ct++)At=rr[tr[Ct]],Wn.array[Mn]=Wn.value[At.a],Wn.array[Mn+1]=Wn.value[At.b],Wn.array[Mn+2]=Wn.value[At.c],Mn+=3;Ct=0;for(kt=nr.length;Ct<kt;Ct++)At=rr[nr[Ct]],Wn.array[Mn]=Wn.value[At.a],Wn.array[Mn+1]=Wn.value[At.b],Wn.array[Mn+2]=Wn.value[At.c],Wn.array[Mn+3]=Wn.value[At.d],Mn+=4}else if("faces"===Wn.boundTo){Ct=0;for(kt=tr.length;Ct<kt;Ct++)_n=Wn.value[tr[Ct]],Wn.array[Mn]=_n,Wn.array[Mn+1]=_n,Wn.array[Mn+2]=_n,Mn+=3;Ct=0;for(kt=nr.length;Ct<kt;Ct++)_n=Wn.value[nr[Ct]],Wn.array[Mn]=_n,Wn.array[Mn+1]=_n,Wn.array[Mn+2]=_n,Wn.array[Mn+3]=_n,Mn+=4}}else if(2===Wn.size){if(void 0===Wn.boundTo||"vertices"===Wn.boundTo){Ct=0;for(kt=tr.length;Ct<kt;Ct++)At=rr[tr[Ct]],Ft=Wn.value[At.a],It=Wn.value[At.b],qt=Wn.value[At.c],Wn.array[Mn]=Ft.x,Wn.array[Mn+1]=Ft.y,Wn.array[Mn+2]=It.x,Wn.array[Mn+3]=It.y,Wn.array[Mn+4]=qt.x,Wn.array[Mn+5]=qt.y,Mn+=6;Ct=0;for(kt=nr.length;Ct<kt;Ct++)At=rr[nr[Ct]],Ft=Wn.value[At.a],It=Wn.value[At.b],qt=Wn.value[At.c],Rt=Wn.value[At.d],Wn.array[Mn]=Ft.x,Wn.array[Mn+1]=Ft.y,Wn.array[Mn+2]=It.x,Wn.array[Mn+3]=It.y,Wn.array[Mn+4]=qt.x,Wn.array[Mn+5]=qt.y,Wn.array[Mn+6]=Rt.x,Wn.array[Mn+7]=Rt.y,Mn+=8}else if("faces"===Wn.boundTo){Ct=0;for(kt=tr.length;Ct<kt;Ct++)qt=It=Ft=_n=Wn.value[tr[Ct]],Wn.array[Mn]=Ft.x,Wn.array[Mn+1]=Ft.y,Wn.array[Mn+2]=It.x,Wn.array[Mn+3]=It.y,Wn.array[Mn+4]=qt.x,Wn.array[Mn+5]=qt.y,Mn+=6;Ct=0;for(kt=nr.length;Ct<kt;Ct++)Rt=qt=It=Ft=_n=Wn.value[nr[Ct]],Wn.array[Mn]=Ft.x,Wn.array[Mn+1]=Ft.y,Wn.array[Mn+2]=It.x,Wn.array[Mn+3]=It.y,Wn.array[Mn+4]=qt.x,Wn.array[Mn+5]=qt.y,Wn.array[Mn+6]=Rt.x,Wn.array[Mn+7]=Rt.y,Mn+=8}}else if(3===Wn.size){var lr;lr="c"===Wn.type?["r","g","b"]:["x","y","z"];if(void 0===Wn.boundTo||"vertices"===Wn.boundTo){Ct=0;for(kt=tr.length;Ct<kt;Ct++)At=rr[tr[Ct]],Ft=Wn.value[At.a],It=Wn.value[At.b],qt=Wn.value[At.c],Wn.array[Mn]=Ft[lr[0]],Wn.array[Mn+1]=Ft[lr[1]],Wn.array[Mn+2]=Ft[lr[2]],Wn.array[Mn+3]=It[lr[0]],Wn.array[Mn+4]=It[lr[1]],Wn.array[Mn+5]=It[lr[2]],Wn.array[Mn+6]=qt[lr[0]],Wn.array[Mn+7]=qt[lr[1]],Wn.array[Mn+8]=qt[lr[2]],Mn+=9;Ct=0;for(kt=nr.length;Ct<kt;Ct++)At=rr[nr[Ct]],Ft=Wn.value[At.a],It=Wn.value[At.b],qt=Wn.value[At.c],Rt=Wn.value[At.d],Wn.array[Mn]=Ft[lr[0]],Wn.array[Mn+1]=Ft[lr[1]],Wn.array[Mn+2]=Ft[lr[2]],Wn.array[Mn+3]=It[lr[0]],Wn.array[Mn+4]=It[lr[1]],Wn.array[Mn+5]=It[lr[2]],Wn.array[Mn+6]=qt[lr[0]],Wn.array[Mn+7]=qt[lr[1]],Wn.array[Mn+8]=qt[lr[2]],Wn.array[Mn+9]=Rt[lr[0]],Wn.array[Mn+10]=Rt[lr[1]],Wn.array[Mn+11]=Rt[lr[2]],Mn+=12}else if("faces"===Wn.boundTo){Ct=0;for(kt=tr.length;Ct<kt;Ct++)qt=It=Ft=_n=Wn.value[tr[Ct]],Wn.array[Mn]=Ft[lr[0]],Wn.array[Mn+1]=Ft[lr[1]],Wn.array[Mn+2]=Ft[lr[2]],Wn.array[Mn+3]=It[lr[0]],Wn.array[Mn+4]=It[lr[1]],Wn.array[Mn+5]=It[lr[2]],Wn.array[Mn+6]=qt[lr[0]],Wn.array[Mn+7]=qt[lr[1]],Wn.array[Mn+8]=qt[lr[2]],Mn+=9;Ct=0;for(kt=nr.length;Ct<kt;Ct++)Rt=qt=It=Ft=_n=Wn.value[nr[Ct]],Wn.array[Mn]=Ft[lr[0]],Wn.array[Mn+1]=Ft[lr[1]],Wn.array[Mn+2]=Ft[lr[2]],Wn.array[Mn+3]=It[lr[0]],Wn.array[Mn+4]=It[lr[1]],Wn.array[Mn+5]=It[lr[2]],Wn.array[Mn+6]=qt[lr[0]],Wn.array[Mn+7]=qt[lr[1]],Wn.array[Mn+8]=qt[lr[2]],Wn.array[Mn+9]=Rt[lr[0]],Wn.array[Mn+10]=Rt[lr[1]],Wn.array[Mn+11]=Rt[lr[2]],Mn+=12}else if("faceVertices"===Wn.boundTo){Ct=0;for(kt=tr.length;Ct<kt;Ct++)_n=Wn.value[tr[Ct]],Ft=_n[0],It=_n[1],qt=_n[2],Wn.array[Mn]=Ft[lr[0]],Wn.array[Mn+1]=Ft[lr[1]],Wn.array[Mn+2]=Ft[lr[2]],Wn.array[Mn+3]=It[lr[0]],Wn.array[Mn+4]=It[lr[1]],Wn.array[Mn+5]=It[lr[2]],Wn.array[Mn+6]=qt[lr[0]],Wn.array[Mn+7]=qt[lr[1]],Wn.array[Mn+8]=qt[lr[2]],Mn+=9;Ct=0;for(kt=nr.length;Ct<kt;Ct++)_n=Wn.value[nr[Ct]],Ft=_n[0],It=_n[1],qt=_n[2],Rt=_n[3],Wn.array[Mn]=Ft[lr[0]],Wn.array[Mn+1]=Ft[lr[1]],Wn.array[Mn+2]=Ft[lr[2]],Wn.array[Mn+3]=It[lr[0]],Wn.array[Mn+4]=It[lr[1]],Wn.array[Mn+5]=It[lr[2]],Wn.array[Mn+6]=qt[lr[0]],Wn.array[Mn+7]=qt[lr[1]],Wn.array[Mn+8]=qt[lr[2]],Wn.array[Mn+9]=Rt[lr[0]],Wn.array[Mn+10]=Rt[lr[1]],Wn.array[Mn+11]=Rt[lr[2]],Mn+=12}}else if(4===Wn.size)if(void 0===Wn.boundTo||"vertices"===Wn.boundTo){Ct=0;for(kt=tr.length;Ct<kt;Ct++)At=rr[tr[Ct]],Ft=Wn.value[At.a],It=Wn.value[At.b],qt=Wn.value[At.c],Wn.array[Mn]=Ft.x,Wn.array[Mn+1]=Ft.y,Wn.array[Mn+2]=Ft.z,Wn.array[Mn+3]=Ft.w,Wn.array[Mn+4]=It.x,Wn.array[Mn+5]=It.y,Wn.array[Mn+6]=It.z,Wn.array[Mn+7]=It.w,Wn.array[Mn+8]=qt.x,Wn.array[Mn+9]=qt.y,Wn.array[Mn+10]=qt.z,Wn.array[Mn+11]=qt.w,Mn+=12;Ct=0;for(kt=nr.length;Ct<kt;Ct++)At=rr[nr[Ct]],Ft=Wn.value[At.a],It=Wn.value[At.b],qt=Wn.value[At.c],Rt=Wn.value[At.d],Wn.array[Mn]=Ft.x,Wn.array[Mn+1]=Ft.y,Wn.array[Mn+2]=Ft.z,Wn.array[Mn+3]=Ft.w,Wn.array[Mn+4]=It.x,Wn.array[Mn+5]=It.y,Wn.array[Mn+6]=It.z,Wn.array[Mn+7]=It.w,Wn.array[Mn+8]=qt.x,Wn.array[Mn+9]=qt.y,Wn.array[Mn+10]=qt.z,Wn.array[Mn+11]=qt.w,Wn.array[Mn+12]=Rt.x,Wn.array[Mn+13]=Rt.y,Wn.array[Mn+14]=Rt.z,Wn.array[Mn+15]=Rt.w,Mn+=16}else if("faces"===Wn.boundTo){Ct=0;for(kt=tr.length;Ct<kt;Ct++)qt=It=Ft=_n=Wn.value[tr[Ct]],Wn.array[Mn]=Ft.x,Wn.array[Mn+1]=Ft.y,Wn.array[Mn+2]=Ft.z,Wn.array[Mn+3]=Ft.w,Wn.array[Mn+4]=It.x,Wn.array[Mn+5]=It.y,Wn.array[Mn+6]=It.z,Wn.array[Mn+7]=It.w,Wn.array[Mn+8]=qt.x,Wn.array[Mn+9]=qt.y,Wn.array[Mn+10]=qt.z,Wn.array[Mn+11]=qt.w,Mn+=12;Ct=0;for(kt=nr.length;Ct<kt;Ct++)Rt=qt=It=Ft=_n=Wn.value[nr[Ct]],Wn.array[Mn]=Ft.x,Wn.array[Mn+1]=Ft.y,Wn.array[Mn+2]=Ft.z,Wn.array[Mn+3]=Ft.w,Wn.array[Mn+4]=It.x,Wn.array[Mn+5]=It.y,Wn.array[Mn+6]=It.z,Wn.array[Mn+7]=It.w,Wn.array[Mn+8]=qt.x,Wn.array[Mn+9]=qt.y,Wn.array[Mn+10]=qt.z,Wn.array[Mn+11]=qt.w,Wn.array[Mn+12]=Rt.x,Wn.array[Mn+13]=Rt.y,Wn.array[Mn+14]=Rt.z,Wn.array[Mn+15]=Rt.w,Mn+=16}else if("faceVertices"===Wn.boundTo){Ct=0;for(kt=tr.length;Ct<kt;Ct++)_n=Wn.value[tr[Ct]],Ft=_n[0],It=_n[1],qt=_n[2],Wn.array[Mn]=Ft.x,Wn.array[Mn+1]=Ft.y,Wn.array[Mn+2]=Ft.z,Wn.array[Mn+3]=Ft.w,Wn.array[Mn+4]=It.x,Wn.array[Mn+5]=It.y,Wn.array[Mn+6]=It.z,Wn.array[Mn+7]=It.w,Wn.array[Mn+8]=qt.x,Wn.array[Mn+9]=qt.y,Wn.array[Mn+10]=qt.z,Wn.array[Mn+11]=qt.w,Mn+=12;Ct=0;for(kt=nr.length;Ct<kt;Ct++)_n=Wn.value[nr[Ct]],Ft=_n[0],It=_n[1],qt=_n[2],Rt=_n[3],Wn.array[Mn]=Ft.x,Wn.array[Mn+1]=Ft.y,Wn.array[Mn+2]=Ft.z,Wn.array[Mn+3]=Ft.w,Wn.array[Mn+4]=It.x,Wn.array[Mn+5]=It.y,Wn.array[Mn+6]=It.z,Wn.array[Mn+7]=It.w,Wn.array[Mn+8]=qt.x,Wn.array[Mn+9]=qt.y,Wn.array[Mn+10]=qt.z,Wn.array[Mn+11]=qt.w,Wn.array[Mn+12]=Rt.x,Wn.array[Mn+13]=Rt.y,Wn.array[Mn+14]=Rt.z,Wn.array[Mn+15]=Rt.w,Mn+=16}xt.bindBuffer(xt.ARRAY_BUFFER,Wn.buffer),xt.bufferData(xt.ARRAY_BUFFER,Wn.array,vt)}}mt&&(delete pt.__inittedArrays,delete pt.__colorArray,delete pt.__normalArray,delete pt.__tangentArray,delete pt.__uvArray,delete pt.__uv2Array,delete pt.__faceArray,delete pt.__vertexArray,delete pt.__lineArray,delete pt.__skinIndexArray,delete pt.__skinWeightArray)}}nt.verticesNeedUpdate=!1,nt.morphTargetsNeedUpdate=!1,nt.elementsNeedUpdate=!1,nt.uvsNeedUpdate=!1,nt.normalsNeedUpdate=!1,nt.colorsNeedUpdate=!1,nt.tangentsNeedUpdate=!1,nt.buffersNeedUpdate=!1,st.attributes&&m(st)}else if(tt instanceof THREE.Ribbon){st=i(tt,nt),it=st.attributes&&v(st);if(nt.verticesNeedUpdate||nt.colorsNeedUpdate||nt.normalsNeedUpdate||it){var cr=nt,hr=xt.DYNAMIC_DRAW,pr=void 0,dr=void 0,vr=void 0,mr=void 0,gr=void 0,yr=void 0,br=void 0,wr=void 0,Er=void 0,Sr=void 0,xr=void 0,Tr=void 0,Nr=void 0,Cr=cr.vertices,kr=cr.colors,Lr=cr.normals,Ar=Cr.length,Or=kr.length,Mr=Lr.length,_r=cr.__vertexArray,Dr=cr.__colorArray,Pr=cr.__normalArray,Hr=cr.colorsNeedUpdate,Br=cr.normalsNeedUpdate,jr=cr.__webglCustomAttributesList;if(cr.verticesNeedUpdate){for(pr=0;pr<Ar;pr++)mr=Cr[pr],gr=3*pr,_r[gr]=mr.x,_r[gr+1]=mr.y,_r[gr+2]=mr.z;xt.bindBuffer(xt.ARRAY_BUFFER,cr.__webglVertexBuffer),xt.bufferData(xt.ARRAY_BUFFER,_r,hr)}if(Hr){for(dr=0;dr<Or;dr++)yr=kr[dr],gr=3*dr,Dr[gr]=yr.r,Dr[gr+1]=yr.g,Dr[gr+2]=yr.b;xt.bindBuffer(xt.ARRAY_BUFFER,cr.__webglColorBuffer),xt.bufferData(xt.ARRAY_BUFFER,Dr,hr)}if(Br){for(vr=0;vr<Mr;vr++)br=Lr[vr],gr=3*vr,Pr[gr]=br.x,Pr[gr+1]=br.y,Pr[gr+2]=br.z;xt.bindBuffer(xt.ARRAY_BUFFER,cr.__webglNormalBuffer),xt.bufferData(xt.ARRAY_BUFFER,Pr,hr)}if(jr){wr=0;for(Er=jr.length;wr<Er;wr++)if(Tr=jr[wr],Tr.needsUpdate&&(void 0===Tr.boundTo||"vertices"===Tr.boundTo)){gr=0,xr=Tr.value.length;if(1===Tr.size)for(Sr=0;Sr<xr;Sr++)Tr.array[Sr]=Tr.value[Sr];else if(2===Tr.size)for(Sr=0;Sr<xr;Sr++)Nr=Tr.value[Sr],Tr.array[gr]=Nr.x,Tr.array[gr+1]=Nr.y,gr+=2;else if(3===Tr.size)if("c"===Tr.type)for(Sr=0;Sr<xr;Sr++)Nr=Tr.value[Sr],Tr.array[gr]=Nr.r,Tr.array[gr+1]=Nr.g,Tr.array[gr+2]=Nr.b,gr+=3;else for(Sr=0;Sr<xr;Sr++)Nr=Tr.value[Sr],Tr.array[gr]=Nr.x,Tr.array[gr+1]=Nr.y,Tr.array[gr+2]=Nr.z,gr+=3;else if(4===Tr.size)for(Sr=0;Sr<xr;Sr++)Nr=Tr.value[Sr],Tr.array[gr]=Nr.x,Tr.array[gr+1]=Nr.y,Tr.array[gr+2]=Nr.z,Tr.array[gr+3]=Nr.w,gr+=4;xt.bindBuffer(xt.ARRAY_BUFFER,Tr.buffer),xt.bufferData(xt.ARRAY_BUFFER,Tr.array,hr)}}}nt.verticesNeedUpdate=!1,nt.colorsNeedUpdate=!1,nt.normalsNeedUpdate=!1,st.attributes&&m(st)}else if(tt instanceof THREE.Line){st=i(tt,nt),it=st.attributes&&v(st);if(nt.verticesNeedUpdate||nt.colorsNeedUpdate||nt.lineDistancesNeedUpdate||it){var Fr=nt,Ir=xt.DYNAMIC_DRAW,qr=void 0,Rr=void 0,Ur=void 0,zr=void 0,Wr=void 0,Xr=void 0,Vr=Fr.vertices,$r=Fr.colors,Jr=Fr.lineDistances,Kr=Vr.length,Qr=$r.length,Gr=Jr.length,Yr=Fr.__vertexArray,Zr=Fr.__colorArray,ei=Fr.__lineDistanceArray,ti=Fr.colorsNeedUpdate,ni=Fr.lineDistancesNeedUpdate,ri=Fr.__webglCustomAttributesList,ii=void 0,si=void 0,oi=void 0,ui=void 0,ai=void 0,fi=void 0;if(Fr.verticesNeedUpdate){for(qr=0;qr<Kr;qr++)zr=Vr[qr],Wr=3*qr,Yr[Wr]=zr.x,Yr[Wr+1]=zr.y,Yr[Wr+2]=zr.z;xt.bindBuffer(xt.ARRAY_BUFFER,Fr.__webglVertexBuffer),xt.bufferData(xt.ARRAY_BUFFER,Yr,Ir)}if(ti){for(Rr=0;Rr<Qr;Rr++)Xr=$r[Rr],Wr=3*Rr,Zr[Wr]=Xr.r,Zr[Wr+1]=Xr.g,Zr[Wr+2]=Xr.b;xt.bindBuffer(xt.ARRAY_BUFFER,Fr.__webglColorBuffer),xt.bufferData(xt.ARRAY_BUFFER,Zr,Ir)}if(ni){for(Ur=0;Ur<Gr;Ur++)ei[Ur]=Jr[Ur];xt.bindBuffer(xt.ARRAY_BUFFER,Fr.__webglLineDistanceBuffer),xt.bufferData(xt.ARRAY_BUFFER,ei,Ir)}if(ri){ii=0;for(si=ri.length;ii<si;ii++)if(fi=ri[ii],fi.needsUpdate&&(void 0===fi.boundTo||"vertices"===fi.boundTo)){Wr=0,ui=fi.value.length;if(1===fi.size)for(oi=0;oi<ui;oi++)fi.array[oi]=fi.value[oi];else if(2===fi.size)for(oi=0;oi<ui;oi++)ai=fi.value[oi],fi.array[Wr]=ai.x,fi.array[Wr+1]=ai.y,Wr+=2;else if(3===fi.size)if("c"===fi.type)for(oi=0;oi<ui;oi++)ai=fi.value[oi],fi.array[Wr]=ai.r,fi.array[Wr+1]=ai.g,fi.array[Wr+2]=ai.b,Wr+=3;else for(oi=0;oi<ui;oi++)ai=fi.value[oi],fi.array[Wr]=ai.x,fi.array[Wr+1]=ai.y,fi.array[Wr+2]=ai.z,Wr+=3;else if(4===fi.size)for(oi=0;oi<ui;oi++)ai=fi.value[oi],fi.array[Wr]=ai.x,fi.array[Wr+1]=ai.y,fi.array[Wr+2]=ai.z,fi.array[Wr+3]=ai.w,Wr+=4;xt.bindBuffer(xt.ARRAY_BUFFER,fi.buffer),xt.bufferData(xt.ARRAY_BUFFER,fi.array,Ir)}}}nt.verticesNeedUpdate=!1,nt.colorsNeedUpdate=!1,nt.lineDistancesNeedUpdate=!1,st.attributes&&m(st)}else if(tt instanceof THREE.ParticleSystem){st=i(tt,nt),it=st.attributes&&v(st);if(nt.verticesNeedUpdate||nt.colorsNeedUpdate||tt.sortParticles||it){var li=nt,ci=xt.DYNAMIC_DRAW,hi=tt,pi=void 0,di=void 0,vi=void 0,mi=void 0,gi=void 0,yi=void 0,bi=li.vertices,wi=bi.length,Ei=li.colors,Si=Ei.length,xi=li.__vertexArray,Ti=li.__colorArray,Ni=li.__sortArray,Ci=li.verticesNeedUpdate,ki=li.colorsNeedUpdate,Li=li.__webglCustomAttributesList,Ai=void 0,Oi=void 0,Mi=void 0,_i=void 0,Di=void 0,Pi=void 0;if(hi.sortParticles){yt.copy(gt),yt.multiply(hi.matrixWorld);for(pi=0;pi<wi;pi++)vi=bi[pi],bt.copy(vi),bt.applyProjection(yt),Ni[pi]=[bt.z,pi];Ni.sort(l);for(pi=0;pi<wi;pi++)vi=bi[Ni[pi][1]],mi=3*pi,xi[mi]=vi.x,xi[mi+1]=vi.y,xi[mi+2]=vi.z;for(di=0;di<Si;di++)mi=3*di,yi=Ei[Ni[di][1]],Ti[mi]=yi.r,Ti[mi+1]=yi.g,Ti[mi+2]=yi.b;if(Li){Ai=0;for(Oi=Li.length;Ai<Oi;Ai++)if(Pi=Li[Ai],void 0===Pi.boundTo||"vertices"===Pi.boundTo)if(mi=0,_i=Pi.value.length,1===Pi.size)for(Mi=0;Mi<_i;Mi++)gi=Ni[Mi][1],Pi.array[Mi]=Pi.value[gi];else if(2===Pi.size)for(Mi=0;Mi<_i;Mi++)gi=Ni[Mi][1],Di=Pi.value[gi],Pi.array[mi]=Di.x,Pi.array[mi+1]=Di.y,mi+=2;else if(3===Pi.size)if("c"===Pi.type)for(Mi=0;Mi<_i;Mi++)gi=Ni[Mi][1],Di=Pi.value[gi],Pi.array[mi]=Di.r,Pi.array[mi+1]=Di.g,Pi.array[mi+2]=Di.b,mi+=3;else for(Mi=0;Mi<_i;Mi++)gi=Ni[Mi][1],Di=Pi.value[gi],Pi.array[mi]=Di.x,Pi.array[mi+1]=Di.y,Pi.array[mi+2]=Di.z,mi+=3;else if(4===Pi.size)for(Mi=0;Mi<_i;Mi++)gi=Ni[Mi][1],Di=Pi.value[gi],Pi.array[mi]=Di.x,Pi.array[mi+1]=Di.y,Pi.array[mi+2]=Di.z,Pi.array[mi+3]=Di.w,mi+=4}}else{if(Ci)for(pi=0;pi<wi;pi++)vi=bi[pi],mi=3*pi,xi[mi]=vi.x,xi[mi+1]=vi.y,xi[mi+2]=vi.z;if(ki)for(di=0;di<Si;di++)yi=Ei[di],mi=3*di,Ti[mi]=yi.r,Ti[mi+1]=yi.g,Ti[mi+2]=yi.b;if(Li){Ai=0;for(Oi=Li.length;Ai<Oi;Ai++)if(Pi=Li[Ai],Pi.needsUpdate&&(void 0===Pi.boundTo||"vertices"===Pi.boundTo))if(_i=Pi.value.length,mi=0,1===Pi.size)for(Mi=0;Mi<_i;Mi++)Pi.array[Mi]=Pi.value[Mi];else if(2===Pi.size)for(Mi=0;Mi<_i;Mi++)Di=Pi.value[Mi],Pi.array[mi]=Di.x,Pi.array[mi+1]=Di.y,mi+=2;else if(3===Pi.size)if("c"===Pi.type)for(Mi=0;Mi<_i;Mi++)Di=Pi.value[Mi],Pi.array[mi]=Di.r,Pi.array[mi+1]=Di.g,Pi.array[mi+2]=Di.b,mi+=3;else for(Mi=0;Mi<_i;Mi++)Di=Pi.value[Mi],Pi.array[mi]=Di.x,Pi.array[mi+1]=Di.y,Pi.array[mi+2]=Di.z,mi+=3;else if(4===Pi.size)for(Mi=0;Mi<_i;Mi++)Di=Pi.value[Mi],Pi.array[mi]=Di.x,Pi.array[mi+1]=Di.y,Pi.array[mi+2]=Di.z,Pi.array[mi+3]=Di.w,mi+=4}}if(Ci||hi.sortParticles)xt.bindBuffer(xt.ARRAY_BUFFER,li.__webglVertexBuffer),xt.bufferData(xt.ARRAY_BUFFER,xi,ci);if(ki||hi.sortParticles)xt.bindBuffer(xt.ARRAY_BUFFER,li.__webglColorBuffer),xt.bufferData(xt.ARRAY_BUFFER,Ti,ci);if(Li){Ai=0;for(Oi=Li.length;Ai<Oi;Ai++)if(Pi=Li[Ai],Pi.needsUpdate||hi.sortParticles)xt.bindBuffer(xt.ARRAY_BUFFER,Pi.buffer),xt.bufferData(xt.ARRAY_BUFFER,Pi.array,ci)}}nt.verticesNeedUpdate=!1,nt.colorsNeedUpdate=!1,st.attributes&&m(st)}}},this.initMaterial=function(e,t,n,r){var i,s,o,u;e.addEventListener("dispose",jt);var a,f,l,c,h;e instanceof THREE.MeshDepthMaterial?h="depth":e instanceof THREE.MeshNormalMaterial?h="normal":e instanceof THREE.MeshBasicMaterial?h="basic":e instanceof THREE.MeshLambertMaterial?h="lambert":e instanceof THREE.MeshPhongMaterial?h="phong":e instanceof THREE.LineBasicMaterial?h="basic":e instanceof THREE.LineDashedMaterial?h="dashed":e instanceof THREE.ParticleBasicMaterial&&(h="particle_basic");if(h){var p=THREE.ShaderLib[h];e.uniforms=THREE.UniformsUtils.clone(p.uniforms),e.vertexShader=p.vertexShader,e.fragmentShader=p.fragmentShader}var d,v,m;i=o=v=m=p=0;for(s=t.length;i<s;i++)d=t[i],d.onlyShadow||(d instanceof THREE.DirectionalLight&&o++,d instanceof THREE.PointLight&&v++,d instanceof THREE.SpotLight&&m++,d instanceof THREE.HemisphereLight&&p++);i=o,s=v,o=m,u=p,p=d=0;for(m=t.length;p<m;p++)v=t[p],v.castShadow&&(v instanceof THREE.SpotLight&&d++,v instanceof THREE.DirectionalLight&&!v.shadowCascade&&d++);c=d,Dt&&r&&r.useVertexTexture?l=1024:(t=xt.getParameter(xt.MAX_VERTEX_UNIFORM_VECTORS),t=Math.floor((t-20)/4),void 0!==r&&r instanceof THREE.SkinnedMesh&&(t=Math.min(r.bones.length,t),t<r.bones.length&&console.warn("WebGLRenderer: too many bones - "+r.bones.length+", this GPU supports just "+t+" (try OpenGL instead of ANGLE)")),l=t);e:{v=e.fragmentShader,m=e.vertexShader,p=e.uniforms,t=e.attributes,d=e.defines;var n={map:!!e.map,envMap:!!e.envMap,lightMap:!!e.lightMap,bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,specularMap:!!e.specularMap,vertexColors:e.vertexColors,fog:n,useFog:e.fog,fogExp:n instanceof THREE.FogExp2,sizeAttenuation:e.sizeAttenuation,skinning:e.skinning,maxBones:l,useVertexTexture:Dt&&r&&r.useVertexTexture,boneTextureWidth:r&&r.boneTextureWidth,boneTextureHeight:r&&r.boneTextureHeight,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:this.maxMorphTargets,maxMorphNormals:this.maxMorphNormals,maxDirLights:i,maxPointLights:s,maxSpotLights:o,maxHemiLights:u,maxShadows:c,shadowMapEnabled:this.shadowMapEnabled&&r.receiveShadow,shadowMapType:this.shadowMapType,shadowMapDebug:this.shadowMapDebug,shadowMapCascade:this.shadowMapCascade,alphaTest:e.alphaTest,metal:e.metal,perPixel:e.perPixel,wrapAround:e.wrapAround,doubleSided:e.side===THREE.DoubleSide,flipSided:e.side===THREE.BackSide},g,y,b,r=[];h?r.push(h):(r.push(v),r.push(m));for(y in d)r.push(y),r.push(d[y]);for(g in n)r.push(g),r.push(n[g]);h=r.join(),g=0;for(y=U.length;g<y;g++)if(r=U[g],r.code===h){r.usedTimes++,f=r.program;break e}g="SHADOWMAP_TYPE_BASIC",n.shadowMapType===THREE.PCFShadowMap?g="SHADOWMAP_TYPE_PCF":n.shadowMapType===THREE.PCFSoftShadowMap&&(g="SHADOWMAP_TYPE_PCF_SOFT"),y=[];for(b in d)r=d[b],!1!==r&&(r="#define "+b+" "+r,y.push(r));r=y.join("\n"),b=xt.createProgram(),y=["precision "+D+" float;",r,_t?"#define VERTEX_TEXTURES":"",R.gammaInput?"#define GAMMA_INPUT":"",R.gammaOutput?"#define GAMMA_OUTPUT":"",R.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"","#define MAX_DIR_LIGHTS "+n.maxDirLights,"#define MAX_POINT_LIGHTS "+n.maxPointLights,"#define MAX_SPOT_LIGHTS "+n.maxSpotLights,"#define MAX_HEMI_LIGHTS "+n.maxHemiLights,"#define MAX_SHADOWS "+n.maxShadows,"#define MAX_BONES "+n.maxBones,n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.lightMap?"#define USE_LIGHTMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.vertexColors?"#define USE_COLOR":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.boneTextureWidth?"#define N_BONE_PIXEL_X "+n.boneTextureWidth.toFixed(1):"",n.boneTextureHeight?"#define N_BONE_PIXEL_Y "+n.boneTextureHeight.toFixed(1):"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals?"#define USE_MORPHNORMALS":"",n.perPixel?"#define PHONG_PER_PIXEL":"",n.wrapAround?"#define WRAP_AROUND":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+g:"",n.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",n.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\n#ifdef USE_COLOR\nattribute vec3 color;\n#endif\n#ifdef USE_MORPHTARGETS\nattribute vec3 morphTarget0;\nattribute vec3 morphTarget1;\nattribute vec3 morphTarget2;\nattribute vec3 morphTarget3;\n#ifdef USE_MORPHNORMALS\nattribute vec3 morphNormal0;\nattribute vec3 morphNormal1;\nattribute vec3 morphNormal2;\nattribute vec3 morphNormal3;\n#else\nattribute vec3 morphTarget4;\nattribute vec3 morphTarget5;\nattribute vec3 morphTarget6;\nattribute vec3 morphTarget7;\n#endif\n#endif\n#ifdef USE_SKINNING\nattribute vec4 skinIndex;\nattribute vec4 skinWeight;\n#endif\n"].join("\n"),g=["precision "+D+" float;",n.bumpMap||n.normalMap?"#extension GL_OES_standard_derivatives : enable":"",r,"#define MAX_DIR_LIGHTS "+n.maxDirLights,"#define MAX_POINT_LIGHTS "+n.maxPointLights,"#define MAX_SPOT_LIGHTS "+n.maxSpotLights,"#define MAX_HEMI_LIGHTS "+n.maxHemiLights,"#define MAX_SHADOWS "+n.maxShadows,n.alphaTest?"#define ALPHATEST "+n.alphaTest:"",R.gammaInput?"#define GAMMA_INPUT":"",R.gammaOutput?"#define GAMMA_OUTPUT":"",R.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.lightMap?"#define USE_LIGHTMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.vertexColors?"#define USE_COLOR":"",n.metal?"#define METAL":"",n.perPixel?"#define PHONG_PER_PIXEL":"",n.wrapAround?"#define WRAP_AROUND":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+g:"",n.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",n.shadowMapCascade?"#define SHADOWMAP_CASCADE":"","uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n"].join("\n"),g=k("fragment",g+v),y=k("vertex",y+m),xt.attachShader(b,y),xt.attachShader(b,g),xt.linkProgram(b),xt.getProgramParameter(b,xt.LINK_STATUS)||console.error("Could not initialise shader\nVALIDATE_STATUS: "+xt.getProgramParameter(b,xt.VALIDATE_STATUS)+", gl error ["+xt.getError()+"]"),xt.deleteShader(g),xt.deleteShader(y),b.uniforms={},b.attributes={};var w;g="viewMatrix modelViewMatrix projectionMatrix normalMatrix modelMatrix cameraPosition morphTargetInfluences".split(" "),n.useVertexTexture?g.push("boneTexture"):g.push("boneGlobalMatrices");for(w in p)g.push(w);w=g,g=0;for(y=w.length;g<y;g++)p=w[g],b.uniforms[p]=xt.getUniformLocation(b,p);g="position normal uv uv2 tangent color skinIndex skinWeight lineDistance".split(" ");for(w=0;w<n.maxMorphTargets;w++)g.push("morphTarget"+w);for(w=0;w<n.maxMorphNormals;w++)g.push("morphNormal"+w);for(f in t)g.push(f);f=g,w=0;for(t=f.length;w<t;w++)g=f[w],b.attributes[g]=xt.getAttribLocation(b,g);b.id=z++,U.push({program:b,code:h,usedTimes:1}),R.info.memory.programs=U.length,f=b}e.program=f,w=e.program.attributes;if(e.morphTargets){e.numSupportedMorphTargets=0,t="morphTarget";for(f=0;f<this.maxMorphTargets;f++)b=t+f,0<=w[b]&&e.numSupportedMorphTargets++}if(e.morphNormals){e.numSupportedMorphNormals=0,t="morphNormal";for(f=0;f<this.maxMorphNormals;f++)b=t+f,0<=w[b]&&e.numSupportedMorphNormals++}e.uniformsList=[];for(a in e.uniforms)e.uniformsList.push([e.uniforms[a],a])},this.setFaceCulling=function(e,t){e===THREE.CullFaceNone?xt.disable(xt.CULL_FACE):(t===THREE.FrontFaceDirectionCW?xt.frontFace(xt.CW):xt.frontFace(xt.CCW),e===THREE.CullFaceBack?xt.cullFace(xt.BACK):e===THREE.CullFaceFront?xt.cullFace(xt.FRONT):xt.cullFace(xt.FRONT_AND_BACK),xt.enable(xt.CULL_FACE))},this.setMaterialFaces=function(e){var t=e.side===THREE.DoubleSide,e=e.side===THREE.BackSide;G!==t&&(t?xt.disable(xt.CULL_FACE):xt.enable(xt.CULL_FACE),G=t),Y!==e&&(e?xt.frontFace(xt.CW):xt.frontFace(xt.CCW),Y=e)},this.setDepthTest=function(e){rt!==e&&(e?xt.enable(xt.DEPTH_TEST):xt.disable(xt.DEPTH_TEST),rt=e)},this.setDepthWrite=function(e){it!==e&&(xt.depthMask(e),it=e)},this.setBlending=function(e,t,n,r){e!==Z&&(e===THREE.NoBlending?xt.disable(xt.BLEND):e===THREE.AdditiveBlending?(xt.enable(xt.BLEND),xt.blendEquation(xt.FUNC_ADD),xt.blendFunc(xt.SRC_ALPHA,xt.ONE)):e===THREE.SubtractiveBlending?(xt.enable(xt.BLEND),xt.blendEquation(xt.FUNC_ADD),xt.blendFunc(xt.ZERO,xt.ONE_MINUS_SRC_COLOR)):e===THREE.MultiplyBlending?(xt.enable(xt.BLEND),xt.blendEquation(xt.FUNC_ADD),xt.blendFunc(xt.ZERO,xt.SRC_COLOR)):e===THREE.CustomBlending?xt.enable(xt.BLEND):(xt.enable(xt.BLEND),xt.blendEquationSeparate(xt.FUNC_ADD,xt.FUNC_ADD),xt.blendFuncSeparate(xt.SRC_ALPHA,xt.ONE_MINUS_SRC_ALPHA,xt.ONE,xt.ONE_MINUS_SRC_ALPHA)),Z=e);if(e===THREE.CustomBlending){if(t!==et&&(xt.blendEquation(M(t)),et=t),n!==tt||r!==nt)xt.blendFunc(M(n),M(r)),tt=n,nt=r}else nt=tt=et=null},this.setTexture=function(e,t){if(e.needsUpdate){e.__webglInit||(e.__webglInit=!0,e.addEventListener("dispose",Ht),e.__webglTexture=xt.createTexture(),R.info.memory.textures++),xt.activeTexture(xt.TEXTURE0+t),xt.bindTexture(xt.TEXTURE_2D,e.__webglTexture),xt.pixelStorei(xt.UNPACK_FLIP_Y_WEBGL,e.flipY),xt.pixelStorei(xt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),xt.pixelStorei(xt.UNPACK_ALIGNMENT,e.unpackAlignment);var n=e.image,r=0===(n.width&n.width-1)&&0===(n.height&n.height-1),i=M(e.format),s=M(e.type);L(xt.TEXTURE_2D,e,r);var o=e.mipmaps;if(e instanceof THREE.DataTexture)if(0<o.length&&r){for(var u=0,a=o.length;u<a;u++)n=o[u],xt.texImage2D(xt.TEXTURE_2D,u,i,n.width,n.height,0,i,s,n.data);e.generateMipmaps=!1}else xt.texImage2D(xt.TEXTURE_2D,0,i,n.width,n.height,0,i,s,n.data);else if(e instanceof THREE.CompressedTexture){u=0;for(a=o.length;u<a;u++)n=o[u],xt.compressedTexImage2D(xt.TEXTURE_2D,u,i,n.width,n.height,0,n.data)}else if(0<o.length&&r){u=0;for(a=o.length;u<a;u++)n=o[u],xt.texImage2D(xt.TEXTURE_2D,u,i,i,s,n);e.generateMipmaps=!1}else xt.texImage2D(xt.TEXTURE_2D,0,i,i,s,e.image);e.generateMipmaps&&r&&xt.generateMipmap(xt.TEXTURE_2D),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()}else xt.activeTexture(xt.TEXTURE0+t),xt.bindTexture(xt.TEXTURE_2D,e.__webglTexture)},this.setRenderTarget=function(e){var t=e instanceof THREE.WebGLRenderTargetCube;if(e&&!e.__webglFramebuffer){void 0===e.depthBuffer&&(e.depthBuffer=!0),void 0===e.stencilBuffer&&(e.stencilBuffer=!0),e.addEventListener("dispose",Bt),e.__webglTexture=xt.createTexture(),R.info.memory.textures++;var n=0===(e.width&e.width-1)&&0===(e.height&e.height-1),r=M(e.format),i=M(e.type);if(t){e.__webglFramebuffer=[],e.__webglRenderbuffer=[],xt.bindTexture(xt.TEXTURE_CUBE_MAP,e.__webglTexture),L(xt.TEXTURE_CUBE_MAP,e,n);for(var s=0;6>s;s++){e.__webglFramebuffer[s]=xt.createFramebuffer(),e.__webglRenderbuffer[s]=xt.createRenderbuffer(),xt.texImage2D(xt.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,r,e.width,e.height,0,r,i,null);var o=e,u=xt.TEXTURE_CUBE_MAP_POSITIVE_X+s;xt.bindFramebuffer(xt.FRAMEBUFFER,e.__webglFramebuffer[s]),xt.framebufferTexture2D(xt.FRAMEBUFFER,xt.COLOR_ATTACHMENT0,u,o.__webglTexture,0),A(e.__webglRenderbuffer[s],e)}n&&xt.generateMipmap(xt.TEXTURE_CUBE_MAP)}else e.__webglFramebuffer=xt.createFramebuffer(),e.__webglRenderbuffer=e.shareDepthFrom?e.shareDepthFrom.__webglRenderbuffer:xt.createRenderbuffer(),xt.bindTexture(xt.TEXTURE_2D,e.__webglTexture),L(xt.TEXTURE_2D,e,n),xt.texImage2D(xt.TEXTURE_2D,0,r,e.width,e.height,0,r,i,null),r=xt.TEXTURE_2D,xt.bindFramebuffer(xt.FRAMEBUFFER,e.__webglFramebuffer),xt.framebufferTexture2D(xt.FRAMEBUFFER,xt.COLOR_ATTACHMENT0,r,e.__webglTexture,0),e.shareDepthFrom?e.depthBuffer&&!e.stencilBuffer?xt.framebufferRenderbuffer(xt.FRAMEBUFFER,xt.DEPTH_ATTACHMENT,xt.RENDERBUFFER,e.__webglRenderbuffer):e.depthBuffer&&e.stencilBuffer&&xt.framebufferRenderbuffer(xt.FRAMEBUFFER,xt.DEPTH_STENCIL_ATTACHMENT,xt.RENDERBUFFER,e.__webglRenderbuffer):A(e.__webglRenderbuffer,e),n&&xt.generateMipmap(xt.TEXTURE_2D);t?xt.bindTexture(xt.TEXTURE_CUBE_MAP,null):xt.bindTexture(xt.TEXTURE_2D,null),xt.bindRenderbuffer(xt.RENDERBUFFER,null),xt.bindFramebuffer(xt.FRAMEBUFFER,null)}e?(t=t?e.__webglFramebuffer[e.activeCubeFace]:e.__webglFramebuffer,n=e.width,e=e.height,i=r=0):(t=null,n=ct,e=ht,r=ft,i=lt),t!==X&&(xt.bindFramebuffer(xt.FRAMEBUFFER,t),xt.viewport(r,i,n,e),X=t),pt=n,dt=e},this.shadowMapPlugin=new THREE.ShadowMapPlugin,this.addPrePlugin(this.shadowMapPlugin),this.addPostPlugin(new THREE.SpritePlugin),this.addPostPlugin(new THREE.LensFlarePlugin)},THREE.WebGLRenderTarget=function(e,t,n){THREE.EventDispatcher.call(this),this.width=e,this.height=t,n=n||{},this.wrapS=void 0!==n.wrapS?n.wrapS:THREE.ClampToEdgeWrapping,this.wrapT=void 0!==n.wrapT?n.wrapT:THREE.ClampToEdgeWrapping,this.magFilter=void 0!==n.magFilter?n.magFilter:THREE.LinearFilter,this.minFilter=void 0!==n.minFilter?n.minFilter:THREE.LinearMipMapLinearFilter,this.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,this.offset=new THREE.Vector2(0,0),this.repeat=new THREE.Vector2(1,1),this.format=void 0!==n.format?n.format:THREE.RGBAFormat,this.type=void 0!==n.type?n.type:THREE.UnsignedByteType,this.depthBuffer=void 0!==n.depthBuffer?n.depthBuffer:!0,this.stencilBuffer=void 0!==n.stencilBuffer?n.stencilBuffer:!0,this.generateMipmaps=!0,this.shareDepthFrom=null},THREE.WebGLRenderTarget.prototype.clone=function(){var e=new THREE.WebGLRenderTarget(this.width,this.height);return e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.format=this.format,e.type=this.type,e.depthBuffer=this.depthBuffer,e.stencilBuffer=this.stencilBuffer,e.generateMipmaps=this.generateMipmaps,e.shareDepthFrom=this.shareDepthFrom,e},THREE.WebGLRenderTarget.prototype.dispose=function(){this.dispatchEvent({type:"dispose"})},THREE.WebGLRenderTargetCube=function(e,t,n){THREE.WebGLRenderTarget.call(this,e,t,n),this.activeCubeFace=0},THREE.WebGLRenderTargetCube.prototype=Object.create(THREE.WebGLRenderTarget.prototype),THREE.RenderableVertex=function(){this.positionWorld=new THREE.Vector3,this.positionScreen=new THREE.Vector4,this.visible=!0},THREE.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},THREE.RenderableFace3=function(){this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.centroidModel=new THREE.Vector3,this.normalModel=new THREE.Vector3,this.normalModelView=new THREE.Vector3,this.vertexNormalsLength=0,this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.vertexNormalsModelView=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.material=this.color=null,this.uvs=[[]],this.z=null},THREE.RenderableFace4=function(){this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.v4=new THREE.RenderableVertex,this.centroidModel=new THREE.Vector3,this.normalModel=new THREE.Vector3,this.normalModelView=new THREE.Vector3,this.vertexNormalsLength=0,this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.vertexNormalsModelView=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.material=this.color=null,this.uvs=[[]],this.z=null},THREE.RenderableObject=function(){this.z=this.object=null},THREE.RenderableParticle=function(){this.rotation=this.z=this.y=this.x=this.object=null,this.scale=new THREE.Vector2,this.material=null},THREE.RenderableLine=function(){this.z=null,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.material=null},THREE.GeometryUtils={merge:function(e,t){var n,r,i=e.vertices.length,s=t instanceof THREE.Mesh?t.geometry:t,o=e.vertices,u=s.vertices,a=e.faces,f=s.faces,l=e.faceVertexUvs[0],s=s.faceVertexUvs[0];t instanceof THREE.Mesh&&(t.matrixAutoUpdate&&t.updateMatrix(),n=t.matrix,r=new THREE.Matrix3,r.getInverse(n),r.transpose());for(var c=0,h=u.length;c<h;c++){var p=u[c].clone();n&&p.applyMatrix4(n),o.push(p)}c=0;for(h=f.length;c<h;c++){var p=f[c],d,v,m=p.vertexNormals,g=p.vertexColors;p instanceof THREE.Face3?d=new THREE.Face3(p.a+i,p.b+i,p.c+i):p instanceof THREE.Face4&&(d=new THREE.Face4(p.a+i,p.b+i,p.c+i,p.d+i)),d.normal.copy(p.normal),r&&d.normal.applyMatrix3(r).normalize(),o=0;for(u=m.length;o<u;o++)v=m[o].clone(),r&&v.applyMatrix3(r).normalize(),d.vertexNormals.push(v);d.color.copy(p.color),o=0;for(u=g.length;o<u;o++)v=g[o],d.vertexColors.push(v.clone());d.materialIndex=p.materialIndex,d.centroid.copy(p.centroid),n&&d.centroid.applyMatrix4(n),a.push(d)}c=0;for(h=s.length;c<h;c++){n=s[c],r=[],o=0;for(u=n.length;o<u;o++)r.push(new THREE.Vector2(n[o].x,n[o].y));l.push(r)}},removeMaterials:function(e,t){for(var n={},r=0,i=t.length;r<i;r++)n[t[r]]=!0;for(var s,o=[],r=0,i=e.faces.length;r<i;r++)s=e.faces[r],s.materialIndex in n||o.push(s);e.faces=o},randomPointInTriangle:function(e,t,n){var r,i,s,o=new THREE.Vector3,u=THREE.GeometryUtils.__v1;return r=THREE.GeometryUtils.random(),i=THREE.GeometryUtils.random(),1<r+i&&(r=1-r,i=1-i),s=1-r-i,o.copy(e),o.multiplyScalar(r),u.copy(t),u.multiplyScalar(i),o.add(u),u.copy(n),u.multiplyScalar(s),o.add(u),o},randomPointInFace:function(e,t,n){var r,i,s;if(e instanceof THREE.Face3)return r=t.vertices[e.a],i=t.vertices[e.b],s=t.vertices[e.c],THREE.GeometryUtils.randomPointInTriangle(r,i,s);if(e instanceof THREE.Face4){r=t.vertices[e.a],i=t.vertices[e.b],s=t.vertices[e.c];var t=t.vertices[e.d],o;return n?e._area1&&e._area2?(n=e._area1,o=e._area2):(n=THREE.GeometryUtils.triangleArea(r,i,t),o=THREE.GeometryUtils.triangleArea(i,s,t),e._area1=n,e._area2=o):(n=THREE.GeometryUtils.triangleArea(r,i,t),o=THREE.GeometryUtils.triangleArea(i,s,t)),THREE.GeometryUtils.random()*(n+o)<n?THREE.GeometryUtils.randomPointInTriangle(r,i,t):THREE.GeometryUtils.randomPointInTriangle(i,s,t)}},randomPointsInGeometry:function(e,t){function n(e){function t(n,r){if(r<n)return n;var i=n+Math.floor((r-n)/2);return f[i]>e?t(n,i-1):f[i]<e?t(i+1,r):i}return t(0,f.length-1)}var r,i,s=e.faces,o=e.vertices,u=s.length,a=0,f=[],l,c,h,p;for(i=0;i<u;i++)r=s[i],r instanceof THREE.Face3?(l=o[r.a],c=o[r.b],h=o[r.c],r._area=THREE.GeometryUtils.triangleArea(l,c,h)):r instanceof THREE.Face4&&(l=o[r.a],c=o[r.b],h=o[r.c],p=o[r.d],r._area1=THREE.GeometryUtils.triangleArea(l,c,p),r._area2=THREE.GeometryUtils.triangleArea(c,h,p),r._area=r._area1+r._area2),a+=r._area,f[i]=a;r=[];for(i=0;i<t;i++)o=THREE.GeometryUtils.random()*a,o=n(o),r[i]=THREE.GeometryUtils.randomPointInFace(s[o],e,!0);return r},triangleArea:function(e,t,n){var r=THREE.GeometryUtils.__v1,i=THREE.GeometryUtils.__v2;return r.subVectors(t,e),i.subVectors(n,e),r.cross(i),.5*r.length()},center:function(e){e.computeBoundingBox();var t=e.boundingBox,n=new THREE.Vector3;return n.addVectors(t.min,t.max),n.multiplyScalar(-0.5),e.applyMatrix((new THREE.Matrix4).makeTranslation(n.x,n.y,n.z)),e.computeBoundingBox(),n},normalizeUVs:function(e){for(var e=e.faceVertexUvs[0],t=0,n=e.length;t<n;t++)for(var r=e[t],i=0,s=r.length;i<s;i++)1!==r[i].x&&(r[i].x-=Math.floor(r[i].x)),1!==r[i].y&&(r[i].y-=Math.floor(r[i].y))},triangulateQuads:function(e){var t,n,r,i,s=[],o=[],u=[];t=0;for(n=e.faceUvs.length;t<n;t++)o[t]=[];t=0;for(n=e.faceVertexUvs.length;t<n;t++)u[t]=[];t=0;for(n=e.faces.length;t<n;t++)if(r=e.faces[t],r instanceof THREE.Face4){i=r.a;var a=r.b,f=r.c,l=r.d,c=new THREE.Face3,h=new THREE.Face3;c.color.copy(r.color),h.color.copy(r.color),c.materialIndex=r.materialIndex,h.materialIndex=r.materialIndex,c.a=i,c.b=a,c.c=l,h.a=a,h.b=f,h.c=l,4===r.vertexColors.length&&(c.vertexColors[0]=r.vertexColors[0].clone(),c.vertexColors[1]=r.vertexColors[1].clone(),c.vertexColors[2]=r.vertexColors[3].clone(),h.vertexColors[0]=r.vertexColors[1].clone(),h.vertexColors[1]=r.vertexColors[2].clone(),h.vertexColors[2]=r.vertexColors[3].clone()),s.push(c,h),r=0;for(i=e.faceVertexUvs.length;r<i;r++)e.faceVertexUvs[r].length&&(c=e.faceVertexUvs[r][t],a=c[1],f=c[2],l=c[3],c=[c[0].clone(),a.clone(),l.clone()],a=[a.clone(),f.clone(),l.clone()],u[r].push(c,a));r=0;for(i=e.faceUvs.length;r<i;r++)e.faceUvs[r].length&&(a=e.faceUvs[r][t],o[r].push(a,a))}else{s.push(r),r=0;for(i=e.faceUvs.length;r<i;r++)o[r].push(e.faceUvs[r][t]);r=0;for(i=e.faceVertexUvs.length;r<i;r++)u[r].push(e.faceVertexUvs[r][t])}e.faces=s,e.faceUvs=o,e.faceVertexUvs=u,e.computeCentroids(),e.computeFaceNormals(),e.computeVertexNormals(),e.hasTangents&&e.computeTangents()},setMaterialIndex:function(e,t,n,r){e=e.faces,r=r||e.length-1;for(n=n||0;n<=r;n++)e[n].materialIndex=t}},THREE.GeometryUtils.random=THREE.Math.random16,THREE.GeometryUtils.__v1=new THREE.Vector3,THREE.GeometryUtils.__v2=new THREE.Vector3,THREE.ImageUtils={crossOrigin:"anonymous",loadTexture:function(e,t,n,r){var i=new Image,s=new THREE.Texture(i,t),t=new THREE.ImageLoader;return t.addEventListener("load",function(e){s.image=e.content,s.needsUpdate=!0,n&&n(s)}),t.addEventListener("error",function(e){r&&r(e.message)}),t.crossOrigin=this.crossOrigin,t.load(e,i),s.sourceFile=e,s},loadCompressedTexture:function(e,t,n,r){var i=new THREE.CompressedTexture;i.mapping=t;var s=new XMLHttpRequest;return s.onload=function(){var e=THREE.ImageUtils.parseDDS(s.response,!0);i.format=e.format,i.mipmaps=e.mipmaps,i.image.width=e.width,i.image.height=e.height,i.generateMipmaps=!1,i.needsUpdate=!0,n&&n(i)},s.onerror=r,s.open("GET",e,!0),s.responseType="arraybuffer",s.send(null),i},loadTextureCube:function(e,t,n,r){var i=[];i.loadCount=0;var s=new THREE.Texture;s.image=i,void 0!==t&&(s.mapping=t),s.flipY=!1;for(var t=0,o=e.length;t<o;++t){var u=new Image;i[t]=u,u.onload=function(){i.loadCount+=1,6===i.loadCount&&(s.needsUpdate=!0,n&&n(s))},u.onerror=r,u.crossOrigin=this.crossOrigin,u.src=e[t]}return s},loadCompressedTextureCube:function(e,t,n,r){var i=[];i.loadCount=0;var s=new THREE.CompressedTexture;s.image=i,void 0!==t&&(s.mapping=t),s.flipY=!1,s.generateMipmaps=!1,t=function(e,t){return function(){var r=THREE.ImageUtils.parseDDS(e.response,!0);t.format=r.format,t.mipmaps=r.mipmaps,t.width=r.width,t.height=r.height,i.loadCount+=1,6===i.loadCount&&(s.format=r.format,s.needsUpdate=!0,n&&n(s))}};if(e instanceof Array)for(var o=0,u=e.length;o<u;++o){var a={};i[o]=a;var f=new XMLHttpRequest;f.onload=t(f,a),f.onerror=r,a=e[o],f.open("GET",a,!0),f.responseType="arraybuffer",f.send(null)}else f=new XMLHttpRequest,f.onload=function(){var e=THREE.ImageUtils.parseDDS(f.response,!0);if(e.isCubemap){for(var t=e.mipmaps.length/e.mipmapCount,r=0;r<t;r++){i[r]={mipmaps:[]};for(var o=0;o<e.mipmapCount;o++)i[r].mipmaps.push(e.mipmaps[r*e.mipmapCount+o]),i[r].format=e.format,i[r].width=e.width,i[r].height=e.height}s.format=e.format,s.needsUpdate=!0,n&&n(s)}},f.onerror=r,f.open("GET",e,!0),f.responseType="arraybuffer",f.send(null);return s},parseDDS:function(e,t){function n(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}var r={mipmaps:[],width:0,height:0,format:null,mipmapCount:1},i=n("DXT1"),s=n("DXT3"),o=n("DXT5"),u=new Int32Array(e,0,31);if(542327876!==u[0])return console.error("ImageUtils.parseDDS(): Invalid magic number in DDS header"),r;if(!u[20]&4)return console.error("ImageUtils.parseDDS(): Unsupported format, must contain a FourCC code"),r;var a=u[21];switch(a){case i:i=8,r.format=THREE.RGB_S3TC_DXT1_Format;break;case s:i=16,r.format=THREE.RGBA_S3TC_DXT3_Format;break;case o:i=16,r.format=THREE.RGBA_S3TC_DXT5_Format;break;default:return console.error("ImageUtils.parseDDS(): Unsupported FourCC code: ",String.fromCharCode(a&255,a>>8&255,a>>16&255,a>>24&255)),r}r.mipmapCount=1,u[2]&131072&&!1!==t&&(r.mipmapCount=Math.max(1,u[7])),r.isCubemap=u[28]&512?!0:!1,r.width=u[4],r.height=u[3];for(var u=u[1]+4,s=r.width,o=r.height,a=r.isCubemap?6:1,f=0;f<a;f++){for(var l=0;l<r.mipmapCount;l++){var c=Math.max(4,s)/4*Math.max(4,o)/4*i,h={data:new Uint8Array(e,u,c),width:s,height:o};r.mipmaps.push(h),u+=c,s=Math.max(.5*s,1),o=Math.max(.5*o,1)}s=r.width,o=r.height}return r},getNormalMap:function(e,t){var n=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]},t=t|1,r=e.width,i=e.height,s=document.createElement("canvas");s.width=r,s.height=i;var o=s.getContext("2d");o.drawImage(e,0,0);for(var u=o.getImageData(0,0,r,i).data,a=o.createImageData(r,i),f=a.data,l=0;l<r;l++)for(var c=0;c<i;c++){var h=0>c-1?0:c-1,p=c+1>i-1?i-1:c+1,d=0>l-1?0:l-1,v=l+1>r-1?r-1:l+1,m=[],g=[0,0,u[4*(c*r+l)]/255*t];m.push([-1,0,u[4*(c*r+d)]/255*t]),m.push([-1,-1,u[4*(h*r+d)]/255*t]),m.push([0,-1,u[4*(h*r+l)]/255*t]),m.push([1,-1,u[4*(h*r+v)]/255*t]),m.push([1,0,u[4*(c*r+v)]/255*t]),m.push([1,1,u[4*(p*r+v)]/255*t]),m.push([0,1,u[4*(p*r+l)]/255*t]),m.push([-1,1,u[4*(p*r+d)]/255*t]),h=[],d=m.length;for(p=0;p<d;p++){var v=m[p],y=m[(p+1)%d],v=[v[0]-g[0],v[1]-g[1],v[2]-g[2]],y=[y[0]-g[0],y[1]-g[1],y[2]-g[2]];h.push(n([v[1]*y[2]-v[2]*y[1],v[2]*y[0]-v[0]*y[2],v[0]*y[1]-v[1]*y[0]]))}m=[0,0,0];for(p=0;p<h.length;p++)m[0]+=h[p][0],m[1]+=h[p][1],m[2]+=h[p][2];m[0]/=h.length,m[1]/=h.length,m[2]/=h.length,g=4*(c*r+l),f[g]=255*((m[0]+1)/2)|0,f[g+1]=255*((m[1]+1)/2)|0,f[g+2]=255*m[2]|0,f[g+3]=255}return o.putImageData(a,0,0),s},generateDataTexture:function(e,t,n){for(var r=e*t,i=new Uint8Array(3*r),s=Math.floor(255*n.r),o=Math.floor(255*n.g),n=Math.floor(255*n.b),u=0;u<r;u++)i[3*u]=s,i[3*u+1]=o,i[3*u+2]=n;return e=new THREE.DataTexture(i,e,t,THREE.RGBFormat),e.needsUpdate=!0,e}},THREE.SceneUtils={createMultiMaterialObject:function(e,t){for(var n=new THREE.Object3D,r=0,i=t.length;r<i;r++)n.add(new THREE.Mesh(e,t[r]));return n},detach:function(e,t,n){e.applyMatrix(t.matrixWorld),t.remove(e),n.add(e)},attach:function(e,t,n){var r=new THREE.Matrix4;r.getInverse(n.matrixWorld),e.applyMatrix(r),t.remove(e),n.add(e)}},THREE.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(e){var t=e.familyName.toLowerCase();return this.faces[t]=this.faces[t]||{},this.faces[t][e.cssFontWeight]=this.faces[t][e.cssFontWeight]||{},this.faces[t][e.cssFontWeight][e.cssFontStyle]=e,this.faces[t][e.cssFontWeight][e.cssFontStyle]=e},drawText:function(e){for(var t=this.getFace(),n=this.size/t.resolution,r=0,i=String(e).split(""),s=i.length,o=[],e=0;e<s;e++){var u=new THREE.Path,u=this.extractGlyphPoints(i[e],t,n,r,u),r=r+u.offset;o.push(u.path)}return{paths:o,offset:r/2}},extractGlyphPoints:function(e,t,n,r,i){var s=[],o,u,a,f,l,c,h,p,d,v,m,g=t.glyphs[e]||t.glyphs["?"];if(g){if(g.o){t=g._cachedOutline||(g._cachedOutline=g.o.split(" ")),f=t.length;for(e=0;e<f;)switch(a=t[e++],a){case"m":a=t[e++]*n+r,l=t[e++]*n,i.moveTo(a,l);break;case"l":a=t[e++]*n+r,l=t[e++]*n,i.lineTo(a,l);break;case"q":a=t[e++]*n+r,l=t[e++]*n,p=t[e++]*n+r,d=t[e++]*n,i.quadraticCurveTo(p,d,a,l);if(o=s[s.length-1]){c=o.x,h=o.y,o=1;for(u=this.divisions;o<=u;o++){var y=o/u;THREE.Shape.Utils.b2(y,c,p,a),THREE.Shape.Utils.b2(y,h,d,l)}}break;case"b":if(a=t[e++]*n+r,l=t[e++]*n,p=t[e++]*n+r,d=t[e++]*-n,v=t[e++]*n+r,m=t[e++]*-n,i.bezierCurveTo(a,l,p,d,v,m),o=s[s.length-1]){c=o.x,h=o.y,o=1;for(u=this.divisions;o<=u;o++)y=o/u,THREE.Shape.Utils.b3(y,c,p,v,a),THREE.Shape.Utils.b3(y,h,d,m,l)}}}return{offset:g.ha*n,path:i}}}},THREE.FontUtils.generateShapes=function(e,t){var t=t||{},n=void 0!==t.curveSegments?t.curveSegments:4,r=void 0!==t.font?t.font:"helvetiker",i=void 0!==t.weight?t.weight:"normal",s=void 0!==t.style?t.style:"normal";THREE.FontUtils.size=void 0!==t.size?t.size:100,THREE.FontUtils.divisions=n,THREE.FontUtils.face=r,THREE.FontUtils.weight=i,THREE.FontUtils.style=s,n=THREE.FontUtils.drawText(e).paths,r=[],i=0;for(s=n.length;i<s;i++)Array.prototype.push.apply(r,n[i].toShapes());return r},function(e){var t=function(e){for(var t=e.length,n=0,r=t-1,i=0;i<t;r=i++)n+=e[r].x*e[i].y-e[i].x*e[r].y;return.5*n};return e.Triangulate=function(e,n){var r=e.length;if(3>r)return null;var i=[],s=[],o=[],u,a,f;if(0<t(e))for(a=0;a<r;a++)s[a]=a;else for(a=0;a<r;a++)s[a]=r-1-a;var l=2*r;for(a=r-1;2<r;){if(0>=l--){console.log("Warning, unable to triangulate polygon!");break}u=a,r<=u&&(u=0),a=u+1,r<=a&&(a=0),f=a+1,r<=f&&(f=0);var c;e:{var h=c=void 0,p=void 0,d=void 0,v=void 0,m=void 0,g=void 0,y=void 0,w=void 0,h=e[s[u]].x,p=e[s[u]].y,d=e[s[a]].x,v=e[s[a]].y,m=e[s[f]].x,g=e[s[f]].y;if(1e-10>(d-h)*(g-p)-(v-p)*(m-h))c=!1;else{var E=void 0,S=void 0,x=void 0,T=void 0,N=void 0,C=void 0,k=void 0,L=void 0,A=void 0,O=void 0,A=L=k=w=y=void 0,E=m-d,S=g-v,x=h-m,T=p-g,N=d-h,C=v-p;for(c=0;c<r;c++)if(c!==u&&c!==a&&c!==f)if(y=e[s[c]].x,w=e[s[c]].y,k=y-h,L=w-p,A=y-d,O=w-v,y-=m,w-=g,A=E*O-S*A,k=N*L-C*k,L=x*w-T*y,0<=A&&0<=L&&0<=k){c=!1;break e}c=!0}}if(c){i.push([e[s[u]],e[s[a]],e[s[f]]]),o.push([s[u],s[a],s[f]]),u=a;for(f=a+1;f<r;u++,f++)s[u]=s[f];r--,l=2*r}}return n?o:i},e.Triangulate.area=t,e}(THREE.FontUtils),self._typeface_js={faces:THREE.FontUtils.faces,loadFace:THREE.FontUtils.loadFace},THREE.Curve=function(){},THREE.Curve.prototype.getPoint=function(){return console.log("Warning, getPoint() not implemented!"),null},THREE.Curve.prototype.getPointAt=function(e){return e=this.getUtoTmapping(e),this.getPoint(e)},THREE.Curve.prototype.getPoints=function(e){e||(e=5);var t,n=[];for(t=0;t<=e;t++)n.push(this.getPoint(t/e));return n},THREE.Curve.prototype.getSpacedPoints=function(e){e||(e=5);var t,n=[];for(t=0;t<=e;t++)n.push(this.getPointAt(t/e));return n},THREE.Curve.prototype.getLength=function(){var e=this.getLengths();return e[e.length-1]},THREE.Curve.prototype.getLengths=function(e){e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200);if(this.cacheArcLengths&&this.cacheArcLengths.length==e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t=[],n,r=this.getPoint(0),i,s=0;t.push(0);for(i=1;i<=e;i++)n=this.getPoint(i/e),s+=n.distanceTo(r),t.push(s),r=n;return this.cacheArcLengths=t},THREE.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},THREE.Curve.prototype.getUtoTmapping=function(e,t){var n=this.getLengths(),r=0,i=n.length,s;s=t?t:e*n[i-1];for(var o=0,u=i-1,a;o<=u;)if(r=Math.floor(o+(u-o)/2),a=n[r]-s,0>a)o=r+1;else{if(!(0<a)){u=r;break}u=r-1}return r=u,n[r]==s?r/(i-1):(o=n[r],n=(r+(s-o)/(n[r+1]-o))/(i-1))},THREE.Curve.prototype.getTangent=function(e){var t=e-1e-4,e=e+1e-4;return 0>t&&(t=0),1<e&&(e=1),t=this.getPoint(t),this.getPoint(e).clone().sub(t).normalize()},THREE.Curve.prototype.getTangentAt=function(e){return e=this.getUtoTmapping(e),this.getTangent(e)},THREE.LineCurve=function(e,t){this.v1=e,this.v2=t},THREE.LineCurve.prototype=Object.create(THREE.Curve.prototype),THREE.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().sub(this.v1);return t.multiplyScalar(e).add(this.v1),t},THREE.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)},THREE.LineCurve.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},THREE.QuadraticBezierCurve=function(e,t,n){this.v0=e,this.v1=t,this.v2=n},THREE.QuadraticBezierCurve.prototype=Object.create(THREE.Curve.prototype),THREE.QuadraticBezierCurve.prototype.getPoint=function(e){var t;return t=THREE.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),e=THREE.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),new THREE.Vector2(t,e)},THREE.QuadraticBezierCurve.prototype.getTangent=function(e){var t;return t=THREE.Curve.Utils.tangentQuadraticBezier(e,this.v0.x,this.v1.x,this.v2.x),e=THREE.Curve.Utils.tangentQuadraticBezier(e,this.v0.y,this.v1.y,this.v2.y),t=new THREE.Vector2(t,e),t.normalize(),t},THREE.CubicBezierCurve=function(e,t,n,r){this.v0=e,this.v1=t,this.v2=n,this.v3=r},THREE.CubicBezierCurve.prototype=Object.create(THREE.Curve.prototype),THREE.CubicBezierCurve.prototype.getPoint=function(e){var t;return t=THREE.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),e=THREE.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new THREE.Vector2(t,e)},THREE.CubicBezierCurve.prototype.getTangent=function(e){var t;return t=THREE.Curve.Utils.tangentCubicBezier(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),e=THREE.Curve.Utils.tangentCubicBezier(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),t=new THREE.Vector2(t,e),t.normalize(),t},THREE.SplineCurve=function(e){this.points=void 0==e?[]:e},THREE.SplineCurve.prototype=Object.create(THREE.Curve.prototype),THREE.SplineCurve.prototype.getPoint=function(e){var t=new THREE.Vector2,n=[],r=this.points,i;return i=(r.length-1)*e,e=Math.floor(i),i-=e,n[0]=0==e?e:e-1,n[1]=e,n[2]=e>r.length-2?r.length-1:e+1,n[3]=e>r.length-3?r.length-1:e+2,t.x=THREE.Curve.Utils.interpolate(r[n[0]].x,r[n[1]].x,r[n[2]].x,r[n[3]].x,i),t.y=THREE.Curve.Utils.interpolate(r[n[0]].y,r[n[1]].y,r[n[2]].y,r[n[3]].y,i),t},THREE.EllipseCurve=function(e,t,n,r,i,s,o){this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=r,this.aStartAngle=i,this.aEndAngle=s,this.aClockwise=o},THREE.EllipseCurve.prototype=Object.create(THREE.Curve.prototype),THREE.EllipseCurve.prototype.getPoint=function(e){var t=this.aEndAngle-this.aStartAngle;return this.aClockwise||(e=1-e),t=this.aStartAngle+e*t,e=this.aX+this.xRadius*Math.cos(t),t=this.aY+this.yRadius*Math.sin(t),new THREE.Vector2(e,t)},THREE.ArcCurve=function(e,t,n,r,i,s){THREE.EllipseCurve.call(this,e,t,n,n,r,i,s)},THREE.ArcCurve.prototype=Object.create(THREE.EllipseCurve.prototype),THREE.Curve.Utils={tangentQuadraticBezier:function(e,t,n,r){return 2*(1-e)*(n-t)+2*e*(r-n)},tangentCubicBezier:function(e,t,n,r,i){return-3*t*(1-e)*(1-e)+3*n*(1-e)*(1-e)-6*e*n*(1-e)+6*e*r*(1-e)-3*e*e*r+3*e*e*i},tangentSpline:function(e){return 6*e*e-6*e+(3*e*e-4*e+1)+(-6*e*e+6*e)+(3*e*e-2*e)},interpolate:function(e,t,n,r,i){var e=.5*(n-e),r=.5*(r-t),s=i*i;return(2*t-2*n+e+r)*i*s+(-3*t+3*n-2*e-r)*s+e*i+t}},THREE.Curve.create=function(e,t){return e.prototype=Object.create(THREE.Curve.prototype),e.prototype.getPoint=t,e},THREE.LineCurve3=THREE.Curve.create(function(e,t){this.v1=e,this.v2=t},function(e){var t=new THREE.Vector3;return t.subVectors(this.v2,this.v1),t.multiplyScalar(e),t.add(this.v1),t}),THREE.QuadraticBezierCurve3=THREE.Curve.create(function(e,t,n){this.v0=e,this.v1=t,this.v2=n},function(e){var t,n;return t=THREE.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),n=THREE.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),e=THREE.Shape.Utils.b2(e,this.v0.z,this.v1.z,this.v2.z),new THREE.Vector3(t,n,e)}),THREE.CubicBezierCurve3=THREE.Curve.create(function(e,t,n,r){this.v0=e,this.v1=t,this.v2=n,this.v3=r},function(e){var t,n;return t=THREE.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),n=THREE.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),e=THREE.Shape.Utils.b3(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z),new THREE.Vector3(t,n,e)}),THREE.SplineCurve3=THREE.Curve.create(function(e){this.points=void 0==e?[]:e},function(e){var t=new THREE.Vector3,n=[],r=this.points,i,e=(r.length-1)*e;i=Math.floor(e),e-=i,n[0]=0==i?i:i-1,n[1]=i,n[2]=i>r.length-2?r.length-1:i+1,n[3]=i>r.length-3?r.length-1:i+2,i=r[n[0]];var s=r[n[1]],o=r[n[2]],n=r[n[3]];return t.x=THREE.Curve.Utils.interpolate(i.x,s.x,o.x,n.x,e),t.y=THREE.Curve.Utils.interpolate(i.y,s.y,o.y,n.y,e),t.z=THREE.Curve.Utils.interpolate(i.z,s.z,o.z,n.z,e),t}),THREE.ClosedSplineCurve3=THREE.Curve.create(function(e){this.points=void 0==e?[]:e},function(e){var t=new THREE.Vector3,n=[],r=this.points,i;return i=(r.length-0)*e,e=Math.floor(i),i-=e,e+=0<e?0:(Math.floor(Math.abs(e)/r.length)+1)*r.length,n[0]=(e-1)%r.length,n[1]=e%r.length,n[2]=(e+1)%r.length,n[3]=(e+2)%r.length,t.x=THREE.Curve.Utils.interpolate(r[n[0]].x,r[n[1]].x,r[n[2]].x,r[n[3]].x,i),t.y=THREE.Curve.Utils.interpolate(r[n[0]].y,r[n[1]].y,r[n[2]].y,r[n[3]].y,i),t.z=THREE.Curve.Utils.interpolate(r[n[0]].z,r[n[1]].z,r[n[2]].z,r[n[3]].z,i),t}),THREE.CurvePath=function(){this.curves=[],this.bends=[],this.autoClose=!1},THREE.CurvePath.prototype=Object.create(THREE.Curve.prototype),THREE.CurvePath.prototype.add=function(e){this.curves.push(e)},THREE.CurvePath.prototype.checkConnection=function(){},THREE.CurvePath.prototype.closePath=function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new THREE.LineCurve(t,e))},THREE.CurvePath.prototype.getPoint=function(e){for(var t=e*this.getLength(),n=this.getCurveLengths(),e=0;e<n.length;){if(n[e]>=t)return t=n[e]-t,e=this.curves[e],t=1-t/e.getLength(),e.getPointAt(t);e++}return null},THREE.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]},THREE.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var e=[],t=0,n,r=this.curves.length;for(n=0;n<r;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e},THREE.CurvePath.prototype.getBoundingBox=function(){var e=this.getPoints(),t,n,r,i,s,o;t=n=Number.NEGATIVE_INFINITY,i=s=Number.POSITIVE_INFINITY;var u,a,f,l,c=e[0]instanceof THREE.Vector3;l=c?new THREE.Vector3:new THREE.Vector2,a=0;for(f=e.length;a<f;a++)u=e[a],u.x>t?t=u.x:u.x<i&&(i=u.x),u.y>n?n=u.y:u.y<s&&(s=u.y),c&&(u.z>r?r=u.z:u.z<o&&(o=u.z)),l.add(u);return e={minX:i,minY:s,maxX:t,maxY:n,centroid:l.divideScalar(f)},c&&(e.maxZ=r,e.minZ=o),e},THREE.CurvePath.prototype.createPointsGeometry=function(e){return e=this.getPoints(e,!0),this.createGeometry(e)},THREE.CurvePath.prototype.createSpacedPointsGeometry=function(e){return e=this.getSpacedPoints(e,!0),this.createGeometry(e)},THREE.CurvePath.prototype.createGeometry=function(e){for(var t=new THREE.Geometry,n=0;n<e.length;n++)t.vertices.push(new THREE.Vector3(e[n].x,e[n].y,e[n].z||0));return t},THREE.CurvePath.prototype.addWrapPath=function(e){this.bends.push(e)},THREE.CurvePath.prototype.getTransformedPoints=function(e,t){var n=this.getPoints(e),r,i;t||(t=this.bends),r=0;for(i=t.length;r<i;r++)n=this.getWrapPoints(n,t[r]);return n},THREE.CurvePath.prototype.getTransformedSpacedPoints=function(e,t){var n=this.getSpacedPoints(e),r,i;t||(t=this.bends),r=0;for(i=t.length;r<i;r++)n=this.getWrapPoints(n,t[r]);return n},THREE.CurvePath.prototype.getWrapPoints=function(e,t){var n=this.getBoundingBox(),r,i,s,o,u,a;r=0;for(i=e.length;r<i;r++)s=e[r],o=s.x,u=s.y,a=o/n.maxX,a=t.getUtoTmapping(a,o),o=t.getPoint(a),u=t.getNormalVector(a).multiplyScalar(u),s.x=o.x+u.x,s.y=o.y+u.y;return e},THREE.Gyroscope=function(){THREE.Object3D.call(this)},THREE.Gyroscope.prototype=Object.create(THREE.Object3D.prototype),THREE.Gyroscope.prototype.updateMatrixWorld=function(e){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||e)this.parent?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(this.translationWorld,this.rotationWorld,this.scaleWorld),this.matrix.decompose(this.translationObject,this.rotationObject,this.scaleObject),this.matrixWorld.compose(this.translationWorld,this.rotationObject,this.scaleWorld)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0;for(var t=0,n=this.children.length;t<n;t++)this.children[t].updateMatrixWorld(e)},THREE.Gyroscope.prototype.translationWorld=new THREE.Vector3,THREE.Gyroscope.prototype.translationObject=new THREE.Vector3,THREE.Gyroscope.prototype.rotationWorld=new THREE.Quaternion,THREE.Gyroscope.prototype.rotationObject=new THREE.Quaternion,THREE.Gyroscope.prototype.scaleWorld=new THREE.Vector3,THREE.Gyroscope.prototype.scaleObject=new THREE.Vector3,THREE.Path=function(e){THREE.CurvePath.call(this),this.actions=[],e&&this.fromPoints(e)},THREE.Path.prototype=Object.create(THREE.CurvePath.prototype),THREE.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"},THREE.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y)},THREE.Path.prototype.moveTo=function(e,t){var n=Array.prototype.slice.call(arguments);this.actions.push({action:THREE.PathActions.MOVE_TO,args:n})},THREE.Path.prototype.lineTo=function(e,t){var n=Array.prototype.slice.call(arguments),r=this.actions[this.actions.length-1].args,r=new THREE.LineCurve(new THREE.Vector2(r[r.length-2],r[r.length-1]),new THREE.Vector2(e,t));this.curves.push(r),this.actions.push({action:THREE.PathActions.LINE_TO,args:n})},THREE.Path.prototype.quadraticCurveTo=function(e,t,n,r){var i=Array.prototype.slice.call(arguments),s=this.actions[this.actions.length-1].args,s=new THREE.QuadraticBezierCurve(new THREE.Vector2(s[s.length-2],s[s.length-1]),new THREE.Vector2(e,t),new THREE.Vector2(n,r));this.curves.push(s),this.actions.push({action:THREE.PathActions.QUADRATIC_CURVE_TO,args:i})},THREE.Path.prototype.bezierCurveTo=function(e,t,n,r,i,s){var o=Array.prototype.slice.call(arguments),u=this.actions[this.actions.length-1].args,u=new THREE.CubicBezierCurve(new THREE.Vector2(u[u.length-2],u[u.length-1]),new THREE.Vector2(e,t),new THREE.Vector2(n,r),new THREE.Vector2(i,s));this.curves.push(u),this.actions.push({action:THREE.PathActions.BEZIER_CURVE_TO,args:o})},THREE.Path.prototype.splineThru=function(e){var t=Array.prototype.slice.call(arguments),n=this.actions[this.actions.length-1].args,n=[new THREE.Vector2(n[n.length-2],n[n.length-1])];Array.prototype.push.apply(n,e),n=new THREE.SplineCurve(n),this.curves.push(n),this.actions.push({action:THREE.PathActions.CSPLINE_THRU,args:t})},THREE.Path.prototype.arc=function(e,t,n,r,i,s){var o=this.actions[this.actions.length-1].args;this.absarc(e+o[o.length-2],t+o[o.length-1],n,r,i,s)},THREE.Path.prototype.absarc=function(e,t,n,r,i,s){this.absellipse(e,t,n,n,r,i,s)},THREE.Path.prototype.ellipse=function(e,t,n,r,i,s,o){var u=this.actions[this.actions.length-1].args;this.absellipse(e+u[u.length-2],t+u[u.length-1],n,r,i,s,o)},THREE.Path.prototype.absellipse=function(e,t,n,r,i,s,o){var u=Array.prototype.slice.call(arguments),a=new THREE.EllipseCurve(e,t,n,r,i,s,o);this.curves.push(a),a=a.getPoint(o?1:0),u.push(a.x),u.push(a.y),this.actions.push({action:THREE.PathActions.ELLIPSE,args:u})},THREE.Path.prototype.getSpacedPoints=function(e){e||(e=40);for(var t=[],n=0;n<e;n++)t.push(this.getPoint(n/e));return t},THREE.Path.prototype.getPoints=function(e,t){if(this.useSpacedPoints)return console.log("tata"),this.getSpacedPoints(e,t);var e=e||12,n=[],r,i,s,o,u,a,f,l,c,h,p,d,v;r=0;for(i=this.actions.length;r<i;r++)switch(s=this.actions[r],o=s.action,s=s.args,o){case THREE.PathActions.MOVE_TO:n.push(new THREE.Vector2(s[0],s[1]));break;case THREE.PathActions.LINE_TO:n.push(new THREE.Vector2(s[0],s[1]));break;case THREE.PathActions.QUADRATIC_CURVE_TO:u=s[2],a=s[3],c=s[0],h=s[1],0<n.length?(o=n[n.length-1],p=o.x,d=o.y):(o=this.actions[r-1].args,p=o[o.length-2],d=o[o.length-1]);for(s=1;s<=e;s++)v=s/e,o=THREE.Shape.Utils.b2(v,p,c,u),v=THREE.Shape.Utils.b2(v,d,h,a),n.push(new THREE.Vector2(o,v));break;case THREE.PathActions.BEZIER_CURVE_TO:u=s[4],a=s[5],c=s[0],h=s[1],f=s[2],l=s[3],0<n.length?(o=n[n.length-1],p=o.x,d=o.y):(o=this.actions[r-1].args,p=o[o.length-2],d=o[o.length-1]);for(s=1;s<=e;s++)v=s/e,o=THREE.Shape.Utils.b3(v,p,c,f,u),v=THREE.Shape.Utils.b3(v,d,h,l,a),n.push(new THREE.Vector2(o,v));break;case THREE.PathActions.CSPLINE_THRU:o=this.actions[r-1].args,v=[new THREE.Vector2(o[o.length-2],o[o.length-1])],o=e*s[0].length,v=v.concat(s[0]),v=new THREE.SplineCurve(v);for(s=1;s<=o;s++)n.push(v.getPointAt(s/o));break;case THREE.PathActions.ARC:u=s[0],a=s[1],h=s[2],f=s[3],o=s[4],c=!!s[5],p=o-f,d=2*e;for(s=1;s<=d;s++)v=s/d,c||(v=1-v),v=f+v*p,o=u+h*Math.cos(v),v=a+h*Math.sin(v),n.push(new THREE.Vector2(o,v));break;case THREE.PathActions.ELLIPSE:u=s[0],a=s[1],h=s[2],l=s[3],f=s[4],o=s[5],c=!!s[6],p=o-f,d=2*e;for(s=1;s<=d;s++)v=s/d,c||(v=1-v),v=f+v*p,o=u+h*Math.cos(v),v=a+l*Math.sin(v),n.push(new THREE.Vector2(o,v))}return r=n[n.length-1],1e-10>Math.abs(r.x-n[0].x)&&1e-10>Math.abs(r.y-n[0].y)&&n.splice(n.length-1,1),t&&n.push(n[0]),n},THREE.Path.prototype.toShapes=function(){var e,t,n,r,i=[],s=new THREE.Path;e=0;for(t=this.actions.length;e<t;e++)n=this.actions[e],r=n.args,n=n.action,n==THREE.PathActions.MOVE_TO&&0!=s.actions.length&&(i.push(s),s=new THREE.Path),s[n].apply(s,r);0!=s.actions.length&&i.push(s);if(0==i.length)return[];var o;r=[],e=!THREE.Shape.Utils.isClockWise(i[0].getPoints());if(1==i.length)return s=i[0],o=new THREE.Shape,o.actions=s.actions,o.curves=s.curves,r.push(o),r;if(e){o=new THREE.Shape,e=0;for(t=i.length;e<t;e++)s=i[e],THREE.Shape.Utils.isClockWise(s.getPoints())?(o.actions=s.actions,o.curves=s.curves,r.push(o),o=new THREE.Shape):o.holes.push(s)}else{e=0;for(t=i.length;e<t;e++)s=i[e],THREE.Shape.Utils.isClockWise(s.getPoints())?(o&&r.push(o),o=new THREE.Shape,o.actions=s.actions,o.curves=s.curves):o.holes.push(s);r.push(o)}return r},THREE.Shape=function(){THREE.Path.apply(this,arguments),this.holes=[]},THREE.Shape.prototype=Object.create(THREE.Path.prototype),THREE.Shape.prototype.extrude=function(e){return new THREE.ExtrudeGeometry(this,e)},THREE.Shape.prototype.makeGeometry=function(e){return new THREE.ShapeGeometry(this,e)},THREE.Shape.prototype.getPointsHoles=function(e){var t,n=this.holes.length,r=[];for(t=0;t<n;t++)r[t]=this.holes[t].getTransformedPoints(e,this.bends);return r},THREE.Shape.prototype.getSpacedPointsHoles=function(e){var t,n=this.holes.length,r=[];for(t=0;t<n;t++)r[t]=this.holes[t].getTransformedSpacedPoints(e,this.bends);return r},THREE.Shape.prototype.extractAllPoints=function(e){return{shape:this.getTransformedPoints(e),holes:this.getPointsHoles(e)}},THREE.Shape.prototype.extractPoints=function(e){return this.useSpacedPoints?this.extractAllSpacedPoints(e):this.extractAllPoints(e)},THREE.Shape.prototype.extractAllSpacedPoints=function(e){return{shape:this.getTransformedSpacedPoints(e),holes:this.getSpacedPointsHoles(e)}},THREE.Shape.Utils={removeHoles:function(e,t){var n=e.concat(),r=n.concat(),i,s,o,u,a,f,l,c,h,p,d=[];for(a=0;a<t.length;a++){f=t[a],Array.prototype.push.apply(r,f),s=Number.POSITIVE_INFINITY;for(i=0;i<f.length;i++){h=f[i],p=[];for(c=0;c<n.length;c++)l=n[c],l=h.distanceToSquared(l),p.push(l),l<s&&(s=l,o=i,u=c)}i=0<=u-1?u-1:n.length-1,s=0<=o-1?o-1:f.length-1;var v=[f[o],n[u],n[i]];c=THREE.FontUtils.Triangulate.area(v);var m=[f[o],f[s],n[u]];h=THREE.FontUtils.Triangulate.area(m),p=u,l=o,u+=1,o+=-1,0>u&&(u+=n.length),u%=n.length,0>o&&(o+=f.length),o%=f.length,i=0<=u-1?u-1:n.length-1,s=0<=o-1?o-1:f.length-1,v=[f[o],n[u],n[i]],v=THREE.FontUtils.Triangulate.area(v),m=[f[o],f[s],n[u]],m=THREE.FontUtils.Triangulate.area(m),c+h>v+m&&(u=p,o=l,0>u&&(u+=n.length),u%=n.length,0>o&&(o+=f.length),o%=f.length,i=0<=u-1?u-1:n.length-1,s=0<=o-1?o-1:f.length-1),c=n.slice(0,u),h=n.slice(u),p=f.slice(o),l=f.slice(0,o),s=[f[o],f[s],n[u]],d.push([f[o],n[u],n[i]]),d.push(s),n=c.concat(p).concat(l).concat(h)}return{shape:n,isolatedPts:d,allpoints:r}},triangulateShape:function(e,t){var n=THREE.Shape.Utils.removeHoles(e,t),r=n.allpoints,i=n.isolatedPts,n=THREE.FontUtils.Triangulate(n.shape,!1),s,o,u,a,f={};s=0;for(o=r.length;s<o;s++)a=r[s].x+":"+r[s].y,void 0!==f[a]&&console.log("Duplicate point",a),f[a]=s;s=0;for(o=n.length;s<o;s++){u=n[s];for(r=0;3>r;r++)a=u[r].x+":"+u[r].y,a=f[a],void 0!==a&&(u[r]=a)}s=0;for(o=i.length;s<o;s++){u=i[s];for(r=0;3>r;r++)a=u[r].x+":"+u[r].y,a=f[a],void 0!==a&&(u[r]=a)}return n.concat(i)},isClockWise:function(e){return 0>THREE.FontUtils.Triangulate.area(e)},b2p0:function(e,t){var n=1-e;return n*n*t},b2p1:function(e,t){return 2*(1-e)*e*t},b2p2:function(e,t){return e*e*t},b2:function(e,t,n,r){return this.b2p0(e,t)+this.b2p1(e,n)+this.b2p2(e,r)},b3p0:function(e,t){var n=1-e;return n*n*n*t},b3p1:function(e,t){var n=1-e;return 3*n*n*e*t},b3p2:function(e,t){return 3*(1-e)*e*e*t},b3p3:function(e,t){return e*e*e*t},b3:function(e,t,n,r,i){return this.b3p0(e,t)+this.b3p1(e,n)+this.b3p2(e,r)+this.b3p3(e,i)}},THREE.AnimationHandler=function(){var e=[],t={},n={update:function(t){for(var n=0;n<e.length;n++)e[n].update(t)},addToUpdate:function(t){-1===e.indexOf(t)&&e.push(t)},removeFromUpdate:function(t){t=e.indexOf(t),-1!==t&&e.splice(t,1)},add:function(e){void 0!==t[e.name]&&console.log("THREE.AnimationHandler.add: Warning! "+e.name+" already exists in library. Overwriting."),t[e.name]=e;if(!0!==e.initialized){for(var n=0;n<e.hierarchy.length;n++){for(var r=0;r<e.hierarchy[n].keys.length;r++)if(0>e.hierarchy[n].keys[r].time&&(e.hierarchy[n].keys[r].time=0),void 0!==e.hierarchy[n].keys[r].rot&&!(e.hierarchy[n].keys[r].rot instanceof THREE.Quaternion)){var i=e.hierarchy[n].keys[r].rot;e.hierarchy[n].keys[r].rot=new THREE.Quaternion(i[0],i[1],i[2],i[3])}if(e.hierarchy[n].keys.length&&void 0!==e.hierarchy[n].keys[0].morphTargets){i={};for(r=0;r<e.hierarchy[n].keys.length;r++)for(var s=0;s<e.hierarchy[n].keys[r].morphTargets.length;s++){var o=e.hierarchy[n].keys[r].morphTargets[s];i[o]=-1}e.hierarchy[n].usedMorphTargets=i;for(r=0;r<e.hierarchy[n].keys.length;r++){var u={};for(o in i){for(s=0;s<e.hierarchy[n].keys[r].morphTargets.length;s++)if(e.hierarchy[n].keys[r].morphTargets[s]===o){u[o]=e.hierarchy[n].keys[r].morphTargetsInfluences[s];break}s===e.hierarchy[n].keys[r].morphTargets.length&&(u[o]=0)}e.hierarchy[n].keys[r].morphTargetsInfluences=u}}for(r=1;r<e.hierarchy[n].keys.length;r++)e.hierarchy[n].keys[r].time===e.hierarchy[n].keys[r-1].time&&(e.hierarchy[n].keys.splice(r,1),r--);for(r=0;r<e.hierarchy[n].keys.length;r++)e.hierarchy[n].keys[r].index=r}r=parseInt(e.length*e.fps,10),e.JIT={},e.JIT.hierarchy=[];for(n=0;n<e.hierarchy.length;n++)e.JIT.hierarchy.push(Array(r));e.initialized=!0}},get:function(e){if("string"==typeof e)return t[e]?t[e]:(console.log("THREE.AnimationHandler.get: Couldn't find animation "+e),null)},parse:function(e){var t=[];if(e instanceof THREE.SkinnedMesh)for(var n=0;n<e.bones.length;n++)t.push(e.bones[n]);else r(e,t);return t}},r=function(e,t){t.push(e);for(var n=0;n<e.children.length;n++)r(e.children[n],t)};return n.LINEAR=0,n.CATMULLROM=1,n.CATMULLROM_FORWARD=2,n}(),THREE.Animation=function(e,t,n){this.root=e,this.data=THREE.AnimationHandler.get(t),this.hierarchy=THREE.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.loop=this.isPaused=!0,this.interpolationType=void 0!==n?n:THREE.AnimationHandler.LINEAR,this.points=[],this.target=new THREE.Vector3},THREE.Animation.prototype.play=function(e,t){if(!1===this.isPlaying){this.isPlaying=!0,this.loop=void 0!==e?e:!0,this.currentTime=void 0!==t?t:0;var n,r=this.hierarchy.length,i;for(n=0;n<r;n++){i=this.hierarchy[n],this.interpolationType!==THREE.AnimationHandler.CATMULLROM_FORWARD&&(i.useQuaternion=!0),i.matrixAutoUpdate=!0,void 0===i.animationCache&&(i.animationCache={},i.animationCache.prevKey={pos:0,rot:0,scl:0},i.animationCache.nextKey={pos:0,rot:0,scl:0},i.animationCache.originalMatrix=i instanceof THREE.Bone?i.skinMatrix:i.matrix);var s=i.animationCache.prevKey;i=i.animationCache.nextKey,s.pos=this.data.hierarchy[n].keys[0],s.rot=this.data.hierarchy[n].keys[0],s.scl=this.data.hierarchy[n].keys[0],i.pos=this.getNextKeyWith("pos",n,1),i.rot=this.getNextKeyWith("rot",n,1),i.scl=this.getNextKeyWith("scl",n,1)}this.update(0)}this.isPaused=!1,THREE.AnimationHandler.addToUpdate(this)},THREE.Animation.prototype.pause=function(){!0===this.isPaused?THREE.AnimationHandler.addToUpdate(this):THREE.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},THREE.Animation.prototype.stop=function(){this.isPaused=this.isPlaying=!1,THREE.AnimationHandler.removeFromUpdate(this)},THREE.Animation.prototype.update=function(e){if(!1!==this.isPlaying){var t=["pos","rot","scl"],n,r,i,s,o,u,a,f,l;l=this.currentTime+=e*this.timeScale,f=this.currentTime%=this.data.length,parseInt(Math.min(f*this.data.fps,this.data.length*this.data.fps),10);for(var c=0,h=this.hierarchy.length;c<h;c++){e=this.hierarchy[c],a=e.animationCache;for(var p=0;3>p;p++){n=t[p],o=a.prevKey[n],u=a.nextKey[n];if(u.time<=l){if(f<l){if(!this.loop){this.stop();return}o=this.data.hierarchy[c].keys[0];for(u=this.getNextKeyWith(n,c,1);u.time<f;)o=u,u=this.getNextKeyWith(n,c,u.index+1)}else do o=u,u=this.getNextKeyWith(n,c,u.index+1);while(u.time<f);a.prevKey[n]=o,a.nextKey[n]=u}e.matrixAutoUpdate=!0,e.matrixWorldNeedsUpdate=!0,r=(f-o.time)/(u.time-o.time),i=o[n],s=u[n];if(0>r||1<r)console.log("THREE.Animation.update: Warning! Scale out of bounds:"+r+" on bone "+c),r=0>r?0:1;if("pos"===n){if(n=e.position,this.interpolationType===THREE.AnimationHandler.LINEAR)n.x=i[0]+(s[0]-i[0])*r,n.y=i[1]+(s[1]-i[1])*r,n.z=i[2]+(s[2]-i[2])*r;else if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD)this.points[0]=this.getPrevKeyWith("pos",c,o.index-1).pos,this.points[1]=i,this.points[2]=s,this.points[3]=this.getNextKeyWith("pos",c,u.index+1).pos,r=.33*r+.33,i=this.interpolateCatmullRom(this.points,r),n.x=i[0],n.y=i[1],n.z=i[2],this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD&&(r=this.interpolateCatmullRom(this.points,1.01*r),this.target.set(r[0],r[1],r[2]),this.target.sub(n),this.target.y=0,this.target.normalize(),r=Math.atan2(this.target.x,this.target.z),e.rotation.set(0,r,0))}else"rot"===n?THREE.Quaternion.slerp(i,s,e.quaternion,r):"scl"===n&&(n=e.scale,n.x=i[0]+(s[0]-i[0])*r,n.y=i[1]+(s[1]-i[1])*r,n.z=i[2]+(s[2]-i[2])*r)}}}},THREE.Animation.prototype.interpolateCatmullRom=function(e,t){var n=[],r=[],i,s,o,u,a,f;return i=(e.length-1)*t,s=Math.floor(i),i-=s,n[0]=0===s?s:s-1,n[1]=s,n[2]=s>e.length-2?s:s+1,n[3]=s>e.length-3?s:s+2,s=e[n[0]],u=e[n[1]],a=e[n[2]],f=e[n[3]],n=i*i,o=i*n,r[0]=this.interpolate(s[0],u[0],a[0],f[0],i,n,o),r[1]=this.interpolate(s[1],u[1],a[1],f[1],i,n,o),r[2]=this.interpolate(s[2],u[2],a[2],f[2],i,n,o),r},THREE.Animation.prototype.interpolate=function(e,t,n,r,i,s,o){return e=.5*(n-e),r=.5*(r-t),(2*(t-n)+e+r)*o+(-3*(t-n)-2*e-r)*s+e*i+t},THREE.Animation.prototype.getNextKeyWith=function(e,t,n){for(var r=this.data.hierarchy[t].keys,n=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?n<r.length-1?n:r.length-1:n%r.length;n<r.length;n++)if(void 0!==r[n][e])return r[n];return this.data.hierarchy[t].keys[0]},THREE.Animation.prototype.getPrevKeyWith=function(e,t,n){for(var r=this.data.hierarchy[t].keys,n=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?0<n?n:0:0<=n?n:n+r.length;0<=n;n--)if(void 0!==r[n][e])return r[n];return this.data.hierarchy[t].keys[r.length-1]},THREE.KeyFrameAnimation=function(e,t,n){this.root=e,this.data=THREE.AnimationHandler.get(t),this.hierarchy=THREE.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=.001,this.isPlaying=!1,this.loop=this.isPaused=!0,this.JITCompile=void 0!==n?n:!0,e=0;for(t=this.hierarchy.length;e<t;e++){var n=this.data.hierarchy[e].sids,r=this.hierarchy[e];if(this.data.hierarchy[e].keys.length&&n){for(var i=0;i<n.length;i++){var s=n[i],o=this.getNextKeyWith(s,e,0);o&&o.apply(s)}r.matrixAutoUpdate=!1,this.data.hierarchy[e].node.updateMatrix(),r.matrixWorldNeedsUpdate=!0}}},THREE.KeyFrameAnimation.prototype.play=function(e,t){if(!this.isPlaying){this.isPlaying=!0,this.loop=void 0!==e?e:!0,this.currentTime=void 0!==t?t:0,this.startTimeMs=t,this.startTime=1e7,this.endTime=-this.startTime;var n,r=this.hierarchy.length,i,s;for(n=0;n<r;n++)i=this.hierarchy[n],s=this.data.hierarchy[n],i.useQuaternion=!0,void 0===s.animationCache&&(s.animationCache={},s.animationCache.prevKey=null,s.animationCache.nextKey=null,s.animationCache.originalMatrix=i instanceof THREE.Bone?i.skinMatrix:i.matrix),i=this.data.hierarchy[n].keys,i.length&&(s.animationCache.prevKey=i[0],s.animationCache.nextKey=i[1],this.startTime=Math.min(i[0].time,this.startTime),this.endTime=Math.max(i[i.length-1].time,this.endTime));this.update(0)}this.isPaused=!1,THREE.AnimationHandler.addToUpdate(this)},THREE.KeyFrameAnimation.prototype.pause=function(){this.isPaused?THREE.AnimationHandler.addToUpdate(this):THREE.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},THREE.KeyFrameAnimation.prototype.stop=function(){this.isPaused=this.isPlaying=!1,THREE.AnimationHandler.removeFromUpdate(this);for(var e=0;e<this.data.hierarchy.length;e++){var t=this.hierarchy[e],n=this.data.hierarchy[e];if(void 0!==n.animationCache){var r=n.animationCache.originalMatrix;t instanceof THREE.Bone?(r.copy(t.skinMatrix),t.skinMatrix=r):(r.copy(t.matrix),t.matrix=r),delete n.animationCache}}},THREE.KeyFrameAnimation.prototype.update=function(e){if(this.isPlaying){var t,n,r,i,s=this.data.JIT.hierarchy,o,u,a;u=this.currentTime+=e*this.timeScale,o=this.currentTime%=this.data.length,o<this.startTimeMs&&(o=this.currentTime=this.startTimeMs+o),i=parseInt(Math.min(o*this.data.fps,this.data.length*this.data.fps),10);if((a=o<u)&&!this.loop){for(var e=0,f=this.hierarchy.length;e<f;e++){var l=this.data.hierarchy[e].keys,s=this.data.hierarchy[e].sids;r=l.length-1,i=this.hierarchy[e];if(l.length){for(l=0;l<s.length;l++)o=s[l],(u=this.getPrevKeyWith(o,e,r))&&u.apply(o);this.data.hierarchy[e].node.updateMatrix(),i.matrixWorldNeedsUpdate=!0}}this.stop()}else if(!(o<this.startTime)){e=0;for(f=this.hierarchy.length;e<f;e++){r=this.hierarchy[e],t=this.data.hierarchy[e];var l=t.keys,c=t.animationCache;if(this.JITCompile&&void 0!==s[e][i])r instanceof THREE.Bone?(r.skinMatrix=s[e][i],r.matrixWorldNeedsUpdate=!1):(r.matrix=s[e][i],r.matrixWorldNeedsUpdate=!0);else if(l.length){this.JITCompile&&c&&(r instanceof THREE.Bone?r.skinMatrix=c.originalMatrix:r.matrix=c.originalMatrix),t=c.prevKey,n=c.nextKey;if(t&&n){if(n.time<=u){if(a&&this.loop){t=l[0];for(n=l[1];n.time<o;)t=n,n=l[t.index+1]}else if(!a)for(var h=l.length-1;n.time<o&&n.index!==h;)t=n,n=l[t.index+1];c.prevKey=t,c.nextKey=n}n.time>=o?t.interpolate(n,o):t.interpolate(n,n.time)}this.data.hierarchy[e].node.updateMatrix(),r.matrixWorldNeedsUpdate=!0}}if(this.JITCompile&&void 0===s[0][i]){this.hierarchy[0].updateMatrixWorld(!0);for(e=0;e<this.hierarchy.length;e++)s[e][i]=this.hierarchy[e]instanceof THREE.Bone?this.hierarchy[e].skinMatrix.clone():this.hierarchy[e].matrix.clone()}}}},THREE.KeyFrameAnimation.prototype.getNextKeyWith=function(e,t,n){t=this.data.hierarchy[t].keys;for(n%=t.length;n<t.length;n++)if(t[n].hasTarget(e))return t[n];return t[0]},THREE.KeyFrameAnimation.prototype.getPrevKeyWith=function(e,t,n){t=this.data.hierarchy[t].keys;for(n=0<=n?n:n+t.length;0<=n;n--)if(t[n].hasTarget(e))return t[n];return t[t.length-1]},THREE.CubeCamera=function(e,t,n){THREE.Object3D.call(this);var r=new THREE.PerspectiveCamera(90,1,e,t);r.up.set(0,-1,0),r.lookAt(new THREE.Vector3(1,0,0)),this.add(r);var i=new THREE.PerspectiveCamera(90,1,e,t);i.up.set(0,-1,0),i.lookAt(new THREE.Vector3(-1,0,0)),this.add(i);var s=new THREE.PerspectiveCamera(90,1,e,t);s.up.set(0,0,1),s.lookAt(new THREE.Vector3(0,1,0)),this.add(s);var o=new THREE.PerspectiveCamera(90,1,e,t);o.up.set(0,0,-1),o.lookAt(new THREE.Vector3(0,-1,0)),this.add(o);var u=new THREE.PerspectiveCamera(90,1,e,t);u.up.set(0,-1,0),u.lookAt(new THREE.Vector3(0,0,1)),this.add(u);var a=new THREE.PerspectiveCamera(90,1,e,t);a.up.set(0,-1,0),a.lookAt(new THREE.Vector3(0,0,-1)),this.add(a),this.renderTarget=new THREE.WebGLRenderTargetCube(n,n,{format:THREE.RGBFormat,magFilter:THREE.LinearFilter,minFilter:THREE.LinearFilter}),this.updateCubeMap=function(e,t){var n=this.renderTarget,l=n.generateMipmaps;n.generateMipmaps=!1,n.activeCubeFace=0,e.render(t,r,n),n.activeCubeFace=1,e.render(t,i,n),n.activeCubeFace=2,e.render(t,s,n),n.activeCubeFace=3,e.render(t,o,n),n.activeCubeFace=4,e.render(t,u,n),n.generateMipmaps=l,n.activeCubeFace=5,e.render(t,a,n)}},THREE.CubeCamera.prototype=Object.create(THREE.Object3D.prototype),THREE.CombinedCamera=function(e,t,n,r,i,s,o){THREE.Camera.call(this),this.fov=n,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2,this.cameraO=new THREE.OrthographicCamera(e/-2,e/2,t/2,t/-2,s,o),this.cameraP=new THREE.PerspectiveCamera(n,e/t,r,i),this.zoom=1,this.toPerspective()},THREE.CombinedCamera.prototype=Object.create(THREE.Camera.prototype),THREE.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near,this.far=this.cameraP.far,this.cameraP.fov=this.fov/this.zoom,this.cameraP.updateProjectionMatrix(),this.projectionMatrix=this.cameraP.projectionMatrix,this.inPerspectiveMode=!0,this.inOrthographicMode=!1},THREE.CombinedCamera.prototype.toOrthographic=function(){var e=this.cameraP.aspect,t=(this.cameraP.near+this.cameraP.far)/2,t=Math.tan(this.fov/2)*t,e=2*t*e/2,t=t/this.zoom,e=e/this.zoom;this.cameraO.left=-e,this.cameraO.right=e,this.cameraO.top=t,this.cameraO.bottom=-t,this.cameraO.updateProjectionMatrix(),this.near=this.cameraO.near,this.far=this.cameraO.far,this.projectionMatrix=this.cameraO.projectionMatrix,this.inPerspectiveMode=!1,this.inOrthographicMode=!0},THREE.CombinedCamera.prototype.setSize=function(e,t){this.cameraP.aspect=e/t,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2},THREE.CombinedCamera.prototype.setFov=function(e){this.fov=e,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},THREE.CombinedCamera.prototype.updateProjectionMatrix=function(){this.inPerspectiveMode?this.toPerspective():(this.toPerspective(),this.toOrthographic())},THREE.CombinedCamera.prototype.setLens=function(e,t){void 0===t&&(t=24);var n=2*THREE.Math.radToDeg(Math.atan(t/(2*e)));return this.setFov(n),n},THREE.CombinedCamera.prototype.setZoom=function(e){this.zoom=e,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},THREE.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0,this.rotation.y=Math.PI,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0,this.rotation.y=-Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0,this.rotation.y=Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CircleGeometry=function(e,t,n,r){THREE.Geometry.call(this);var e=e||50,n=void 0!==n?n:0,r=void 0!==r?r:2*Math.PI,t=void 0!==t?Math.max(3,t):8,i,s=[];i=new THREE.Vector3;var o=new THREE.Vector2(.5,.5);this.vertices.push(i),s.push(o);for(i=0;i<=t;i++){var u=new THREE.Vector3,a=n+i/t*r;u.x=e*Math.cos(a),u.y=e*Math.sin(a),this.vertices.push(u),s.push(new THREE.Vector2((u.x/e+1)/2,-(u.y/e+1)/2+1))}n=new THREE.Vector3(0,0,-1);for(i=1;i<=t;i++)this.faces.push(new THREE.Face3(i,i+1,0,[n,n,n])),this.faceVertexUvs[0].push([s[i],s[i+1],o]);this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,e)},THREE.CircleGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.CubeGeometry=function(e,t,n,r,i,s){function o(e,t,n,r,i,s,o,a){var f,l=u.widthSegments,c=u.heightSegments,p=i/2,d=s/2,v=u.vertices.length;if("x"===e&&"y"===t||"y"===e&&"x"===t)f="z";else if("x"===e&&"z"===t||"z"===e&&"x"===t)f="y",c=u.depthSegments;else if("z"===e&&"y"===t||"y"===e&&"z"===t)f="x",l=u.depthSegments;var m=l+1,g=c+1,y=i/l,b=s/c,w=new THREE.Vector3;w[f]=0<o?1:-1;for(i=0;i<g;i++)for(s=0;s<m;s++){var E=new THREE.Vector3;E[e]=(s*y-p)*n,E[t]=(i*b-d)*r,E[f]=o,u.vertices.push(E)}for(i=0;i<c;i++)for(s=0;s<l;s++)e=new THREE.Face4(s+m*i+v,s+m*(i+1)+v,s+1+m*(i+1)+v,s+1+m*i+v),e.normal.copy(w),e.vertexNormals.push(w.clone(),w.clone(),w.clone(),w.clone()),e.materialIndex=a,u.faces.push(e),u.faceVertexUvs[0].push([new THREE.Vector2(s/l,1-i/c),new THREE.Vector2(s/l,1-(i+1)/c),new THREE.Vector2((s+1)/l,1-(i+1)/c),new THREE.Vector2((s+1)/l,1-i/c)])}THREE.Geometry.call(this);var u=this;this.width=e,this.height=t,this.depth=n,this.widthSegments=r||1,this.heightSegments=i||1,this.depthSegments=s||1,e=this.width/2,t=this.height/2,n=this.depth/2,o("z","y",-1,-1,this.depth,this.height,e,0),o("z","y",1,-1,this.depth,this.height,-e,1),o("x","z",1,1,this.width,this.depth,t,2),o("x","z",1,-1,this.width,this.depth,-t,3),o("x","y",1,-1,this.width,this.height,n,4),o("x","y",-1,-1,this.width,this.height,-n,5),this.computeCentroids(),this.mergeVertices()},THREE.CubeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.CylinderGeometry=function(e,t,n,r,i,s){THREE.Geometry.call(this);var e=void 0!==e?e:20,t=void 0!==t?t:20,n=void 0!==n?n:100,o=n/2,r=r||8,i=i||1,u,a,f=[],l=[];for(a=0;a<=i;a++){var c=[],h=[],p=a/i,d=p*(t-e)+e;for(u=0;u<=r;u++){var v=u/r,m=new THREE.Vector3;m.x=d*Math.sin(2*v*Math.PI),m.y=-p*n+o,m.z=d*Math.cos(2*v*Math.PI),this.vertices.push(m),c.push(this.vertices.length-1),h.push(new THREE.Vector2(v,1-p))}f.push(c),l.push(h)}n=(t-e)/n;for(u=0;u<r;u++){0!==e?(c=this.vertices[f[0][u]].clone(),h=this.vertices[f[0][u+1]].clone()):(c=this.vertices[f[1][u]].clone(),h=this.vertices[f[1][u+1]].clone()),c.setY(Math.sqrt(c.x*c.x+c.z*c.z)*n).normalize(),h.setY(Math.sqrt(h.x*h.x+h.z*h.z)*n).normalize();for(a=0;a<i;a++){var p=f[a][u],d=f[a+1][u],v=f[a+1][u+1],m=f[a][u+1],g=c.clone(),y=c.clone(),b=h.clone(),w=h.clone(),E=l[a][u].clone(),S=l[a+1][u].clone(),x=l[a+1][u+1].clone(),T=l[a][u+1].clone();this.faces.push(new THREE.Face4(p,d,v,m,[g,y,b,w])),this.faceVertexUvs[0].push([E,S,x,T])}}if(!s&&0<e){this.vertices.push(new THREE.Vector3(0,o,0));for(u=0;u<r;u++)p=f[0][u],d=f[0][u+1],v=this.vertices.length-1,g=new THREE.Vector3(0,1,0),y=new THREE.Vector3(0,1,0),b=new THREE.Vector3(0,1,0),E=l[0][u].clone(),S=l[0][u+1].clone(),x=new THREE.Vector2(S.u,0),this.faces.push(new THREE.Face3(p,d,v,[g,y,b])),this.faceVertexUvs[0].push([E,S,x])}if(!s&&0<t){this.vertices.push(new THREE.Vector3(0,-o,0));for(u=0;u<r;u++)p=f[a][u+1],d=f[a][u],v=this.vertices.length-1,g=new THREE.Vector3(0,-1,0),y=new THREE.Vector3(0,-1,0),b=new THREE.Vector3(0,-1,0),E=l[a][u+1].clone(),S=l[a][u].clone(),x=new THREE.Vector2(S.u,1),this.faces.push(new THREE.Face3(p,d,v,[g,y,b])),this.faceVertexUvs[0].push([E,S,x])}this.computeCentroids(),this.computeFaceNormals()},THREE.CylinderGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ExtrudeGeometry=function(e,t){"undefined"!=typeof e&&(THREE.Geometry.call(this),e=e instanceof Array?e:[e],this.shapebb=e[e.length-1].getBoundingBox(),this.addShapeList(e,t),this.computeCentroids(),this.computeFaceNormals())},THREE.ExtrudeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ExtrudeGeometry.prototype.addShapeList=function(e,t){for(var n=e.length,r=0;r<n;r++)this.addShape(e[r],t)},THREE.ExtrudeGeometry.prototype.addShape=function(e,t){function n(e,t,n){return t||console.log("die"),t.clone().multiplyScalar(n).add(e)}function r(e,t,n){var r=THREE.ExtrudeGeometry.__v1,i=THREE.ExtrudeGeometry.__v2,s=THREE.ExtrudeGeometry.__v3,o=THREE.ExtrudeGeometry.__v4,u=THREE.ExtrudeGeometry.__v5,a=THREE.ExtrudeGeometry.__v6;return r.set(e.x-t.x,e.y-t.y),i.set(e.x-n.x,e.y-n.y),r=r.normalize(),i=i.normalize(),s.set(-r.y,r.x),o.set(i.y,-i.x),u.copy(e).add(s),a.copy(e).add(o),u.equals(a)?o.clone():(u.copy(t).add(s),a.copy(n).add(o),s=r.dot(o),o=a.sub(u).dot(o),0===s&&(console.log("Either infinite or no solutions!"),0===o?console.log("Its finite solutions."):console.log("Too bad, no solutions.")),o/=s,0>o?(t=Math.atan2(t.y-e.y,t.x-e.x),e=Math.atan2(n.y-e.y,n.x-e.x),t>e&&(e+=2*Math.PI),n=(t+e)/2,e=-Math.cos(n),n=-Math.sin(n),new THREE.Vector2(e,n)):r.multiplyScalar(o).add(u).sub(e).clone())}function i(n,r){var i,s;for(F=n.length;0<=--F;){i=F,s=F-1,0>s&&(s=n.length-1);for(var o=0,u=p+2*l,o=0;o<u;o++){var a=H*o,f=H*(o+1),c=r+i+a,a=r+s+a,h=r+s+f,f=r+i+f,d=n,v=o,m=u,g=i,w=s,c=c+L,a=a+L,h=h+L,f=f+L;k.faces.push(new THREE.Face4(c,a,h,f,null,null,y)),c=b.generateSideWallUV(k,e,d,t,c,a,h,f,v,m,g,w),k.faceVertexUvs[0].push(c)}}}function s(e,t,n){k.vertices.push(new THREE.Vector3(e,t,n))}function o(n,r,i,s){n+=L,r+=L,i+=L,k.faces.push(new THREE.Face3(n,r,i,null,null,g)),n=s?b.generateBottomUV(k,e,t,n,r,i):b.generateTopUV(k,e,t,n,r,i),k.faceVertexUvs[0].push(n)}var u=void 0!==t.amount?t.amount:100,a=void 0!==t.bevelThickness?t.bevelThickness:6,f=void 0!==t.bevelSize?t.bevelSize:a-2,l=void 0!==t.bevelSegments?t.bevelSegments:3,c=void 0!==t.bevelEnabled?t.bevelEnabled:!0,h=void 0!==t.curveSegments?t.curveSegments:12,p=void 0!==t.steps?t.steps:1,d=t.extrudePath,v,m=!1,g=t.material,y=t.extrudeMaterial,b=void 0!==t.UVGenerator?t.UVGenerator:THREE.ExtrudeGeometry.WorldUVGenerator,w,E,S,x;d&&(v=d.getSpacedPoints(p),m=!0,c=!1,w=void 0!==t.frames?t.frames:new THREE.TubeGeometry.FrenetFrames(d,p,!1),E=new THREE.Vector3,S=new THREE.Vector3,x=new THREE.Vector3),c||(f=a=l=0);var T,N,C,k=this,L=this.vertices.length,h=e.extractPoints(h),A=h.shape,h=h.holes;if(d=!THREE.Shape.Utils.isClockWise(A)){A=A.reverse(),N=0;for(C=h.length;N<C;N++)T=h[N],THREE.Shape.Utils.isClockWise(T)&&(h[N]=T.reverse());d=!1}var O=THREE.Shape.Utils.triangulateShape(A,h),d=A;N=0;for(C=h.length;N<C;N++)T=h[N],A=A.concat(T);var M,_,D,P,H=A.length,B=O.length,j=[],F=0,I=d.length;M=I-1;for(_=F+1;F<I;F++,M++,_++)M===I&&(M=0),_===I&&(_=0),j[F]=r(d[F],d[M],d[_]);var q=[],R,U=j.concat();N=0;for(C=h.length;N<C;N++){T=h[N],R=[],F=0,I=T.length,M=I-1;for(_=F+1;F<I;F++,M++,_++)M===I&&(M=0),_===I&&(_=0),R[F]=r(T[F],T[M],T[_]);q.push(R),U=U.concat(R)}for(M=0;M<l;M++){T=M/l,D=a*(1-T),_=f*Math.sin(T*Math.PI/2),F=0;for(I=d.length;F<I;F++)P=n(d[F],j[F],_),s(P.x,P.y,-D);N=0;for(C=h.length;N<C;N++){T=h[N],R=q[N],F=0;for(I=T.length;F<I;F++)P=n(T[F],R[F],_),s(P.x,P.y,-D)}}_=f;for(F=0;F<H;F++)P=c?n(A[F],U[F],_):A[F],m?(S.copy(w.normals[0]).multiplyScalar(P.x),E.copy(w.binormals[0]).multiplyScalar(P.y),x.copy(v[0]).add(S).add(E),s(x.x,x.y,x.z)):s(P.x,P.y,0);for(T=1;T<=p;T++)for(F=0;F<H;F++)P=c?n(A[F],U[F],_):A[F],m?(S.copy(w.normals[T]).multiplyScalar(P.x),E.copy(w.binormals[T]).multiplyScalar(P.y),x.copy(v[T]).add(S).add(E),s(x.x,x.y,x.z)):s(P.x,P.y,u/p*T);for(M=l-1;0<=M;M--){T=M/l,D=a*(1-T),_=f*Math.sin(T*Math.PI/2),F=0;for(I=d.length;F<I;F++)P=n(d[F],j[F],_),s(P.x,P.y,u+D);N=0;for(C=h.length;N<C;N++){T=h[N],R=q[N],F=0;for(I=T.length;F<I;F++)P=n(T[F],R[F],_),m?s(P.x,P.y+v[p-1].y,v[p-1].x+D):s(P.x,P.y,u+D)}}if(c){a=0*H;for(F=0;F<B;F++)u=O[F],o(u[2]+a,u[1]+a,u[0]+a,!0);a=H*(p+2*l);for(F=0;F<B;F++)u=O[F],o(u[0]+a,u[1]+a,u[2]+a,!1)}else{for(F=0;F<B;F++)u=O[F],o(u[2],u[1],u[0],!0);for(F=0;F<B;F++)u=O[F],o(u[0]+H*p,u[1]+H*p,u[2]+H*p,!1)}u=0,i(d,u),u+=d.length,N=0;for(C=h.length;N<C;N++)T=h[N],i(T,u),u+=T.length},THREE.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(e,t,n,r,i,s){return t=e.vertices[i].x,i=e.vertices[i].y,n=e.vertices[s].x,s=e.vertices[s].y,[new THREE.Vector2(e.vertices[r].x,e.vertices[r].y),new THREE.Vector2(t,i),new THREE.Vector2(n,s)]},generateBottomUV:function(e,t,n,r,i,s){return this.generateTopUV(e,t,n,r,i,s)},generateSideWallUV:function(e,t,n,r,i,s,o,u){var t=e.vertices[i].x,n=e.vertices[i].y,i=e.vertices[i].z,r=e.vertices[s].x,a=e.vertices[s].y,s=e.vertices[s].z,f=e.vertices[o].x,l=e.vertices[o].y,o=e.vertices[o].z,c=e.vertices[u].x,h=e.vertices[u].y,e=e.vertices[u].z;return.01>Math.abs(n-a)?[new THREE.Vector2(t,1-i),new THREE.Vector2(r,1-s),new THREE.Vector2(f,1-o),new THREE.Vector2(c,1-e)]:[new THREE.Vector2(n,1-i),new THREE.Vector2(a,1-s),new THREE.Vector2(l,1-o),new THREE.Vector2(h,1-e)]}},THREE.ExtrudeGeometry.__v1=new THREE.Vector2,THREE.ExtrudeGeometry.__v2=new THREE.Vector2,THREE.ExtrudeGeometry.__v3=new THREE.Vector2,THREE.ExtrudeGeometry.__v4=new THREE.Vector2,THREE.ExtrudeGeometry.__v5=new THREE.Vector2,THREE.ExtrudeGeometry.__v6=new THREE.Vector2,THREE.ShapeGeometry=function(e,t){THREE.Geometry.call(this),0==e instanceof Array&&(e=[e]),this.shapebb=e[e.length-1].getBoundingBox(),this.addShapeList(e,t),this.computeCentroids(),this.computeFaceNormals()},THREE.ShapeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ShapeGeometry.prototype.addShapeList=function(e,t){for(var n=0,r=e.length;n<r;n++)this.addShape(e[n],t);return this},THREE.ShapeGeometry.prototype.addShape=function(e,t){void 0===t&&(t={});var n=t.material,r=void 0===t.UVGenerator?THREE.ExtrudeGeometry.WorldUVGenerator:t.UVGenerator,i,s,o,u=this.vertices.length;i=e.extractPoints(void 0!==t.curveSegments?t.curveSegments:12);var a=i.shape,f=i.holes;if(!THREE.Shape.Utils.isClockWise(a)){a=a.reverse(),i=0;for(s=f.length;i<s;i++)o=f[i],THREE.Shape.Utils.isClockWise(o)&&(f[i]=o.reverse())}var l=THREE.Shape.Utils.triangulateShape(a,f);i=0;for(s=f.length;i<s;i++)o=f[i],a=a.concat(o);f=a.length,s=l.length;for(i=0;i<f;i++)o=a[i],this.vertices.push(new THREE.Vector3(o.x,o.y,0));for(i=0;i<s;i++)f=l[i],a=f[0]+u,o=f[1]+u,f=f[2]+u,this.faces.push(new THREE.Face3(a,o,f,null,null,n)),this.faceVertexUvs[0].push(r.generateBottomUV(this,e,t,a,o,f))},THREE.LatheGeometry=function(e,t,n,r){THREE.Geometry.call(this);for(var t=t||12,n=n||0,r=r||2*Math.PI,i=1/(e.length-1),s=1/t,o=0,u=t;o<=u;o++)for(var a=n+o*s*r,f=Math.cos(a),l=Math.sin(a),a=0,c=e.length;a<c;a++){var h=e[a],p=new THREE.Vector3;p.x=f*h.x-l*h.y,p.y=l*h.x+f*h.y,p.z=h.z,this.vertices.push(p)}n=e.length,o=0;for(u=t;o<u;o++){a=0;for(c=e.length-1;a<c;a++)r=t=a+n*o,l=t+n,f=t+1+n,this.faces.push(new THREE.Face4(r,l,f,t+1)),f=o*s,t=a*i,r=f+s,l=t+i,this.faceVertexUvs[0].push([new THREE.Vector2(f,t),new THREE.Vector2(r,t),new THREE.Vector2(r,l),new THREE.Vector2(f,l)])}this.mergeVertices(),this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.LatheGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.PlaneGeometry=function(e,t,n,r){THREE.Geometry.call(this),this.width=e,this.height=t,this.widthSegments=n||1,this.heightSegments=r||1;for(var n=e/2,i=t/2,r=this.widthSegments,s=this.heightSegments,o=r+1,u=s+1,a=this.width/r,f=this.height/s,l=new THREE.Vector3(0,0,1),e=0;e<u;e++)for(t=0;t<o;t++)this.vertices.push(new THREE.Vector3(t*a-n,-(e*f-i),0));for(e=0;e<s;e++)for(t=0;t<r;t++)n=new THREE.Face4(t+o*e,t+o*(e+1),t+1+o*(e+1),t+1+o*e),n.normal.copy(l),n.vertexNormals.push(l.clone(),l.clone(),l.clone(),l.clone()),this.faces.push(n),this.faceVertexUvs[0].push([new THREE.Vector2(t/r,1-e/s),new THREE.Vector2(t/r,1-(e+1)/s),new THREE.Vector2((t+1)/r,1-(e+1)/s),new THREE.Vector2((t+1)/r,1-e/s)]);this.computeCentroids()},THREE.PlaneGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.RingGeometry=function(e,t,n,r,i,s){THREE.Geometry.call(this);for(var e=e||0,t=t||50,i=void 0!==i?i:0,s=void 0!==s?s:2*Math.PI,n=void 0!==n?Math.max(3,n):8,r=void 0!==r?Math.max(3,r):8,o=[],u=e,a=(t-e)/r,e=0;e<=r;e++){for(t=0;t<=n;t++){var f=new THREE.Vector3,l=i+t/n*s;f.x=u*Math.cos(l),f.y=u*Math.sin(l),this.vertices.push(f),o.push(new THREE.Vector2((f.x/u+1)/2,-(f.y/u+1)/2+1))}u+=a}i=new THREE.Vector3(0,0,1);for(e=0;e<r;e++){s=e*n;for(t=0;t<=n;t++){var l=t+s,a=l+e,f=l+n+e,c=l+n+1+e;this.faces.push(new THREE.Face3(a,f,c,[i,i,i])),this.faceVertexUvs[0].push([o[a],o[f],o[c]]),a=l+e,f=l+n+1+e,c=l+1+e,this.faces.push(new THREE.Face3(a,f,c,[i,i,i])),this.faceVertexUvs[0].push([o[a],o[f],o[c]])}}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,u)},THREE.RingGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.SphereGeometry=function(e,t,n,r,i,s,o){THREE.Geometry.call(this),this.radius=e||50,this.widthSegments=Math.max(3,Math.floor(t)||8),this.heightSegments=Math.max(2,Math.floor(n)||6);for(var r=void 0!==r?r:0,i=void 0!==i?i:2*Math.PI,s=void 0!==s?s:0,o=void 0!==o?o:Math.PI,u=[],a=[],n=0;n<=this.heightSegments;n++){for(var f=[],l=[],t=0;t<=this.widthSegments;t++){var c=t/this.widthSegments,h=n/this.heightSegments,p=new THREE.Vector3;p.x=-this.radius*Math.cos(r+c*i)*Math.sin(s+h*o),p.y=this.radius*Math.cos(s+h*o),p.z=this.radius*Math.sin(r+c*i)*Math.sin(s+h*o),this.vertices.push(p),f.push(this.vertices.length-1),l.push(new THREE.Vector2(c,1-h))}u.push(f),a.push(l)}for(n=0;n<this.heightSegments;n++)for(t=0;t<this.widthSegments;t++){var r=u[n][t+1],i=u[n][t],s=u[n+1][t],o=u[n+1][t+1],f=this.vertices[r].clone().normalize(),l=this.vertices[i].clone().normalize(),c=this.vertices[s].clone().normalize(),h=this.vertices[o].clone().normalize(),p=a[n][t+1].clone(),d=a[n][t].clone(),v=a[n+1][t].clone(),m=a[n+1][t+1].clone();Math.abs(this.vertices[r].y)===this.radius?(this.faces.push(new THREE.Face3(r,s,o,[f,c,h])),this.faceVertexUvs[0].push([p,v,m])):Math.abs(this.vertices[s].y)===this.radius?(this.faces.push(new THREE.Face3(r,i,s,[f,l,c])),this.faceVertexUvs[0].push([p,d,v])):(this.faces.push(new THREE.Face4(r,i,s,o,[f,l,c,h])),this.faceVertexUvs[0].push([p,d,v,m]))}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,e)},THREE.SphereGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TextGeometry=function(e,t){var n=THREE.FontUtils.generateShapes(e,t);t.amount=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),THREE.ExtrudeGeometry.call(this,n,t)},THREE.TextGeometry.prototype=Object.create(THREE.ExtrudeGeometry.prototype),THREE.TorusGeometry=function(e,t,n,r,i){THREE.Geometry.call(this),this.radius=e||100,this.tube=t||40,this.radialSegments=n||8,this.tubularSegments=r||6,this.arc=i||2*Math.PI,i=new THREE.Vector3,e=[],t=[];for(n=0;n<=this.radialSegments;n++)for(r=0;r<=this.tubularSegments;r++){var s=r/this.tubularSegments*this.arc,o=2*n/this.radialSegments*Math.PI;i.x=this.radius*Math.cos(s),i.y=this.radius*Math.sin(s);var u=new THREE.Vector3;u.x=(this.radius+this.tube*Math.cos(o))*Math.cos(s),u.y=(this.radius+this.tube*Math.cos(o))*Math.sin(s),u.z=this.tube*Math.sin(o),this.vertices.push(u),e.push(new THREE.Vector2(r/this.tubularSegments,n/this.radialSegments)),t.push(u.clone().sub(i).normalize())}for(n=1;n<=this.radialSegments;n++)for(r=1;r<=this.tubularSegments;r++){var i=(this.tubularSegments+1)*n+r-1,s=(this.tubularSegments+1)*(n-1)+r-1,o=(this.tubularSegments+1)*(n-1)+r,u=(this.tubularSegments+1)*n+r,a=new THREE.Face4(i,s,o,u,[t[i],t[s],t[o],t[u]]);a.normal.add(t[i]),a.normal.add(t[s]),a.normal.add(t[o]),a.normal.add(t[u]),a.normal.normalize(),this.faces.push(a),this.faceVertexUvs[0].push([e[i].clone(),e[s].clone(),e[o].clone(),e[u].clone()])}this.computeCentroids()},THREE.TorusGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TorusKnotGeometry=function(e,t,n,r,i,s,o){function u(e,t,n,r,i,s){var o=Math.cos(e);return Math.cos(t),t=Math.sin(e),e*=n/r,n=Math.cos(e),o*=.5*i*(2+n),t=.5*i*(2+n)*t,i=.5*s*i*Math.sin(e),new THREE.Vector3(o,t,i)}THREE.Geometry.call(this),this.radius=e||100,this.tube=t||40,this.radialSegments=n||64,this.tubularSegments=r||8,this.p=i||2,this.q=s||3,this.heightScale=o||1,this.grid=Array(this.radialSegments),n=new THREE.Vector3,r=new THREE.Vector3,i=new THREE.Vector3;for(e=0;e<this.radialSegments;++e){this.grid[e]=Array(this.tubularSegments);for(t=0;t<this.tubularSegments;++t){var a=2*(e/this.radialSegments)*this.p*Math.PI,o=2*(t/this.tubularSegments)*Math.PI,s=u(a,o,this.q,this.p,this.radius,this.heightScale),a=u(a+.01,o,this.q,this.p,this.radius,this.heightScale);n.subVectors(a,s),r.addVectors(a,s),i.crossVectors(n,r),r.crossVectors(i,n),i.normalize(),r.normalize(),a=-this.tube*Math.cos(o),o=this.tube*Math.sin(o),s.x+=a*r.x+o*i.x,s.y+=a*r.y+o*i.y,s.z+=a*r.z+o*i.z,this.grid[e][t]=this.vertices.push(new THREE.Vector3(s.x,s.y,s.z))-1}}for(e=0;e<this.radialSegments;++e)for(t=0;t<this.tubularSegments;++t){var i=(e+1)%this.radialSegments,s=(t+1)%this.tubularSegments,n=this.grid[e][t],r=this.grid[i][t],i=this.grid[i][s],s=this.grid[e][s],o=new THREE.Vector2(e/this.radialSegments,t/this.tubularSegments),a=new THREE.Vector2((e+1)/this.radialSegments,t/this.tubularSegments),f=new THREE.Vector2((e+1)/this.radialSegments,(t+1)/this.tubularSegments),l=new THREE.Vector2(e/this.radialSegments,(t+1)/this.tubularSegments);this.faces.push(new THREE.Face4(n,r,i,s)),this.faceVertexUvs[0].push([o,a,f,l])}this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.TorusKnotGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TubeGeometry=function(e,t,n,r,i,s){THREE.Geometry.call(this),this.path=e,this.segments=t||64,this.radius=n||1,this.radiusSegments=r||8,this.closed=i||!1,s&&(this.debug=new THREE.Object3D),this.grid=[];var o,u,i=this.segments+1,a,f,l,s=new THREE.Vector3,c,h,p,t=new THREE.TubeGeometry.FrenetFrames(this.path,this.segments,this.closed);c=t.tangents,h=t.normals,p=t.binormals,this.tangents=c,this.normals=h,this.binormals=p;for(t=0;t<i;t++){this.grid[t]=[],r=t/(i-1),l=e.getPointAt(r),r=c[t],o=h[t],u=p[t],this.debug&&(this.debug.add(new THREE.ArrowHelper(r,l,n,255)),this.debug.add(new THREE.ArrowHelper(o,l,n,16711680)),this.debug.add(new THREE.ArrowHelper(u,l,n,65280)));for(r=0;r<this.radiusSegments;r++)a=2*(r/this.radiusSegments)*Math.PI,f=-this.radius*Math.cos(a),a=this.radius*Math.sin(a),s.copy(l),s.x+=f*o.x+a*u.x,s.y+=f*o.y+a*u.y,s.z+=f*o.z+a*u.z,this.grid[t][r]=this.vertices.push(new THREE.Vector3(s.x,s.y,s.z))-1}for(t=0;t<this.segments;t++)for(r=0;r<this.radiusSegments;r++)i=this.closed?(t+1)%this.segments:t+1,s=(r+1)%this.radiusSegments,e=this.grid[t][r],n=this.grid[i][r],i=this.grid[i][s],s=this.grid[t][s],c=new THREE.Vector2(t/this.segments,r/this.radiusSegments),h=new THREE.Vector2((t+1)/this.segments,r/this.radiusSegments),p=new THREE.Vector2((t+1)/this.segments,(r+1)/this.radiusSegments),o=new THREE.Vector2(t/this.segments,(r+1)/this.radiusSegments),this.faces.push(new THREE.Face4(e,n,i,s)),this.faceVertexUvs[0].push([c,h,p,o]);this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.TubeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TubeGeometry.FrenetFrames=function(e,t,n){new THREE.Vector3;var r=new THREE.Vector3;new THREE.Vector3;var i=[],s=[],o=[],u=new THREE.Vector3,a=new THREE.Matrix4,t=t+1,f,l,c;this.tangents=i,this.normals=s,this.binormals=o;for(f=0;f<t;f++)l=f/(t-1),i[f]=e.getTangentAt(l),i[f].normalize();s[0]=new THREE.Vector3,o[0]=new THREE.Vector3,e=Number.MAX_VALUE,f=Math.abs(i[0].x),l=Math.abs(i[0].y),c=Math.abs(i[0].z),f<=e&&(e=f,r.set(1,0,0)),l<=e&&(e=l,r.set(0,1,0)),c<=e&&r.set(0,0,1),u.crossVectors(i[0],r).normalize(),s[0].crossVectors(i[0],u),o[0].crossVectors(i[0],s[0]);for(f=1;f<t;f++)s[f]=s[f-1].clone(),o[f]=o[f-1].clone(),u.crossVectors(i[f-1],i[f]),1e-4<u.length()&&(u.normalize(),r=Math.acos(i[f-1].dot(i[f])),s[f].applyMatrix4(a.makeRotationAxis(u,r))),o[f].crossVectors(i[f],s[f]);if(n){r=Math.acos(s[0].dot(s[t-1])),r/=t-1,0<i[0].dot(u.crossVectors(s[0],s[t-1]))&&(r=-r);for(f=1;f<t;f++)s[f].applyMatrix4(a.makeRotationAxis(i[f],r*f)),o[f].crossVectors(i[f],s[f])}},THREE.PolyhedronGeometry=function(e,t,n,r){function i(e){var t=e.normalize().clone();t.index=a.vertices.push(t)-1;var n=Math.atan2(e.z,-e.x)/2/Math.PI+.5,e=Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+.5;return t.uv=new THREE.Vector2(n,1-e),t}function s(e,t,n,r){1>r?(r=new THREE.Face3(e.index,t.index,n.index,[e.clone(),t.clone(),n.clone()]),r.centroid.add(e).add(t).add(n).divideScalar(3),r.normal=r.centroid.clone().normalize(),a.faces.push(r),r=Math.atan2(r.centroid.z,-r.centroid.x),a.faceVertexUvs[0].push([u(e.uv,e,r),u(t.uv,t,r),u(n.uv,n,r)])):(r-=1,s(e,o(e,t),o(e,n),r),s(o(e,t),t,o(t,n),r),s(o(e,n),o(t,n),n,r),s(o(e,t),o(t,n),o(e,n),r))}function o(e,t){c[e.index]||(c[e.index]=[]),c[t.index]||(c[t.index]=[]);var n=c[e.index][t.index];return void 0===n&&(c[e.index][t.index]=c[t.index][e.index]=n=i((new THREE.Vector3).addVectors(e,t).divideScalar(2))),n}function u(e,t,n){return 0>n&&1===e.x&&(e=new THREE.Vector2(e.x-1,e.y)),0===t.x&&0===t.z&&(e=new THREE.Vector2(n/2/Math.PI+.5,e.y)),e}THREE.Geometry.call(this);for(var n=n||1,r=r||0,a=this,f=0,l=e.length;f<l;f++)i(new THREE.Vector3(e[f][0],e[f][1],e[f][2]));for(var c=[],e=this.vertices,f=0,l=t.length;f<l;f++)s(e[t[f][0]],e[t[f][1]],e[t[f][2]],r);this.mergeVertices(),f=0;for(l=this.vertices.length;f<l;f++)this.vertices[f].multiplyScalar(n);this.computeCentroids(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,n)},THREE.PolyhedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.IcosahedronGeometry=function(e,t){var n=(1+Math.sqrt(5))/2;THREE.PolyhedronGeometry.call(this,[[-1,n,0],[1,n,0],[-1,-n,0],[1,-n,0],[0,-1,n],[0,1,n],[0,-1,-n],[0,1,-n],[n,0,-1],[n,0,1],[-n,0,-1],[-n,0,1]],[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]],e,t)},THREE.IcosahedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.OctahedronGeometry=function(e,t){THREE.PolyhedronGeometry.call(this,[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],[[0,2,4],[0,4,3],[0,3,5],[0,5,2],[1,2,5],[1,5,3],[1,3,4],[1,4,2]],e,t)},THREE.OctahedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TetrahedronGeometry=function(e,t){THREE.PolyhedronGeometry.call(this,[[1,1,1],[-1,-1,1],[-1,1,-1],[1,-1,-1]],[[2,1,0],[0,3,2],[1,3,0],[2,3,1]],e,t)},THREE.TetrahedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ParametricGeometry=function(e,t,n,r){THREE.Geometry.call(this);var i=this.vertices,s=this.faces,o=this.faceVertexUvs[0],r=void 0===r?!1:r,u,a,f,l,c=t+1;for(u=0;u<=n;u++){l=u/n;for(a=0;a<=t;a++)f=a/t,f=e(f,l),i.push(f)}var h,p,d,v;for(u=0;u<n;u++)for(a=0;a<t;a++)e=u*c+a,i=u*c+a+1,l=(u+1)*c+a,f=(u+1)*c+a+1,h=new THREE.Vector2(a/t,u/n),p=new THREE.Vector2((a+1)/t,u/n),d=new THREE.Vector2(a/t,(u+1)/n),v=new THREE.Vector2((a+1)/t,(u+1)/n),r?(s.push(new THREE.Face3(e,i,l)),s.push(new THREE.Face3(i,f,l)),o.push([h,p,d]),o.push([p,v,d])):(s.push(new THREE.Face4(e,i,f,l)),o.push([h,p,v,d]));this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.ParametricGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ConvexGeometry=function(e){function t(e){var t=e.length();return new THREE.Vector2(e.x/t,e.y/t)}THREE.Geometry.call(this);for(var n=[[0,1,2],[0,2,1]],r=3;r<e.length;r++){var i=r,s=e[i].clone(),o=s.length();s.x+=o*2e-6*(Math.random()-.5),s.y+=o*2e-6*(Math.random()-.5),s.z+=o*2e-6*(Math.random()-.5);for(var o=[],u=0;u<n.length;){var a=n[u],f=s,l=e[a[0]],c;c=l;var h=e[a[1]],p=e[a[2]],d=new THREE.Vector3,v=new THREE.Vector3;d.subVectors(p,h),v.subVectors(c,h),d.cross(v),d.normalize(),c=d,l=c.dot(l);if(c.dot(f)>=l){for(f=0;3>f;f++){l=[a[f],a[(f+1)%3]],c=!0;for(h=0;h<o.length;h++)if(o[h][0]===l[1]&&o[h][1]===l[0]){o[h]=o[o.length-1],o.pop(),c=!1;break}c&&o.push(l)}n[u]=n[n.length-1],n.pop()}else u++}for(h=0;h<o.length;h++)n.push([o[h][0],o[h][1],i])}i=0,s=Array(e.length);for(r=0;r<n.length;r++){o=n[r];for(u=0;3>u;u++)void 0===s[o[u]]&&(s[o[u]]=i++,this.vertices.push(e[o[u]])),o[u]=s[o[u]]}for(r=0;r<n.length;r++)this.faces.push(new THREE.Face3(n[r][0],n[r][1],n[r][2]));for(r=0;r<this.faces.length;r++)o=this.faces[r],this.faceVertexUvs[0].push([t(this.vertices[o.a]),t(this.vertices[o.b]),t(this.vertices[o.c])]);this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.ConvexGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.AxisHelper=function(e){var t=new THREE.Geometry;t.vertices.push(new THREE.Vector3,new THREE.Vector3(e||1,0,0),new THREE.Vector3,new THREE.Vector3(0,e||1,0),new THREE.Vector3,new THREE.Vector3(0,0,e||1)),t.colors.push(new THREE.Color(16711680),new THREE.Color(16755200),new THREE.Color(65280),new THREE.Color(11206400),new THREE.Color(255),new THREE.Color(43775)),e=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors}),THREE.Line.call(this,t,e,THREE.LinePieces)},THREE.AxisHelper.prototype=Object.create(THREE.Line.prototype),THREE.ArrowHelper=function(e,t,n,r){THREE.Object3D.call(this),void 0===n&&(n=20),void 0===r&&(r=16776960);var i=new THREE.Geometry;i.vertices.push(new THREE.Vector3(0,0,0)),i.vertices.push(new THREE.Vector3(0,1,0)),this.line=new THREE.Line(i,new THREE.LineBasicMaterial({color:r})),this.add(this.line),i=new THREE.CylinderGeometry(0,.05,.25,5,1),this.cone=new THREE.Mesh(i,new THREE.MeshBasicMaterial({color:r})),this.cone.position.set(0,1,0),this.add(this.cone),t instanceof THREE.Vector3&&(this.position=t),this.setDirection(e),this.setLength(n)},THREE.ArrowHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.ArrowHelper.prototype.setDirection=function(e){var t=THREE.ArrowHelper.__v1.copy(e).normalize();.999<t.y?this.rotation.set(0,0,0):-0.999>t.y?this.rotation.set(Math.PI,0,0):(e=THREE.ArrowHelper.__v2.set(t.z,0,-t.x).normalize(),t=Math.acos(t.y),e=THREE.ArrowHelper.__q1.setFromAxisAngle(e,t),this.rotation.setEulerFromQuaternion(e,this.eulerOrder))},THREE.ArrowHelper.prototype.setLength=function(e){this.scale.set(e,e,e)},THREE.ArrowHelper.prototype.setColor=function(e){this.line.material.color.setHex(e),this.cone.material.color.setHex(e)},THREE.ArrowHelper.__v1=new THREE.Vector3,THREE.ArrowHelper.__v2=new THREE.Vector3,THREE.ArrowHelper.__q1=new THREE.Quaternion,THREE.CameraHelper=function(e){function t(e,t,r){n(e,r),n(t,r)}function n(e,t){r.geometry.vertices.push(new THREE.Vector3),r.geometry.colors.push(new THREE.Color(t)),void 0===r.pointMap[e]&&(r.pointMap[e]=[]),r.pointMap[e].push(r.geometry.vertices.length-1)}THREE.Line.call(this);var r=this;this.geometry=new THREE.Geometry,this.material=new THREE.LineBasicMaterial({color:16777215,vertexColors:THREE.FaceColors}),this.type=THREE.LinePieces,this.matrixWorld=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap={},t("n1","n2",16755200),t("n2","n4",16755200),t("n4","n3",16755200),t("n3","n1",16755200),t("f1","f2",16755200),t("f2","f4",16755200),t("f4","f3",16755200),t("f3","f1",16755200),t("n1","f1",16755200),t("n2","f2",16755200),t("n3","f3",16755200),t("n4","f4",16755200),t("p","n1",16711680),t("p","n2",16711680),t("p","n3",16711680),t("p","n4",16711680),t("u1","u2",43775),t("u2","u3",43775),t("u3","u1",43775),t("c","t",16777215),t("p","c",3355443),t("cn1","cn2",3355443),t("cn3","cn4",3355443),t("cf1","cf2",3355443),t("cf3","cf4",3355443),this.camera=e,this.update(e)},THREE.CameraHelper.prototype=Object.create(THREE.Line.prototype),THREE.CameraHelper.prototype.update=function(){function e(e,n,r,i){THREE.CameraHelper.__v.set(n,r,i),THREE.CameraHelper.__projector.unprojectVector(THREE.CameraHelper.__v,THREE.CameraHelper.__c),e=t.pointMap[e];if(void 0!==e){n=0;for(r=e.length;n<r;n++)t.geometry.vertices[e[n]].copy(THREE.CameraHelper.__v)}}var t=this;THREE.CameraHelper.__c.projectionMatrix.copy(this.camera.projectionMatrix),e("c",0,0,-1),e("t",0,0,1),e("n1",-1,-1,-1),e("n2",1,-1,-1),e("n3",-1,1,-1),e("n4",1,1,-1),e("f1",-1,-1,1),e("f2",1,-1,1),e("f3",-1,1,1),e("f4",1,1,1),e("u1",.7,1.1,-1),e("u2",-0.7,1.1,-1),e("u3",0,2,-1),e("cf1",-1,0,1),e("cf2",1,0,1),e("cf3",0,-1,1),e("cf4",0,1,1),e("cn1",-1,0,-1),e("cn2",1,0,-1),e("cn3",0,-1,-1),e("cn4",0,1,-1),this.geometry.verticesNeedUpdate=!0},THREE.CameraHelper.__projector=new THREE.Projector,THREE.CameraHelper.__v=new THREE.Vector3,THREE.CameraHelper.__c=new THREE.Camera,THREE.DirectionalLightHelper=function(e,t){THREE.Object3D.call(this),this.light=e;var n=new THREE.SphereGeometry(t,4,2),r=new THREE.MeshBasicMaterial({fog:!1,wireframe:!0});r.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightSphere=new THREE.Mesh(n,r),this.lightSphere.position=this.light.position,this.add(this.lightSphere),n=new THREE.Geometry,n.vertices.push(this.light.position),n.vertices.push(this.light.target.position),n.computeLineDistances(),r=new THREE.LineDashedMaterial({dashSize:4,gapSize:4,opacity:.75,transparent:!0,fog:!1}),r.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine=new THREE.Line(n,r),this.add(this.targetLine)},THREE.DirectionalLightHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.DirectionalLightHelper.prototype.update=function(){this.lightSphere.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine.geometry.computeLineDistances(),this.targetLine.geometry.verticesNeedUpdate=!0,this.targetLine.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},THREE.GridHelper=function(e,t){for(var n=new THREE.Geometry,r=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors}),i=new THREE.Color(4473924),s=new THREE.Color(8947848),o=-e;o<=e;o+=t){n.vertices.push(new THREE.Vector3(-e,0,o)),n.vertices.push(new THREE.Vector3(e,0,o)),n.vertices.push(new THREE.Vector3(o,0,-e)),n.vertices.push(new THREE.Vector3(o,0,e));var u=0===o?i:s;n.colors.push(u,u,u,u)}THREE.Line.call(this,n,r,THREE.LinePieces)},THREE.GridHelper.prototype=Object.create(THREE.Line.prototype),THREE.HemisphereLightHelper=function(e,t){THREE.Object3D.call(this),this.light=e;var n=new THREE.SphereGeometry(t,4,2);n.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2));for(var r=0;8>r;r++)n.faces[r].materialIndex=4>r?0:1;r=new THREE.MeshBasicMaterial({fog:!1,wireframe:!0}),r.color.copy(e.color).multiplyScalar(e.intensity);var i=new THREE.MeshBasicMaterial({fog:!1,wireframe:!0});i.color.copy(e.groundColor).multiplyScalar(e.intensity),this.lightSphere=new THREE.Mesh(n,new THREE.MeshFaceMaterial([r,i])),this.lightSphere.position=e.position,this.lightSphere.lookAt(new THREE.Vector3),this.add(this.lightSphere)},THREE.HemisphereLightHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.HemisphereLightHelper.prototype.update=function(){this.lightSphere.lookAt(new THREE.Vector3),this.lightSphere.material.materials[0].color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightSphere.material.materials[1].color.copy(this.light.groundColor).multiplyScalar(this.light.intensity)},THREE.PointLightHelper=function(e,t){THREE.Object3D.call(this),this.light=e;var n=new THREE.SphereGeometry(t,4,2),r=new THREE.MeshBasicMaterial({fog:!1,wireframe:!0});r.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightSphere=new THREE.Mesh(n,r),this.lightSphere.position=this.light.position,this.add(this.lightSphere)},THREE.PointLightHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.PointLightHelper.prototype.update=function(){this.lightSphere.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},THREE.SpotLightHelper=function(e,t){THREE.Object3D.call(this),this.light=e;var n=new THREE.SphereGeometry(t,4,2),r=new THREE.MeshBasicMaterial({fog:!1,wireframe:!0});r.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightSphere=new THREE.Mesh(n,r),this.lightSphere.position=this.light.position,this.add(this.lightSphere),n=new THREE.CylinderGeometry(1e-4,1,1,8,1,!0),n.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2).translate(new THREE.Vector3(0,-0.5,0))),r=new THREE.MeshBasicMaterial({fog:!1,wireframe:!0,opacity:.3,transparent:!0}),r.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightCone=new THREE.Mesh(n,r),this.lightCone.position=this.light.position,n=e.distance?e.distance:1e4,r=2*n*Math.tan(.5*e.angle),this.lightCone.scale.set(r,r,n),this.lightCone.lookAt(this.light.target.position),this.add(this.lightCone)},THREE.SpotLightHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.SpotLightHelper.prototype.update=function(){var e=this.light.distance?this.light.distance:1e4,t=2*e*Math.tan(.5*this.light.angle);this.lightCone.scale.set(t,t,e),this.lightCone.lookAt(this.light.target.position),this.lightSphere.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightCone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},THREE.ImmediateRenderObject=function(){THREE.Object3D.call(this),this.render=function(){}},THREE.ImmediateRenderObject.prototype=Object.create(THREE.Object3D.prototype),THREE.LensFlare=function(e,t,n,r,i){THREE.Object3D.call(this),this.lensFlares=[],this.positionScreen=new THREE.Vector3,this.customUpdateCallback=void 0,void 0!==e&&this.add(e,t,n,r,i)},THREE.LensFlare.prototype=Object.create(THREE.Object3D.prototype),THREE.LensFlare.prototype.add=function(e,t,n,r,i,s){void 0===t&&(t=-1),void 0===n&&(n=0),void 0===s&&(s=1),void 0===i&&(i=new THREE.Color(16777215)),void 0===r&&(r=THREE.NormalBlending),n=Math.min(n,Math.max(0,n)),this.lensFlares.push({texture:e,size:t,distance:n,x:0,y:0,z:0,scale:1,rotation:1,opacity:s,color:i,blending:r})},THREE.LensFlare.prototype.updateLensFlares=function(){var e,t=this.lensFlares.length,n,r=2*-this.positionScreen.x,i=2*-this.positionScreen.y;for(e=0;e<t;e++)n=this.lensFlares[e],n.x=this.positionScreen.x+r*n.distance,n.y=this.positionScreen.y+i*n.distance,n.wantedRotation=.25*n.x*Math.PI,n.rotation+=.25*(n.wantedRotation-n.rotation)},THREE.MorphBlendMesh=function(e,t){THREE.Mesh.call(this,e,t),this.animationsMap={},this.animationsList=[];var n=this.geometry.morphTargets.length;this.createAnimation("__default",0,n-1,n/1),this.setAnimationWeight("__default",1)},THREE.MorphBlendMesh.prototype=Object.create(THREE.Mesh.prototype),THREE.MorphBlendMesh.prototype.createAnimation=function(e,t,n,r){t={startFrame:t,endFrame:n,length:n-t+1,fps:r,duration:(n-t)/r,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1},this.animationsMap[e]=t,this.animationsList.push(t)},THREE.MorphBlendMesh.prototype.autoCreateAnimations=function(e){for(var t=/([a-z]+)(\d+)/,n,r={},i=this.geometry,s=0,o=i.morphTargets.length;s<o;s++){var u=i.morphTargets[s].name.match(t);if(u&&1<u.length){var a=u[1];r[a]||(r[a]={start:Infinity,end:-Infinity}),u=r[a],s<u.start&&(u.start=s),s>u.end&&(u.end=s),n||(n=a)}}for(a in r)u=r[a],this.createAnimation(a,u.start,u.end,e);this.firstAnimation=n},THREE.MorphBlendMesh.prototype.setAnimationDirectionForward=function(e){if(e=this.animationsMap[e])e.direction=1,e.directionBackwards=!1},THREE.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(e){if(e=this.animationsMap[e])e.direction=-1,e.directionBackwards=!0},THREE.MorphBlendMesh.prototype.setAnimationFPS=function(e,t){var n=this.animationsMap[e];n&&(n.fps=t,n.duration=(n.end-n.start)/n.fps)},THREE.MorphBlendMesh.prototype.setAnimationDuration=function(e,t){var n=this.animationsMap[e];n&&(n.duration=t,n.fps=(n.end-n.start)/n.duration)},THREE.MorphBlendMesh.prototype.setAnimationWeight=function(e,t){var n=this.animationsMap[e];n&&(n.weight=t)},THREE.MorphBlendMesh.prototype.setAnimationTime=function(e,t){var n=this.animationsMap[e];n&&(n.time=t)},THREE.MorphBlendMesh.prototype.getAnimationTime=function(e){var t=0;if(e=this.animationsMap[e])t=e.time;return t},THREE.MorphBlendMesh.prototype.getAnimationDuration=function(e){var t=-1;if(e=this.animationsMap[e])t=e.duration;return t},THREE.MorphBlendMesh.prototype.playAnimation=function(e){var t=this.animationsMap[e];t?(t.time=0,t.active=!0):console.warn("animation["+e+"] undefined")},THREE.MorphBlendMesh.prototype.stopAnimation=function(e){if(e=this.animationsMap[e])e.active=!1},THREE.MorphBlendMesh.prototype.update=function(e){for(var t=0,n=this.animationsList.length;t<n;t++){var r=this.animationsList[t];if(r.active){var i=r.duration/r.length;r.time+=r.direction*e;if(r.mirroredLoop){if(r.time>r.duration||0>r.time)r.direction*=-1,r.time>r.duration&&(r.time=r.duration,r.directionBackwards=!0),0>r.time&&(r.time=0,r.directionBackwards=!1)}else r.time%=r.duration,0>r.time&&(r.time+=r.duration);var s=r.startFrame+THREE.Math.clamp(Math.floor(r.time/i),0,r.length-1),o=r.weight;s!==r.currentFrame&&(this.morphTargetInfluences[r.lastFrame]=0,this.morphTargetInfluences[r.currentFrame]=1*o,this.morphTargetInfluences[s]=0,r.lastFrame=r.currentFrame,r.currentFrame=s),i=r.time%i/i,r.directionBackwards&&(i=1-i),this.morphTargetInfluences[r.currentFrame]=i*o,this.morphTargetInfluences[r.lastFrame]=(1-i)*o}}},THREE.LensFlarePlugin=function(){function e(e,n){var r=t.createProgram(),i=t.createShader(t.FRAGMENT_SHADER),s=t.createShader(t.VERTEX_SHADER),o="precision "+n+" float;\n";return t.shaderSource(i,o+e.fragmentShader),t.shaderSource(s,o+e.vertexShader),t.compileShader(i),t.compileShader(s),t.attachShader(r,i),t.attachShader(r,s),t.linkProgram(r),r}var t,n,r,i,s,o,u,a,f,l,c,h,p;this.init=function(v){t=v.context,n=v,r=v.getPrecision(),i=new Float32Array(16),s=new Uint16Array(6),v=0,i[v++]=-1,i[v++]=-1,i[v++]=0,i[v++]=0,i[v++]=1,i[v++]=-1,i[v++]=1,i[v++]=0,i[v++]=1,i[v++]=1,i[v++]=1,i[v++]=1,i[v++]=-1,i[v++]=1,i[v++]=0,i[v++]=1,v=0,s[v++]=0,s[v++]=1,s[v++]=2,s[v++]=0,s[v++]=2,s[v++]=3,o=t.createBuffer(),u=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,i,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,u),t.bufferData(t.ELEMENT_ARRAY_BUFFER,s,t.STATIC_DRAW),a=t.createTexture(),f=t.createTexture(),t.bindTexture(t.TEXTURE_2D,a),t.texImage2D(t.TEXTURE_2D,0,t.RGB,16,16,0,t.RGB,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.bindTexture(t.TEXTURE_2D,f),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,16,16,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),0>=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS)?(l=!1,c=e(THREE.ShaderFlares.lensFlare,r)):(l=!0,c=e(THREE.ShaderFlares.lensFlareVertexTexture,r)),h={},p={},h.vertex=t.getAttribLocation(c,"position"),h.uv=t.getAttribLocation(c,"uv"),p.renderType=t.getUniformLocation(c,"renderType"),p.map=t.getUniformLocation(c,"map"),p.occlusionMap=t.getUniformLocation(c,"occlusionMap"),p.opacity=t.getUniformLocation(c,"opacity"),p.color=t.getUniformLocation(c,"color"),p.scale=t.getUniformLocation(c,"scale"),p.rotation=t.getUniformLocation(c,"rotation"),p.screenPosition=t.getUniformLocation(c,"screenPosition")},this.render=function(e,r,i,s){var e=e.__webglFlares,d=e.length;if(d){var v=new THREE.Vector3,y=s/i,w=.5*i,E=.5*s,S=16/s,x=new THREE.Vector2(S*y,S),T=new THREE.Vector3(1,1,0),N=new THREE.Vector2(1,1),C=p,S=h;t.useProgram(c),t.enableVertexAttribArray(h.vertex),t.enableVertexAttribArray(h.uv),t.uniform1i(C.occlusionMap,0),t.uniform1i(C.map,1),t.bindBuffer(t.ARRAY_BUFFER,o),t.vertexAttribPointer(S.vertex,2,t.FLOAT,!1,16,0),t.vertexAttribPointer(S.uv,2,t.FLOAT,!1,16,8),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,u),t.disable(t.CULL_FACE),t.depthMask(!1);var L,A,O,M,_;for(L=0;L<d;L++)if(S=16/s,x.set(S*y,S),M=e[L],v.set(M.matrixWorld.elements[12],M.matrixWorld.elements[13],M.matrixWorld.elements[14]),v.applyMatrix4(r.matrixWorldInverse),v.applyProjection(r.projectionMatrix),T.copy(v),N.x=T.x*w+w,N.y=T.y*E+E,l||0<N.x&&N.x<i&&0<N.y&&N.y<s){t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,a),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGB,N.x-8,N.y-8,16,16,0),t.uniform1i(C.renderType,0),t.uniform2f(C.scale,x.x,x.y),t.uniform3f(C.screenPosition,T.x,T.y,T.z),t.disable(t.BLEND),t.enable(t.DEPTH_TEST),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,f),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,N.x-8,N.y-8,16,16,0),t.uniform1i(C.renderType,1),t.disable(t.DEPTH_TEST),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,a),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),M.positionScreen.copy(T),M.customUpdateCallback?M.customUpdateCallback(M):M.updateLensFlares(),t.uniform1i(C.renderType,2),t.enable(t.BLEND),A=0;for(O=M.lensFlares.length;A<O;A++)_=M.lensFlares[A],.001<_.opacity&&.001<_.scale&&(T.x=_.x,T.y=_.y,T.z=_.z,S=_.size*_.scale/s,x.x=S*y,x.y=S,t.uniform3f(C.screenPosition,T.x,T.y,T.z),t.uniform2f(C.scale,x.x,x.y),t.uniform1f(C.rotation,_.rotation),t.uniform1f(C.opacity,_.opacity),t.uniform3f(C.color,_.color.r,_.color.g,_.color.b),n.setBlending(_.blending,_.blendEquation,_.blendSrc,_.blendDst),n.setTexture(_.texture,1),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0))}t.enable(t.CULL_FACE),t.enable(t.DEPTH_TEST),t.depthMask(!0)}}},THREE.ShadowMapPlugin=function(){var e,t,n,r,i,s,o=new THREE.Frustum,u=new THREE.Matrix4,a=new THREE.Vector3,f=new THREE.Vector3,l=new THREE.Vector3;this.init=function(o){e=o.context,t=o;var o=THREE.ShaderLib.depthRGBA,u=THREE.UniformsUtils.clone(o.uniforms);n=new THREE.ShaderMaterial({fragmentShader:o.fragmentShader,vertexShader:o.vertexShader,uniforms:u}),r=new THREE.ShaderMaterial({fragmentShader:o.fragmentShader,vertexShader:o.vertexShader,uniforms:u,morphTargets:!0}),i=new THREE.ShaderMaterial({fragmentShader:o.fragmentShader,vertexShader:o.vertexShader,uniforms:u,skinning:!0}),s=new THREE.ShaderMaterial({fragmentShader:o.fragmentShader,vertexShader:o.vertexShader,uniforms:u,morphTargets:!0,skinning:!0}),n._shadowPass=!0,r._shadowPass=!0,i._shadowPass=!0,s._shadowPass=!0},this.render=function(e,n){t.shadowMapEnabled&&t.shadowMapAutoUpdate&&this.update(e,n)},this.update=function(p,v){var m,y,w,E,S,x,T,N,C,L=[];E=0,e.clearColor(1,1,1,1),e.disable(e.BLEND),e.enable(e.CULL_FACE),e.frontFace(e.CCW),t.shadowMapCullFace===THREE.CullFaceFront?e.cullFace(e.FRONT):e.cullFace(e.BACK),t.setDepthTest(!0),m=0;for(y=p.__lights.length;m<y;m++)if(w=p.__lights[m],w.castShadow)if(w instanceof THREE.DirectionalLight&&w.shadowCascade)for(S=0;S<w.shadowCascadeCount;S++){var A;if(w.shadowCascadeArray[S])A=w.shadowCascadeArray[S];else{C=w,T=S,A=new THREE.DirectionalLight,A.isVirtual=!0,A.onlyShadow=!0,A.castShadow=!0,A.shadowCameraNear=C.shadowCameraNear,A.shadowCameraFar=C.shadowCameraFar,A.shadowCameraLeft=C.shadowCameraLeft,A.shadowCameraRight=C.shadowCameraRight,A.shadowCameraBottom=C.shadowCameraBottom,A.shadowCameraTop=C.shadowCameraTop,A.shadowCameraVisible=C.shadowCameraVisible,A.shadowDarkness=C.shadowDarkness,A.shadowBias=C.shadowCascadeBias[T],A.shadowMapWidth=C.shadowCascadeWidth[T],A.shadowMapHeight=C.shadowCascadeHeight[T],A.pointsWorld=[],A.pointsFrustum=[],N=A.pointsWorld,x=A.pointsFrustum;for(var O=0;8>O;O++)N[O]=new THREE.Vector3,x[O]=new THREE.Vector3;N=C.shadowCascadeNearZ[T],C=C.shadowCascadeFarZ[T],x[0].set(-1,-1,N),x[1].set(1,-1,N),x[2].set(-1,1,N),x[3].set(1,1,N),x[4].set(-1,-1,C),x[5].set(1,-1,C),x[6].set(-1,1,C),x[7].set(1,1,C),A.originalCamera=v,x=new THREE.Gyroscope,x.position=w.shadowCascadeOffset,x.add(A),x.add(A.target),v.add(x),w.shadowCascadeArray[S]=A,console.log("Created virtualLight",A)}T=w,N=S,C=T.shadowCascadeArray[N],C.position.copy(T.position),C.target.position.copy(T.target.position),C.lookAt(C.target),C.shadowCameraVisible=T.shadowCameraVisible,C.shadowDarkness=T.shadowDarkness,C.shadowBias=T.shadowCascadeBias[N],x=T.shadowCascadeNearZ[N],T=T.shadowCascadeFarZ[N],C=C.pointsFrustum,C[0].z=x,C[1].z=x,C[2].z=x,C[3].z=x,C[4].z=T,C[5].z=T,C[6].z=T,C[7].z=T,L[E]=A,E++}else L[E]=w,E++;m=0;for(y=L.length;m<y;m++){w=L[m],w.shadowMap||(S=THREE.LinearFilter,t.shadowMapType===THREE.PCFSoftShadowMap&&(S=THREE.NearestFilter),w.shadowMap=new THREE.WebGLRenderTarget(w.shadowMapWidth,w.shadowMapHeight,{minFilter:S,magFilter:S,format:THREE.RGBAFormat}),w.shadowMapSize=new THREE.Vector2(w.shadowMapWidth,w.shadowMapHeight),w.shadowMatrix=new THREE.Matrix4);if(!w.shadowCamera){if(w instanceof THREE.SpotLight)w.shadowCamera=new THREE.PerspectiveCamera(w.shadowCameraFov,w.shadowMapWidth/w.shadowMapHeight,w.shadowCameraNear,w.shadowCameraFar);else{if(!(w instanceof THREE.DirectionalLight)){console.error("Unsupported light type for shadow");continue}w.shadowCamera=new THREE.OrthographicCamera(w.shadowCameraLeft,w.shadowCameraRight,w.shadowCameraTop,w.shadowCameraBottom,w.shadowCameraNear,w.shadowCameraFar)}p.add(w.shadowCamera),t.autoUpdateScene&&p.updateMatrixWorld()}w.shadowCameraVisible&&!w.cameraHelper&&(w.cameraHelper=new THREE.CameraHelper(w.shadowCamera),w.shadowCamera.add(w.cameraHelper));if(w.isVirtual&&A.originalCamera==v){S=v,E=w.shadowCamera,x=w.pointsFrustum,C=w.pointsWorld,a.set(Infinity,Infinity,Infinity),f.set(-Infinity,-Infinity,-Infinity);for(T=0;8>T;T++)N=C[T],N.copy(x[T]),THREE.ShadowMapPlugin.__projector.unprojectVector(N,S),N.applyMatrix4(E.matrixWorldInverse),N.x<a.x&&(a.x=N.x),N.x>f.x&&(f.x=N.x),N.y<a.y&&(a.y=N.y),N.y>f.y&&(f.y=N.y),N.z<a.z&&(a.z=N.z),N.z>f.z&&(f.z=N.z);E.left=a.x,E.right=f.x,E.top=f.y,E.bottom=a.y,E.updateProjectionMatrix()}E=w.shadowMap,x=w.shadowMatrix,S=w.shadowCamera,S.position.getPositionFromMatrix(w.matrixWorld),l.getPositionFromMatrix(w.target.matrixWorld),S.lookAt(l),S.updateMatrixWorld(),S.matrixWorldInverse.getInverse(S.matrixWorld),w.cameraHelper&&(w.cameraHelper.visible=w.shadowCameraVisible),w.shadowCameraVisible&&w.cameraHelper.update(),x.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),x.multiply(S.projectionMatrix),x.multiply(S.matrixWorldInverse),u.multiplyMatrices(S.projectionMatrix,S.matrixWorldInverse),o.setFromMatrix(u),t.setRenderTarget(E),t.clear(),C=p.__webglObjects,w=0;for(E=C.length;w<E;w++)if(T=C[w],x=T.object,T.render=!1,x.visible&&x.castShadow&&(!(x instanceof THREE.Mesh||x instanceof THREE.ParticleSystem)||!x.frustumCulled||o.intersectsObject(x)))x._modelViewMatrix.multiplyMatrices(S.matrixWorldInverse,x.matrixWorld),T.render=!0;w=0;for(E=C.length;w<E;w++)T=C[w],T.render&&(x=T.object,T=T.buffer,O=x.material instanceof THREE.MeshFaceMaterial?x.material.materials[0]:x.material,N=0<x.geometry.morphTargets.length&&O.morphTargets,O=x instanceof THREE.SkinnedMesh&&O.skinning,N=x.customDepthMaterial?x.customDepthMaterial:O?N?s:i:N?r:n,T instanceof THREE.BufferGeometry?t.renderBufferDirect(S,p.__lights,null,N,T,x):t.renderBuffer(S,p.__lights,null,N,T,x));C=p.__webglObjectsImmediate,w=0;for(E=C.length;w<E;w++)T=C[w],x=T.object,x.visible&&x.castShadow&&(x._modelViewMatrix.multiplyMatrices(S.matrixWorldInverse,x.matrixWorld),t.renderImmediateObject(S,p.__lights,null,n,x))}m=t.getClearColor(),y=t.getClearAlpha(),e.clearColor(m.r,m.g,m.b,y),e.enable(e.BLEND),t.shadowMapCullFace===THREE.CullFaceFront&&e.cullFace(e.BACK)}},THREE.ShadowMapPlugin.__projector=new THREE.Projector,THREE.SpritePlugin=function(){function e(e,t){return e.z!==t.z?t.z-e.z:t.id-e.id}var t,n,r,i,s,o,u,a,f,l;this.init=function(e){t=e.context,n=e,r=e.getPrecision(),i=new Float32Array(16),s=new Uint16Array(6),e=0,i[e++]=-1,i[e++]=-1,i[e++]=0,i[e++]=0,i[e++]=1,i[e++]=-1,i[e++]=1,i[e++]=0,i[e++]=1,i[e++]=1,i[e++]=1,i[e++]=1,i[e++]=-1,i[e++]=1,i[e++]=0,i[e++]=1,e=0,s[e++]=0,s[e++]=1,s[e++]=2,s[e++]=0,s[e++]=2,s[e++]=3,o=t.createBuffer(),u=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,i,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,u),t.bufferData(t.ELEMENT_ARRAY_BUFFER,s,t.STATIC_DRAW);var e=THREE.ShaderSprite.sprite,p=t.createProgram(),v=t.createShader(t.FRAGMENT_SHADER),m=t.createShader(t.VERTEX_SHADER),y="precision "+r+" float;\n";t.shaderSource(v,y+e.fragmentShader),t.shaderSource(m,y+e.vertexShader),t.compileShader(v),t.compileShader(m),t.attachShader(p,v),t.attachShader(p,m),t.linkProgram(p),a=p,f={},l={},f.position=t.getAttribLocation(a,"position"),f.uv=t.getAttribLocation(a,"uv"),l.uvOffset=t.getUniformLocation(a,"uvOffset"),l.uvScale=t.getUniformLocation(a,"uvScale"),l.rotation=t.getUniformLocation(a,"rotation"),l.scale=t.getUniformLocation(a,"scale"),l.alignment=t.getUniformLocation(a,"alignment"),l.color=t.getUniformLocation(a,"color"),l.map=t.getUniformLocation(a,"map"),l.opacity=t.getUniformLocation(a,"opacity"),l.useScreenCoordinates=t.getUniformLocation(a,"useScreenCoordinates"),l.sizeAttenuation=t.getUniformLocation(a,"sizeAttenuation"),l.screenPosition=t.getUniformLocation(a,"screenPosition"),l.modelViewMatrix=t.getUniformLocation(a,"modelViewMatrix"),l.projectionMatrix=t.getUniformLocation(a,"projectionMatrix"),l.fogType=t.getUniformLocation(a,"fogType"),l.fogDensity=t.getUniformLocation(a,"fogDensity"),l.fogNear=t.getUniformLocation(a,"fogNear"),l.fogFar=t.getUniformLocation(a,"fogFar"),l.fogColor=t.getUniformLocation(a,"fogColor"),l.alphaTest=t.getUniformLocation(a,"alphaTest")},this.render=function(r,i,s,p){var d=r.__webglSprites,v=d.length;if(v){var m=f,y=l,w=p/s,s=.5*s,E=.5*p;t.useProgram(a),t.enableVertexAttribArray(m.position),t.enableVertexAttribArray(m.uv),t.disable(t.CULL_FACE),t.enable(t.BLEND),t.bindBuffer(t.ARRAY_BUFFER,o),t.vertexAttribPointer(m.position,2,t.FLOAT,!1,16,0),t.vertexAttribPointer(m.uv,2,t.FLOAT,!1,16,8),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,u),t.uniformMatrix4fv(y.projectionMatrix,!1,i.projectionMatrix.elements),t.activeTexture(t.TEXTURE0),t.uniform1i(y.map,0);var S=m=0,x=r.fog;x?(t.uniform3f(y.fogColor,x.color.r,x.color.g,x.color.b),x instanceof THREE.Fog?(t.uniform1f(y.fogNear,x.near),t.uniform1f(y.fogFar,x.far),t.uniform1i(y.fogType,1),S=m=1):x instanceof THREE.FogExp2&&(t.uniform1f(y.fogDensity,x.density),t.uniform1i(y.fogType,2),S=m=2)):(t.uniform1i(y.fogType,0),S=m=0);for(var T,N,C=[],x=0;x<v;x++)T=d[x],N=T.material,T.visible&&0!==N.opacity&&(N.useScreenCoordinates?T.z=-T.position.z:(T._modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,T.matrixWorld),T.z=-T._modelViewMatrix.elements[14]));d.sort(e);for(x=0;x<v;x++)T=d[x],N=T.material,T.visible&&0!==N.opacity&&N.map&&N.map.image&&N.map.image.width&&(t.uniform1f(y.alphaTest,N.alphaTest),!0===N.useScreenCoordinates?(t.uniform1i(y.useScreenCoordinates,1),t.uniform3f(y.screenPosition,(T.position.x*n.devicePixelRatio-s)/s,(E-T.position.y*n.devicePixelRatio)/E,Math.max(0,Math.min(1,T.position.z))),C[0]=n.devicePixelRatio,C[1]=n.devicePixelRatio):(t.uniform1i(y.useScreenCoordinates,0),t.uniform1i(y.sizeAttenuation,N.sizeAttenuation?1:0),t.uniformMatrix4fv(y.modelViewMatrix,!1,T._modelViewMatrix.elements),C[0]=1,C[1]=1),i=r.fog&&N.fog?S:0,m!==i&&(t.uniform1i(y.fogType,i),m=i),i=1/(N.scaleByViewport?p:1),C[0]*=i*w*T.scale.x,C[1]*=i*T.scale.y,t.uniform2f(y.uvScale,N.uvScale.x,N.uvScale.y),t.uniform2f(y.uvOffset,N.uvOffset.x,N.uvOffset.y),t.uniform2f(y.alignment,N.alignment.x,N.alignment.y),t.uniform1f(y.opacity,N.opacity),t.uniform3f(y.color,N.color.r,N.color.g,N.color.b),t.uniform1f(y.rotation,T.rotation),t.uniform2fv(y.scale,C),n.setBlending(N.blending,N.blendEquation,N.blendSrc,N.blendDst),n.setDepthTest(N.depthTest),n.setDepthWrite(N.depthWrite),n.setTexture(N.map,0),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0));t.enable(t.CULL_FACE)}}},THREE.DepthPassPlugin=function(){this.enabled=!1,this.renderTarget=null;var e,t,n,r,i,s,o=new THREE.Frustum,u=new THREE.Matrix4;this.init=function(o){e=o.context,t=o;var o=THREE.ShaderLib.depthRGBA,u=THREE.UniformsUtils.clone(o.uniforms);n=new THREE.ShaderMaterial({fragmentShader:o.fragmentShader,vertexShader:o.vertexShader,uniforms:u}),r=new THREE.ShaderMaterial({fragmentShader:o.fragmentShader,vertexShader:o.vertexShader,uniforms:u,morphTargets:!0}),i=new THREE.ShaderMaterial({fragmentShader:o.fragmentShader,vertexShader:o.vertexShader,uniforms:u,skinning:!0}),s=new THREE.ShaderMaterial({fragmentShader:o.fragmentShader,vertexShader:o.vertexShader,uniforms:u,morphTargets:!0,skinning:!0}),n._shadowPass=!0,r._shadowPass=!0,i._shadowPass=!0,s._shadowPass=!0},this.render=function(e,t){this.enabled&&this.update(e,t)},this.update=function(l,p){var v,m,y,w,E,S;e.clearColor(1,1,1,1),e.disable(e.BLEND),t.setDepthTest(!0),t.autoUpdateScene&&l.updateMatrixWorld(),p.matrixWorldInverse.getInverse(p.matrixWorld),u.multiplyMatrices(p.projectionMatrix,p.matrixWorldInverse),o.setFromMatrix(u),t.setRenderTarget(this.renderTarget),t.clear(),S=l.__webglObjects,v=0;for(m=S.length;v<m;v++)if(y=S[v],E=y.object,y.render=!1,E.visible&&(!(E instanceof THREE.Mesh||E instanceof THREE.ParticleSystem)||!E.frustumCulled||o.intersectsObject(E)))E._modelViewMatrix.multiplyMatrices(p.matrixWorldInverse,E.matrixWorld),y.render=!0;var x;v=0;for(m=S.length;v<m;v++)if(y=S[v],y.render&&(E=y.object,y=y.buffer,!(E instanceof THREE.ParticleSystem)||E.customDepthMaterial))(x=E.material instanceof THREE.MeshFaceMaterial?E.material.materials[0]:E.material)&&t.setMaterialFaces(E.material),w=0<E.geometry.morphTargets.length&&x.morphTargets,x=E instanceof THREE.SkinnedMesh&&x.skinning,w=E.customDepthMaterial?E.customDepthMaterial:x?w?s:i:w?r:n,y instanceof THREE.BufferGeometry?t.renderBufferDirect(p,l.__lights,null,w,y,E):t.renderBuffer(p,l.__lights,null,w,y,E);S=l.__webglObjectsImmediate,v=0;for(m=S.length;v<m;v++)y=S[v],E=y.object,E.visible&&(E._modelViewMatrix.multiplyMatrices(p.matrixWorldInverse,E.matrixWorld),t.renderImmediateObject(p,l.__lights,null,n,E));v=t.getClearColor(),m=t.getClearAlpha(),e.clearColor(v.r,v.g,v.b,m),e.enable(e.BLEND)}},THREE.ShaderFlares={lensFlareVertexTexture:{vertexShader:"uniform lowp int renderType;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform sampler2D occlusionMap;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) ) +\ntexture2D( occlusionMap, vec2( 0.5, 0.1 ) ) +\ntexture2D( occlusionMap, vec2( 0.9, 0.1 ) ) +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 ) ) +\ntexture2D( occlusionMap, vec2( 0.9, 0.9 ) ) +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 ) ) +\ntexture2D( occlusionMap, vec2( 0.1, 0.9 ) ) +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 ) ) +\ntexture2D( occlusionMap, vec2( 0.5, 0.5 ) );\nvVisibility = (       visibility.r / 9.0 ) *\n( 1.0 - visibility.g / 9.0 ) *\n(       visibility.b / 9.0 ) *\n( 1.0 - visibility.a / 9.0 );\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"uniform lowp int renderType;\nuniform sampler2D map;\nuniform float opacity;\nuniform vec3 color;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * vVisibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"},lensFlare:{vertexShader:"uniform lowp int renderType;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif( renderType == 2 ) {\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"precision mediump float;\nuniform lowp int renderType;\nuniform sampler2D map;\nuniform sampler2D occlusionMap;\nuniform float opacity;\nuniform vec3 color;\nvarying vec2 vUV;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nfloat visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;\nvisibility = ( 1.0 - visibility / 4.0 );\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * visibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"}},THREE.ShaderSprite={sprite:{vertexShader:"uniform int useScreenCoordinates;\nuniform int sizeAttenuation;\nuniform vec3 screenPosition;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 alignment;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position + alignment;\nvec2 rotatedPosition;\nrotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;\nrotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;\nvec4 finalPosition;\nif( useScreenCoordinates != 0 ) {\nfinalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );\n} else {\nfinalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition * ( sizeAttenuation == 1 ? 1.0 : finalPosition.z );\n}\ngl_Position = finalPosition;\n}",fragmentShader:"uniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nuniform int fogType;\nuniform vec3 fogColor;\nuniform float fogDensity;\nuniform float fogNear;\nuniform float fogFar;\nuniform float alphaTest;\nvarying vec2 vUV;\nvoid main() {\nvec4 texture = texture2D( map, vUV );\nif ( texture.a < alphaTest ) discard;\ngl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\nif ( fogType > 0 ) {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat fogFactor = 0.0;\nif ( fogType == 1 ) {\nfogFactor = smoothstep( fogNear, fogFar, depth );\n} else {\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n}\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n}\n}"}},define("three",function(e){return function(){var t,n;return t||e.THREE}}(this));var Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(e){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var e=document.createElement("div");return e.id="webgl-error-message",e.style.fontFamily="monospace",e.style.fontSize="13px",e.style.fontWeight="normal",e.style.textAlign="center",e.style.background="#fff",e.style.color="#000",e.style.padding="1.5em",e.style.width="400px",e.style.margin="5em auto 0",this.webgl||(e.innerHTML=window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n"):['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n")),e},addGetWebGLMessage:function(e){var t,n,r;e=e||{},t=e.parent!==undefined?e.parent:document.body,n=e.id!==undefined?e.id:"oldie",r=Detector.getWebGLErrorMessage(),r.id=n,t.appendChild(r)}};define("detector",function(e){return function(){var t,n;return t||e.Detector}}(this)),THREE.FlyControlsMod=function(e,t){function n(e,t){return function(){t.apply(e,arguments)}}this.object=e,this.domElement=t!==undefined?t:document,t&&this.domElement.setAttribute("tabindex",-1),this.movementSpeed=1,this.rollSpeed=.005,this.dragToLook=!1,this.autoForward=!1,this.object.useQuaternion=!0,this.tmpQuaternion=new THREE.Quaternion,this.mouseStatus=0,this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this.moveVector=new THREE.Vector3(0,0,0),this.rotationVector=new THREE.Vector3(0,0,0),this.handleEvent=function(e){typeof this[e.type]=="function"&&this[e.type](e)},this.keydown=function(e){if(e.altKey)return;switch(e.keyCode){case 16:this.movementSpeedMultiplier=.1;break;case 87:this.moveState.forward=1;break;case 83:this.moveState.back=1;break;case 65:this.moveState.left=1;break;case 68:this.moveState.right=1;break;case 82:this.moveState.up=1;break;case 70:this.moveState.down=1;break;case 38:this.moveState.pitchUp=1;break;case 40:this.moveState.pitchDown=1;break;case 81:this.moveState.yawLeft=1;break;case 69:this.moveState.yawRight=1}this.updateMovementVector(),this.updateRotationVector()},this.keyup=function(e){switch(e.keyCode){case 16:this.movementSpeedMultiplier=1;break;case 87:this.moveState.forward=0;break;case 83:this.moveState.back=0;break;case 65:this.moveState.left=0;break;case 68:this.moveState.right=0;break;case 82:this.moveState.up=0;break;case 70:this.moveState.down=0;break;case 38:this.moveState.pitchUp=0;break;case 40:this.moveState.pitchDown=0;break;case 81:this.moveState.yawLeft=0;break;case 69:this.moveState.yawRight=0}this.updateMovementVector(),this.updateRotationVector()},this.mousedown=function(e){this.domElement!==document&&this.domElement.focus(),e.preventDefault(),e.stopPropagation();if(this.dragToLook)this.mouseStatus++;else{switch(e.button){case 0:this.moveState.forward=1;break;case 2:this.moveState.back=1}this.updateMovementVector()}},this.mousemove=function(e){if(!this.dragToLook||this.mouseStatus>0){var t=this.getContainerDimensions(),n=t.size[0]/2,r=t.size[1]/2;this.moveState.yawLeft=-(e.pageX-t.offset[0]-n)/n,this.moveState.pitchDown=(e.pageY-t.offset[1]-r)/r,this.updateRotationVector()}},this.mouseup=function(e){e.preventDefault(),e.stopPropagation();if(this.dragToLook)this.mouseStatus--,this.moveState.yawLeft=this.moveState.pitchDown=0;else{switch(e.button){case 0:this.moveState.forward=0;break;case 2:this.moveState.back=0}this.updateMovementVector()}this.updateRotationVector()},this.update=function(e){var t=e*this.movementSpeed,n=e*this.rollSpeed;this.object.translateX(this.moveVector.x*t),this.object.translateY(this.moveVector.y*t),this.object.translateZ(this.moveVector.z*t),this.tmpQuaternion.set(this.rotationVector.x*n,this.rotationVector.y*n,this.rotationVector.z*n,1).normalize(),this.object.quaternion.multiply(this.tmpQuaternion),this.object.rotation.setEulerFromQuaternion(this.object.quaternion,this.object.eulerOrder)},this.updateMovementVector=function(){var e=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right,this.moveVector.y=-this.moveState.down+this.moveState.up,this.moveVector.z=-e+this.moveState.back},this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp,this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft,this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft},this.getContainerDimensions=function(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}},this.domElement.addEventListener("keydown",n(this,this.keydown),!1),this.domElement.addEventListener("keyup",n(this,this.keyup),!1),this.updateMovementVector(),this.updateRotationVector()},define("flyControlsMod",["three"],function(){}),define("demos/robot",["three","detector","flyControlsMod"],function(e,t){var n="demo-robot",r={id:n,constructor:function(){if(!t.webgl)return;var r=new e.WebGLRenderer({antialias:!0}),i=document.getElementsByClassName(n)[0],s=i.getElementsByClassName("demo-container")[0],o=s.getElementsByClassName("loading")[0];o.style.display="block",s.appendChild(r.domElement);var u=s.offsetWidth,a=s.offsetHeight;r.setSize(u,a);var f=new e.Scene,l=new e.PerspectiveCamera(45,u/a,1,1e4);l.position.y=250,l.position.z=1e3,f.add(l);var c=new e.FlyControlsMod(l);c.movementSpeed=50,c.rollSpeed=.1,c.dragToLook=!0;var h=new e.AmbientLight(13421772);f.add(h);var p=new e.SpotLight(16777215,1,2e3);p.position.set(50,50,500),p.target.position.set(0,250,0),f.add(p);var d=new e.JSONLoader,v,m=new e.Clock,g="models/robot_cartoon_02/robot_cartoon_02.js";d.load(g,function(t,n){v=new e.Mesh(t,new e.MeshFaceMaterial(n)),v.rotation.x=Math.PI/2,v.rotation.z=-Math.PI/3,v.position.set(0,0,0),f.add(v),o.style.display="none",b()});var y=!1;this.start=function(){y=!1,b()},this.stop=function(){y=!0};var b=function(){if(y)return;r.render(f,l);var e=m.getDelta();c.update(e),requestAnimationFrame(b)};this.updateSize=function(e,t){console.log("Update size",e,t),r.setSize(e,t),l.aspect=e/t,l.updateProjectionMatrix()}}};return r}),define("demos/creative",["three","detector"],function(e,t){var n="demo-creative",r={id:n,constructor:function(){function v(){r=new e.WebGLRenderer({antialias:!0});var t=document.getElementsByClassName(n)[0];s=t.getElementsByClassName("demo-container")[0],s.appendChild(r.domElement),l=s.offsetWidth,c=s.offsetHeight,r.setSize(l,c),u=new e.Scene,o=new e.PerspectiveCamera(75,l/c,1,2e3),o.position.z=500,u.add(o);var a=new e.Geometry;for(i=0;i<100;i++){var f=new e.Vector3;f.x=Math.random()*2e3-1e3,f.y=Math.random()*2e3-1e3,f.z=Math.random()*2e3-1e3,a.vertices.push(f)}var h=e.ImageUtils.loadTexture("img/HTML5_Badge_512.png"),p=e.ImageUtils.loadTexture("img/HTML5_Badge_512.png"),d=new e.ParticleBasicMaterial({size:50,map:h,transparent:!0,depthTest:!1,sizeAttenuation:!1}),v=new e.ParticleBasicMaterial({size:250,map:p,transparent:!0,depthTest:!1,sizeAttenuation:!1}),m=new e.ParticleSystem(a,d),g=new e.ParticleSystem(a,v);m.rotation.set(Math.random()*6,Math.random()*6,Math.random()*6),g.rotation.set(Math.random()*6,Math.random()*6,Math.random()*6),u.add(m),u.add(g),document.addEventListener("mousemove",y,!1),document.addEventListener("touchstart",b,!1),document.addEventListener("touchmove",w,!1)}function y(e){a=e.clientX-p,f=e.clientY-d}function b(e){e.touches.length===1&&(e.preventDefault(),a=e.touches[0].pageX-p,f=e.touches[0].pageY-d)}function w(e){e.touches.length===1&&(e.preventDefault(),a=e.touches[0].pageX-p,f=e.touches[0].pageY-d)}var r,s,o,u,a=0,f=0,l,c,h=!1,p=window.innerWidth/2,d=window.innerHeight/2;if(!t.webgl)return;v(),this.start=function(){h=!1,m()},this.stop=function(){h=!0};var m=function(){if(h)return;g(),requestAnimationFrame(m)},g=function(){var t=Date.now()*5e-5;o.position.x+=(a-o.position.x)*.05,o.position.y+=(-f-o.position.y)*.05,o.lookAt(u.position);for(i=0;i<u.children.length;i++){var n=u.children[i];n instanceof e.ParticleSystem&&(n.rotation.y=t*(i<4?i+1:-(i+1)))}r.render(u,o)};this.updateSize=function(e,t){console.log("Update size",e,t),r.setSize(e,t),p=e/2,d=t/2,o.aspect=e/t,o.updateProjectionMatrix()}}};return r});var PIXI=PIXI||{},Phaser=Phaser||{VERSION:"1.0.6",GAMES:[],AUTO:0,CANVAS:1,WEBGL:2,SPRITE:0,BUTTON:1,BULLET:2,GRAPHICS:3,TEXT:4,TILESPRITE:5,BITMAPTEXT:6,GROUP:7,RENDERTEXTURE:8,TILEMAP:9,TILEMAPLAYER:10,EMITTER:11};PIXI.InteractionManager=function(e){},Phaser.Utils={pad:function(e,t,n,r){if(typeof t=="undefined")var t=0;if(typeof n=="undefined")var n=" ";if(typeof r=="undefined")var r=3;if(t+1>=e.length)switch(r){case 1:e=Array(t+1-e.length).join(n)+e;break;case 3:var i=Math.ceil((padlen=t-e.length)/2),s=padlen-i;e=Array(s+1).join(n)+e+Array(i+1).join(n);break;default:e+=Array(t+1-e.length).join(n)}return e},isPlainObject:function(e){if(typeof e!="object"||e.nodeType||e===e.window)return!1;try{if(e.constructor&&!hasOwn.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}return!0},extend:function(){var e,t,n,r,i,s,o=arguments[0]||{},u=1,a=arguments.length,f=!1;typeof o=="boolean"&&(f=o,o=arguments[1]||{},u=2),a===u&&(o=this,--u);for(;u<a;u++)if((e=arguments[u])!=null)for(t in e){n=o[t],r=e[t];if(o===r)continue;f&&r&&(Phaser.Utils.isPlainObject(r)||(i=Array.isArray(r)))?(i?(i=!1,s=n&&Array.isArray(n)?n:[]):s=n&&Phaser.Utils.isPlainObject(n)?n:{},o[t]=Phaser.Utils.extend(f,s,r)):r!==undefined&&(o[t]=r)}return o}},typeof Function.prototype.bind!="function"&&(Function.prototype.bind=function(){var e=Array.prototype.slice;return function(t){function i(){var s=r.concat(e.call(arguments));n.apply(this instanceof i?this:t,s)}var n=this,r=e.call(arguments,1);if(typeof n!="function")throw new TypeError;return i.prototype=function s(e){e&&(s.prototype=e);if(!(this instanceof s))return new s}(n.prototype),i}}()),determineMatrixArrayType(),PIXI.mat3={},PIXI.mat3.create=function(){var e=new PIXI.Matrix(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},PIXI.mat3.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},PIXI.mat4={},PIXI.mat4.create=function(){var e=new PIXI.Matrix(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},PIXI.mat3.multiply=function(e,t,n){n||(n=e);var r=e[0],i=e[1],s=e[2],o=e[3],u=e[4],a=e[5],f=e[6],l=e[7],c=e[8],h=t[0],p=t[1],d=t[2],v=t[3],m=t[4],g=t[5],y=t[6],b=t[7],w=t[8];return n[0]=h*r+p*o+d*f,n[1]=h*i+p*u+d*l,n[2]=h*s+p*a+d*c,n[3]=v*r+m*o+g*f,n[4]=v*i+m*u+g*l,n[5]=v*s+m*a+g*c,n[6]=y*r+b*o+w*f,n[7]=y*i+b*u+w*l,n[8]=y*s+b*a+w*c,n},PIXI.mat3.clone=function(e){var t=new PIXI.Matrix(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},PIXI.mat3.transpose=function(e,t){if(!t||e===t){var n=e[1],r=e[2],i=e[5];return e[1]=e[3],e[2]=e[6],e[3]=n,e[5]=e[7],e[6]=r,e[7]=i,e}return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],t},PIXI.mat3.toMat4=function(e,t){return t||(t=PIXI.mat4.create()),t[15]=1,t[14]=0,t[13]=0,t[12]=0,t[11]=0,t[10]=e[8],t[9]=e[7],t[8]=e[6],t[7]=0,t[6]=e[5],t[5]=e[4],t[4]=e[3],t[3]=0,t[2]=e[2],t[1]=e[1],t[0]=e[0],t},PIXI.mat4.create=function(){var e=new PIXI.Matrix(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},PIXI.mat4.transpose=function(e,t){if(!t||e===t){var n=e[1],r=e[2],i=e[3],s=e[6],o=e[7],u=e[11];return e[1]=e[4],e[2]=e[8],e[3]=e[12],e[4]=n,e[6]=e[9],e[7]=e[13],e[8]=r,e[9]=s,e[11]=e[14],e[12]=i,e[13]=o,e[14]=u,e}return t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15],t},PIXI.mat4.multiply=function(e,t,n){n||(n=e);var r=e[0],i=e[1],s=e[2],o=e[3],u=e[4],a=e[5],f=e[6],l=e[7],c=e[8],h=e[9],p=e[10],d=e[11],v=e[12],m=e[13],g=e[14],y=e[15],b=t[0],w=t[1],E=t[2],S=t[3];return n[0]=b*r+w*u+E*c+S*v,n[1]=b*i+w*a+E*h+S*m,n[2]=b*s+w*f+E*p+S*g,n[3]=b*o+w*l+E*d+S*y,b=t[4],w=t[5],E=t[6],S=t[7],n[4]=b*r+w*u+E*c+S*v,n[5]=b*i+w*a+E*h+S*m,n[6]=b*s+w*f+E*p+S*g,n[7]=b*o+w*l+E*d+S*y,b=t[8],w=t[9],E=t[10],S=t[11],n[8]=b*r+w*u+E*c+S*v,n[9]=b*i+w*a+E*h+S*m,n[10]=b*s+w*f+E*p+S*g,n[11]=b*o+w*l+E*d+S*y,b=t[12],w=t[13],E=t[14],S=t[15],n[12]=b*r+w*u+E*c+S*v,n[13]=b*i+w*a+E*h+S*m,n[14]=b*s+w*f+E*p+S*g,n[15]=b*o+w*l+E*d+S*y,n},PIXI.Point=function(e,t){this.x=e||0,this.y=t||0},PIXI.Point.prototype.clone=function(){return new PIXI.Point(this.x,this.y)},PIXI.Point.prototype.constructor=PIXI.Point,PIXI.Rectangle=function(e,t,n,r){this.x=e||0,this.y=t||0,this.width=n||0,this.height=r||0},PIXI.Rectangle.prototype.clone=function(){return new PIXI.Rectangle(this.x,this.y,this.width,this.height)},PIXI.Rectangle.prototype.contains=function(e,t){if(this.width<=0||this.height<=0)return!1;var n=this.x;if(e>=n&&e<=n+this.width){var r=this.y;if(t>=r&&t<=r+this.height)return!0}return!1},PIXI.Rectangle.prototype.constructor=PIXI.Rectangle,PIXI.DisplayObject=function(){this.last=this,this.first=this,this.position=new PIXI.Point,this.scale=new PIXI.Point(1,1),this.pivot=new PIXI.Point(0,0),this.rotation=0,this.alpha=1,this.visible=!0,this.hitArea=null,this.buttonMode=!1,this.renderable=!1,this.parent=null,this.stage=null,this.worldAlpha=1,this._interactive=!1,this.worldTransform=PIXI.mat3.create(),this.localTransform=PIXI.mat3.create(),this.color=[],this.dynamic=!0,this._sr=0,this._cr=1},PIXI.DisplayObject.prototype.constructor=PIXI.DisplayObject,PIXI.DisplayObject.prototype.setInteractive=function(e){this.interactive=e},Object.defineProperty(PIXI.DisplayObject.prototype,"interactive",{get:function(){return this._interactive},set:function(e){this._interactive=e,this.stage&&(this.stage.dirty=!0)}}),Object.defineProperty(PIXI.DisplayObject.prototype,"mask",{get:function(){return this._mask},set:function(e){this._mask=e,e?this.addFilter(e):this.removeFilter()}}),PIXI.DisplayObject.prototype.addFilter=function(e){if(this.filter)return;this.filter=!0;var t=new PIXI.FilterBlock,n=new PIXI.FilterBlock;t.mask=e,n.mask=e,t.first=t.last=this,n.first=n.last=this,t.open=!0;var r=t,i=t,s,o;o=this.first._iPrev,o?(s=o._iNext,r._iPrev=o,o._iNext=r):s=this,s&&(s._iPrev=i,i._iNext=s);var r=n,i=n,s=null,o=null;o=this.last,s=o._iNext,s&&(s._iPrev=i,i._iNext=s),r._iPrev=o,o._iNext=r;var u=this,a=this.last;while(u)u.last==a&&(u.last=n),u=u.parent;this.first=t,this.__renderGroup&&this.__renderGroup.addFilterBlocks(t,n),e.renderable=!1},PIXI.DisplayObject.prototype.removeFilter=function(){if(!this.filter)return;this.filter=!1;var e=this.first,t=e._iNext,n=e._iPrev;t&&(t._iPrev=n),n&&(n._iNext=t),this.first=e._iNext;var r=this.last,t=r._iNext,n=r._iPrev;t&&(t._iPrev=n),n._iNext=t;var i=r._iPrev,s=this;while(s.last==r){s.last=i,s=s.parent;if(!s)break}var o=e.mask;o.renderable=!0,this.__renderGroup&&this.__renderGroup.removeFilterBlocks(e,r)},PIXI.DisplayObject.prototype.updateTransform=function(){this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation));var e=this.localTransform,t=this.parent.worldTransform,n=this.worldTransform;e[0]=this._cr*this.scale.x,e[1]=-this._sr*this.scale.y,e[3]=this._sr*this.scale.x,e[4]=this._cr*this.scale.y;var r=this.pivot.x,i=this.pivot.y,s=e[0],o=e[1],u=this.position.x-e[0]*r-i*e[1],a=e[3],f=e[4],l=this.position.y-e[4]*i-r*e[3],c=t[0],h=t[1],p=t[2],d=t[3],v=t[4],m=t[5];e[2]=u,e[5]=l,n[0]=c*s+h*a,n[1]=c*o+h*f,n[2]=c*u+h*l+p,n[3]=d*s+v*a,n[4]=d*o+v*f,n[5]=d*u+v*l+m,this.worldAlpha=this.alpha*this.parent.worldAlpha,this.vcount=PIXI.visibleCount},PIXI.visibleCount=0,PIXI.DisplayObjectContainer=function(){PIXI.DisplayObject.call(this),this.children=[]},PIXI.DisplayObjectContainer.prototype=Object.create(PIXI.DisplayObject.prototype),PIXI.DisplayObjectContainer.prototype.constructor=PIXI.DisplayObjectContainer,PIXI.DisplayObjectContainer.prototype.addChild=function(e){e.parent!=undefined&&e.parent.removeChild(e),e.parent=this,this.children.push(e);if(this.stage){var t=e;do t.interactive&&(this.stage.dirty=!0),t.stage=this.stage,t=t._iNext;while(t)}var n=e.first,r=e.last,i,s;this.filter?s=this.last._iPrev:s=this.last,i=s._iNext;var o=this,u=s;while(o)o.last==u&&(o.last=e.last),o=o.parent;i&&(i._iPrev=r,r._iNext=i),n._iPrev=s,s._iNext=n,this.__renderGroup&&(e.__renderGroup&&e.__renderGroup.removeDisplayObjectAndChildren(e),this.__renderGroup.addDisplayObjectAndChildren(e))},PIXI.DisplayObjectContainer.prototype.addChildAt=function(e,t){if(!(t>=0&&t<=this.children.length))throw new Error(e+" The index "+t+" supplied is out of bounds "+this.children.length);e.parent!=undefined&&e.parent.removeChild(e),e.parent=this;if(this.stage){var n=e;do n.interactive&&(this.stage.dirty=!0),n.stage=this.stage,n=n._iNext;while(n)}var r=e.first,i=e.last,s,o;if(t==this.children.length){o=this.last;var u=this,a=this.last;while(u)u.last==a&&(u.last=e.last),u=u.parent}else t==0?o=this:o=this.children[t-1].last;s=o._iNext,s&&(s._iPrev=i,i._iNext=s),r._iPrev=o,o._iNext=r,this.children.splice(t,0,e),this.__renderGroup&&(e.__renderGroup&&e.__renderGroup.removeDisplayObjectAndChildren(e),this.__renderGroup.addDisplayObjectAndChildren(e))},PIXI.DisplayObjectContainer.prototype.swapChildren=function(e,t){return},PIXI.DisplayObjectContainer.prototype.getChildAt=function(e){if(e>=0&&e<this.children.length)return this.children[e];throw new Error(child+" Both the supplied DisplayObjects must be a child of the caller "+this)},PIXI.DisplayObjectContainer.prototype.removeChild=function(e){var t=this.children.indexOf(e);if(t===-1)throw new Error(e+" The supplied DisplayObject must be a child of the caller "+this);var n=e.first,r=e.last,i=r._iNext,s=n._iPrev;i&&(i._iPrev=s),s._iNext=i;if(this.last==r){var o=n._iPrev,u=this;while(u.last==r.last){u.last=o,u=u.parent;if(!u)break}}r._iNext=null,n._iPrev=null;if(this.stage){var a=e;do a.interactive&&(this.stage.dirty=!0),a.stage=null,a=a._iNext;while(a)}e.__renderGroup&&e.__renderGroup.removeDisplayObjectAndChildren(e),e.parent=undefined,this.children.splice(t,1)},PIXI.DisplayObjectContainer.prototype.updateTransform=function(){if(!this.visible)return;PIXI.DisplayObject.prototype.updateTransform.call(this);for(var e=0,t=this.children.length;e<t;e++)this.children[e].updateTransform()},PIXI.blendModes={},PIXI.blendModes.NORMAL=0,PIXI.blendModes.SCREEN=1,PIXI.Sprite=function(e){PIXI.DisplayObjectContainer.call(this),this.anchor=new PIXI.Point,this.texture=e,this.blendMode=PIXI.blendModes.NORMAL,this._width=0,this._height=0,e.baseTexture.hasLoaded?this.updateFrame=!0:(this.onTextureUpdateBind=this.onTextureUpdate.bind(this),this.texture.addEventListener("update",this.onTextureUpdateBind)),this.renderable=!0},PIXI.Sprite.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),PIXI.Sprite.prototype.constructor=PIXI.Sprite,Object.defineProperty(PIXI.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width},set:function(e){this.scale.x=e/this.texture.frame.width,this._width=e}}),Object.defineProperty(PIXI.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(e){this.scale.y=e/this.texture.frame.height,this._height=e}}),PIXI.Sprite.prototype.setTexture=function(e){this.texture.baseTexture!=e.baseTexture?(this.textureChange=!0,this.texture=e,this.__renderGroup&&this.__renderGroup.updateTexture(this)):this.texture=e,this.updateFrame=!0},PIXI.Sprite.prototype.onTextureUpdate=function(e){this._width&&(this.scale.x=this._width/this.texture.frame.width),this._height&&(this.scale.y=this._height/this.texture.frame.height),this.updateFrame=!0},PIXI.Sprite.fromFrame=function(e){var t=PIXI.TextureCache[e];if(!t)throw new Error("The frameId '"+e+"' does not exist in the texture cache"+this);return new PIXI.Sprite(t)},PIXI.Sprite.fromImage=function(e){var t=PIXI.Texture.fromImage(e);return new PIXI.Sprite(t)},PIXI.Stage=function(e,t){PIXI.DisplayObjectContainer.call(this),this.worldTransform=PIXI.mat3.create(),this.interactive=t,this.interactionManager=new PIXI.InteractionManager(this),this.dirty=!0,this.__childrenAdded=[],this.__childrenRemoved=[],this.stage=this,this.stage.hitArea=new PIXI.Rectangle(0,0,1e5,1e5),this.setBackgroundColor(e),this.worldVisible=!0},PIXI.Stage.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),PIXI.Stage.prototype.constructor=PIXI.Stage,PIXI.Stage.prototype.updateTransform=function(){this.worldAlpha=1,this.vcount=PIXI.visibleCount;for(var e=0,t=this.children.length;e<t;e++)this.children[e].updateTransform();this.dirty&&(this.dirty=!1,this.interactionManager.dirty=!0),this.interactive&&this.interactionManager.update()},PIXI.Stage.prototype.setBackgroundColor=function(e){this.backgroundColor=e||0,this.backgroundColorSplit=HEXtoRGB(this.backgroundColor);var t=this.backgroundColor.toString(16);t="000000".substr(0,6-t.length)+t,this.backgroundColorString="#"+t},PIXI.Stage.prototype.getMousePosition=function(){return this.interactionManager.mouse.global},PIXI.CustomRenderable=function(){PIXI.DisplayObject.call(this)},PIXI.CustomRenderable.prototype=Object.create(PIXI.DisplayObject.prototype),PIXI.CustomRenderable.prototype.constructor=PIXI.CustomRenderable,PIXI.CustomRenderable.prototype.renderCanvas=function(e){},PIXI.CustomRenderable.prototype.initWebGL=function(e){},PIXI.CustomRenderable.prototype.renderWebGL=function(e,t){},PIXI.Strip=function(e,t,n){PIXI.DisplayObjectContainer.call(this),this.texture=e,this.blendMode=PIXI.blendModes.NORMAL;try{this.uvs=new Float32Array([0,1,1,1,1,0,0,1]),this.verticies=new Float32Array([0,0,0,0,0,0,0,0,0]),this.colors=new Float32Array([1,1,1,1]),this.indices=new Uint16Array([0,1,2,3])}catch(r){this.uvs=[0,1,1,1,1,0,0,1],this.verticies=[0,0,0,0,0,0,0,0,0],this.colors=[1,1,1,1],this.indices=[0,1,2,3]}this.width=t,this.height=n,e.baseTexture.hasLoaded?(this.width=this.texture.frame.width,this.height=this.texture.frame.height,this.updateFrame=!0):(this.onTextureUpdateBind=this.onTextureUpdate.bind(this),this.texture.addEventListener("update",this.onTextureUpdateBind)),this.renderable=!0},PIXI.Strip.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),PIXI.Strip.prototype.constructor=PIXI.Strip,PIXI.Strip.prototype.setTexture=function(e){this.texture=e,this.width=e.frame.width,this.height=e.frame.height,this.updateFrame=!0},PIXI.Strip.prototype.onTextureUpdate=function(e){this.updateFrame=!0},PIXI.Rope=function(e,t){PIXI.Strip.call(this,e),this.points=t;try{this.verticies=new Float32Array(t.length*4),this.uvs=new Float32Array(t.length*4),this.colors=new Float32Array(t.length*2),this.indices=new Uint16Array(t.length*2)}catch(n){this.verticies=verticies,this.uvs=uvs,this.colors=colors,this.indices=indices}this.refresh()},PIXI.Rope.prototype=Object.create(PIXI.Strip.prototype),PIXI.Rope.prototype.constructor=PIXI.Rope,PIXI.Rope.prototype.refresh=function(){var e=this.points;if(e.length<1)return;var t=this.uvs,n=this.indices,r=this.colors,i=e[0],s,o={x:0,y:0},u=e[0];this.count-=.2,t[0]=0,t[1]=1,t[2]=0,t[3]=1,r[0]=1,r[1]=1,n[0]=0,n[1]=1;var a=e.length;for(var f=1;f<a;f++){var u=e[f],l=f*4,c=f/(a-1);f%2?(t[l]=c,t[l+1]=0,t[l+2]=c,t[l+3]=1):(t[l]=c,t[l+1]=0,t[l+2]=c,t[l+3]=1),l=f*2,r[l]=1,r[l+1]=1,l=f*2,n[l]=l,n[l+1]=l+1,i=u}},PIXI.Rope.prototype.updateTransform=function(){var e=this.points;if(e.length<1)return;var t=this.verticies,n=e[0],r,i={x:0,y:0},s=e[0];this.count-=.2,t[0]=s.x+i.x,t[1]=s.y+i.y,t[2]=s.x-i.x,t[3]=s.y-i.y;var o=e.length;for(var u=1;u<o;u++){var s=e[u],a=u*4;u<e.length-1?r=e[u+1]:r=s,i.y=-(r.x-n.x),i.x=r.y-n.y;var f=(1-u/(o-1))*10;f>1&&(f=1);var l=Math.sqrt(i.x*i.x+i.y*i.y),c=this.texture.height/2;i.x/=l,i.y/=l,i.x*=c,i.y*=c,t[a]=s.x+i.x,t[a+1]=s.y+i.y,t[a+2]=s.x-i.x,t[a+3]=s.y-i.y,n=s}PIXI.DisplayObjectContainer.prototype.updateTransform.call(this)},PIXI.Rope.prototype.setTexture=function(e){this.texture=e,this.updateFrame=!0},PIXI.TilingSprite=function(e,t,n){PIXI.DisplayObjectContainer.call(this),this.texture=e,this.width=t,this.height=n,this.tileScale=new PIXI.Point(1,1),this.tilePosition=new PIXI.Point(0,0),this.renderable=!0,this.blendMode=PIXI.blendModes.NORMAL},PIXI.TilingSprite.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),PIXI.TilingSprite.prototype.constructor=PIXI.TilingSprite,PIXI.TilingSprite.prototype.setTexture=function(e){this.texture=e,this.updateFrame=!0},PIXI.TilingSprite.prototype.onTextureUpdate=function(e){this.updateFrame=!0},PIXI.FilterBlock=function(e){this.graphics=e,this.visible=!0,this.renderable=!0},PIXI.MaskFilter=function(e){this.graphics},PIXI.Graphics=function(){PIXI.DisplayObjectContainer.call(this),this.renderable=!0,this.fillAlpha=1,this.lineWidth=0,this.lineColor="black",this.graphicsData=[],this.currentPath={points:[]}},PIXI.Graphics.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),PIXI.Graphics.prototype.constructor=PIXI.Graphics,PIXI.Graphics.prototype.lineStyle=function(e,t,n){this.currentPath.points.length==0&&this.graphicsData.pop(),this.lineWidth=e||0,this.lineColor=t||0,this.lineAlpha=n==undefined?1:n,this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:PIXI.Graphics.POLY},this.graphicsData.push(this.currentPath)},PIXI.Graphics.prototype.moveTo=function(e,t){this.currentPath.points.length==0&&this.graphicsData.pop(),this.currentPath=this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:PIXI.Graphics.POLY},this.currentPath.points.push(e,t),this.graphicsData.push(this.currentPath)},PIXI.Graphics.prototype.lineTo=function(e,t){this.currentPath.points.push(e,t),this.dirty=!0},PIXI.Graphics.prototype.beginFill=function(e,t){this.filling=!0,this.fillColor=e||0,this.fillAlpha=t==undefined?1:t},PIXI.Graphics.prototype.endFill=function(){this.filling=!1,this.fillColor=null,this.fillAlpha=1},PIXI.Graphics.prototype.drawRect=function(e,t,n,r){this.currentPath.points.length==0&&this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[e,t,n,r],type:PIXI.Graphics.RECT},this.graphicsData.push(this.currentPath),this.dirty=!0},PIXI.Graphics.prototype.drawCircle=function(e,t,n){this.currentPath.points.length==0&&this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[e,t,n,n],type:PIXI.Graphics.CIRC},this.graphicsData.push(this.currentPath),this.dirty=!0},PIXI.Graphics.prototype.drawElipse=function(e,t,n,r){this.currentPath.points.length==0&&this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[e,t,n,r],type:PIXI.Graphics.ELIP},this.graphicsData.push(this.currentPath),this.dirty=!0},PIXI.Graphics.prototype.clear=function(){this.lineWidth=0,this.filling=!1,this.dirty=!0,this.clearDirty=!0,this.graphicsData=[]},PIXI.Graphics.POLY=0,PIXI.Graphics.RECT=1,PIXI.Graphics.CIRC=2,PIXI.Graphics.ELIP=3,PIXI.CanvasGraphics=function(){},PIXI.CanvasGraphics.renderGraphics=function(e,t){var n=e.worldAlpha;for(var r=0;r<e.graphicsData.length;r++){var i=e.graphicsData[r],s=i.points;t.strokeStyle=color="#"+("00000"+(i.lineColor|0).toString(16)).substr(-6),t.lineWidth=i.lineWidth;if(i.type==PIXI.Graphics.POLY){t.beginPath(),t.moveTo(s[0],s[1]);for(var o=1;o<s.length/2;o++)t.lineTo(s[o*2],s[o*2+1]);s[0]==s[s.length-2]&&s[1]==s[s.length-1]&&t.closePath(),i.fill&&(t.globalAlpha=i.fillAlpha*n,t.fillStyle=color="#"+("00000"+(i.fillColor|0).toString(16)).substr(-6),t.fill()),i.lineWidth&&(t.globalAlpha=i.lineAlpha*n,t.stroke())}else if(i.type==PIXI.Graphics.RECT)i.fillColor&&(t.globalAlpha=i.fillAlpha*n,t.fillStyle=color="#"+("00000"+(i.fillColor|0).toString(16)).substr(-6),t.fillRect(s[0],s[1],s[2],s[3])),i.lineWidth&&(t.globalAlpha=i.lineAlpha*n,t.strokeRect(s[0],s[1],s[2],s[3]));else if(i.type==PIXI.Graphics.CIRC)t.beginPath(),t.arc(s[0],s[1],s[2],0,2*Math.PI),t.closePath(),i.fill&&(t.globalAlpha=i.fillAlpha*n,t.fillStyle=color="#"+("00000"+(i.fillColor|0).toString(16)).substr(-6),t.fill()),i.lineWidth&&(t.globalAlpha=i.lineAlpha*n,t.stroke());else if(i.type==PIXI.Graphics.ELIP){var u=i.points,a=u[2]*2,f=u[3]*2,l=u[0]-a/2,c=u[1]-f/2;t.beginPath();var h=.5522848,p=a/2*h,d=f/2*h,v=l+a,m=c+f,g=l+a/2,y=c+f/2;t.moveTo(l,y),t.bezierCurveTo(l,y-d,g-p,c,g,c),t.bezierCurveTo(g+p,c,v,y-d,v,y),t.bezierCurveTo(v,y+d,g+p,m,g,m),t.bezierCurveTo(g-p,m,l,y+d,l,y),t.closePath(),i.fill&&(t.globalAlpha=i.fillAlpha*n,t.fillStyle=color="#"+("00000"+(i.fillColor|0).toString(16)).substr(-6),t.fill()),i.lineWidth&&(t.globalAlpha=i.lineAlpha*n,t.stroke())}}},PIXI.CanvasGraphics.renderGraphicsMask=function(e,t){var n=e.worldAlpha,r=e.graphicsData.length;r>1&&(r=1,console.log("Pixi.js warning: masks in canvas can only mask using the first path in the graphics object"));for(var i=0;i<1;i++){var s=e.graphicsData[i],o=s.points;if(s.type==PIXI.Graphics.POLY){t.beginPath(),t.moveTo(o[0],o[1]);for(var u=1;u<o.length/2;u++)t.lineTo(o[u*2],o[u*2+1]);o[0]==o[o.length-2]&&o[1]==o[o.length-1]&&t.closePath()}else if(s.type==PIXI.Graphics.RECT)t.beginPath(),t.rect(o[0],o[1],o[2],o[3]),t.closePath();else if(s.type==PIXI.Graphics.CIRC)t.beginPath(),t.arc(o[0],o[1],o[2],0,2*Math.PI),t.closePath();else if(s.type==PIXI.Graphics.ELIP){var a=s.points,f=a[2]*2,l=a[3]*2,c=a[0]-f/2,h=a[1]-l/2;t.beginPath();var p=.5522848,d=f/2*p,v=l/2*p,m=c+f,g=h+l,y=c+f/2,b=h+l/2;t.moveTo(c,b),t.bezierCurveTo(c,b-v,y-d,h,y,h),t.bezierCurveTo(y+d,h,m,b-v,m,b),t.bezierCurveTo(m,b+v,y+d,g,y,g),t.bezierCurveTo(y-d,g,c,b+v,c,b),t.closePath()}}},PIXI.CanvasRenderer=function(e,t,n,r){this.transparent=r,this.width=e||800,this.height=t||600,this.view=n||document.createElement("canvas"),this.context=this.view.getContext("2d"),this.refresh=!0,this.view.width=this.width,this.view.height=this.height,this.count=0},PIXI.CanvasRenderer.prototype.constructor=PIXI.CanvasRenderer,PIXI.CanvasRenderer.prototype.render=function(e){PIXI.texturesToUpdate=[],PIXI.texturesToDestroy=[],PIXI.visibleCount++,e.updateTransform(),this.view.style.backgroundColor!=e.backgroundColorString&&!this.transparent&&(this.view.style.backgroundColor=e.backgroundColorString),this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.width,this.height),this.renderDisplayObject(e),e.interactive&&(e._interactiveEventsAdded||(e._interactiveEventsAdded=!0,e.interactionManager.setTarget(this))),PIXI.Texture.frameUpdates.length>0&&(PIXI.Texture.frameUpdates=[])},PIXI.CanvasRenderer.prototype.resize=function(e,t){this.width=e,this.height=t,this.view.width=e,this.view.height=t},PIXI.CanvasRenderer.prototype.renderDisplayObject=function(e){var t,n=this.context;n.globalCompositeOperation="source-over";var r=e.last._iNext;e=e.first;do{t=e.worldTransform;if(!e.visible){e=e.last._iNext;continue}if(!e.renderable){e=e._iNext;continue}if(e instanceof PIXI.Sprite){var i=e.texture.frame;i&&(n.globalAlpha=e.worldAlpha,n.setTransform(t[0],t[3],t[1],t[4],t[2],t[5]),n.drawImage(e.texture.baseTexture.source,i.x,i.y,i.width,i.height,e.anchor.x*-i.width,e.anchor.y*-i.height,i.width,i.height))}else if(e instanceof PIXI.Strip)n.setTransform(t[0],t[3],t[1],t[4],t[2],t[5]),this.renderStrip(e);else if(e instanceof PIXI.TilingSprite)n.setTransform(t[0],t[3],t[1],t[4],t[2],t[5]),this.renderTilingSprite(e);else if(e instanceof PIXI.CustomRenderable)e.renderCanvas(this);else if(e instanceof PIXI.Graphics)n.setTransform(t[0],t[3],t[1],t[4],t[2],t[5]),PIXI.CanvasGraphics.renderGraphics(e,n);else if(e instanceof PIXI.FilterBlock)if(e.open){n.save();var s=e.mask.alpha,o=e.mask.worldTransform;n.setTransform(o[0],o[3],o[1],o[4],o[2],o[5]),e.mask.worldAlpha=.5,n.worldAlpha=0,PIXI.CanvasGraphics.renderGraphicsMask(e.mask,n),n.clip(),e.mask.worldAlpha=s}else n.restore();e=e._iNext}while(e!=r)},PIXI.CanvasRenderer.prototype.renderStripFlat=function(e){var t=this.context,n=e.verticies,r=e.uvs,i=n.length/2;this.count++,t.beginPath();for(var s=1;s<i-2;s++){var o=s*2,u=n[o],a=n[o+2],f=n[o+4],l=n[o+1],c=n[o+3],h=n[o+5];t.moveTo(u,l),t.lineTo(a,c),t.lineTo(f,h)}t.fillStyle="#FF0000",t.fill(),t.closePath()},PIXI.CanvasRenderer.prototype.renderTilingSprite=function(e){var t=this.context;t.globalAlpha=e.worldAlpha,e.__tilePattern||(e.__tilePattern=t.createPattern(e.texture.baseTexture.source,"repeat")),t.beginPath();var n=e.tilePosition,r=e.tileScale;t.scale(r.x,r.y),t.translate(n.x,n.y),t.fillStyle=e.__tilePattern,t.fillRect(-n.x,-n.y,e.width/r.x,e.height/r.y),t.scale(1/r.x,1/r.y),t.translate(-n.x,-n.y),t.closePath()},PIXI.CanvasRenderer.prototype.renderStrip=function(e){var t=this.context,n=e.verticies,r=e.uvs,i=n.length/2;this.count++;for(var s=1;s<i-2;s++){var o=s*2,u=n[o],a=n[o+2],f=n[o+4],l=n[o+1],c=n[o+3],h=n[o+5],p=r[o]*e.texture.width,d=r[o+2]*e.texture.width,v=r[o+4]*e.texture.width,m=r[o+1]*e.texture.height,g=r[o+3]*e.texture.height,y=r[o+5]*e.texture.height;t.save(),t.beginPath(),t.moveTo(u,l),t.lineTo(a,c),t.lineTo(f,h),t.closePath(),t.clip();var b=p*g+m*v+d*y-g*v-m*d-p*y,w=u*g+m*f+a*y-g*f-m*a-u*y,E=p*a+u*v+d*f-a*v-u*d-p*f,S=p*g*f+m*a*v+u*d*y-u*g*v-m*d*f-p*a*y,x=l*g+m*h+c*y-g*h-m*c-l*y,T=p*c+l*v+d*h-c*v-l*d-p*h,N=p*g*h+m*c*v+l*d*y-l*g*v-m*d*h-p*c*y;t.transform(w/b,x/b,E/b,T/b,S/b,N/b),t.drawImage(e.texture.baseTexture.source,0,0),t.restore()}},PIXI._batchs=[],PIXI._getBatch=function(e){return PIXI._batchs.length==0?new PIXI.WebGLBatch(e):PIXI._batchs.pop()},PIXI._returnBatch=function(e){e.clean(),PIXI._batchs.push(e)},PIXI._restoreBatchs=function(e){for(var t=0;t<PIXI._batchs.length;t++)PIXI._batchs[t].restoreLostContext(e)},PIXI.WebGLBatch=function(e){this.gl=e,this.size=0,this.vertexBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),this.uvBuffer=e.createBuffer(),this.colorBuffer=e.createBuffer(),this.blendMode=PIXI.blendModes.NORMAL,this.dynamicSize=1},PIXI.WebGLBatch.prototype.constructor=PIXI.WebGLBatch,PIXI.WebGLBatch.prototype.clean=function(){this.verticies=[],this.uvs=[],this.indices=[],this.colors=[],this.dynamicSize=1,this.texture=null,this.last=null,this.size=0,this.head,this.tail},PIXI.WebGLBatch.prototype.restoreLostContext=function(e){this.gl=e,this.vertexBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),this.uvBuffer=e.createBuffer(),this.colorBuffer=e.createBuffer()},PIXI.WebGLBatch.prototype.init=function(e){e.batch=this,this.dirty=!0,this.blendMode=e.blendMode,this.texture=e.texture.baseTexture,this.head=e,this.tail=e,this.size=1,this.growBatch()},PIXI.WebGLBatch.prototype.insertBefore=function(e,t){this.size++,e.batch=this,this.dirty=!0;var n=t.__prev;t.__prev=e,e.__next=t,n?(e.__prev=n,n.__next=e):this.head=e},PIXI.WebGLBatch.prototype.insertAfter=function(e,t){this.size++,e.batch=this,this.dirty=!0;var n=t.__next;t.__next=e,e.__prev=t,n?(e.__next=n,n.__prev=e):this.tail=e},PIXI.WebGLBatch.prototype.remove=function(e){this.size--;if(this.size==0){e.batch=null,e.__prev=null,e.__next=null;return}e.__prev?e.__prev.__next=e.__next:(this.head=e.__next,this.head.__prev=null),e.__next?e.__next.__prev=e.__prev:(this.tail=e.__prev,this.tail.__next=null),e.batch=null,e.__next=null,e.__prev=null,this.dirty=!0},PIXI.WebGLBatch.prototype.split=function(e){this.dirty=!0;var t=new PIXI.WebGLBatch(this.gl);t.init(e),t.texture=this.texture,t.tail=this.tail,this.tail=e.__prev,this.tail.__next=null,e.__prev=null;var n=0;while(e)n++,e.batch=t,e=e.__next;return t.size=n,this.size-=n,t},PIXI.WebGLBatch.prototype.merge=function(e){this.dirty=!0,this.tail.__next=e.head,e.head.__prev=this.tail,this.size+=e.size,this.tail=e.tail;var t=e.head;while(t)t.batch=this,t=t.__next},PIXI.WebGLBatch.prototype.growBatch=function(){var e=this.gl;this.size==1?this.dynamicSize=1:this.dynamicSize=this.size*1.5,this.verticies=new Float32Array(this.dynamicSize*8),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.verticies,e.DYNAMIC_DRAW),this.uvs=new Float32Array(this.dynamicSize*8),e.bindBuffer(e.ARRAY_BUFFER,this.uvBuffer),e.bufferData(e.ARRAY_BUFFER,this.uvs,e.DYNAMIC_DRAW),this.dirtyUVS=!0,this.colors=new Float32Array(this.dynamicSize*4),e.bindBuffer(e.ARRAY_BUFFER,this.colorBuffer),e.bufferData(e.ARRAY_BUFFER,this.colors,e.DYNAMIC_DRAW),this.dirtyColors=!0,this.indices=new Uint16Array(this.dynamicSize*6);var t=this.indices.length/6;for(var n=0;n<t;n++){var r=n*6,i=n*4;this.indices[r+0]=i+0,this.indices[r+1]=i+1,this.indices[r+2]=i+2,this.indices[r+3]=i+0,this.indices[r+4]=i+2,this.indices[r+5]=i+3}e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indices,e.STATIC_DRAW)},PIXI.WebGLBatch.prototype.refresh=function(){var e=this.gl;this.dynamicSize<this.size&&this.growBatch();var t=0,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y=this.head;while(y){c=t*8;var b=y.texture,w=b.frame,E=b.baseTexture.width,S=b.baseTexture.height;this.uvs[c+0]=w.x/E,this.uvs[c+1]=w.y/S,this.uvs[c+2]=(w.x+w.width)/E,this.uvs[c+3]=w.y/S,this.uvs[c+4]=(w.x+w.width)/E,this.uvs[c+5]=(w.y+w.height)/S,this.uvs[c+6]=w.x/E,this.uvs[c+7]=(w.y+w.height)/S,y.updateFrame=!1,colorIndex=t*4,this.colors[colorIndex]=this.colors[colorIndex+1]=this.colors[colorIndex+2]=this.colors[colorIndex+3]=y.worldAlpha,y=y.__next,t++}this.dirtyUVS=!0,this.dirtyColors=!0},PIXI.WebGLBatch.prototype.update=function(){var e=this.gl,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b=0,w=this.head;while(w){if(w.vcount===PIXI.visibleCount){n=w.texture.frame.width,r=w.texture.frame.height,i=w.anchor.x,s=w.anchor.y,o=n*(1-i),u=n*-i,a=r*(1-s),f=r*-s,l=b*8,t=w.worldTransform,p=t[0],d=t[3],v=t[1],m=t[4],g=t[2],y=t[5],this.verticies[l+0]=p*u+v*f+g,this.verticies[l+1]=m*f+d*u+y,this.verticies[l+2]=p*o+v*f+g,this.verticies[l+3]=m*f+d*o+y,this.verticies[l+4]=p*o+v*a+g,this.verticies[l+5]=m*a+d*o+y,this.verticies[l+6]=p*u+v*a+g,this.verticies[l+7]=m*a+d*u+y;if(w.updateFrame||w.texture.updateFrame){this.dirtyUVS=!0;var E=w.texture,S=E.frame,x=E.baseTexture.width,T=E.baseTexture.height;this.uvs[l+0]=S.x/x,this.uvs[l+1]=S.y/T,this.uvs[l+2]=(S.x+S.width)/x,this.uvs[l+3]=S.y/T,this.uvs[l+4]=(S.x+S.width)/x,this.uvs[l+5]=(S.y+S.height)/T,this.uvs[l+6]=S.x/x,this.uvs[l+7]=(S.y+S.height)/T,w.updateFrame=!1}if(w.cacheAlpha!=w.worldAlpha){w.cacheAlpha=w.worldAlpha;var N=b*4;this.colors[N]=this.colors[N+1]=this.colors[N+2]=this.colors[N+3]=w.worldAlpha,this.dirtyColors=!0}}else l=b*8,this.verticies[l+0]=0,this.verticies[l+1]=0,this.verticies[l+2]=0,this.verticies[l+3]=0,this.verticies[l+4]=0,this.verticies[l+5]=0,this.verticies[l+6]=0,this.verticies[l+7]=0;b++,w=w.__next}},PIXI.WebGLBatch.prototype.render=function(e,t){e=e||0,t==undefined&&(t=this.size),this.dirty&&(this.refresh(),this.dirty=!1);if(this.size==0)return;this.update();var n=this.gl,r=PIXI.shaderProgram;n.useProgram(r),n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer),n.bufferSubData(n.ARRAY_BUFFER,0,this.verticies),n.vertexAttribPointer(r.vertexPositionAttribute,2,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,this.uvBuffer),this.dirtyUVS&&(this.dirtyUVS=!1,n.bufferSubData(n.ARRAY_BUFFER,0,this.uvs)),n.vertexAttribPointer(r.textureCoordAttribute,2,n.FLOAT,!1,0,0),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,this.texture._glTexture),n.bindBuffer(n.ARRAY_BUFFER,this.colorBuffer),this.dirtyColors&&(this.dirtyColors=!1,n.bufferSubData(n.ARRAY_BUFFER,0,this.colors)),n.vertexAttribPointer(r.colorAttribute,1,n.FLOAT,!1,0,0),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var i=t-e;n.drawElements(n.TRIANGLES,i*6,n.UNSIGNED_SHORT,e*2*6)},PIXI.WebGLGraphics=function(){},PIXI.WebGLGraphics.renderGraphics=function(e,t){var n=PIXI.gl;e._webGL||(e._webGL={points:[],indices:[],lastIndex:0,buffer:n.createBuffer(),indexBuffer:n.createBuffer()}),e.dirty&&(e.dirty=!1,e.clearDirty&&(e.clearDirty=!1,e._webGL.lastIndex=0,e._webGL.points=[],e._webGL.indices=[]),PIXI.WebGLGraphics.updateGraphics(e)),PIXI.activatePrimitiveShader();var r=PIXI.mat3.clone(e.worldTransform);PIXI.mat3.transpose(r),n.blendFunc(n.ONE,n.ONE_MINUS_SRC_ALPHA),n.uniformMatrix3fv(PIXI.primitiveProgram.translationMatrix,!1,r),n.uniform2f(PIXI.primitiveProgram.projectionVector,t.x,t.y),n.uniform1f(PIXI.primitiveProgram.alpha,e.worldAlpha),n.bindBuffer(n.ARRAY_BUFFER,e._webGL.buffer),n.vertexAttribPointer(PIXI.shaderProgram.vertexPositionAttribute,2,n.FLOAT,!1,0,0),n.vertexAttribPointer(PIXI.primitiveProgram.vertexPositionAttribute,2,n.FLOAT,!1,24,0),n.vertexAttribPointer(PIXI.primitiveProgram.colorAttribute,4,n.FLOAT,!1,24,8),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e._webGL.indexBuffer),n.drawElements(n.TRIANGLE_STRIP,e._webGL.indices.length,n.UNSIGNED_SHORT,0),PIXI.activateDefaultShader()},PIXI.WebGLGraphics.updateGraphics=function(e){for(var t=e._webGL.lastIndex;t<e.graphicsData.length;t++){var n=e.graphicsData[t];n.type==PIXI.Graphics.POLY?(n.fill&&n.points.length>3&&PIXI.WebGLGraphics.buildPoly(n,e._webGL),n.lineWidth>0&&PIXI.WebGLGraphics.buildLine(n,e._webGL)):n.type==PIXI.Graphics.RECT?PIXI.WebGLGraphics.buildRectangle(n,e._webGL):(n.type==PIXI.Graphics.CIRC||n.type==PIXI.Graphics.ELIP)&&PIXI.WebGLGraphics.buildCircle(n,e._webGL)}e._webGL.lastIndex=e.graphicsData.length;var r=PIXI.gl;e._webGL.glPoints=new Float32Array(e._webGL.points),r.bindBuffer(r.ARRAY_BUFFER,e._webGL.buffer),r.bufferData(r.ARRAY_BUFFER,e._webGL.glPoints,r.STATIC_DRAW),e._webGL.glIndicies=new Uint16Array(e._webGL.indices),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,e._webGL.indexBuffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,e._webGL.glIndicies,r.STATIC_DRAW)},PIXI.WebGLGraphics.buildRectangle=function(e,t){var n=e.points,r=n[0],i=n[1],s=n[2],o=n[3];if(e.fill){var u=HEXtoRGB(e.fillColor),a=e.fillAlpha,f=u[0]*a,l=u[1]*a,c=u[2]*a,h=t.points,p=t.indices,d=h.length/6;h.push(r,i),h.push(f,l,c,a),h.push(r+s,i),h.push(f,l,c,a),h.push(r,i+o),h.push(f,l,c,a),h.push(r+s,i+o),h.push(f,l,c,a),p.push(d,d,d+1,d+2,d+3,d+3)}e.lineWidth&&(e.points=[r,i,r+s,i,r+s,i+o,r,i+o,r,i],PIXI.WebGLGraphics.buildLine(e,t))},PIXI.WebGLGraphics.buildCircle=function(e,t){var n=e.points,r=n[0],i=n[1],s=n[2],o=n[3],u=40,a=Math.PI*2/u;if(e.fill){var f=HEXtoRGB(e.fillColor),l=e.fillAlpha,c=f[0]*l,h=f[1]*l,p=f[2]*l,d=t.points,v=t.indices,m=d.length/6;v.push(m);for(var g=0;g<u+1;g++)d.push(r,i,c,h,p,l),d.push(r+Math.sin(a*g)*s,i+Math.cos(a*g)*o,c,h,p,l),v.push(m++,m++);v.push(m-1)}if(e.lineWidth){e.points=[];for(var g=0;g<u+1;g++)e.points.push(r+Math.sin(a*g)*s,i+Math.cos(a*g)*o);PIXI.WebGLGraphics.buildLine(e,t)}},PIXI.WebGLGraphics.buildLine=function(e,t){var n=!0,r=e.points;if(r.length==0)return;var i=new PIXI.Point(r[0],r[1]),s=new PIXI.Point(r[r.length-2],r[r.length-1]);if(i.x==s.x&&i.y==s.y){r.pop(),r.pop(),s=new PIXI.Point(r[r.length-2],r[r.length-1]);var o=s.x+(i.x-s.x)*.5,u=s.y+(i.y-s.y)*.5;r.unshift(o,u),r.push(o,u)}var a=t.points,f=t.indices,l=r.length/2,c=r.length,h=a.length/6,p=e.lineWidth/2,d=HEXtoRGB(e.lineColor),v=e.lineAlpha,m=d[0]*v,g=d[1]*v,y=d[2]*v,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R;b=r[0],w=r[1],E=r[2],S=r[3],N=-(w-S),C=b-E,R=Math.sqrt(N*N+C*C),N/=R,C/=R,N*=p,C*=p,a.push(b-N,w-C,m,g,y,v),a.push(b+N,w+C,m,g,y,v);for(var U=1;U<l-1;U++)b=r[(U-1)*2],w=r[(U-1)*2+1],E=r[U*2],S=r[U*2+1],x=r[(U+1)*2],T=r[(U+1)*2+1],N=-(w-S),C=b-E,R=Math.sqrt(N*N+C*C),N/=R,C/=R,N*=p,C*=p,k=-(S-T),L=E-x,R=Math.sqrt(k*k+L*L),k/=R,L/=R,k*=p,L*=p,D=-C+w-(-C+S),P=-N+E-(-N+b),H=(-N+b)*(-C+S)-(-N+E)*(-C+w),B=-L+T-(-L+S),j=-k+E-(-k+x),F=(-k+x)*(-L+S)-(-k+E)*(-L+T),I=D*j-B*P,I==0&&(I+=1),px=(P*F-j*H)/I,py=(B*H-D*F)/I,q=(px-E)*(px-E)+(py-S)+(py-S),q>19600?(A=N-k,O=C-L,R=Math.sqrt(A*A+O*O),A/=R,O/=R,A*=p,O*=p,a.push(E-A,S-O),a.push(m,g,y,v),a.push(E+A,S+O),a.push(m,g,y,v),a.push(E-A,S-O),a.push(m,g,y,v),c++):(a.push(px,py),a.push(m,g,y,v),a.push(E-(px-E),S-(py-S)),a.push(m,g,y,v));b=r[(l-2)*2],w=r[(l-2)*2+1],E=r[(l-1)*2],S=r[(l-1)*2+1],N=-(w-S),C=b-E,R=Math.sqrt(N*N+C*C),N/=R,C/=R,N*=p,C*=p,a.push(E-N,S-C),a.push(m,g,y,v),a.push(E+N,S+C),a.push(m,g,y,v),f.push(h);for(var U=0;U<c;U++)f.push(h++);f.push(h-1)},PIXI.WebGLGraphics.buildPoly=function(e,t){var n=e.points;if(n.length<6)return;var r=t.points,i=t.indices,s=n.length/2,o=HEXtoRGB(e.fillColor),u=e.fillAlpha,a=o[0]*u,f=o[1]*u,l=o[2]*u,c=PIXI.PolyK.Triangulate(n),h=r.length/6;for(var p=0;p<c.length;p+=3)i.push(c[p]+h),i.push(c[p]+h),i.push(c[p+1]+h),i.push(c[p+2]+h),i.push(c[p+2]+h);for(var p=0;p<s;p++)r.push(n[p*2],n[p*2+1],a,f,l,u)},PIXI._defaultFrame=new PIXI.Rectangle(0,0,1,1),PIXI.gl,PIXI.WebGLRenderer=function(e,t,n,r,i){this.transparent=!!r,this.width=e||800,this.height=t||600,this.view=n||document.createElement("canvas"),this.view.width=this.width,this.view.height=this.height;var s=this;this.view.addEventListener("webglcontextlost",function(e){s.handleContextLost(e)},!1),this.view.addEventListener("webglcontextrestored",function(e){s.handleContextRestored(e)},!1),this.batchs=[];try{PIXI.gl=this.gl=this.view.getContext("experimental-webgl",{alpha:this.transparent,antialias:!!i,premultipliedAlpha:!1,stencil:!0})}catch(o){throw new Error(" This browser does not support webGL. Try using the canvas renderer"+this)}PIXI.initPrimitiveShader(),PIXI.initDefaultShader(),PIXI.initDefaultStripShader(),PIXI.activateDefaultShader();var u=this.gl;PIXI.WebGLRenderer.gl=u,this.batch=new PIXI.WebGLBatch(u),u.disable(u.DEPTH_TEST),u.disable(u.CULL_FACE),u.enable(u.BLEND),u.colorMask(!0,!0,!0,this.transparent),PIXI.projection=new PIXI.Point(400,300),this.resize(this.width,this.height),this.contextLost=!1,this.stageRenderGroup=new PIXI.WebGLRenderGroup(this.gl)},PIXI.WebGLRenderer.prototype.constructor=PIXI.WebGLRenderer,PIXI.WebGLRenderer.getBatch=function(){return PIXI._batchs.length==0?new PIXI.WebGLBatch(PIXI.WebGLRenderer.gl):PIXI._batchs.pop()},PIXI.WebGLRenderer.returnBatch=function(e){e.clean(),PIXI._batchs.push(e)},PIXI.WebGLRenderer.prototype.render=function(e){if(this.contextLost)return;this.__stage!==e&&(this.__stage=e,this.stageRenderGroup.setRenderable(e)),PIXI.WebGLRenderer.updateTextures(),PIXI.visibleCount++,e.updateTransform();var t=this.gl;t.colorMask(!0,!0,!0,this.transparent),t.viewport(0,0,this.width,this.height),t.bindFramebuffer(t.FRAMEBUFFER,null),t.clearColor(e.backgroundColorSplit[0],e.backgroundColorSplit[1],e.backgroundColorSplit[2],!this.transparent),t.clear(t.COLOR_BUFFER_BIT),this.stageRenderGroup.backgroundColor=e.backgroundColorSplit,this.stageRenderGroup.render(PIXI.projection),e.interactive&&(e._interactiveEventsAdded||(e._interactiveEventsAdded=!0,e.interactionManager.setTarget(this)));if(PIXI.Texture.frameUpdates.length>0){for(var n=0;n<PIXI.Texture.frameUpdates.length;n++)PIXI.Texture.frameUpdates[n].updateFrame=!1;PIXI.Texture.frameUpdates=[]}},PIXI.WebGLRenderer.updateTextures=function(){for(var e=0;e<PIXI.texturesToUpdate.length;e++)PIXI.WebGLRenderer.updateTexture(PIXI.texturesToUpdate[e]);for(var e=0;e<PIXI.texturesToDestroy.length;e++)PIXI.WebGLRenderer.destroyTexture(PIXI.texturesToDestroy[e]);PIXI.texturesToUpdate=[],PIXI.texturesToDestroy=[]},PIXI.WebGLRenderer.updateTexture=function(e){var t=PIXI.gl;e._glTexture||(e._glTexture=t.createTexture()),e.hasLoaded&&(t.bindTexture(t.TEXTURE_2D,e._glTexture),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e.source),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),e._powerOf2?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT)):(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)),t.bindTexture(t.TEXTURE_2D,null))},PIXI.WebGLRenderer.destroyTexture=function(e){var t=PIXI.gl;e._glTexture&&(e._glTexture=t.createTexture(),t.deleteTexture(t.TEXTURE_2D,e._glTexture))},PIXI.WebGLRenderer.prototype.resize=function(e,t){this.width=e,this.height=t,this.view.width=e,this.view.height=t,this.gl.viewport(0,0,this.width,this.height),PIXI.projection.x=this.width/2,PIXI.projection.y=this.height/2},PIXI.WebGLRenderer.prototype.handleContextLost=function(e){e.preventDefault(),this.contextLost=!0},PIXI.WebGLRenderer.prototype.handleContextRestored=function(e){this.gl=this.view.getContext("experimental-webgl",{alpha:!0}),this.initShaders();for(var t in PIXI.TextureCache){var n=PIXI.TextureCache[t].baseTexture;n._glTexture=null,PIXI.WebGLRenderer.updateTexture(n)}for(var r=0;r<this.batchs.length;r++)this.batchs[r].restoreLostContext(this.gl),this.batchs[r].dirty=!0;PIXI._restoreBatchs(this.gl),this.contextLost=!1},PIXI.WebGLRenderGroup=function(e){this.gl=e,this.root,this.backgroundColor,this.batchs=[],this.toRemove=[]},PIXI.WebGLRenderGroup.prototype.constructor=PIXI.WebGLRenderGroup,PIXI.WebGLRenderGroup.prototype.setRenderable=function(e){this.root&&this.removeDisplayObjectAndChildren(this.root),e.worldVisible=e.visible,this.root=e,this.addDisplayObjectAndChildren(e)},PIXI.WebGLRenderGroup.prototype.render=function(e){PIXI.WebGLRenderer.updateTextures();var t=this.gl;t.uniform2f(PIXI.shaderProgram.projectionVector,e.x,e.y),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA);var n;for(var r=0;r<this.batchs.length;r++){n=this.batchs[r];if(n instanceof PIXI.WebGLBatch){this.batchs[r].render();continue}var i=n.vcount===PIXI.visibleCount;n instanceof PIXI.TilingSprite?i&&this.renderTilingSprite(n,e):n instanceof PIXI.Strip?i&&this.renderStrip(n,e):n instanceof PIXI.Graphics?i&&n.renderable&&PIXI.WebGLGraphics.renderGraphics(n,e):n instanceof PIXI.FilterBlock&&(n.open?(t.enable(t.STENCIL_TEST),t.colorMask(!1,!1,!1,!1),t.stencilFunc(t.ALWAYS,1,255),t.stencilOp(t.KEEP,t.KEEP,t.REPLACE),PIXI.WebGLGraphics.renderGraphics(n.mask,e),t.colorMask(!0,!0,!0,!1),t.stencilFunc(t.NOTEQUAL,0,255),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)):t.disable(t.STENCIL_TEST))}},PIXI.WebGLRenderGroup.prototype.handleFilter=function(e,t){},PIXI.WebGLRenderGroup.prototype.renderSpecific=function(e,t){PIXI.WebGLRenderer.updateTextures();var n=this.gl;n.uniform2f(PIXI.shaderProgram.projectionVector,t.x,t.y);var r,i,s,o,u=e.first;while(u._iNext){u=u._iNext;if(u.renderable&&u.__renderGroup)break}var a=u.batch;if(u instanceof PIXI.Sprite){a=u.batch;var f=a.head,l=f;if(f==u)r=0;else{r=1;while(f.__next!=u)r++,f=f.__next}}else a=u;var c=e,h,p=e;while(p.children.length>0)p=p.children[p.children.length-1],p.renderable&&(c=p);if(c instanceof PIXI.Sprite){h=c.batch;var f=h.head;if(f==c)s=0;else{s=1;while(f.__next!=c)s++,f=f.__next}}else h=c;if(a==h){a instanceof PIXI.WebGLBatch?a.render(r,s+1):this.renderSpecial(a,t);return}i=this.batchs.indexOf(a),o=this.batchs.indexOf(h),a instanceof PIXI.WebGLBatch?a.render(r):this.renderSpecial(a,t);for(var d=i+1;d<o;d++)renderable=this.batchs[d],renderable instanceof PIXI.WebGLBatch?this.batchs[d].render():this.renderSpecial(renderable,t);h instanceof PIXI.WebGLBatch?h.render(0,s+1):this.renderSpecial(h,t)},PIXI.WebGLRenderGroup.prototype.renderSpecial=function(e,t){var n=e.vcount===PIXI.visibleCount;if(e instanceof PIXI.TilingSprite)n&&this.renderTilingSprite(e,t);else if(e instanceof PIXI.Strip)n&&this.renderStrip(e,t);else if(e instanceof PIXI.CustomRenderable)n&&e.renderWebGL(this,t);else if(e instanceof PIXI.Graphics)n&&e.renderable&&PIXI.WebGLGraphics.renderGraphics(e,t);else if(e instanceof PIXI.FilterBlock){var r=PIXI.gl;e.open?(r.enable(r.STENCIL_TEST),r.colorMask(!1,!1,!1,!1),r.stencilFunc(r.ALWAYS,1,255),r.stencilOp(r.KEEP,r.KEEP,r.REPLACE),PIXI.WebGLGraphics.renderGraphics(e.mask,t),r.colorMask(!0,!0,!0,!0),r.stencilFunc(r.NOTEQUAL,0,255),r.stencilOp(r.KEEP,r.KEEP,r.KEEP)):r.disable(r.STENCIL_TEST)}},PIXI.WebGLRenderGroup.prototype.updateTexture=function(e){this.removeObject(e);var t=e.first;while(t!=this.root){t=t._iPrev;if(t.renderable&&t.__renderGroup)break}var n=e.last;while(n._iNext){n=n._iNext;if(n.renderable&&n.__renderGroup)break}this.insertObject(e,t,n)},PIXI.WebGLRenderGroup.prototype.addFilterBlocks=function(e,t){e.__renderGroup=this,t.__renderGroup=this;var n=e;while(n!=this.root){n=n._iPrev;if(n.renderable&&n.__renderGroup)break}this.insertAfter(e,n);var r=t;while(r!=this.root){r=r._iPrev;if(r.renderable&&r.__renderGroup)break}this.insertAfter(t,r)},PIXI.WebGLRenderGroup.prototype.removeFilterBlocks=function(e,t){this.removeObject(e),this.removeObject(t)},PIXI.WebGLRenderGroup.prototype.addDisplayObjectAndChildren=function(e){e.__renderGroup&&e.__renderGroup.removeDisplayObjectAndChildren(e);var t=e.first;while(t!=this.root.first){t=t._iPrev;if(t.renderable&&t.__renderGroup)break}var n=e.last;while(n._iNext){n=n._iNext;if(n.renderable&&n.__renderGroup)break}var r=e.first,i=e.last._iNext;do r.__renderGroup=this,r.renderable&&(this.insertObject(r,t,n),t=r),r=r._iNext;while(r!=i)},PIXI.WebGLRenderGroup.prototype.removeDisplayObjectAndChildren=function(e){if(e.__renderGroup!=this)return;var t=e.last;do e.__renderGroup=null,e.renderable&&this.removeObject(e),e=e._iNext;while(e)},PIXI.WebGLRenderGroup.prototype.insertObject=function(e,t,n){var r=t,i=n;if(e instanceof PIXI.Sprite){var s,o;if(r instanceof PIXI.Sprite){s=r.batch;if(s&&s.texture==e.texture.baseTexture&&s.blendMode==e.blendMode){s.insertAfter(e,r);return}}else s=r;if(i)if(i instanceof PIXI.Sprite){o=i.batch;if(o){if(o.texture==e.texture.baseTexture&&o.blendMode==e.blendMode){o.insertBefore(e,i);return}if(o==s){var u=s.split(i),a=PIXI.WebGLRenderer.getBatch(),f=this.batchs.indexOf(s);a.init(e),this.batchs.splice(f+1,0,a,u);return}}}else o=i;var a=PIXI.WebGLRenderer.getBatch();a.init(e);if(s){var f=this.batchs.indexOf(s);this.batchs.splice(f+1,0,a)}else this.batchs.push(a);return}e instanceof PIXI.TilingSprite?this.initTilingSprite(e):e instanceof PIXI.Strip?this.initStrip(e):e,this.insertAfter(e,r)},PIXI.WebGLRenderGroup.prototype.insertAfter=function(e,t){if(t instanceof PIXI.Sprite){var n=t.batch;if(n)if(n.tail==t){var r=this.batchs.indexOf(n);this.batchs.splice(r+1,0,e)}else{var i=n.split(t.__next),r=this.batchs.indexOf(n);this.batchs.splice(r+1,0,e,i)}else this.batchs.push(e)}else{var r=this.batchs.indexOf(t);this.batchs.splice(r+1,0,e)}},PIXI.WebGLRenderGroup.prototype.removeObject=function(e){var t;if(e instanceof PIXI.Sprite){var n=e.batch;if(!n)return;n.remove(e),n.size==0&&(t=n)}else t=e;if(t){var r=this.batchs.indexOf(t);if(r==-1)return;if(r==0||r==this.batchs.length-1){this.batchs.splice(r,1),t instanceof PIXI.WebGLBatch&&PIXI.WebGLRenderer.returnBatch(t);return}if(this.batchs[r-1]instanceof PIXI.WebGLBatch&&this.batchs[r+1]instanceof PIXI.WebGLBatch&&this.batchs[r-1].texture==this.batchs[r+1].texture&&this.batchs[r-1].blendMode==this.batchs[r+1].blendMode){this.batchs[r-1].merge(this.batchs[r+1]),t instanceof PIXI.WebGLBatch&&PIXI.WebGLRenderer.returnBatch(t),PIXI.WebGLRenderer.returnBatch(this.batchs[r+1]),this.batchs.splice(r,2);return}this.batchs.splice(r,1),t instanceof PIXI.WebGLBatch&&PIXI.WebGLRenderer.returnBatch(t)}},PIXI.WebGLRenderGroup.prototype.initTilingSprite=function(e){var t=this.gl;e.verticies=new Float32Array([0,0,e.width,0,e.width,e.height,0,e.height]),e.uvs=new Float32Array([0,0,1,0,1,1,0,1]),e.colors=new Float32Array([1,1,1,1]),e.indices=new Uint16Array([0,1,3,2]),e._vertexBuffer=t.createBuffer(),e._indexBuffer=t.createBuffer(),e._uvBuffer=t.createBuffer(),e._colorBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,e._vertexBuffer),t.bufferData(t.ARRAY_BUFFER,e.verticies,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,e._uvBuffer),t.bufferData(t.ARRAY_BUFFER,e.uvs,t.DYNAMIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,e._colorBuffer),t.bufferData(t.ARRAY_BUFFER,e.colors,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e._indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,e.indices,t.STATIC_DRAW),e.texture.baseTexture._glTexture?(t.bindTexture(t.TEXTURE_2D,e.texture.baseTexture._glTexture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),e.texture.baseTexture._powerOf2=!0):e.texture.baseTexture._powerOf2=!0},PIXI.WebGLRenderGroup.prototype.renderStrip=function(e,t){var n=this.gl,r=PIXI.shaderProgram;n.useProgram(PIXI.stripShaderProgram);var i=PIXI.mat3.clone(e.worldTransform);PIXI.mat3.transpose(i),n.uniformMatrix3fv(PIXI.stripShaderProgram.translationMatrix,!1,i),n.uniform2f(PIXI.stripShaderProgram.projectionVector,t.x,t.y),n.uniform1f(PIXI.stripShaderProgram.alpha,e.worldAlpha),e.dirty?(e.dirty=!1,n.bindBuffer(n.ARRAY_BUFFER,e._vertexBuffer),n.bufferData(n.ARRAY_BUFFER,e.verticies,n.STATIC_DRAW),n.vertexAttribPointer(r.vertexPositionAttribute,2,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,e._uvBuffer),n.bufferData(n.ARRAY_BUFFER,e.uvs,n.STATIC_DRAW),n.vertexAttribPointer(r.textureCoordAttribute,2,n.FLOAT,!1,0,0),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,e.texture.baseTexture._glTexture),n.bindBuffer(n.ARRAY_BUFFER,e._colorBuffer),n.bufferData(n.ARRAY_BUFFER,e.colors,n.STATIC_DRAW),n.vertexAttribPointer(r.colorAttribute,1,n.FLOAT,!1,0,0),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e._indexBuffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,e.indices,n.STATIC_DRAW)):(n.bindBuffer(n.ARRAY_BUFFER,e._vertexBuffer),n.bufferSubData(n.ARRAY_BUFFER,0,e.verticies),n.vertexAttribPointer(r.vertexPositionAttribute,2,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,e._uvBuffer),n.vertexAttribPointer(r.textureCoordAttribute,2,n.FLOAT,!1,0,0),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,e.texture.baseTexture._glTexture),n.bindBuffer(n.ARRAY_BUFFER,e._colorBuffer),n.vertexAttribPointer(r.colorAttribute,1,n.FLOAT,!1,0,0),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e._indexBuffer)),n.drawElements(n.TRIANGLE_STRIP,e.indices.length,n.UNSIGNED_SHORT,0),n.useProgram(PIXI.shaderProgram)},PIXI.WebGLRenderGroup.prototype.renderTilingSprite=function(e,t){var n=this.gl,r=PIXI.shaderProgram,i=e.tilePosition,s=e.tileScale,o=i.x/e.texture.baseTexture.width,u=i.y/e.texture.baseTexture.height,a=e.width/e.texture.baseTexture.width/s.x,f=e.height/e.texture.baseTexture.height/s.y;e.uvs[0]=0-o,e.uvs[1]=0-u,e.uvs[2]=1*a-o,e.uvs[3]=0-u,e.uvs[4]=1*a-o,e.uvs[5]=1*f-u,e.uvs[6]=0-o,e.uvs[7]=1*f-u,n.bindBuffer(n.ARRAY_BUFFER,e._uvBuffer),n.bufferSubData(n.ARRAY_BUFFER,0,e.uvs),this.renderStrip(e,t)},PIXI.WebGLRenderGroup.prototype.initStrip=function(e){var t=this.gl,n=this.shaderProgram;e._vertexBuffer=t.createBuffer(),e._indexBuffer=t.createBuffer(),e._uvBuffer=t.createBuffer(),e._colorBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,e._vertexBuffer),t.bufferData(t.ARRAY_BUFFER,e.verticies,t.DYNAMIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,e._uvBuffer),t.bufferData(t.ARRAY_BUFFER,e.uvs,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,e._colorBuffer),t.bufferData(t.ARRAY_BUFFER,e.colors,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e._indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,e.indices,t.STATIC_DRAW)},PIXI.shaderFragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y));","gl_FragColor = gl_FragColor * vColor;","}"],PIXI.shaderVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform vec2 projectionVector;","varying vec2 vTextureCoord;","varying float vColor;","void main(void) {","gl_Position = vec4( aVertexPosition.x / projectionVector.x -1.0, aVertexPosition.y / -projectionVector.y + 1.0 , 0.0, 1.0);","vTextureCoord = aTextureCoord;","vColor = aColor;","}"],PIXI.stripShaderFragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying float vColor;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y));","gl_FragColor = gl_FragColor * alpha;","}"],PIXI.stripShaderVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","varying vec2 vTextureCoord;","varying float vColor;","void main(void) {","vec3 v = translationMatrix * vec3(aVertexPosition, 1.0);","gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","vTextureCoord = aTextureCoord;","vColor = aColor;","}"],PIXI.primitiveShaderFragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","gl_FragColor = vColor;","}"],PIXI.primitiveShaderVertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform float alpha;","varying vec4 vColor;","void main(void) {","vec3 v = translationMatrix * vec3(aVertexPosition, 1.0);","gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","vColor = aColor  * alpha;","}"],PIXI.initPrimitiveShader=function(){var e=PIXI.gl,t=PIXI.compileProgram(PIXI.primitiveShaderVertexSrc,PIXI.primitiveShaderFragmentSrc);e.useProgram(t),t.vertexPositionAttribute=e.getAttribLocation(t,"aVertexPosition"),t.colorAttribute=e.getAttribLocation(t,"aColor"),t.projectionVector=e.getUniformLocation(t,"projectionVector"),t.translationMatrix=e.getUniformLocation(t,"translationMatrix"),t.alpha=e.getUniformLocation(t,"alpha"),PIXI.primitiveProgram=t},PIXI.initDefaultShader=function(){var e=this.gl,t=PIXI.compileProgram(PIXI.shaderVertexSrc,PIXI.shaderFragmentSrc);e.useProgram(t),t.vertexPositionAttribute=e.getAttribLocation(t,"aVertexPosition"),t.projectionVector=e.getUniformLocation(t,"projectionVector"),t.textureCoordAttribute=e.getAttribLocation(t,"aTextureCoord"),t.colorAttribute=e.getAttribLocation(t,"aColor"),t.samplerUniform=e.getUniformLocation(t,"uSampler"),PIXI.shaderProgram=t},PIXI.initDefaultStripShader=function(){var e=this.gl,t=PIXI.compileProgram(PIXI.stripShaderVertexSrc,PIXI.stripShaderFragmentSrc);e.useProgram(t),t.vertexPositionAttribute=e.getAttribLocation(t,"aVertexPosition"),t.projectionVector=e.getUniformLocation(t,"projectionVector"),t.textureCoordAttribute=e.getAttribLocation(t,"aTextureCoord"),t.translationMatrix=e.getUniformLocation(t,"translationMatrix"),t.alpha=e.getUniformLocation(t,"alpha"),t.colorAttribute=e.getAttribLocation(t,"aColor"),t.projectionVector=e.getUniformLocation(t,"projectionVector"),t.samplerUniform=e.getUniformLocation(t,"uSampler"),PIXI.stripShaderProgram=t},PIXI.CompileVertexShader=function(e,t){return PIXI._CompileShader(e,t,e.VERTEX_SHADER)},PIXI.CompileFragmentShader=function(e,t){return PIXI._CompileShader(e,t,e.FRAGMENT_SHADER)},PIXI._CompileShader=function(e,t,n){var r=t.join("\n"),i=e.createShader(n);return e.shaderSource(i,r),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS)?i:(alert(e.getShaderInfoLog(i)),null)},PIXI.compileProgram=function(e,t){var n=PIXI.gl,r=PIXI.CompileFragmentShader(n,t),i=PIXI.CompileVertexShader(n,e),s=n.createProgram();return n.attachShader(s,i),n.attachShader(s,r),n.linkProgram(s),n.getProgramParameter(s,n.LINK_STATUS)||alert("Could not initialise shaders"),s},PIXI.activateDefaultShader=function(){var e=PIXI.gl,t=PIXI.shaderProgram;e.useProgram(t),e.enableVertexAttribArray(t.vertexPositionAttribute),e.enableVertexAttribArray(t.textureCoordAttribute),e.enableVertexAttribArray(t.colorAttribute)},PIXI.activatePrimitiveShader=function(){var e=PIXI.gl;e.disableVertexAttribArray(PIXI.shaderProgram.textureCoordAttribute),e.disableVertexAttribArray(PIXI.shaderProgram.colorAttribute),e.useProgram(PIXI.primitiveProgram),e.enableVertexAttribArray(PIXI.primitiveProgram.vertexPositionAttribute),e.enableVertexAttribArray(PIXI.primitiveProgram.colorAttribute)},PIXI.BitmapText=function(e,t){PIXI.DisplayObjectContainer.call(this),this.setText(e),this.setStyle(t),this.updateText(),this.dirty=!1},PIXI.BitmapText.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),PIXI.BitmapText.prototype.constructor=PIXI.BitmapText,PIXI.BitmapText.prototype.setText=function(e){this.text=e||" ",this.dirty=!0},PIXI.BitmapText.prototype.setStyle=function(e){e=e||{},e.align=e.align||"left",this.style=e;var t=e.font.split(" ");this.fontName=t[t.length-1],this.fontSize=t.length>=2?parseInt(t[t.length-2],10):PIXI.BitmapText.fonts[this.fontName].size,this.dirty=!0},PIXI.BitmapText.prototype.updateText=function(){var e=PIXI.BitmapText.fonts[this.fontName],t=new PIXI.Point,n=null,r=[],i=0,s=[],o=0,u=this.fontSize/e.size;for(var a=0;a<this.text.length;a++){var f=this.text.charCodeAt(a);if(/(?:\r\n|\r|\n)/.test(this.text.charAt(a))){s.push(t.x),i=Math.max(i,t.x),o++,t.x=0,t.y+=e.lineHeight,n=null;continue}var l=e.chars[f];if(!l)continue;n&&l[n]&&(t.x+=l.kerning[n]),r.push({texture:l.texture,line:o,charCode:f,position:new PIXI.Point(t.x+l.xOffset,t.y+l.yOffset)}),t.x+=l.xAdvance,n=f}s.push(t.x),i=Math.max(i,t.x);var c=[];for(a=0;a<=o;a++){var h=0;this.style.align=="right"?h=i-s[a]:this.style.align=="center"&&(h=(i-s[a])/2),c.push(h)}for(a=0;a<r.length;a++){var p=new PIXI.Sprite(r[a].texture);p.position.x=(r[a].position.x+c[r[a].line])*u,p.position.y=r[a].position.y*u,p.scale.x=p.scale.y=u,this.addChild(p)}this.width=i*u,this.height=(t.y+e.lineHeight)*u},PIXI.BitmapText.prototype.updateTransform=function(){if(this.dirty){while(this.children.length>0)this.removeChild(this.getChildAt(0));this.updateText(),this.dirty=!1}PIXI.DisplayObjectContainer.prototype.updateTransform.call(this)},PIXI.BitmapText.fonts={},PIXI.Text=function(e,t){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),PIXI.Sprite.call(this,PIXI.Texture.fromCanvas(this.canvas)),this.setText(e),this.setStyle(t),this.updateText(),this.dirty=!1},PIXI.Text.prototype=Object.create(PIXI.Sprite.prototype),PIXI.Text.prototype.constructor=PIXI.Text,PIXI.Text.prototype.setStyle=function(e){e=e||{},e.font=e.font||"bold 20pt Arial",e.fill=e.fill||"black",e.align=e.align||"left",e.stroke=e.stroke||"black",e.strokeThickness=e.strokeThickness||0,e.wordWrap=e.wordWrap||!1,e.wordWrapWidth=e.wordWrapWidth||100,this.style=e,this.dirty=!0},PIXI.Sprite.prototype.setText=function(e){this.text=e.toString()||" ",this.dirty=!0},PIXI.Text.prototype.updateText=function(){this.context.font=this.style.font;var e=this.text;this.style.wordWrap&&(e=this.wordWrap(this.text));var t=e.split(/(?:\r\n|\r|\n)/),n=[],r=0;for(var i=0;i<t.length;i++){var s=this.context.measureText(t[i]).width;n[i]=s,r=Math.max(r,s)}this.canvas.width=r+this.style.strokeThickness;var o=this.determineFontHeight("font: "+this.style.font+";")+this.style.strokeThickness;this.canvas.height=o*t.length,this.context.fillStyle=this.style.fill,this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.lineWidth=this.style.strokeThickness,this.context.textBaseline="top";for(i=0;i<t.length;i++){var u=new PIXI.Point(this.style.strokeThickness/2,this.style.strokeThickness/2+i*o);this.style.align=="right"?u.x+=r-n[i]:this.style.align=="center"&&(u.x+=(r-n[i])/2),this.style.stroke&&this.style.strokeThickness&&this.context.strokeText(t[i],u.x,u.y),this.style.fill&&this.context.fillText(t[i],u.x,u.y)}this.updateTexture()},PIXI.Text.prototype.updateTexture=function(){this.texture.baseTexture.width=this.canvas.width,this.texture.baseTexture.height=this.canvas.height,this.texture.frame.width=this.canvas.width,this.texture.frame.height=this.canvas.height,this._width=this.canvas.width,this._height=this.canvas.height,PIXI.texturesToUpdate.push(this.texture.baseTexture)},PIXI.Text.prototype.updateTransform=function(){this.dirty&&(this.updateText(),this.dirty=!1),PIXI.Sprite.prototype.updateTransform.call(this)},PIXI.Text.prototype.determineFontHeight=function(e){var t=PIXI.Text.heightCache[e];if(!t){var n=document.getElementsByTagName("body")[0],r=document.createElement("div"),i=document.createTextNode("M");r.appendChild(i),r.setAttribute("style",e+";position:absolute;top:0;left:0"),n.appendChild(r),t=r.offsetHeight,PIXI.Text.heightCache[e]=t,n.removeChild(r)}return t},PIXI.Text.prototype.wordWrap=function(e){var t=function(e,t,n,r,i){var s=Math.floor((r-n)/2)+n;return s==n?1:e.measureText(t.substring(0,s)).width<=i?e.measureText(t.substring(0,s+1)).width>i?s:arguments.callee(e,t,s,r,i):arguments.callee(e,t,n,s,i)},n=function(e,n,r){if(e.measureText(n).width<=r||n.length<1)return n;var i=t(e,n,0,n.length,r);return n.substring(0,i)+"\n"+arguments.callee(e,n.substring(i),r)},r="",i=e.split("\n");for(var s=0;s<i.length;s++)r+=n(this.context,i[s],this.style.wordWrapWidth)+"\n";return r},PIXI.Text.prototype.destroy=function(e){e&&this.texture.destroy()},PIXI.Text.heightCache={},PIXI.BaseTextureCache={},PIXI.texturesToUpdate=[],PIXI.texturesToDestroy=[],PIXI.BaseTexture=function(e){PIXI.EventTarget.call(this),this.width=100,this.height=100,this.hasLoaded=!1,this.source=e;if(!e)return;if(this.source instanceof Image||this.source instanceof HTMLImageElement)if(this.source.complete)this.hasLoaded=!0,this.width=this.source.width,this.height=this.source.height,PIXI.texturesToUpdate.push(this);else{var t=this;this.source.onload=function(){t.hasLoaded=!0,t.width=t.source.width,t.height=t.source.height,PIXI.texturesToUpdate.push(t),t.dispatchEvent({type:"loaded",content:t})}}else this.hasLoaded=!0,this.width=this.source.width,this.height=this.source.height,PIXI.texturesToUpdate.push(this);this._powerOf2=!1},PIXI.BaseTexture.prototype.constructor=PIXI.BaseTexture,PIXI.BaseTexture.prototype.destroy=function(){this.source instanceof Image&&(this.source.src=null),this.source=null,PIXI.texturesToDestroy.push(this)},PIXI.BaseTexture.fromImage=function(e,t){var n=PIXI.BaseTextureCache[e];if(!n){var r=new Image;t&&(r.crossOrigin=""),r.src=e,n=new PIXI.BaseTexture(r),PIXI.BaseTextureCache[e]=n}return n},PIXI.TextureCache={},PIXI.FrameCache={},PIXI.Texture=function(e,t){PIXI.EventTarget.call(this),t||(this.noFrame=!0,t=new PIXI.Rectangle(0,0,1,1)),e instanceof PIXI.Texture&&(e=e.baseTexture),this.baseTexture=e,this.frame=t,this.trim=new PIXI.Point,this.scope=this;if(e.hasLoaded)this.noFrame&&(t=new PIXI.Rectangle(0,0,e.width,e.height)),this.setFrame(t);else{var n=this;e.addEventListener("loaded",function(){n.onBaseTextureLoaded()})}},PIXI.Texture.prototype.constructor=PIXI.Texture,PIXI.Texture.prototype.onBaseTextureLoaded=function(e){var t=this.baseTexture;t.removeEventListener("loaded",this.onLoaded),this.noFrame&&(this.frame=new PIXI.Rectangle(0,0,t.width,t.height)),this.noFrame=!1,this.width=this.frame.width,this.height=this.frame.height,this.scope.dispatchEvent({type:"update",content:this})},PIXI.Texture.prototype.destroy=function(e){e&&this.baseTexture.destroy()},PIXI.Texture.prototype.setFrame=function(e){this.frame=e,this.width=e.width,this.height=e.height;if(e.x+e.width>this.baseTexture.width||e.y+e.height>this.baseTexture.height)throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);this.updateFrame=!0,PIXI.Texture.frameUpdates.push(this)},PIXI.Texture.fromImage=function(e,t){var n=PIXI.TextureCache[e];return n||(n=new PIXI.Texture(PIXI.BaseTexture.fromImage(e,t)),PIXI.TextureCache[e]=n),n},PIXI.Texture.fromFrame=function(e){var t=PIXI.TextureCache[e];if(!t)throw new Error("The frameId '"+e+"' does not exist in the texture cache "+this);return t},PIXI.Texture.fromCanvas=function(e){var t=new PIXI.BaseTexture(e);return new PIXI.Texture(t)},PIXI.Texture.addTextureToCache=function(e,t){PIXI.TextureCache[t]=e},PIXI.Texture.removeTextureFromCache=function(e){var t=PIXI.TextureCache[e];return PIXI.TextureCache[e]=null,t},PIXI.Texture.frameUpdates=[],PIXI.RenderTexture=function(e,t){PIXI.EventTarget.call(this),this.width=e||100,this.height=t||100,this.indetityMatrix=PIXI.mat3.create(),this.frame=new PIXI.Rectangle(0,0,this.width,this.height),PIXI.gl?this.initWebGL():this.initCanvas()},PIXI.RenderTexture.prototype=Object.create(PIXI.Texture.prototype),PIXI.RenderTexture.prototype.constructor=PIXI.RenderTexture,PIXI.RenderTexture.prototype.initWebGL=function(){var e=PIXI.gl;this.glFramebuffer=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,this.glFramebuffer),this.glFramebuffer.width=this.width,this.glFramebuffer.height=this.height,this.baseTexture=new PIXI.BaseTexture,this.baseTexture.width=this.width,this.baseTexture.height=this.height,this.baseTexture._glTexture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.baseTexture._glTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.width,this.height,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),this.baseTexture.isRender=!0,e.bindFramebuffer(e.FRAMEBUFFER,this.glFramebuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.baseTexture._glTexture,0),this.projection=new PIXI.Point(this.width/2,this.height/2),this.render=this.renderWebGL},PIXI.RenderTexture.prototype.resize=function(e,t){this.width=e,this.height=t;if(PIXI.gl){this.projection.x=this.width/2,this.projection.y=this.height/2;var n=PIXI.gl;n.bindTexture(n.TEXTURE_2D,this.baseTexture._glTexture),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,this.width,this.height,0,n.RGBA,n.UNSIGNED_BYTE,null)}else this.frame.width=this.width,this.frame.height=this.height,this.renderer.resize(this.width,this.height)},PIXI.RenderTexture.prototype.initCanvas=function(){this.renderer=new PIXI.CanvasRenderer(this.width,this.height,null,0),this.baseTexture=new PIXI.BaseTexture(this.renderer.view),this.frame=new PIXI.Rectangle(0,0,this.width,this.height),this.render=this.renderCanvas},PIXI.RenderTexture.prototype.renderWebGL=function(e,t,n){var r=PIXI.gl;r.colorMask(!0,!0,!0,!0),r.viewport(0,0,this.width,this.height),r.bindFramebuffer(r.FRAMEBUFFER,this.glFramebuffer),n&&(r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT));var i=e.children,s=e.worldTransform;e.worldTransform=PIXI.mat3.create(),e.worldTransform[4]=-1,e.worldTransform[5]=this.projection.y*2,t&&(e.worldTransform[2]=t.x,e.worldTransform[5]-=t.y),PIXI.visibleCount++,e.vcount=PIXI.visibleCount;for(var o=0,u=i.length;o<u;o++)i[o].updateTransform();var a=e.__renderGroup;a?e==a.root?a.render(this.projection):a.renderSpecific(e,this.projection):(this.renderGroup||(this.renderGroup=new PIXI.WebGLRenderGroup(r)),this.renderGroup.setRenderable(e),this.renderGroup.render(this.projection)),e.worldTransform=s},PIXI.RenderTexture.prototype.renderCanvas=function(e,t,n){var r=e.children;e.worldTransform=PIXI.mat3.create(),t&&(e.worldTransform[2]=t.x,e.worldTransform[5]=t.y);for(var i=0,s=r.length;i<s;i++)r[i].updateTransform();n&&this.renderer.context.clearRect(0,0,this.width,this.height),this.renderer.renderDisplayObject(e),this.renderer.context.setTransform(1,0,0,1,0,0)},PIXI.EventTarget=function(){var e={};this.addEventListener=this.on=function(t,n){e[t]===undefined&&(e[t]=[]),e[t].indexOf(n)===-1&&e[t].push(n)},this.dispatchEvent=this.emit=function(t){for(var n in e[t.type])e[t.type][n](t)},this.removeEventListener=this.off=function(t,n){var r=e[t].indexOf(n);r!==-1&&e[t].splice(r,1)}},PIXI.PolyK={},PIXI.PolyK.Triangulate=function(e){var t=!0,n=e.length>>1;if(n<3)return[];var r=[],i=[];for(var s=0;s<n;s++)i.push(s);var s=0,o=n;while(o>3){var u=i[(s+0)%o],a=i[(s+1)%o],f=i[(s+2)%o],l=e[2*u],c=e[2*u+1],h=e[2*a],p=e[2*a+1],d=e[2*f],v=e[2*f+1],m=!1;if(PIXI.PolyK._convex(l,c,h,p,d,v,t)){m=!0;for(var g=0;g<o;g++){var y=i[g];if(y==u||y==a||y==f)continue;if(PIXI.PolyK._PointInTriangle(e[2*y],e[2*y+1],l,c,h,p,d,v)){m=!1;break}}}if(m)r.push(u,a,f),i.splice((s+1)%o,1),o--,s=0;else if(s++>3*o){if(!t)return console.log("PIXI Warning: shape too complex to fill"),[];var r=[];i=[];for(var s=0;s<n;s++)i.push(s);s=0,o=n,t=!1}}return r.push(i[0],i[1],i[2]),r},PIXI.PolyK._PointInTriangle=function(e,t,n,r,i,s,o,u){var a=o-n,f=u-r,l=i-n,c=s-r,h=e-n,p=t-r,d=a*a+f*f,v=a*l+f*c,m=a*h+f*p,g=l*l+c*c,y=l*h+c*p,b=1/(d*g-v*v),w=(g*m-v*y)*b,E=(d*y-v*m)*b;return w>=0&&E>=0&&w+E<1},PIXI.PolyK._convex=function(e,t,n,r,i,s,o){return(t-r)*(i-n)+(n-e)*(s-r)>=0==o},Phaser.Camera=function(e,t,n,r,i,s){this.game=e,this.world=e.world,this.id=0,this.view=new Phaser.Rectangle(n,r,i,s),this.screenView=new Phaser.Rectangle(n,r,i,s),this.deadzone=null,this.visible=!0,this.atLimit={x:!1,y:!1},this.target=null,this._edge=0},Phaser.Camera.FOLLOW_LOCKON=0,Phaser.Camera.FOLLOW_PLATFORMER=1,Phaser.Camera.FOLLOW_TOPDOWN=2,Phaser.Camera.FOLLOW_TOPDOWN_TIGHT=3,Phaser.Camera.prototype={follow:function(e,t){typeof t=="undefined"&&(t=Phaser.Camera.FOLLOW_LOCKON),this.target=e;var n;switch(t){case Phaser.Camera.FOLLOW_PLATFORMER:var r=this.width/8,i=this.height/3;this.deadzone=new Phaser.Rectangle((this.width-r)/2,(this.height-i)/2-i*.25,r,i);break;case Phaser.Camera.FOLLOW_TOPDOWN:n=Math.max(this.width,this.height)/4,this.deadzone=new Phaser.Rectangle((this.width-n)/2,(this.height-n)/2,n,n);break;case Phaser.Camera.FOLLOW_TOPDOWN_TIGHT:n=Math.max(this.width,this.height)/8,this.deadzone=new Phaser.Rectangle((this.width-n)/2,(this.height-n)/2,n,n);break;case Phaser.Camera.FOLLOW_LOCKON:default:this.deadzone=null}},focusOnXY:function(e,t){this.view.x=Math.round(e-this.view.halfWidth),this.view.y=Math.round(t-this.view.halfHeight)},update:function(){this.target!==null&&(this.deadzone?(this._edge=this.target.x-this.deadzone.x,this.view.x>this._edge&&(this.view.x=this._edge),this._edge=this.target.x+this.target.width-this.deadzone.x-this.deadzone.width,this.view.x<this._edge&&(this.view.x=this._edge),this._edge=this.target.y-this.deadzone.y,this.view.y>this._edge&&(this.view.y=this._edge),this._edge=this.target.y+this.target.height-this.deadzone.y-this.deadzone.height,this.view.y<this._edge&&(this.view.y=this._edge)):this.focusOnXY(this.target.x,this.target.y)),this.checkWorldBounds()},checkWorldBounds:function(){this.atLimit.x=!1,this.atLimit.y=!1,this.view.x<this.world.bounds.left&&(this.atLimit.x=!0,this.view.x=this.world.bounds.left),this.view.x>this.world.bounds.right-this.width&&(this.atLimit.x=!0,this.view.x=this.world.bounds.right-this.width+1),this.view.y<this.world.bounds.top&&(this.atLimit.y=!0,this.view.y=this.world.bounds.top),this.view.y>this.world.bounds.bottom-this.height&&(this.atLimit.y=!0,this.view.y=this.world.bounds.bottom-this.height+1),this.view.floor()},setPosition:function(e,t){this.view.x=e,this.view.y=t,this.checkWorldBounds()},setSize:function(e,t){this.view.width=e,this.view.height=t}},Object.defineProperty(Phaser.Camera.prototype,"x",{get:function(){return this.view.x},set:function(e){this.view.x=e,this.checkWorldBounds()}}),Object.defineProperty(Phaser.Camera.prototype,"y",{get:function(){return this.view.y},set:function(e){this.view.y=e,this.checkWorldBounds()}}),Object.defineProperty(Phaser.Camera.prototype,"width",{get:function(){return this.view.width},set:function(e){this.view.width=e}}),Object.defineProperty(Phaser.Camera.prototype,"height",{get:function(){return this.view.height},set:function(e){this.view.height=e}}),Phaser.State=function(){this.game=null,this.add=null,this.camera=null,this.cache=null,this.input=null,this.load=null,this.math=null,this.sound=null,this.stage=null,this.time=null,this.tweens=null,this.world=null,this.particles=null,this.physics=null},Phaser.State.prototype={preload:function(){},create:function(){},update:function(){},render:function(){},paused:function(){},destroy:function(){}},Phaser.StateManager=function(e,t){this.game=e,this.states={},t!==null&&(this._pendingState=t)},Phaser.StateManager.prototype={game:null,_pendingState:null,_created:!1,states:{},current:"",onInitCallback:null,onPreloadCallback:null,onCreateCallback:null,onUpdateCallback:null,onRenderCallback:null,onPreRenderCallback:null,onLoadUpdateCallback:null,onLoadRenderCallback:null,onPausedCallback:null,onShutDownCallback:null,boot:function(){this._pendingState!==null&&(typeof this._pendingState=="string"?this.start(this._pendingState,!1,!1):this.add("default",this._pendingState,!0))},add:function(e,t,n){typeof n=="undefined"&&(n=!1);var r;return t instanceof Phaser.State?r=t:typeof t=="object"?(r=t,r.game=this.game):typeof t=="function"&&(r=new t(this.game)),this.states[e]=r,n&&(this.game.isBooted?this.start(e):this._pendingState=e),r},remove:function(e){this.current==e&&(this.callbackContext=null,this.onInitCallback=null,this.onShutDownCallback=null,this.onPreloadCallback=null,this.onLoadRenderCallback=null,this.onLoadUpdateCallback=null,this.onCreateCallback=null,this.onUpdateCallback=null,this.onRenderCallback=null,this.onPausedCallback=null,this.onDestroyCallback=null),delete this.states[e]},start:function(e,t,n){typeof t=="undefined"&&(t=!0),typeof n=="undefined"&&(n=!1);if(this.game.isBooted==0){this._pendingState=e;return}if(this.checkState(e)==0)return;this.current&&this.onShutDownCallback.call(this.callbackContext),t&&(this.game.world.destroy(),n==1&&this.game.cache.destroy()),this.setCurrentState(e),this.onPreloadCallback?(this.game.load.reset(),this.onPreloadCallback.call(this.callbackContext),this.game.load.queueSize==0?this.game.loadComplete():this.game.load.start()):this.game.loadComplete()},dummy:function(){},checkState:function(e){if(this.states[e]){var t=!1;return this.states[e].preload&&(t=!0),t==0&&this.states[e].loadRender&&(t=!0),t==0&&this.states[e].loadUpdate&&(t=!0),t==0&&this.states[e].create&&(t=!0),t==0&&this.states[e].update&&(t=!0),t==0&&this.states[e].preRender&&(t=!0),t==0&&this.states[e].render&&(t=!0),t==0&&this.states[e].paused&&(t=!0),t==0?(console.warn("Invalid Phaser State object given. Must contain at least a one of the required functions."),!1):!0}return console.warn("Phaser.StateManager - No state found with the key: "+e),!1},link:function(e){this.states[e].game=this.game,this.states[e].add=this.game.add,this.states[e].camera=this.game.camera,this.states[e].cache=this.game.cache,this.states[e].input=this.game.input,this.states[e].load=this.game.load,this.states[e].math=this.game.math,this.states[e].sound=this.game.sound,this.states[e].stage=this.game.stage,this.states[e].time=this.game.time,this.states[e].tweens=this.game.tweens,this.states[e].world=this.game.world,this.states[e].particles=this.game.particles,this.states[e].physics=this.game.physics,this.states[e].rnd=this.game.rnd},setCurrentState:function(e){this.callbackContext=this.states[e],this.link(e),this.onInitCallback=this.states[e].init||this.dummy,this.onPreloadCallback=this.states[e].preload||null,this.onLoadRenderCallback=this.states[e].loadRender||null,this.onLoadUpdateCallback=this.states[e].loadUpdate||null,this.onCreateCallback=this.states[e].create||null,this.onUpdateCallback=this.states[e].update||null,this.onPreRenderCallback=this.states[e].preRender||null,this.onRenderCallback=this.states[e].render||null,this.onPausedCallback=this.states[e].paused||null,this.onShutDownCallback=this.states[e].shutdown||this.dummy,this.current=e,this._created=!1,this.onInitCallback.call(this.callbackContext)},loadComplete:function(){this._created==0&&this.onCreateCallback&&this.onCreateCallback.call(this.callbackContext),this._created=!0},update:function(){this._created&&this.onUpdateCallback?this.onUpdateCallback.call(this.callbackContext):this.onLoadUpdateCallback&&this.onLoadUpdateCallback.call(this.callbackContext)},preRender:function(){this.onPreRenderCallback&&this.onPreRenderCallback.call(this.callbackContext)},render:function(){this._created&&this.onRenderCallback?this.onRenderCallback.call(this.callbackContext):this.onLoadRenderCallback&&this.onLoadRenderCallback.call(this.callbackContext)},destroy:function(){this.callbackContext=null,this.onInitCallback=null,this.onShutDownCallback=null,this.onPreloadCallback=null,this.onLoadRenderCallback=null,this.onLoadUpdateCallback=null,this.onCreateCallback=null,this.onUpdateCallback=null,this.onRenderCallback=null,this.onPausedCallback=null,this.onDestroyCallback=null,this.game=null,this.states={},this._pendingState=null}},Phaser.LinkedList=function(){this.next=null,this.prev=null,this.first=null,this.last=null,this.total=0},Phaser.LinkedList.prototype={add:function(e){if(this.total==0&&this.first==null&&this.last==null){this.first=e,this.last=e,this.next=e,e.prev=this,this.total++;return}return this.last.next=e,e.prev=this.last,this.last=e,this.total++,e},remove:function(e){if(this.first==null&&this.last==null)return;this.total--;if(this.first==e&&this.last==e){this.first=null,this.last=null,this.next=null,e.next=null,e.prev=null;return}var t=e.prev;e.next&&(e.next.prev=e.prev),t.next=e.next},callAll:function(e){if(!this.first||!this.last)return;var t=this.first;do t&&t[e]&&t[e].call(t),t=t.next;while(t!=this.last.next)},dump:function(){var e=20,t="\n"+Phaser.Utils.pad("Node",e)+"|"+Phaser.Utils.pad("Next",e)+"|"+Phaser.Utils.pad("Previous",e)+"|"+Phaser.Utils.pad("First",e)+"|"+Phaser.Utils.pad("Last",e);console.log(t);var t=Phaser.Utils.pad("----------",e)+"|"+Phaser.Utils.pad("----------",e)+"|"+Phaser.Utils.pad("----------",e)+"|"+Phaser.Utils.pad("----------",e)+"|"+Phaser.Utils.pad("----------",e);console.log(t);var n=this,r=n.last.next;n=n.first;do{var i=n.sprite.name||"*",s="-",o="-",u="-",a="-";n.next&&(s=n.next.sprite.name),n.prev&&(o=n.prev.sprite.name),n.first&&(u=n.first.sprite.name),n.last&&(a=n.last.sprite.name),typeof s=="undefined"&&(s="-"),typeof o=="undefined"&&(o="-"),typeof u=="undefined"&&(u="-"),typeof a=="undefined"&&(a="-");var t=Phaser.Utils.pad(i,e)+"|"+Phaser.Utils.pad(s,e)+"|"+Phaser.Utils.pad(o,e)+"|"+Phaser.Utils.pad(u,e)+"|"+Phaser.Utils.pad(a,e);console.log(t),n=n.next}while(n!=r)}},Phaser.Signal=function(){this._bindings=[],this._prevParams=null;var e=this;this.dispatch=function(){Phaser.Signal.prototype.dispatch.apply(e,arguments)}},Phaser.Signal.prototype={memorize:!1,_shouldPropagate:!0,active:!0,validateListener:function(e,t){if(typeof e!="function")throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",t))},_registerListener:function(e,t,n,r){var i=this._indexOfListener(e,n),s;if(i!==-1){s=this._bindings[i];if(s.isOnce()!==t)throw new Error("You cannot add"+(t?"":"Once")+"() then add"+(t?"Once":"")+"() the same listener without removing the relationship first.")}else s=new Phaser.SignalBinding(this,e,t,n,r),this._addBinding(s);return this.memorize&&this._prevParams&&s.execute(this._prevParams),s},_addBinding:function(e){var t=this._bindings.length;do--t;while(this._bindings[t]&&e._priority<=this._bindings[t]._priority);this._bindings.splice(t+1,0,e)},_indexOfListener:function(e,t){var n=this._bindings.length,r;while(n--){r=this._bindings[n];if(r._listener===e&&r.context===t)return n}return-1},has:function(e,t){return this._indexOfListener(e,t)!==-1},add:function(e,t,n){return this.validateListener(e,"add"),this._registerListener(e,!1,t,n)},addOnce:function(e,t,n){return this.validateListener(e,"addOnce"),this._registerListener(e,!0,t,n)},remove:function(e,t){this.validateListener(e,"remove");var n=this._indexOfListener(e,t);return n!==-1&&(this._bindings[n]._destroy(),this._bindings.splice(n,1)),e},removeAll:function(){var e=this._bindings.length;while(e--)this._bindings[e]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(e){if(!this.active)return;var t=Array.prototype.slice.call(arguments),n=this._bindings.length,r;this.memorize&&(this._prevParams=t);if(!n)return;r=this._bindings.slice(),this._shouldPropagate=!0;do n--;while(r[n]&&this._shouldPropagate&&r[n].execute(t)!==!1)},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Phaser.Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}},Phaser.SignalBinding=function(e,t,n,r,i){this._listener=t,this._isOnce=n,this.context=r,this._signal=e,this._priority=i||0},Phaser.SignalBinding.prototype={active:!0,params:null,execute:function(e){var t,n;return this.active&&!!this._listener&&(n=this.params?this.params.concat(e):e,t=this._listener.apply(this.context,n),this._isOnce&&this.detach()),t},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[Phaser.SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},Phaser.Plugin=function(e,t){this.game=e,this.parent=t,this.active=!1,this.visible=!1,this.hasPreUpdate=!1,this.hasUpdate=!1,this.hasRender=!1,this.hasPostRender=!1},Phaser.Plugin.prototype={preUpdate:function(){},update:function(){},render:function(){},postRender:function(){},destroy:function(){this.game=null,this.parent=null,this.active=!1,this.visible=!1}},Phaser.PluginManager=function(e,t){this.game=e,this._parent=t,this.plugins=[],this._pluginsLength=0},Phaser.PluginManager.prototype={add:function(e){var t=!1;typeof e=="function"?e=new e(this.game,this._parent):(e.game=this.game,e.parent=this._parent),typeof e["preUpdate"]=="function"&&(e.hasPreUpdate=!0,t=!0),typeof e["update"]=="function"&&(e.hasUpdate=!0,t=!0),typeof e["render"]=="function"&&(e.hasRender=!0,t=!0),typeof e["postRender"]=="function"&&(e.hasPostRender=!0,t=!0);if(t){if(e.hasPreUpdate||e.hasUpdate)e.active=!0;if(e.hasRender||e.hasPostRender)e.visible=!0;return this._pluginsLength=this.plugins.push(e),e}return null},remove:function(e){this._pluginsLength--},preUpdate:function(){if(this._pluginsLength==0)return;for(this._p=0;this._p<this._pluginsLength;this._p++)this.plugins[this._p].active&&this.plugins[this._p].hasPreUpdate&&this.plugins[this._p].preUpdate()},update:function(){if(this._pluginsLength==0)return;for(this._p=0;this._p<this._pluginsLength;this._p++)this.plugins[this._p].active&&this.plugins[this._p].hasUpdate&&this.plugins[this._p].update()},render:function(){if(this._pluginsLength==0)return;for(this._p=0;this._p<this._pluginsLength;this._p++)this.plugins[this._p].visible&&this.plugins[this._p].hasRender&&this.plugins[this._p].render()},postRender:function(){if(this._pluginsLength==0)return;for(this._p=0;this._p<this._pluginsLength;this._p++)this.plugins[this._p].visible&&this.plugins[this._p].hasPostRender&&this.plugins[this._p].postRender()},destroy:function(){this.plugins.length=0,this._pluginsLength=0,this.game=null,this._parent=null}},Phaser.Stage=function(e,t,n){this.game=e,this._backgroundColor="rgb(0,0,0)",this.offset=new Phaser.Point,this.canvas=Phaser.Canvas.create(t,n),this.canvas.style["-webkit-full-screen"]="width: 100%; height: 100%",this._stage=new PIXI.Stage(0,!1),this._stage.name="_stage_root",this.scaleMode=Phaser.StageScaleMode.NO_SCALE,this.scale=new Phaser.StageScaleMode(this.game,t,n),this.aspectRatio=t/n},Phaser.Stage.prototype={boot:function(){console.log("Phaser.Stage boot, offset:",this.offset),Phaser.Canvas.getOffset(this.canvas,this.offset),this.bounds=new Phaser.Rectangle(this.offset.x,this.offset.y,this.game.width,this.game.height);var e=this;this._onChange=function(t){return e.visibilityChange(t)},document.addEventListener("visibilitychange",this._onChange,!1),document.addEventListener("webkitvisibilitychange",this._onChange,!1),document.addEventListener("pagehide",this._onChange,!1),document.addEventListener("pageshow",this._onChange,!1),window.onblur=this._onChange,window.onfocus=this._onChange},visibilityChange:function(e){if(this.disableVisibilityChange)return;e.type=="pagehide"||e.type=="blur"||document["hidden"]==1||document["webkitHidden"]==1?this.game.paused=!0:this.game.paused=!1}},Object.defineProperty(Phaser.Stage.prototype,"backgroundColor",{get:function(){return this._backgroundColor},set:function(e){this._backgroundColor=e,typeof e=="string"&&(e=Phaser.Color.hexToRGB(e)),this._stage.setBackgroundColor(e)}}),Phaser.Group=function(e,t,n,r){t=t||null,typeof r=="undefined"&&(r=!1),this.game=e,this.name=n||"group",r?this._container=this.game.stage._stage:(this._container=new PIXI.DisplayObjectContainer,this._container.name=this.name,t?t instanceof Phaser.Group?t._container.addChild(this._container):t.addChild(this._container):this.game.stage._stage.addChild(this._container)),this.type=Phaser.GROUP,this.exists=!0,this._sortIndex="y"},Phaser.Group.prototype={add:function(e){return e.group!==this&&(e.group=this,e.events&&e.events.onAddedToGroup.dispatch(e,this),this._container.addChild(e)),e},addAt:function(e,t){return e.group!==this&&(e.group=this,e.events&&e.events.onAddedToGroup.dispatch(e,this),this._container.addChildAt(e,t)),e},getAt:function(e){return this._container.getChildAt(e)},create:function(e,t,n,r,i){typeof i=="undefined"&&(i=!0);var s=new Phaser.Sprite(this.game,e,t,n,r);return s.group=this,s.exists=i,s.events&&s.events.onAddedToGroup.dispatch(s,this),this._container.addChild(s),s},swap:function(e,t){if(e===t||!e.parent||!t.parent)return console.warn("You cannot swap a child with itself or swap un-parented children"),!1;var n=e._iPrev,r=e._iNext,i=t._iPrev,s=t._iNext,o=this._container.last._iNext,u=this.game.stage._stage;do u!==e&&u!==t&&(u.first===e?u.first=t:u.first===t&&(u.first=e),u.last===e?u.last=t:u.last===t&&(u.last=e)),u=u._iNext;while(u!=o);return e._iNext==t?(e._iNext=s,e._iPrev=t,t._iNext=e,t._iPrev=n,n&&(n._iNext=t),s&&(s._iPrev=e),e.__renderGroup&&e.__renderGroup.updateTexture(e),t.__renderGroup&&t.__renderGroup.updateTexture(t),!0):t._iNext==e?(e._iNext=t,e._iPrev=i,t._iNext=r,t._iPrev=e,i&&(i._iNext=e),r&&(s._iPrev=t),e.__renderGroup&&e.__renderGroup.updateTexture(e),t.__renderGroup&&t.__renderGroup.updateTexture(t),!0):(e._iNext=s,e._iPrev=i,t._iNext=r,t._iPrev=n,n&&(n._iNext=t),r&&(r._iPrev=t),i&&(i._iNext=e),s&&(s._iPrev=e),e.__renderGroup&&e.__renderGroup.updateTexture(e),t.__renderGroup&&t.__renderGroup.updateTexture(t),!0)},bringToTop:function(e){return e.group===this&&(this.remove(e),this.add(e)),e},getIndex:function(e){return this._container.children.indexOf(e)},replace:function(e,t){if(!this._container.first._iNext)return;var n=this.getIndex(e);n!=-1&&(t.parent!=undefined&&(t.events.onRemovedFromGroup.dispatch(t,this),t.parent.removeChild(t)),this._container.removeChild(e),this._container.addChildAt(t,n),t.events.onAddedToGroup.dispatch(t,this))},setProperty:function(e,t,n,r){r=r||0,t.length==1?r==0?e[t[0]]=n:r==1?e[t[0]]+=n:r==2?e[t[0]]-=n:r==3?e[t[0]]*=n:r==4&&(e[t[0]]/=n):t.length==2?r==0?e[t[0]][t[1]]=n:r==1?e[t[0]][t[1]]+=n:r==2?e[t[0]][t[1]]-=n:r==3?e[t[0]][t[1]]*=n:r==4&&(e[t[0]][t[1]]/=n):t.length==3?r==0?e[t[0]][t[1]][t[2]]=n:r==1?e[t[0]][t[1]][t[2]]+=n:r==2?e[t[0]][t[1]][t[2]]-=n:r==3?e[t[0]][t[1]][t[2]]*=n:r==4&&(e[t[0]][t[1]][t[2]]/=n):t.length==4&&(r==0?e[t[0]][t[1]][t[2]][t[3]]=n:r==1?e[t[0]][t[1]][t[2]][t[3]]+=n:r==2?e[t[0]][t[1]][t[2]][t[3]]-=n:r==3?e[t[0]][t[1]][t[2]][t[3]]*=n:r==4&&(e[t[0]][t[1]][t[2]][t[3]]/=n))},setAll:function(e,t,n,r,i){e=e.split("."),n=n||!1,r=r||!1,i=i||0;if(this._container.children.length>0&&this._container.first._iNext){var s=this._container.first._iNext;do(n==0||n&&s.alive)&&(r==0||r&&s.visible)&&this.setProperty(s,e,t,i),s=s._iNext;while(s!=this._container.last._iNext)}},addAll:function(e,t,n,r){this.setAll(e,t,n,r,1)},subAll:function(e,t,n,r){this.setAll(e,t,n,r,2)},multiplyAll:function(e,t,n,r){this.setAll(e,t,n,r,3)},divideAll:function(e,t,n,r){this.setAll(e,t,n,r,4)},callAllExists:function(e,t,n){var r=Array.prototype.splice.call(arguments,3);if(this._container.children.length>0&&this._container.first._iNext){var i=this._container.first._iNext;do i.exists==n&&i[e]&&i[e].apply(i,r),i=i._iNext;while(i!=this._container.last._iNext)}},callAll:function(e,t){var n=Array.prototype.splice.call(arguments,2);if(this._container.children.length>0&&this._container.first._iNext){var r=this._container.first._iNext;do r[e]&&r[e].apply(r,n),r=r._iNext;while(r!=this._container.last._iNext)}},forEach:function(e,t,n){typeof n=="undefined"&&(n=!1);if(this._container.children.length>0&&this._container.first._iNext){var r=this._container.first._iNext;do(n==0||n&&r.exists)&&e.call(t,r),r=r._iNext;while(r!=this._container.last._iNext)}},forEachAlive:function(e,t){if(this._container.children.length>0&&this._container.first._iNext){var n=this._container.first._iNext;do n.alive&&e.call(t,n),n=n._iNext;while(n!=this._container.last._iNext)}},forEachDead:function(e,t){if(this._container.children.length>0&&this._container.first._iNext){var n=this._container.first._iNext;do n.alive==0&&e.call(t,n),n=n._iNext;while(n!=this._container.last._iNext)}},getFirstExists:function(e){typeof e!="boolean"&&(e=!0);if(this._container.children.length>0&&this._container.first._iNext){var t=this._container.first._iNext;do{if(t.exists===e)return t;t=t._iNext}while(t!=this._container.last._iNext)}return null},getFirstAlive:function(){if(this._container.children.length>0&&this._container.first._iNext){var e=this._container.first._iNext;do{if(e.alive)return e;e=e._iNext}while(e!=this._container.last._iNext)}return null},getFirstDead:function(){if(this._container.children.length>0&&this._container.first._iNext){var e=this._container.first._iNext;do{if(!e.alive)return e;e=e._iNext}while(e!=this._container.last._iNext)}return null},countLiving:function(){var e=-1;if(this._container.children.length>0&&this._container.first._iNext){var t=this._container.first._iNext;do t.alive&&e++,t=t._iNext;while(t!=this._container.last._iNext)}return e},countDead:function(){var e=-1;if(this._container.children.length>0&&this._container.first._iNext){var t=this._container.first._iNext;do t.alive||e++,t=t._iNext;while(t!=this._container.last._iNext)}return e},getRandom:function(e,t){return this._container.children.length==0?null:(e=e||0,t=t||this._container.children.length,this.game.math.getRandom(this._container.children,e,t))},remove:function(e){e.events.onRemovedFromGroup.dispatch(e,this),this._container.removeChild(e),e.group=null},removeAll:function(){if(this._container.children.length==0)return;do this._container.children[0].events&&this._container.children[0].events.onRemovedFromGroup.dispatch(this._container.children[0],this),this._container.removeChild(this._container.children[0]);while(this._container.children.length>0)},removeBetween:function(e,t){if(this._container.children.length==0)return;if(e>t||e<0||t>this._container.children.length)return!1;for(var n=e;n<t;n++){var r=this._container.children[n];r.events.onRemovedFromGroup.dispatch(r,this),this._container.removeChild(r)}},destroy:function(){this.removeAll(),this._container.parent.removeChild(this._container),this._container=null,this.game=null,this.exists=!1},dump:function(e){typeof e=="undefined"&&(e=!1);var t=20,n="\n"+Phaser.Utils.pad("Node",t)+"|"+Phaser.Utils.pad("Next",t)+"|"+Phaser.Utils.pad("Previous",t)+"|"+Phaser.Utils.pad("First",t)+"|"+Phaser.Utils.pad("Last",t);console.log(n);var n=Phaser.Utils.pad("----------",t)+"|"+Phaser.Utils.pad("----------",t)+"|"+Phaser.Utils.pad("----------",t)+"|"+Phaser.Utils.pad("----------",t)+"|"+Phaser.Utils.pad("----------",t);console.log(n);if(e)var r=this.game.stage._stage.last._iNext,i=this.game.stage._stage;else var r=this._container.last._iNext,i=this._container;do{var s=i.name||"*",o="-",u="-",a="-",f="-";i._iNext&&(o=i._iNext.name),i._iPrev&&(u=i._iPrev.name),i.first&&(a=i.first.name),i.last&&(f=i.last.name),typeof o=="undefined"&&(o="-"),typeof u=="undefined"&&(u="-"),typeof a=="undefined"&&(a="-"),typeof f=="undefined"&&(f="-");var n=Phaser.Utils.pad(s,t)+"|"+Phaser.Utils.pad(o,t)+"|"+Phaser.Utils.pad(u,t)+"|"+Phaser.Utils.pad(a,t)+"|"+Phaser.Utils.pad(f,t);console.log(n),i=i._iNext}while(i!=r)}},Object.defineProperty(Phaser.Group.prototype,"length",{get:function(){return this._container.children.length}}),Object.defineProperty(Phaser.Group.prototype,"x",{get:function(){return this._container.position.x},set:function(e){this._container.position.x=e}}),Object.defineProperty(Phaser.Group.prototype,"y",{get:function(){return this._container.position.y},set:function(e){this._container.position.y=e}}),Object.defineProperty(Phaser.Group.prototype,"angle",{get:function(){return Phaser.Math.radToDeg(this._container.rotation)},set:function(e){this._container.rotation=Phaser.Math.degToRad(e)}}),Object.defineProperty(Phaser.Group.prototype,"rotation",{get:function(){return this._container.rotation},set:function(e){this._container.rotation=e}}),Object.defineProperty(Phaser.Group.prototype,"visible",{get:function(){return this._container.visible},set:function(e){this._container.visible=e}}),Phaser.World=function(e){this.game=e,this.bounds=new Phaser.Rectangle(0,0,e.width,e.height),this.camera=null,this.currentRenderOrderID=0,this.group=null},Phaser.World.prototype={boot:function(){this.camera=new Phaser.Camera(this.game,0,0,0,this.game.width,this.game.height),this.game.camera=this.camera,this.group=new Phaser.Group(this.game,null,"__world",!0)},update:function(){this.camera.update(),this.currentRenderOrderID=0;if(this.game.stage._stage.first._iNext){var e=this.game.stage._stage.first._iNext;do e.preUpdate&&e.preUpdate(),e.update&&e.update(),e=e._iNext;while(e!=this.game.stage._stage.last._iNext)}},setSize:function(e,t){e>=this.game.width&&(this.bounds.width=e),t>=this.game.height&&(this.bounds.height=t)},destroy:function(){this.camera.x=0,this.camera.y=0,this.game.input.reset(!0),this.group.removeAll()}},Object.defineProperty(Phaser.World.prototype,"width",{get:function(){return this.bounds.width},set:function(e){this.bounds.width=e}}),Object.defineProperty(Phaser.World.prototype,"height",{get:function(){return this.bounds.height},set:function(e){this.bounds.height=e}}),Object.defineProperty(Phaser.World.prototype,"centerX",{get:function(){return this.bounds.halfWidth}}),Object.defineProperty(Phaser.World.prototype,"centerY",{get:function(){return this.bounds.halfHeight}}),Object.defineProperty(Phaser.World.prototype,"randomX",{get:function(){return Math.round(Math.random()*this.bounds.width)}}),Object.defineProperty(Phaser.World.prototype,"randomY",{get:function(){return Math.round(Math.random()*this.bounds.height)}}),Phaser.Game=function(e,t,n,r,i,s,o){e=e||800,t=t||600,n=n||Phaser.AUTO,r=r||"",i=i||null,s=s||!1,o=typeof o=="undefined"?!0:o,this.id=Phaser.GAMES.push(this)-1,this.parent=r,this.width=e,this.height=t,this.transparent=s,this.antialias=o,this.renderer=null,this.state=new Phaser.StateManager(this,i),this._paused=!1,this.renderType=n,this._loadComplete=!1,this.isBooted=!1,this.isRunning=!1,this.raf=null,this.add=null,this.cache=null,this.input=null,this.load=null,this.math=null,this.net=null,this.sound=null,this.stage=null,this.time=null,this.tweens=null,this.world=null,this.physics=null,this.rnd=null,this.device=null,this.camera=null,this.canvas=null,this.context=null,this.debug=null,this.particles=null;var u=this;return this._onBoot=function(){return u.boot()},document.readyState==="complete"||document.readyState==="interactive"?window.setTimeout(this._onBoot,0):(document.addEventListener("DOMContentLoaded",this._onBoot,!1),window.addEventListener("load",this._onBoot,!1)),this},Phaser.Game.prototype={boot:function(){if(this.isBooted)return;document.body?(document.removeEventListener("DOMContentLoaded",this._onBoot),window.removeEventListener("load",this._onBoot),this.onPause=new Phaser.Signal,this.onResume=new Phaser.Signal,this.isBooted=!0,this.device=new Phaser.Device,this.math=Phaser.Math,this.rnd=new Phaser.RandomDataGenerator([(Date.now()*Math.random()).toString()]),this.stage=new Phaser.Stage(this,this.width,this.height),this.setUpRenderer(),this.world=new Phaser.World(this),this.add=new Phaser.GameObjectFactory(this),this.cache=new Phaser.Cache(this),this.load=new Phaser.Loader(this),this.time=new Phaser.Time(this),this.tweens=new Phaser.TweenManager(this),this.input=new Phaser.Input(this),this.sound=new Phaser.SoundManager(this),this.physics=new Phaser.Physics.Arcade(this),this.particles=new Phaser.Particles(this),this.plugins=new Phaser.PluginManager(this,this),this.net=new Phaser.Net(this),this.debug=new Phaser.Utils.Debug(this),this.load.onLoadComplete.add(this.loadComplete,this),this.stage.boot(),this.world.boot(),this.input.boot(),this.sound.boot(),this.state.boot(),this.renderType==Phaser.CANVAS?console.log("%cPhaser "+Phaser.VERSION+" initialized. Rendering to Canvas","color: #ffff33; background: #000000"):console.log("%cPhaser "+Phaser.VERSION+" initialized. Rendering to WebGL","color: #ffff33; background: #000000"),this.isRunning=!0,this._loadComplete=!1,this.raf=new Phaser.RequestAnimationFrame(this),this.raf.start()):window.setTimeout(this._onBoot,20)},setUpRenderer:function(){if(this.renderType===Phaser.CANVAS||this.renderType===Phaser.AUTO&&this.device.webGL==0){if(!this.device.canvas)throw new Error("Phaser.Game - cannot create Canvas or WebGL context, aborting.");this.renderType=Phaser.CANVAS,this.renderer=new PIXI.CanvasRenderer(this.width,this.height,this.stage.canvas,this.transparent),Phaser.Canvas.setSmoothingEnabled(this.renderer.context,this.antialias),this.canvas=this.renderer.view,this.context=this.renderer.context}else this.renderType=Phaser.WEBGL,this.renderer=new PIXI.WebGLRenderer(this.width,this.height,this.stage.canvas,this.transparent,this.antialias),this.canvas=this.renderer.view,this.context=null;Phaser.Canvas.addToDOM(this.renderer.view,this.parent,!0),Phaser.Canvas.setTouchAction(this.renderer.view)},loadComplete:function(){this._loadComplete=!0,this.state.loadComplete()},update:function(e){this.time.update(e),this._paused||(this.plugins.preUpdate(),this.physics.preUpdate(),this.input.update(),this.tweens.update(),this.sound.update(),this.world.update(),this.particles.update(),this.state.update(),this.plugins.update(),this.renderer.render(this.stage._stage),this.plugins.render(),this.state.render(),this.plugins.postRender())},destroy:function(){this.state.destroy(),this.state=null,this.cache=null,this.input=null,this.load=null,this.sound=null,this.stage=null,this.time=null,this.world=null,this.isBooted=!1}},Object.defineProperty(Phaser.Game.prototype,"paused",{get:function(){return this._paused},set:function(e){e===!0?this._paused==0&&(this._paused=!0,this.onPause.dispatch(this)):this._paused&&(this._paused=!1,this.onResume.dispatch(this))}}),Phaser.Input=function(e){this.game=e,this.hitCanvas=null,this.hitContext=null},Phaser.Input.MOUSE_OVERRIDES_TOUCH=0,Phaser.Input.TOUCH_OVERRIDES_MOUSE=1,Phaser.Input.MOUSE_TOUCH_COMBINE=2,Phaser.Input.prototype={game:null,pollRate:0,_pollCounter:0,_oldPosition:null,_x:0,_y:0,disabled:!1,multiInputOverride:Phaser.Input.MOUSE_TOUCH_COMBINE,position:null,speed:null,circle:null,scale:null,maxPointers:10,currentPointers:0,tapRate:200,doubleTapRate:300,holdRate:2e3,justPressedRate:200,justReleasedRate:200,recordPointerHistory:!1,recordRate:100,recordLimit:100,pointer1:null,pointer2:null,pointer3:null,pointer4:null,pointer5:null,pointer6:null,pointer7:null,pointer8:null,pointer9:null,pointer10:null,activePointer:null,mousePointer:null,mouse:null,keyboard:null,touch:null,mspointer:null,onDown:null,onUp:null,onTap:null,onHold:null,interactiveItems:new Phaser.LinkedList,boot:function(){this.mousePointer=new Phaser.Pointer(this.game,0),this.pointer1=new Phaser.Pointer(this.game,1),this.pointer2=new Phaser.Pointer(this.game,2),this.mouse=new Phaser.Mouse(this.game),this.keyboard=new Phaser.Keyboard(this.game),this.touch=new Phaser.Touch(this.game),this.mspointer=new Phaser.MSPointer(this.game),this.onDown=new Phaser.Signal,this.onUp=new Phaser.Signal,this.onTap=new Phaser.Signal,this.onHold=new Phaser.Signal,this.scale=new Phaser.Point(1,1),this.speed=new Phaser.Point,this.position=new Phaser.Point,this._oldPosition=new Phaser.Point,this.circle=new Phaser.Circle(0,0,44),this.activePointer=this.mousePointer,this.currentPointers=0,this.hitCanvas=document.createElement("canvas"),this.hitCanvas.width=1,this.hitCanvas.height=1,this.hitContext=this.hitCanvas.getContext("2d"),this.mouse.start(),this.keyboard.start(),this.touch.start(),this.mspointer.start(),this.mousePointer.active=!0},addPointer:function(){var e=0;for(var t=10;t>0;t--)this["pointer"+t]===null&&(e=t);return e==0?(console.warn("You can only have 10 Pointer objects"),null):(this["pointer"+e]=new Phaser.Pointer(this.game,e),this["pointer"+e])},update:function(){if(this.pollRate>0&&this._pollCounter<this.pollRate){this._pollCounter++;return}this.speed.x=this.position.x-this._oldPosition.x,this.speed.y=this.position.y-this._oldPosition.y,this._oldPosition.copyFrom(this.position),this.mousePointer.update(),this.pointer1.update(),this.pointer2.update(),this.pointer3&&this.pointer3.update(),this.pointer4&&this.pointer4.update(),this.pointer5&&this.pointer5.update(),this.pointer6&&this.pointer6.update(),this.pointer7&&this.pointer7.update(),this.pointer8&&this.pointer8.update(),this.pointer9&&this.pointer9.update(),this.pointer10&&this.pointer10.update(),this._pollCounter=0},reset:function(e){if(this.game.isBooted==0)return;typeof e=="undefined"&&(e=!1),this.keyboard.reset(),this.mousePointer.reset();for(var t=1;t<=10;t++)this["pointer"+t]&&this["pointer"+t].reset();this.currentPointers=0,this.game.stage.canvas.style.cursor="default",e==1&&(this.onDown.dispose(),this.onUp.dispose(),this.onTap.dispose(),this.onHold.dispose(),this.onDown=new Phaser.Signal,this.onUp=new Phaser.Signal,this.onTap=new Phaser.Signal,this.onHold=new Phaser.Signal,this.interactiveItems.callAll("reset")),this._pollCounter=0},resetSpeed:function(e,t){this._oldPosition.setTo(e,t),this.speed.setTo(0,0)},startPointer:function(e){if(this.maxPointers<10&&this.totalActivePointers==this.maxPointers)return null;if(this.pointer1.active==0)return this.pointer1.start(e);if(this.pointer2.active==0)return this.pointer2.start(e);for(var t=3;t<=10;t++)if(this["pointer"+t]&&this["pointer"+t].active==0)return this["pointer"+t].start(e);return null},updatePointer:function(e){if(this.pointer1.active&&this.pointer1.identifier==e.identifier)return this.pointer1.move(e);if(this.pointer2.active&&this.pointer2.identifier==e.identifier)return this.pointer2.move(e);for(var t=3;t<=10;t++)if(this["pointer"+t]&&this["pointer"+t].active&&this["pointer"+t].identifier==e.identifier)return this["pointer"+t].move(e);return null},stopPointer:function(e){if(this.pointer1.active&&this.pointer1.identifier==e.identifier)return this.pointer1.stop(e);if(this.pointer2.active&&this.pointer2.identifier==e.identifier)return this.pointer2.stop(e);for(var t=3;t<=10;t++)if(this["pointer"+t]&&this["pointer"+t].active&&this["pointer"+t].identifier==e.identifier)return this["pointer"+t].stop(e);return null},getPointer:function(e){e=e||!1;if(this.pointer1.active==e)return this.pointer1;if(this.pointer2.active==e)return this.pointer2;for(var t=3;t<=10;t++)if(this["pointer"+t]&&this["pointer"+t].active==e)return this["pointer"+t];return null},getPointerFromIdentifier:function(e){if(this.pointer1.identifier==e)return this.pointer1;if(this.pointer2.identifier==e)return this.pointer2;for(var t=3;t<=10;t++)if(this["pointer"+t]&&this["pointer"+t].identifier==e)return this["pointer"+t];return null},getDistance:function(e,t){},getAngle:function(e,t){}},Object.defineProperty(Phaser.Input.prototype,"x",{get:function(){return this._x},set:function(e){this._x=Math.floor(e)}}),Object.defineProperty(Phaser.Input.prototype,"y",{get:function(){return this._y},set:function(e){this._y=Math.floor(e)}}),Object.defineProperty(Phaser.Input.prototype,"pollLocked",{get:function(){return this.pollRate>0&&this._pollCounter<this.pollRate}}),Object.defineProperty(Phaser.Input.prototype,"totalInactivePointers",{get:function(){return 10-this.currentPointers}}),Object.defineProperty(Phaser.Input.prototype,"totalActivePointers",{get:function(){this.currentPointers=0;for(var e=1;e<=10;e++)this["pointer"+e]&&this["pointer"+e].active&&this.currentPointers++;return this.currentPointers}}),Object.defineProperty(Phaser.Input.prototype,"worldX",{get:function(){return this.game.camera.view.x+this.x}}),Object.defineProperty(Phaser.Input.prototype,"worldY",{get:function(){return this.game.camera.view.y+this.y}}),Phaser.Keyboard=function(e){this.game=e,this._keys={},this._capture={}},Phaser.Keyboard.prototype={game:null,disabled:!1,_onKeyDown:null,_onKeyUp:null,start:function(){var e=this;this._onKeyDown=function(t){return e.onKeyDown(t)},this._onKeyUp=function(t){return e.onKeyUp(t)},document.body.addEventListener("keydown",this._onKeyDown,!1),document.body.addEventListener("keyup",this._onKeyUp,!1)},stop:function(){document.body.removeEventListener("keydown",this._onKeyDown),document.body.removeEventListener("keyup",this._onKeyUp)},addKeyCapture:function(e){if(typeof e=="object")for(var t in e)this._capture[e[t]]=!0;else this._capture[e]=!0},removeKeyCapture:function(e){delete this._capture[e]},clearCaptures:function(){this._capture={}},onKeyDown:function(e){if(this.game.input.disabled||this.disabled)return;this._capture[e.keyCode]&&e.preventDefault(),this._keys[e.keyCode]?(this._keys[e.keyCode].isDown=!0,this._keys[e.keyCode].timeDown=this.game.time.now):this._keys[e.keyCode]={isDown:!0,timeDown:this.game.time.now,timeUp:0}},onKeyUp:function(e){if(this.game.input.disabled||this.disabled)return;this._capture[e.keyCode]&&e.preventDefault(),this._keys[e.keyCode]?(this._keys[e.keyCode].isDown=!1,this._keys[e.keyCode].timeUp=this.game.time.now):this._keys[e.keyCode]={isDown:!1,timeDown:0,timeUp:this.game.time.now}},reset:function(){for(var e in this._keys)this._keys[e].isDown=!1},justPressed:function(e,t){return typeof t=="undefined"&&(t=250),this._keys[e]&&this._keys[e].isDown===!0&&this.game.time.now-this._keys[e].timeDown<t?!0:!1},justReleased:function(e,t){return typeof t=="undefined"&&(t=250),this._keys[e]&&this._keys[e].isDown===!1&&this.game.time.now-this._keys[e].timeUp<t?!0:!1},isDown:function(e){return this._keys[e]?this._keys[e].isDown:!1}},Phaser.Keyboard.A="A".charCodeAt(0),Phaser.Keyboard.B="B".charCodeAt(0),Phaser.Keyboard.C="C".charCodeAt(0),Phaser.Keyboard.D="D".charCodeAt(0),Phaser.Keyboard.E="E".charCodeAt(0),Phaser.Keyboard.F="F".charCodeAt(0),Phaser.Keyboard.G="G".charCodeAt(0),Phaser.Keyboard.H="H".charCodeAt(0),Phaser.Keyboard.I="I".charCodeAt(0),Phaser.Keyboard.J="J".charCodeAt(0),Phaser.Keyboard.K="K".charCodeAt(0),Phaser.Keyboard.L="L".charCodeAt(0),Phaser.Keyboard.M="M".charCodeAt(0),Phaser.Keyboard.N="N".charCodeAt(0),Phaser.Keyboard.O="O".charCodeAt(0),Phaser.Keyboard.P="P".charCodeAt(0),Phaser.Keyboard.Q="Q".charCodeAt(0),Phaser.Keyboard.R="R".charCodeAt(0),Phaser.Keyboard.S="S".charCodeAt(0),Phaser.Keyboard.T="T".charCodeAt(0),Phaser.Keyboard.U="U".charCodeAt(0),Phaser.Keyboard.V="V".charCodeAt(0),Phaser.Keyboard.W="W".charCodeAt(0),Phaser.Keyboard.X="X".charCodeAt(0),Phaser.Keyboard.Y="Y".charCodeAt(0),Phaser.Keyboard.Z="Z".charCodeAt(0),Phaser.Keyboard.ZERO="0".charCodeAt(0),Phaser.Keyboard.ONE="1".charCodeAt(0),Phaser.Keyboard.TWO="2".charCodeAt(0),Phaser.Keyboard.THREE="3".charCodeAt(0),Phaser.Keyboard.FOUR="4".charCodeAt(0),Phaser.Keyboard.FIVE="5".charCodeAt(0),Phaser.Keyboard.SIX="6".charCodeAt(0),Phaser.Keyboard.SEVEN="7".charCodeAt(0),Phaser.Keyboard.EIGHT="8".charCodeAt(0),Phaser.Keyboard.NINE="9".charCodeAt(0),Phaser.Keyboard.NUMPAD_0=96,Phaser.Keyboard.NUMPAD_1=97,Phaser.Keyboard.NUMPAD_2=98,Phaser.Keyboard.NUMPAD_3=99,Phaser.Keyboard.NUMPAD_4=100,Phaser.Keyboard.NUMPAD_5=101,Phaser.Keyboard.NUMPAD_6=102,Phaser.Keyboard.NUMPAD_7=103,Phaser.Keyboard.NUMPAD_8=104,Phaser.Keyboard.NUMPAD_9=105,Phaser.Keyboard.NUMPAD_MULTIPLY=106,Phaser.Keyboard.NUMPAD_ADD=107,Phaser.Keyboard.NUMPAD_ENTER=108,Phaser.Keyboard.NUMPAD_SUBTRACT=109,Phaser.Keyboard.NUMPAD_DECIMAL=110,Phaser.Keyboard.NUMPAD_DIVIDE=111,Phaser.Keyboard.F1=112,Phaser.Keyboard.F2=113,Phaser.Keyboard.F3=114,Phaser.Keyboard.F4=115,Phaser.Keyboard.F5=116,Phaser.Keyboard.F6=117,Phaser.Keyboard.F7=118,Phaser.Keyboard.F8=119,Phaser.Keyboard.F9=120,Phaser.Keyboard.F10=121,Phaser.Keyboard.F11=122,Phaser.Keyboard.F12=123,Phaser.Keyboard.F13=124,Phaser.Keyboard.F14=125,Phaser.Keyboard.F15=126,Phaser.Keyboard.COLON=186,Phaser.Keyboard.EQUALS=187,Phaser.Keyboard.UNDERSCORE=189,Phaser.Keyboard.QUESTION_MARK=191,Phaser.Keyboard.TILDE=192,Phaser.Keyboard.OPEN_BRACKET=219,Phaser.Keyboard.BACKWARD_SLASH=220,Phaser.Keyboard.CLOSED_BRACKET=221,Phaser.Keyboard.QUOTES=222,Phaser.Keyboard.BACKSPACE=8,Phaser.Keyboard.TAB=9,Phaser.Keyboard.CLEAR=12,Phaser.Keyboard.ENTER=13,Phaser.Keyboard.SHIFT=16,Phaser.Keyboard.CONTROL=17,Phaser.Keyboard.ALT=18,Phaser.Keyboard.CAPS_LOCK=20,Phaser.Keyboard.ESC=27,Phaser.Keyboard.SPACEBAR=32,Phaser.Keyboard.PAGE_UP=33,Phaser.Keyboard.PAGE_DOWN=34,Phaser.Keyboard.END=35,Phaser.Keyboard.HOME=36,Phaser.Keyboard.LEFT=37,Phaser.Keyboard.UP=38,Phaser.Keyboard.RIGHT=39,Phaser.Keyboard.DOWN=40,Phaser.Keyboard.INSERT=45,Phaser.Keyboard.DELETE=46,Phaser.Keyboard.HELP=47,Phaser.Keyboard.NUM_LOCK=144,Phaser.Mouse=function(e){this.game=e,this.callbackContext=this.game,this.mouseDownCallback=null,this.mouseMoveCallback=null,this.mouseUpCallback=null},Phaser.Mouse.LEFT_BUTTON=0,Phaser.Mouse.MIDDLE_BUTTON=1,Phaser.Mouse.RIGHT_BUTTON=2,Phaser.Mouse.prototype={game:null,disabled:!1,locked:!1,start:function(){var e=this;if(this.game.device.android&&this.game.device.chrome==0)return;this._onMouseDown=function(t){return e.onMouseDown(t)},this._onMouseMove=function(t){return e.onMouseMove(t)},this._onMouseUp=function(t){return e.onMouseUp(t)},this.game.renderer.view.addEventListener("mousedown",this._onMouseDown,!0),this.game.renderer.view.addEventListener("mousemove",this._onMouseMove,!0),this.game.renderer.view.addEventListener("mouseup",this._onMouseUp,!0)},onMouseDown:function(e){this.mouseDownCallback&&this.mouseDownCallback.call(this.callbackContext,e);if(this.game.input.disabled||this.disabled)return;e.identifier=0,this.game.input.mousePointer.start(e)},onMouseMove:function(e){this.mouseMoveCallback&&this.mouseMoveCallback.call(this.callbackContext,e);if(this.game.input.disabled||this.disabled)return;e.identifier=0,this.game.input.mousePointer.move(e)},onMouseUp:function(e){this.mouseUpCallback&&this.mouseUpCallback.call(this.callbackContext,e);if(this.game.input.disabled||this.disabled)return;e.identifier=0,this.game.input.mousePointer.stop(e)},requestPointerLock:function(){if(this.game.device.pointerLock){var e=this.game.stage.canvas;e.requestPointerLock=e.requestPointerLock||e.mozRequestPointerLock||e.webkitRequestPointerLock,e.requestPointerLock();var t=this;this._pointerLockChange=function(e){return t.pointerLockChange(e)},document.addEventListener("pointerlockchange",this._pointerLockChange,!1),document.addEventListener("mozpointerlockchange",this._pointerLockChange,!1),document.addEventListener("webkitpointerlockchange",this._pointerLockChange,!1)}},pointerLockChange:function(e){var t=this.game.stage.canvas;document.pointerLockElement===t||document.mozPointerLockElement===t||document.webkitPointerLockElement===t?this.locked=!0:this.locked=!1},releasePointerLock:function(){document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock,document.exitPointerLock(),document.removeEventListener("pointerlockchange",this._pointerLockChange),document.removeEventListener("mozpointerlockchange",this._pointerLockChange),document.removeEventListener("webkitpointerlockchange",this._pointerLockChange)},stop:function(){this.game.stage.canvas.removeEventListener("mousedown",this._onMouseDown),this.game.stage.canvas.removeEventListener("mousemove",this._onMouseMove),this.game.stage.canvas.removeEventListener("mouseup",this._onMouseUp)}},Phaser.MSPointer=function(e){this.game=e,this.callbackContext=this.game,this.mouseDownCallback=null,this.mouseMoveCallback=null,this.mouseUpCallback=null},Phaser.MSPointer.prototype={game:null,disabled:!1,_onMSPointerDown:null,_onMSPointerMove:null,_onMSPointerUp:null,start:function(){var e=this;this.game.device.mspointer==1&&(this._onMSPointerDown=function(t){return e.onPointerDown(t)},this._onMSPointerMove=function(t){return e.onPointerMove(t)},this._onMSPointerUp=function(t){return e.onPointerUp(t)},this.game.renderer.view.addEventListener("MSPointerDown",this._onMSPointerDown,!1),this.game.renderer.view.addEventListener("MSPointerMove",this._onMSPointerMove,!1),this.game.renderer.view.addEventListener("MSPointerUp",this._onMSPointerUp,!1),this.game.renderer.view.style["-ms-content-zooming"]="none",this.game.renderer.view.style["-ms-touch-action"]="none")},onPointerDown:function(e){if(this.game.input.disabled||this.disabled)return;e.preventDefault(),e.identifier=e.pointerId,this.game.input.startPointer(e)},onPointerMove:function(e){if(this.game.input.disabled||this.disabled)return;e.preventDefault(),e.identifier=e.pointerId,this.game.input.updatePointer(e)},onPointerUp:function(e){if(this.game.input.disabled||this.disabled)return;e.preventDefault(),e.identifier=e.pointerId,this.game.input.stopPointer(e)},stop:function(){this.game.stage.canvas.removeEventListener("MSPointerDown",this._onMSPointerDown),this.game.stage.canvas.removeEventListener("MSPointerMove",this._onMSPointerMove),this.game.stage.canvas.removeEventListener("MSPointerUp",this._onMSPointerUp)}},Phaser.Pointer=function(e,t){this._holdSent=!1,this._history=[],this._nextDrop=0,this._stateReset=!1,this.positionDown=null,this.position=null,this.circle=null,this.withinGame=!1,this.clientX=-1,this.clientY=-1,this.pageX=-1,this.pageY=-1,this.screenX=-1,this.screenY=-1,this.x=-1,this.y=-1,this.isMouse=!1,this.isDown=!1,this.isUp=!0,this.timeDown=0,this.timeUp=0,this.previousTapTime=0,this.totalTouches=0,this.msSinceLastClick=Number.MAX_VALUE,this.targetObject=null,this.game=e,this.id=t,this.active=!1,this.position=new Phaser.Point,this.positionDown=new Phaser.Point,this.circle=new Phaser.Circle(0,0,44),t==0&&(this.isMouse=!0)},Phaser.Pointer.prototype={start:function(e){this.identifier=e.identifier,this.target=e.target,e.button&&(this.button=e.button);if(this.game.paused==1&&this.game.stage.scale.incorrectOrientation==0)return this.game.paused=!1,this;this._history.length=0,this.active=!0,this.withinGame=!0,this.isDown=!0,this.isUp=!1,this.msSinceLastClick=this.game.time.now-this.timeDown,this.timeDown=this.game.time.now,this._holdSent=!1,this.move(e),this.positionDown.setTo(this.x,this.y);if(this.game.input.multiInputOverride==Phaser.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride==Phaser.Input.MOUSE_TOUCH_COMBINE||this.game.input.multiInputOverride==Phaser.Input.TOUCH_OVERRIDES_MOUSE&&this.game.input.currentPointers==0)this.game.input.x=this.x*this.game.input.scale.x,this.game.input.y=this.y*this.game.input.scale.y,this.game.input.position.setTo(this.x,this.y),this.game.input.onDown.dispatch(this),this.game.input.resetSpeed(this.x,this.y);return this._stateReset=!1,this.totalTouches++,this.isMouse==0&&this.game.input.currentPointers++,this.targetObject!==null&&this.targetObject._touchedHandler(this),this},update:function(){this.active&&(this._holdSent==0&&this.duration>=this.game.input.holdRate&&((this.game.input.multiInputOverride==Phaser.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride==Phaser.Input.MOUSE_TOUCH_COMBINE||this.game.input.multiInputOverride==Phaser.Input.TOUCH_OVERRIDES_MOUSE&&this.game.input.currentPointers==0)&&this.game.input.onHold.dispatch(this),this._holdSent=!0),this.game.input.recordPointerHistory&&this.game.time.now>=this._nextDrop&&(this._nextDrop=this.game.time.now+this.game.input.recordRate,this._history.push({x:this.position.x,y:this.position.y}),this._history.length>this.game.input.recordLimit&&this._history.shift()))},move:function(e){if(this.game.input.pollLocked)return;e.button&&(this.button=e.button),this.clientX=e.clientX,this.clientY=e.clientY,this.pageX=e.pageX,this.pageY=e.pageY,this.screenX=e.screenX,this.screenY=e.screenY,this.x=(this.pageX-this.game.stage.offset.x)*this.game.input.scale.x,this.y=(this.pageY-this.game.stage.offset.y)*this.game.input.scale.y,this.position.setTo(this.x,this.y),this.circle.x=this.x,this.circle.y=this.y;if(this.game.input.multiInputOverride==Phaser.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride==Phaser.Input.MOUSE_TOUCH_COMBINE||this.game.input.multiInputOverride==Phaser.Input.TOUCH_OVERRIDES_MOUSE&&this.game.input.currentPointers==0)this.game.input.activePointer=this,this.game.input.x=this.x,this.game.input.y=this.y,this.game.input.position.setTo(this.game.input.x,this.game.input.y),this.game.input.circle.x=this.game.input.x,this.game.input.circle.y=this.game.input.y;if(this.game.paused)return this;if(this.targetObject!==null&&this.targetObject.isDragged==1)return this.targetObject.update(this)==0&&(this.targetObject=null),this;this._highestRenderOrderID=-1,this._highestRenderObject=null,this._highestInputPriorityID=-1;if(this.game.input.interactiveItems.total>0){var t=this.game.input.interactiveItems.next;do(t.pixelPerfect||t.priorityID>this._highestInputPriorityID||t.priorityID==this._highestInputPriorityID&&t.sprite.renderOrderID>this._highestRenderOrderID)&&t.checkPointerOver(this)&&(this._highestRenderOrderID=t.sprite.renderOrderID,this._highestInputPriorityID=t.priorityID,this._highestRenderObject=t),t=t.next;while(t!=null)}return this._highestRenderObject==null?this.targetObject&&(this.targetObject._pointerOutHandler(this),this.targetObject=null):this.targetObject==null?(this.targetObject=this._highestRenderObject,this._highestRenderObject._pointerOverHandler(this)):this.targetObject==this._highestRenderObject?this._highestRenderObject.update(this)==0&&(this.targetObject=null):(this.targetObject._pointerOutHandler(this),this.targetObject=this._highestRenderObject,this.targetObject._pointerOverHandler(this)),this},leave:function(e){this.withinGame=!1,this.move(e)},stop:function(e){if(this._stateReset){e.preventDefault();return}this.timeUp=this.game.time.now;if(this.game.input.multiInputOverride==Phaser.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride==Phaser.Input.MOUSE_TOUCH_COMBINE||this.game.input.multiInputOverride==Phaser.Input.TOUCH_OVERRIDES_MOUSE&&this.game.input.currentPointers==0)this.game.input.onUp.dispatch(this),this.duration>=0&&this.duration<=this.game.input.tapRate&&(this.timeUp-this.previousTapTime<this.game.input.doubleTapRate?this.game.input.onTap.dispatch(this,!0):this.game.input.onTap.dispatch(this,!1),this.previousTapTime=this.timeUp);this.id>0&&(this.active=!1),this.withinGame=!1,this.isDown=!1,this.isUp=!0,this.isMouse==0&&this.game.input.currentPointers--;if(this.game.input.interactiveItems.total>0){var t=this.game.input.interactiveItems.next;do t&&t._releasedHandler(this),t=t.next;while(t!=null)}return this.targetObject&&this.targetObject._releasedHandler(this),this.targetObject=null,this},justPressed:function(e){return e=e||this.game.input.justPressedRate,this.isDown===!0&&this.timeDown+e>this.game.time.now},justReleased:function(e){return e=e||this.game.input.justReleasedRate,this.isUp===!0&&this.timeUp+e>this.game.time.now},reset:function(){this.isMouse==0&&(this.active=!1),this.identifier=null,this.isDown=!1,this.isUp=!0,this.totalTouches=0,this._holdSent=!1,this._history.length=0,this._stateReset=!0,this.targetObject&&this.targetObject._releasedHandler(this),this.targetObject=null},toString:function(){return"[{Pointer (id="+this.id+" identifer="+this.identifier+" active="+this.active+" duration="+this.duration+" withinGame="+this.withinGame+" x="+this.x+" y="+this.y+" clientX="+this.clientX+" clientY="+this.clientY+" screenX="+this.screenX+" screenY="+this.screenY+" pageX="+this.pageX+" pageY="+this.pageY+")}]"}},Object.defineProperty(Phaser.Pointer.prototype,"duration",{get:function(){return this.isUp?-1:this.game.time.now-this.timeDown}}),Object.defineProperty(Phaser.Pointer.prototype,"worldX",{get:function(){return this.game.world.camera.x+this.x}}),Object.defineProperty(Phaser.Pointer.prototype,"worldY",{get:function(){return this.game.world.camera.y+this.y}}),Phaser.Touch=function(e){this.game=e,this.callbackContext=this.game,this.touchStartCallback=null,this.touchMoveCallback=null,this.touchEndCallback=null,this.touchEnterCallback=null,this.touchLeaveCallback=null,this.touchCancelCallback=null,this.preventDefault=!0},Phaser.Touch.prototype={game:null,disabled:!1,_onTouchStart:null,_onTouchMove:null,_onTouchEnd:null,_onTouchEnter:null,_onTouchLeave:null,_onTouchCancel:null,_onTouchMove:null,start:function(){var e=this;this.game.device.touch&&(this._onTouchStart=function(t){return e.onTouchStart(t)},this._onTouchMove=function(t){return e.onTouchMove(t)},this._onTouchEnd=function(t){return e.onTouchEnd(t)},this._onTouchEnter=function(t){return e.onTouchEnter(t)},this._onTouchLeave=function(t){return e.onTouchLeave(t)},this._onTouchCancel=function(t){return e.onTouchCancel(t)},this.game.renderer.view.addEventListener("touchstart",this._onTouchStart,!1),this.game.renderer.view.addEventListener("touchmove",this._onTouchMove,!1),this.game.renderer.view.addEventListener("touchend",this._onTouchEnd,!1),this.game.renderer.view.addEventListener("touchenter",this._onTouchEnter,!1),this.game.renderer.view.addEventListener("touchleave",this._onTouchLeave,!1),this.game.renderer.view.addEventListener("touchcancel",this._onTouchCancel,!1))},consumeDocumentTouches:function(){this._documentTouchMove=function(e){e.preventDefault()},document.addEventListener("touchmove",this._documentTouchMove,!1)},onTouchStart:function(e){this.touchStartCallback&&this.touchStartCallback.call(this.callbackContext,e);if(this.game.input.disabled||this.disabled)return;this.preventDefault&&e.preventDefault();for(var t=0;t<e.changedTouches.length;t++)this.game.input.startPointer(e.changedTouches[t])},onTouchCancel:function(e){this.touchCancelCallback&&this.touchCancelCallback.call(this.callbackContext,e);if(this.game.input.disabled||this.disabled)return;this.preventDefault&&e.preventDefault();for(var t=0;t<e.changedTouches.length;t++)this.game.input.stopPointer(e.changedTouches[t])},onTouchEnter:function(e){this.touchEnterCallback&&this.touchEnterCallback.call(this.callbackContext,e);if(this.game.input.disabled||this.disabled)return;this.preventDefault&&e.preventDefault();for(var t=0;t<e.changedTouches.length;t++);},onTouchLeave:function(e){this.touchLeaveCallback&&this.touchLeaveCallback.call(this.callbackContext,e),this.preventDefault&&e.preventDefault();for(var t=0;t<e.changedTouches.length;t++);},onTouchMove:function(e){this.touchMoveCallback&&this.touchMoveCallback.call(this.callbackContext,e),this.preventDefault&&e.preventDefault();for(var t=0;t<e.changedTouches.length;t++)this.game.input.updatePointer(e.changedTouches[t])},onTouchEnd:function(e){this.touchEndCallback&&this.touchEndCallback.call(this.callbackContext,e),this.preventDefault&&e.preventDefault();for(var t=0;t<e.changedTouches.length;t++)this.game.input.stopPointer(e.changedTouches[t])},stop:function(){this.game.device.touch&&(this.game.stage.canvas.removeEventListener("touchstart",this._onTouchStart),this.game.stage.canvas.removeEventListener("touchmove",this._onTouchMove),this.game.stage.canvas.removeEventListener("touchend",this._onTouchEnd),this.game.stage.canvas.removeEventListener("touchenter",this._onTouchEnter),this.game.stage.canvas.removeEventListener("touchleave",this._onTouchLeave),this.game.stage.canvas.removeEventListener("touchcancel",this._onTouchCancel))}},Phaser.InputHandler=function(e){this.game=e.game,this.sprite=e,this.enabled=!1,this.parent=null,this.next=null,this.prev=null,this.last=this,this.first=this,this.priorityID=0,this.useHandCursor=!1,this.isDragged=!1,this.allowHorizontalDrag=!0,this.allowVerticalDrag=!0,this.bringToTop=!1,this.snapOffset=null,this.snapOnDrag=!1,this.snapOnRelease=!1,this.snapX=0,this.snapY=0,this.pixelPerfect=!1,this.pixelPerfectAlpha=255,this.draggable=!1,this.boundsRect=null,this.boundsSprite=null,this.consumePointerEvent=!1,this._tempPoint=new Phaser.Point},Phaser.InputHandler.prototype={start:function(e,t){e=e||0,t=t||!1;if(this.enabled==0){this.game.input.interactiveItems.add(this),this.useHandCursor=t,this.priorityID=e,this._pointerData=[];for(var n=0;n<10;n++)this._pointerData.push({id:n,x:0,y:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1});this.snapOffset=new Phaser.Point,this.enabled=!0,this.sprite.events&&this.sprite.events.onInputOver==null&&(this.sprite.events.onInputOver=new Phaser.Signal,this.sprite.events.onInputOut=new Phaser.Signal,this.sprite.events.onInputDown=new Phaser.Signal,this.sprite.events.onInputUp=new Phaser.Signal,this.sprite.events.onDragStart=new Phaser.Signal,this.sprite.events.onDragStop=new Phaser.Signal)}return this.sprite},reset:function(){this.enabled=!1;for(var e=0;e<10;e++)this._pointerData[e]={id:e,x:0,y:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1}},stop:function(){if(this.enabled==0)return;this.enabled=!1,this.game.input.interactiveItems.remove(this)},destroy:function(){this.enabled&&(this.stop(),this.sprite=null)},pointerX:function(e){return e=e||0,this._pointerData[e].x},pointerY:function(e){return e=e||0,this._pointerData[e].y},pointerDown:function(e){return e=e||0,this._pointerData[e].isDown},pointerUp:function(e){return e=e||0,this._pointerData[e].isUp},pointerTimeDown:function(e){return e=e||0,this._pointerData[e].timeDown},pointerTimeUp:function(e){return e=e||0,this._pointerData[e].timeUp},pointerOver:function(e){return e=e||0,this._pointerData[e].isOver},pointerOut:function(e){return e=e||0,this._pointerData[e].isOut},pointerTimeOver:function(e){return e=e||0,this._pointerData[e].timeOver},pointerTimeOut:function(e){return e=e||0,this._pointerData[e].timeOut},pointerDragged:function(e){return e=e||0,this._pointerData[e].isDragged},checkPointerOver:function(e){if(!this.enabled||!this.sprite.visible)return!1;this.sprite.getLocalUnmodifiedPosition(this._tempPoint,e.x,e.y);var t=-this.sprite.texture.frame.width*this.sprite.anchor.x,n;if(this._tempPoint.x>t&&this._tempPoint.x<t+this.sprite.texture.frame.width){n=-this.sprite.texture.frame.height*this.sprite.anchor.y;if(this._tempPoint.y>n&&this._tempPoint.y<n+this.sprite.texture.frame.height)return this.pixelPerfect?this.checkPixel(this._tempPoint.x,this._tempPoint.y):!0}},checkPixel:function(e,t){e+=this.sprite.texture.frame.width*this.sprite.anchor.x,t+=this.sprite.texture.frame.height*this.sprite.anchor.y;if(this.sprite.texture.baseTexture.source){this.game.input.hitContext.clearRect(0,0,1,1),this.game.input.hitContext.drawImage(this.sprite.texture.baseTexture.source,e,t,1,1,0,0,1,1);var n=this.game.input.hitContext.getImageData(0,0,1,1);if(n.data[3]>=this.pixelPerfectAlpha)return!0}return!1},update:function(e){if(this.enabled==0||this.sprite.visible==0)return this._pointerOutHandler(e),!1;if(this.draggable&&this._draggedPointerID==e.id)return this.updateDrag(e);if(this._pointerData[e.id].isOver==1)return this.checkPointerOver(e)?(this._pointerData[e.id].x=e.x-this.sprite.x,this._pointerData[e.id].y=e.y-this.sprite.y,!0):(this._pointerOutHandler(e),!1)},_pointerOverHandler:function(e){this._pointerData[e.id].isOver==0&&(this._pointerData[e.id].isOver=!0,this._pointerData[e.id].isOut=!1,this._pointerData[e.id].timeOver=this.game.time.now,this._pointerData[e.id].x=e.x-this.sprite.x,this._pointerData[e.id].y=e.y-this.sprite.y,this.useHandCursor&&this._pointerData[e.id].isDragged==0&&(this.game.stage.canvas.style.cursor="pointer"),this.sprite.events.onInputOver.dispatch(this.sprite,e))},_pointerOutHandler:function(e){this._pointerData[e.id].isOver=!1,this._pointerData[e.id].isOut=!0,this._pointerData[e.id].timeOut=this.game.time.now,this.useHandCursor&&this._pointerData[e.id].isDragged==0&&(this.game.stage.canvas.style.cursor="default"),this.sprite.events.onInputOut.dispatch(this.sprite,e)},_touchedHandler:function(e){return this._pointerData[e.id].isDown==0&&this._pointerData[e.id].isOver==1&&(this._pointerData[e.id].isDown=!0,this._pointerData[e.id].isUp=!1,this._pointerData[e.id].timeDown=this.game.time.now,this.sprite.events.onInputDown.dispatch(this.sprite,e),this.draggable&&this.isDragged==0&&this.startDrag(e),this.bringToTop&&this.sprite.bringToTop()),this.consumePointerEvent},_releasedHandler:function(e){this._pointerData[e.id].isDown&&e.isUp&&(this._pointerData[e.id].isDown=!1,this._pointerData[e.id].isUp=!0,this._pointerData[e.id].timeUp=this.game.time.now,this._pointerData[e.id].downDuration=this._pointerData[e.id].timeUp-this._pointerData[e.id].timeDown,this.checkPointerOver(e)?this.sprite.events.onInputUp.dispatch(this.sprite,e):this.useHandCursor&&(this.game.stage.canvas.style.cursor="default"),this.draggable&&this.isDragged&&this._draggedPointerID==e.id&&this.stopDrag(e))},updateDrag:function(e){return e.isUp?(this.stopDrag(e),!1):(this.allowHorizontalDrag&&(this.sprite.x=e.x+this._dragPoint.x+this.dragOffset.x),this.allowVerticalDrag&&(this.sprite.y=e.y+this._dragPoint.y+this.dragOffset.y),this.boundsRect&&this.checkBoundsRect(),this.boundsSprite&&this.checkBoundsSprite(),this.snapOnDrag&&(this.sprite.x=Math.floor(this.sprite.x/this.snapX)*this.snapX,this.sprite.y=Math.floor(this.sprite.y/this.snapY)*this.snapY),!0)},justOver:function(e,t){return e=e||0,t=t||500,this._pointerData[e].isOver&&this.overDuration(e)<t},justOut:function(e,t){return e=e||0,t=t||500,this._pointerData[e].isOut&&this.game.time.now-this._pointerData[e].timeOut<t},justPressed:function(e,t){return e=e||0,t=t||500,this._pointerData[e].isDown&&this.downDuration(e)<t},justReleased:function(e,t){return e=e||0,t=t||500,this._pointerData[e].isUp&&this.game.time.now-this._pointerData[e].timeUp<t},overDuration:function(e){return e=e||0,this._pointerData[e].isOver?this.game.time.now-this._pointerData[e].timeOver:-1},downDuration:function(e){return e=e||0,this._pointerData[e].isDown?this.game.time.now-this._pointerData[e].timeDown:-1},enableDrag:function(e,t,n,r,i,s){typeof e=="undefined"&&(e=!1),typeof t=="undefined"&&(t=!1),typeof n=="undefined"&&(n=!1),r=r||255,i=i||null,s=s||null,this._dragPoint=new Phaser.Point,this.draggable=!0,this.bringToTop=t,this.dragOffset=new Phaser.Point,this.dragFromCenter=e,this.pixelPerfect=n,this.pixelPerfectAlpha=r,i&&(this.boundsRect=i),s&&(this.boundsSprite=s)},disableDrag:function(){if(this._pointerData)for(var e=0;e<10;e++)this._pointerData[e].isDragged=!1;this.draggable=!1,this.isDragged=!1,this._draggedPointerID=-1},startDrag:function(e){this.isDragged=!0,this._draggedPointerID=e.id,this._pointerData[e.id].isDragged=!0,this.dragFromCenter?(this.sprite.centerOn(e.x,e.y),this._dragPoint.setTo(this.sprite.x-e.x,this.sprite.y-e.y)):this._dragPoint.setTo(this.sprite.x-e.x,this.sprite.y-e.y),this.updateDrag(e),this.bringToTop&&this.sprite.bringToTop(),this.sprite.events.onDragStart.dispatch(this.sprite,e)},stopDrag:function(e){this.isDragged=!1,this._draggedPointerID=-1,this._pointerData[e.id].isDragged=!1,this.snapOnRelease&&(this.sprite.x=Math.floor(this.sprite.x/this.snapX)*this.snapX,this.sprite.y=Math.floor(this.sprite.y/this.snapY)*this.snapY),this.sprite.events.onDragStop.dispatch(this.sprite,e),this.sprite.events.onInputUp.dispatch(this.sprite,e)},setDragLock:function(e,t){typeof e=="undefined"&&(e=!0),typeof t=="undefined"&&(t=!0),this.allowHorizontalDrag=e,this.allowVerticalDrag=t},enableSnap:function(e,t,n,r){typeof n=="undefined"&&(n=!0),typeof r=="undefined"&&(r=!1),this.snapX=e,this.snapY=t,this.snapOnDrag=n,this.snapOnRelease=r},disableSnap:function(){this.snapOnDrag=!1,this.snapOnRelease=!1},checkBoundsRect:function(){this.sprite.x<this.boundsRect.left?this.sprite.x=this.boundsRect.x:this.sprite.x+this.sprite.width>this.boundsRect.right&&(this.sprite.x=this.boundsRect.right-this.sprite.width),this.sprite.y<this.boundsRect.top?this.sprite.y=this.boundsRect.top:this.sprite.y+this.sprite.height>this.boundsRect.bottom&&(this.sprite.y=this.boundsRect.bottom-this.sprite.height)},checkBoundsSprite:function(){this.sprite.x<this.boundsSprite.x?this.sprite.x=this.boundsSprite.x:this.sprite.x+this.sprite.width>this.boundsSprite.x+this.boundsSprite.width&&(this.sprite.x=this.boundsSprite.x+this.boundsSprite.width-this.sprite.width),this.sprite.y<this.boundsSprite.y?this.sprite.y=this.boundsSprite.y:this.sprite.y+this.sprite.height>this.boundsSprite.y+this.boundsSprite.height&&(this.sprite.y=this.boundsSprite.y+this.boundsSprite.height-this.sprite.height)}},Phaser.Events=function(e){this.parent=e,this.onAddedToGroup=new Phaser.Signal,this.onRemovedFromGroup=new Phaser.Signal,this.onKilled=new Phaser.Signal,this.onRevived=new Phaser.Signal,this.onOutOfBounds=new Phaser.Signal,this.onInputOver=null,this.onInputOut=null,this.onInputDown=null,this.onInputUp=null,this.onDragStart=null,this.onDragStop=null,this.onAnimationStart=null,this.onAnimationComplete=null,this.onAnimationLoop=null},Phaser.GameObjectFactory=function(e){this.game=e,this.world=this.game.world},Phaser.GameObjectFactory.prototype={game:null,world:null,existing:function(e){return this.world.group.add(e)},sprite:function(e,t,n,r){return this.world.group.add(new Phaser.Sprite(this.game,e,t,n,r))},child:function(e,t,n,r,i){var s=this.world.group.add(new Phaser.Sprite(this.game,t,n,r,i));return e.addChild(s),s},tween:function(e){return this.game.tweens.create(e)},group:function(e,t){return new Phaser.Group(this.game,e,t)},audio:function(e,t,n){return this.game.sound.add(e,t,n)},tileSprite:function(e,t,n,r,i,s){return this.world.group.add(new Phaser.TileSprite(this.game,e,t,n,r,i,s))},text:function(e,t,n,r){return this.world.group.add(new Phaser.Text(this.game,e,t,n,r))},button:function(e,t,n,r,i,s,o,u){return this.world.group.add(new Phaser.Button(this.game,e,t,n,r,i,s,o,u))},graphics:function(e,t){return this.world.group.add(new Phaser.Graphics(this.game,e,t))},emitter:function(e,t,n){return this.game.particles.add(new Phaser.Particles.Arcade.Emitter(this.game,e,t,n))},bitmapText:function(e,t,n,r){return this.world.group.add(new Phaser.BitmapText(this.game,e,t,n,r))},tilemap:function(e,t,n,r,i,s){return this.world.group.add(new Phaser.Tilemap(this.game,n,e,t,r,i,s))},renderTexture:function(e,t,n){var r=new Phaser.RenderTexture(this.game,e,t,n);return this.game.cache.addRenderTexture(e,r),r}},Phaser.Sprite=function(e,t,n,r,i){t=t||0,n=n||0,r=r||null,i=i||null,this.game=e,this.exists=!0,this.alive=!0,this.group=null,this.name="",this.type=Phaser.SPRITE,this.renderOrderID=-1,this.lifespan=0,this.events=new Phaser.Events(this),this.animations=new Phaser.AnimationManager(this),this.input=new Phaser.InputHandler(this),this.key=r;if(r instanceof Phaser.RenderTexture)PIXI.Sprite.call(this,r),this.currentFrame=this.game.cache.getTextureFrame(r.name);else{if(r==null||this.game.cache.checkImageKey(r)==0)r="__default";PIXI.Sprite.call(this,PIXI.TextureCache[r]),this.game.cache.isSpriteSheet(r)?(this.animations.loadFrameData(this.game.cache.getFrameData(r)),i!==null&&(typeof i=="string"?this.frameName=i:this.frame=i)):this.currentFrame=this.game.cache.getFrame(r)}this.anchor=new Phaser.Point,this._cropUUID=null,this._cropRect=null,this.x=t,this.y=n,this.position.x=t,this.position.y=n,this.autoCull=!1,this.scale=new Phaser.Point(1,1),this.scrollFactor=new Phaser.Point(1,1),this._cache={dirty:!1,a00:1,a01:0,a02:t,a10:0,a11:1,a12:n,id:1,i01:0,i10:0,idi:1,left:null,right:null,top:null,bottom:null,x:-1,y:-1,scaleX:1,scaleY:1,width:this.currentFrame.sourceSizeW,height:this.currentFrame.sourceSizeH,halfWidth:Math.floor(this.currentFrame.sourceSizeW/2),halfHeight:Math.floor(this.currentFrame.sourceSizeH/2),frameID:this.currentFrame.uuid,frameWidth:this.currentFrame.width,frameHeight:this.currentFrame.height,boundsX:0,boundsY:0,cameraVisible:!0},this.offset=new Phaser.Point,this.center=new Phaser.Point(t+Math.floor(this._cache.width/2),n+Math.floor(this._cache.height/2)),this.topLeft=new Phaser.Point(t,n),this.topRight=new Phaser.Point(t+this._cache.width,n),this.bottomRight=new Phaser.Point(t+this._cache.width,n+this._cache.height),this.bottomLeft=new Phaser.Point(t,n+this._cache.height),this.bounds=new Phaser.Rectangle(t,n,this._cache.width,this._cache.height),this.body=new Phaser.Physics.Arcade.Body(this),this.velocity=this.body.velocity,this.acceleration=this.body.acceleration,this.inWorld=Phaser.Rectangle.intersects(this.bounds,this.game.world.bounds),this.inWorldThreshold=0,this._outOfBoundsFired=!1},Phaser.Sprite.prototype=Object.create(PIXI.Sprite.prototype),Phaser.Sprite.prototype.constructor=Phaser.Sprite,Phaser.Sprite.prototype.preUpdate=function(){if(!this.exists){this.renderOrderID=-1;return}if(this.lifespan>0){this.lifespan-=this.game.time.elapsed;if(this.lifespan<=0){this.kill();return}}this._cache.dirty=!1,this.animations.update()&&(this._cache.dirty=!0),this._cache.x=this.x-this.game.world.camera.x*this.scrollFactor.x,this._cache.y=this.y-this.game.world.camera.y*this.scrollFactor.y;if(this.position.x!=this._cache.x||this.position.y!=this._cache.y)this.position.x=this._cache.x,this.position.y=this._cache.y,this._cache.dirty=!0;this.visible&&(this.renderOrderID=this.game.world.currentRenderOrderID++);if(this.worldTransform[0]!=this._cache.a00||this.worldTransform[1]!=this._cache.a01)this._cache.a00=this.worldTransform[0],this._cache.a01=this.worldTransform[1],this._cache.i01=this.worldTransform[1],this._cache.scaleX=Math.sqrt(this._cache.a00*this._cache.a00+this._cache.a01*this._cache.a01),this._cache.a01*=-1,this._cache.dirty=!0;if(this.worldTransform[3]!=this._cache.a10||this.worldTransform[4]!=this._cache.a11)this._cache.a10=this.worldTransform[3],this._cache.i10=this.worldTransform[3],this._cache.a11=this.worldTransform[4],this._cache.scaleY=Math.sqrt(this._cache.a10*this._cache.a10+this._cache.a11*this._cache.a11),this._cache.a10*=-1,this._cache.dirty=!0;if(this.worldTransform[2]!=this._cache.a02||this.worldTransform[5]!=this._cache.a12)this._cache.a02=this.worldTransform[2],this._cache.a12=this.worldTransform[5],this._cache.dirty=!0;this.currentFrame.uuid!=this._cache.frameID&&(this._cache.frameWidth=this.texture.frame.width,this._cache.frameHeight=this.texture.frame.height,this._cache.frameID=this.currentFrame.uuid,this._cache.dirty=!0),this._cache.dirty&&(this._cache.width=Math.floor(this.currentFrame.sourceSizeW*this._cache.scaleX),this._cache.height=Math.floor(this.currentFrame.sourceSizeH*this._cache.scaleY),this._cache.halfWidth=Math.floor(this._cache.width/2),this._cache.halfHeight=Math.floor(this._cache.height/2),this._cache.id=1/(this._cache.a00*this._cache.a11+this._cache.a01*-this._cache.a10),this._cache.idi=1/(this._cache.a00*this._cache.a11+this._cache.i01*-this._cache.i10),this.updateBounds()),this._cache.dirty&&(this._cache.cameraVisible=Phaser.Rectangle.intersects(this.game.world.camera.screenView,this.bounds,0),this.autoCull==1&&(this.renderable=this._cache.cameraVisible),this.body.updateBounds(this.center.x,this.center.y,this._cache.scaleX,this._cache.scaleY)),this.body.update()},Phaser.Sprite.prototype.postUpdate=function(){this.exists&&this.body.postUpdate()},Phaser.Sprite.prototype.centerOn=function(e,t){this.x=e+(this.x-this.center.x),this.y=t+(this.y-this.center.y)},Phaser.Sprite.prototype.revive=function(){this.alive=!0,this.exists=!0,this.visible=!0,this.events.onRevived.dispatch(this)},Phaser.Sprite.prototype.kill=function(){this.alive=!1,this.exists=!1,this.visible=!1,this.events.onKilled.dispatch(this)},Phaser.Sprite.prototype.reset=function(e,t){this.x=e,this.y=t,this.position.x=e,this.position.y=t,this.alive=!0,this.exists=!0,this.visible=!0,this._outOfBoundsFired=!1,this.body.reset()},Phaser.Sprite.prototype.updateBounds=function(){this.offset.setTo(this._cache.a02-this.anchor.x*this._cache.width,this._cache.a12-this.anchor.y*this._cache.height),this.getLocalPosition(this.center,this.offset.x+this._cache.halfWidth,this.offset.y+this._cache.halfHeight),this.getLocalPosition(this.topLeft,this.offset.x,this.offset.y),this.getLocalPosition(this.topRight,this.offset.x+this._cache.width,this.offset.y),this.getLocalPosition(this.bottomLeft,this.offset.x,this.offset.y+this._cache.height),this.getLocalPosition(this.bottomRight,this.offset.x+this._cache.width,this.offset.y+this._cache.height),this._cache.left=Phaser.Math.min(this.topLeft.x,this.topRight.x,this.bottomLeft.x,this.bottomRight.x),this._cache.right=Phaser.Math.max(this.topLeft.x,this.topRight.x,this.bottomLeft.x,this.bottomRight.x),this._cache.top=Phaser.Math.min(this.topLeft.y,this.topRight.y,this.bottomLeft.y,this.bottomRight.y),this._cache.bottom=Phaser.Math.max(this.topLeft.y,this.topRight.y,this.bottomLeft.y,this.bottomRight.y),this.bounds.setTo(this._cache.left,this._cache.top,this._cache.right-this._cache.left,this._cache.bottom-this._cache.top),this._cache.boundsX=this._cache.x,this._cache.boundsY=this._cache.y,this.inWorld==0?(this.inWorld=Phaser.Rectangle.intersects(this.bounds,this.game.world.bounds,this.inWorldThreshold),this.inWorld&&(this._outOfBoundsFired=!1)):(this.inWorld=Phaser.Rectangle.intersects(this.bounds,this.game.world.bounds,this.inWorldThreshold),this.inWorld==0&&(this.events.onOutOfBounds.dispatch(this),this._outOfBoundsFired=!0))},Phaser.Sprite.prototype.getLocalPosition=function(e,t,n){return e.x=(this._cache.a11*this._cache.id*t+ -this._cache.a01*this._cache.id*n+(this._cache.a12*this._cache.a01-this._cache.a02*this._cache.a11)*this._cache.id)*this._cache.scaleX+this._cache.a02,e.y=(this._cache.a00*this._cache.id*n+ -this._cache.a10*this._cache.id*t+(-this._cache.a12*this._cache.a00+this._cache.a02*this._cache.a10)*this._cache.id)*this._cache.scaleY+this._cache.a12,e},Phaser.Sprite.prototype.getLocalUnmodifiedPosition=function(e,t,n){return e.x=this._cache.a11*this._cache.idi*t+ -this._cache.i01*this._cache.idi*n+(this._cache.a12*this._cache.i01-this._cache.a02*this._cache.a11)*this._cache.idi,e.y=this._cache.a00*this._cache.idi*n+ -this._cache.i10*this._cache.idi*t+(-this._cache.a12*this._cache.a00+this._cache.a02*this._cache.i10)*this._cache.idi,e},Phaser.Sprite.prototype.bringToTop=function(){this.group?this.group.bringToTop(this):this.game.world.bringToTop(this)},Phaser.Sprite.prototype.getBounds=function(e){e=e||new Phaser.Rectangle;var t=Phaser.Math.min(this.topLeft.x,this.topRight.x,this.bottomLeft.x,this.bottomRight.x),n=Phaser.Math.max(this.topLeft.x,this.topRight.x,this.bottomLeft.x,this.bottomRight.x),r=Phaser.Math.min(this.topLeft.y,this.topRight.y,this.bottomLeft.y,this.bottomRight.y),i=Phaser.Math.max(this.topLeft.y,this.topRight.y,this.bottomLeft.y,this.bottomRight.y);return e.x=t,e.y=r,e.width=n-t,e.height=i-r,e},Object.defineProperty(Phaser.Sprite.prototype,"angle",{get:function(){return Phaser.Math.radToDeg(this.rotation)},set:function(e){this.rotation=Phaser.Math.degToRad(e)}}),Object.defineProperty(Phaser.Sprite.prototype,"frame",{get:function(){return this.animations.frame},set:function(e){this.animations.frame=e}}),Object.defineProperty(Phaser.Sprite.prototype,"frameName",{get:function(){return this.animations.frameName},set:function(e){this.animations.frameName=e}}),Object.defineProperty(Phaser.Sprite.prototype,"inCamera",{get:function(){return this._cache.cameraVisible}}),Object.defineProperty(Phaser.Sprite.prototype,"crop",{get:function(){return this._cropRect},set:function(e){e instanceof Phaser.Rectangle&&(this._cropUUID==null?(this._cropUUID=this.game.rnd.uuid(),PIXI.TextureCache[this._cropUUID]=new PIXI.Texture(PIXI.BaseTextureCache[this.key],{x:e.x,y:e.y,width:e.width,height:e.height})):PIXI.TextureCache[this._cropUUID].frame=e,this._cropRect=e,this.setTexture(PIXI.TextureCache[this._cropUUID]))}}),Object.defineProperty(Phaser.Sprite.prototype,"inputEnabled",{get:function(){return this.input.enabled},set:function(e){e?this.input.enabled==0&&this.input.start():this.input.enabled&&this.input.stop()}}),Phaser.TileSprite=function(e,t,n,r,i,s,o){t=t||0,n=n||0,r=r||256,i=i||256,s=s||null,o=o||null,Phaser.Sprite.call(this,e,t,n,s,o),this.texture=PIXI.TextureCache[s],PIXI.TilingSprite.call(this,this.texture,r,i),this.type=Phaser.TILESPRITE,this.tileScale=new Phaser.Point(1,1),this.tilePosition=new Phaser.Point(0,0)},Phaser.TileSprite.prototype=Phaser.Utils.extend(!0,PIXI.TilingSprite.prototype,Phaser.Sprite.prototype),Phaser.TileSprite.prototype.constructor=Phaser.TileSprite,Phaser.Text=function(e,t,n,r,i){t=t||0,n=n||0,r=r||"",i=i||"",this.exists=!0,this.alive=!0,this.group=null,this.name="",this.game=e,this._text=r,this._style=i,PIXI.Text.call(this,r,i),this.type=Phaser.TEXT,this.position.x=this.x=t,this.position.y=this.y=n,this.anchor=new Phaser.Point,this.scale=new Phaser.Point(1,1),this.scrollFactor=new Phaser.Point(1,1),this._cache={dirty:!1,a00:1,a01:0,a02:t,a10:0,a11:1,a12:n,id:1,x:-1,y:-1,scaleX:1,scaleY:1},this._cache.x=this.x-this.game.world.camera.x*this.scrollFactor.x,this._cache.y=this.y-this.game.world.camera.y*this.scrollFactor.y,this.renderable=!0},Phaser.Text.prototype=Object.create(PIXI.Text.prototype),Phaser.Text.prototype.constructor=Phaser.Text,Phaser.Text.prototype.update=function(){if(!this.exists)return;this._cache.dirty=!1,this._cache.x=this.x-this.game.world.camera.x*this.scrollFactor.x,this._cache.y=this.y-this.game.world.camera.y*this.scrollFactor.y;if(this.position.x!=this._cache.x||this.position.y!=this._cache.y)this.position.x=this._cache.x,this.position.y=this._cache.y,this._cache.dirty=!0},Object.defineProperty(Phaser.Text.prototype,"angle",{get:function(){return Phaser.Math.radToDeg(this.rotation)},set:function(e){this.rotation=Phaser.Math.degToRad(e)}}),Object.defineProperty(Phaser.Text.prototype,"text",{get:function(){return this._text},set:function(e){e!==this._text&&(this._text=e,this.dirty=!0)}}),Object.defineProperty(Phaser.Text.prototype,"style",{get:function(){return this._style},set:function(e){e!==this._style&&(this._style=e,this.dirty=!0)}}),Phaser.BitmapText=function(e,t,n,r,i){t=t||0,n=n||0,r=r||"",i=i||"",this.exists=!0,this.alive=!0,this.group=null,this.name="",this.game=e,PIXI.BitmapText.call(this,r,i),this.type=Phaser.BITMAPTEXT,this.position.x=t,this.position.y=n,this.anchor=new Phaser.Point,this.scale=new Phaser.Point(1,1),this.scrollFactor=new Phaser.Point(1,1),this._cache={dirty:!1,a00:1,a01:0,a02:t,a10:0,a11:1,a12:n,id:1,x:-1,y:-1,scaleX:1,scaleY:1},this._cache.x=this.x-this.game.world.camera.x*this.scrollFactor.x,this._cache.y=this.y-this.game.world.camera.y*this.scrollFactor.y,this.renderable=!0},Phaser.BitmapText.prototype=Object.create(PIXI.BitmapText.prototype),Phaser.BitmapText.prototype.constructor=Phaser.BitmapText,Phaser.BitmapText.prototype.update=function(){if(!this.exists)return;this._cache.dirty=!1,this._cache.x=this.x-this.game.world.camera.x*this.scrollFactor.x,this._cache.y=this.y-this.game.world.camera.y*this.scrollFactor.y;if(this.position.x!=this._cache.x||this.position.y!=this._cache.y)this.position.x=this._cache.x,this.position.y=this._cache.y,this._cache.dirty=!0;this.pivot.x=this.anchor.x*this.width,this.pivot.y=this.anchor.y*this.height},Object.defineProperty(Phaser.BitmapText.prototype,"angle",{get:function(){return Phaser.Math.radToDeg(this.rotation)},set:function(e){this.rotation=Phaser.Math.degToRad(e)}}),Object.defineProperty(Phaser.BitmapText.prototype,"x",{get:function(){return this.position.x},set:function(e){this.position.x=e}}),Object.defineProperty(Phaser.BitmapText.prototype,"y",{get:function(){return this.position.y},set:function(e){this.position.y=e}}),Phaser.Button=function(e,t,n,r,i,s,o,u,a){t=t||0,n=n||0,r=r||null,i=i||null,s=s||this,Phaser.Sprite.call(this,e,t,n,r,u),this.type=Phaser.BUTTON,this._onOverFrameName=null,this._onOutFrameName=null,this._onDownFrameName=null,this._onUpFrameName=null,this._onOverFrameID=null,this._onOutFrameID=null,this._onDownFrameID=null,this._onUpFrameID=null,this.onInputOver=new Phaser.Signal,this.onInputOut=new Phaser.Signal,this.onInputDown=new Phaser.Signal,this.onInputUp=new Phaser.Signal,this.setFrames(o,u,a),i!==null&&this.onInputUp.add(i,s),this.input.start(0,!1,!0),this.events.onInputOver.add(this.onInputOverHandler,this),this.events.onInputOut.add(this.onInputOutHandler,this),this.events.onInputDown.add(this.onInputDownHandler,this),this.events.onInputUp.add(this.onInputUpHandler,this)},Phaser.Button.prototype=Phaser.Utils.extend(!0,Phaser.Sprite.prototype,PIXI.Sprite.prototype),Phaser.Button.prototype.constructor=Phaser.Button,Phaser.Button.prototype.setFrames=function(e,t,n){e!==null&&(typeof e=="string"?this._onOverFrameName=e:this._onOverFrameID=e),t!==null&&(typeof t=="string"?(this._onOutFrameName=t,this._onUpFrameName=t):(this._onOutFrameID=t,this._onUpFrameID=t)),n!==null&&(typeof n=="string"?this._onDownFrameName=n:this._onDownFrameID=n)},Phaser.Button.prototype.onInputOverHandler=function(e){this._onOverFrameName!=null?this.frameName=this._onOverFrameName:this._onOverFrameID!=null&&(this.frame=this._onOverFrameID),this.onInputOver&&this.onInputOver.dispatch(this,e)},Phaser.Button.prototype.onInputOutHandler=function(e){this._onOutFrameName!=null?this.frameName=this._onOutFrameName:this._onOutFrameID!=null&&(this.frame=this._onOutFrameID),this.onInputOut&&this.onInputOut.dispatch(this,e)},Phaser.Button.prototype.onInputDownHandler=function(e){this._onDownFrameName!=null?this.frameName=this._onDownFrameName:this._onDownFrameID!=null&&(this.frame=this._onDownFrameID),this.onInputDown&&this.onInputDown.dispatch(this,e)},Phaser.Button.prototype.onInputUpHandler=function(e){this._onUpFrameName!=null?this.frameName=this._onUpFrameName:this._onUpFrameID!=null&&(this.frame=this._onUpFrameID),this.onInputUp&&this.onInputUp.dispatch(this,e)},Phaser.Graphics=function(e,t,n){PIXI.Graphics.call(this),Phaser.Sprite.call(this,e,t,n),this.type=Phaser.GRAPHICS},Phaser.Graphics.prototype=Object.create(PIXI.Graphics.prototype),Phaser.Graphics.prototype.constructor=Phaser.Graphics,Phaser.Graphics.prototype=Phaser.Utils.extend(!0,Phaser.Graphics.prototype,Phaser.Sprite.prototype),Object.defineProperty(Phaser.Graphics.prototype,"angle",{get:function(){return Phaser.Math.radToDeg(this.rotation)},set:function(e){this.rotation=Phaser.Math.degToRad(e)}}),Phaser.RenderTexture=function(e,t,n,r){this.game=e,this.name=t,PIXI.EventTarget.call(this),this.width=n||100,this.height=r||100,this.indetityMatrix=PIXI.mat3.create(),this.frame=new PIXI.Rectangle(0,0,this.width,this.height),this.type=Phaser.RENDERTEXTURE,PIXI.gl?this.initWebGL():this.initCanvas()},Phaser.RenderTexture.prototype=Phaser.Utils.extend(!0,PIXI.RenderTexture.prototype),Phaser.RenderTexture.prototype.constructor=Phaser.RenderTexture,Phaser.Canvas={create:function(e,t){e=e||256,t=t||256;var n=document.createElement("canvas");return n.width=e,n.height=t,n.style.display="block",n},getOffset:function(e,t){t=t||new Phaser.Point;var n=e.getBoundingClientRect(),r=e.clientTop||document.body.clientTop||0,i=e.clientLeft||document.body.clientLeft||0,s=window.pageYOffset||e.scrollTop||document.body.scrollTop,o=window.pageXOffset||e.scrollLeft||document.body.scrollLeft;return t.x=n.left+o-i,t.y=n.top+s-r,t},getAspectRatio:function(e){return e.width/e.height},setBackgroundColor:function(e,t){return t=t||"rgb(0,0,0)",e.style.backgroundColor=t,e},setTouchAction:function(e,t){return t=t||"none",e.style.msTouchAction=t,e.style["ms-touch-action"]=t,e.style["touch-action"]=t,e},addToDOM:function(e,t,n){return t=t||"",typeof n=="undefined"&&(n=!0),t!==""?document.getElementById(t)?(document.getElementById(t).appendChild(e),n&&(document.getElementById(t).style.overflow="hidden")):document.body.appendChild(e):document.body.appendChild(e),e},setTransform:function(e,t,n,r,i,s,o){return e.setTransform(r,s,o,i,t,n),e},setSmoothingEnabled:function(e,t){return e.imageSmoothingEnabled=t,e.mozImageSmoothingEnabled=t,e.oImageSmoothingEnabled=t,e.webkitImageSmoothingEnabled=t,e.msImageSmoothingEnabled=t,e},setImageRenderingCrisp:function(e){return e.style["image-rendering"]="crisp-edges",e.style["image-rendering"]="-moz-crisp-edges",e.style["image-rendering"]="-webkit-optimize-contrast",e.style.msInterpolationMode="nearest-neighbor",e},setImageRenderingBicubic:function(e){return e.style["image-rendering"]="auto",e.style.msInterpolationMode="bicubic",e}},Phaser.StageScaleMode=function(e,t,n){this._startHeight=0,this.forceLandscape=!1,this.forcePortrait=!1,this.incorrectOrientation=!1,this.pageAlignHorizontally=!1,this.pageAlignVeritcally=!1,this.minWidth=null,this.maxWidth=null,this.minHeight=null,this.maxHeight=null,this.width=0,this.height=0,this.maxIterations=5,this.game=e,this.enterLandscape=new Phaser.Signal,this.enterPortrait=new Phaser.Signal,window.orientation?this.orientation=window.orientation:window.outerWidth>window.outerHeight?this.orientation=90:this.orientation=0,this.scaleFactor=new Phaser.Point(1,1),this.aspectRatio=0;var r=this;window.addEventListener("orientationchange",function(e){return r.checkOrientation(e)},!1),window.addEventListener("resize",function(e){return r.checkResize(e)},!1)},Phaser.StageScaleMode.EXACT_FIT=0,Phaser.StageScaleMode.NO_SCALE=1,Phaser.StageScaleMode.SHOW_ALL=2,Phaser.StageScaleMode.prototype={startFullScreen:function(){if(this.isFullScreen)return;var e=this.game.canvas;e.requestFullScreen?e.requestFullScreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullScreen&&e.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT),this.game.stage.canvas.style.width="100%",this.game.stage.canvas.style.height="100%"},stopFullScreen:function(){document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()},checkOrientationState:function(){if(this.incorrectOrientation){if(this.forceLandscape&&window.innerWidth>window.innerHeight||this.forcePortrait&&window.innerHeight>window.innerWidth)this.game.paused=!1,this.incorrectOrientation=!1,this.refresh()}else if(this.forceLandscape&&window.innerWidth<window.innerHeight||this.forcePortrait&&window.innerHeight<window.innerWidth)this.game.paused=!0,this.incorrectOrientation=!0,this.refresh()},checkOrientation:function(e){this.orientation=window.orientation,this.isLandscape?this.enterLandscape.dispatch(this.orientation,!0,!1):this.enterPortrait.dispatch(this.orientation,!1,!0),this.game.stage.scaleMode!==Phaser.StageScaleMode.NO_SCALE&&this.refresh()},checkResize:function(e){window.outerWidth>window.outerHeight?this.orientation=90:this.orientation=0,this.isLandscape?this.enterLandscape.dispatch(this.orientation,!0,!1):this.enterPortrait.dispatch(this.orientation,!1,!0),this.game.stage.scaleMode!==Phaser.StageScaleMode.NO_SCALE&&this.refresh()},refresh:function(){var e=this;this.game.device.iPad==0&&this.game.device.webApp==0&&this.game.device.desktop==0&&(this.game.device.android&&this.game.device.chrome==0?window.scrollTo(0,1):window.scrollTo(0,0)),this._check==null&&this.maxIterations>0&&(this._iterations=this.maxIterations,this._check=window.setInterval(function(){return e.setScreenSize()},10),this.setScreenSize())},setScreenSize:function(e){typeof e=="undefined"&&(e=!1),this.game.device.iPad==0&&this.game.device.webApp==0&&this.game.device.desktop==0&&(this.game.device.android&&this.game.device.chrome==0?window.scrollTo(0,1):window.scrollTo(0,0)),this._iterations--;if(e||window.innerHeight>this._startHeight||this._iterations<0)document.documentElement.style.minHeight=window.innerHeight+"px",this.incorrectOrientation==1?this.setMaximum():this.game.stage.scaleMode==Phaser.StageScaleMode.EXACT_FIT?this.setExactFit():this.game.stage.scaleMode==Phaser.StageScaleMode.SHOW_ALL&&this.setShowAll(),this.setSize(),clearInterval(this._check),this._check=null},setSize:function(){this.incorrectOrientation==0&&(this.maxWidth&&this.width>this.maxWidth&&(this.width=this.maxWidth),this.maxHeight&&this.height>this.maxHeight&&(this.height=this.maxHeight),this.minWidth&&this.width<this.minWidth&&(this.width=this.minWidth),this.minHeight&&this.height<this.minHeight&&(this.height=this.minHeight)),this.game.canvas.style.width=this.width+"px",this.game.canvas.style.height=this.height+"px",this.game.input.scale.setTo(this.game.width/this.width,this.game.height/this.height),this.pageAlignHorizontally&&(this.width<window.innerWidth&&this.incorrectOrientation==0?this.game.canvas.style.marginLeft=Math.round((window.innerWidth-this.width)/2)+"px":this.game.canvas.style.marginLeft="0px"),this.pageAlignVeritcally&&(this.height<window.innerHeight&&this.incorrectOrientation==0?this.game.canvas.style.marginTop=Math.round((window.innerHeight-this.height)/2)+"px":this.game.canvas.style.marginTop="0px"),Phaser.Canvas.getOffset(this.game.canvas,this.game.stage.offset),this.aspectRatio=this.width/this.height,this.scaleFactor.x=this.game.width/this.width,this.scaleFactor.y=this.game.height/this.height},setMaximum:function(){this.width=window.innerWidth,this.height=window.innerHeight},setShowAll:function(){var e=Math.min(window.innerHeight/this.game.height,window.innerWidth/this.game.width);this.width=Math.round(this.game.width*e),this.height=Math.round(this.game.height*e)},setExactFit:function(){var e=window.innerWidth-0,t=window.innerHeight-5;console.log("available",e,t),this.maxWidth&&e>this.maxWidth?this.width=this.maxWidth:this.width=e,this.maxHeight&&t>this.maxHeight?this.height=this.maxHeight:this.height=t,console.log("setExactFit",this.width,this.height,this.game.stage.offset)}},Object.defineProperty(Phaser.StageScaleMode.prototype,"isFullScreen",{get:function(){return document.fullscreenElement===null||document.mozFullScreenElement===null||document.webkitFullscreenElement===null?!1:!0}}),Object.defineProperty(Phaser.StageScaleMode.prototype,"isPortrait",{get:function(){return this.orientation==0||this.orientation==180}}),Object.defineProperty(Phaser.StageScaleMode.prototype,"isLandscape",{get:function(){return this.orientation===90||this.orientation===-90}}),Phaser.Device=function(){this.patchAndroidClearRectBug=!1,this.desktop=!1,this.iOS=!1,this.android=!1,this.chromeOS=!1,this.linux=!1,this.macOS=!1,this.windows=!1,this.canvas=!1,this.file=!1,this.fileSystem=!1,this.localStorage=!1,this.webGL=!1,this.worker=!1,this.touch=!1,this.mspointer=!1,this.css3D=!1,this.pointerLock=!1,this.arora=!1,this.chrome=!1,this.epiphany=!1,this.firefox=!1,this.ie=!1,this.ieVersion=0,this.mobileSafari=!1,this.midori=!1,this.opera=!1,this.safari=!1,this.webApp=!1,this.audioData=!1,this.webAudio=!1,this.ogg=!1,this.opus=!1,this.mp3=!1,this.wav=!1,this.m4a=!1,this.webm=!1,this.iPhone=!1,this.iPhone4=!1,this.iPad=!1,this.pixelRatio=0,this._checkAudio(),this._checkBrowser(),this._checkCSS3D(),this._checkDevice(),this._checkFeatures(),this._checkOS()},Phaser.Device.prototype={_checkOS:function(){var e=navigator.userAgent;/Android/.test(e)?this.android=!0:/CrOS/.test(e)?this.chromeOS=!0:/iP[ao]d|iPhone/i.test(e)?this.iOS=!0:/Linux/.test(e)?this.linux=!0:/Mac OS/.test(e)?this.macOS=!0:/Windows/.test(e)&&(this.windows=!0);if(this.windows||this.macOS||this.linux)this.desktop=!0},_checkFeatures:function(){this.canvas=!!window.CanvasRenderingContext2D;try{this.localStorage=!!localStorage.getItem}catch(e){this.localStorage=!1}this.file=!!window.File&&!!window.FileReader&&!!window.FileList&&!!window.Blob,this.fileSystem=!!window.requestFileSystem,this.webGL=function(){try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(e){return!1}}(),this.worker=!!window.Worker;if("ontouchstart"in document.documentElement||window.navigator.msPointerEnabled)this.touch=!0;window.navigator.msPointerEnabled&&(this.mspointer=!0),this.pointerLock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document},_checkBrowser:function(){var e=navigator.userAgent;/Arora/.test(e)?this.arora=!0:/Chrome/.test(e)?this.chrome=!0:/Epiphany/.test(e)?this.epiphany=!0:/Firefox/.test(e)?this.firefox=!0:/Mobile Safari/.test(e)?this.mobileSafari=!0:/MSIE (\d+\.\d+);/.test(e)?(this.ie=!0,this.ieVersion=parseInt(RegExp.$1)):/Midori/.test(e)?this.midori=!0:/Opera/.test(e)?this.opera=!0:/Safari/.test(e)&&(this.safari=!0),navigator.standalone&&(this.webApp=!0)},_checkAudio:function(){this.audioData=!!window.Audio,this.webAudio=!!window.webkitAudioContext||!!window.AudioContext;var e=document.createElement("audio"),t=!1;try{if(t=!!e.canPlayType){e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.ogg=!0),e.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,"")&&(this.opus=!0),e.canPlayType("audio/mpeg;").replace(/^no$/,"")&&(this.mp3=!0),e.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"")&&(this.wav=!0);if(e.canPlayType("audio/x-m4a;")||e.canPlayType("audio/aac;").replace(/^no$/,""))this.m4a=!0;e.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")&&(this.webm=!0)}}catch(n){}},_checkDevice:function(){this.pixelRatio=window.devicePixelRatio||1,this.iPhone=navigator.userAgent.toLowerCase().indexOf("iphone")!=-1,this.iPhone4=this.pixelRatio==2&&this.iPhone,this.iPad=navigator.userAgent.toLowerCase().indexOf("ipad")!=-1},_checkCSS3D:function(){var e=document.createElement("p"),t,n={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};document.body.insertBefore(e,null);for(var r in n)e.style[r]!==undefined&&(e.style[r]="translate3d(1px,1px,1px)",t=window.getComputedStyle(e).getPropertyValue(n[r]));document.body.removeChild(e),this.css3D=t!==undefined&&t.length>0&&t!=="none"},canPlayAudio:function(e){return e=="mp3"&&this.mp3?!0:e=="ogg"&&(this.ogg||this.opus)?!0:e=="m4a"&&this.m4a?!0:e=="wav"&&this.wav?!0:e=="webm"&&this.webm?!0:!1},isConsoleOpen:function(){return window.console&&window.console.firebug?!0:window.console?(console.profile(),console.profileEnd(),console.clear&&console.clear(),console.profiles.length>0):!1}},Phaser.RequestAnimationFrame=function(e){this.game=e,this._isSetTimeOut=!1,this.isRunning=!1;var t=["ms","moz","webkit","o"];for(var n=0;n<t.length&&!window.requestAnimationFrame;n++)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]},Phaser.RequestAnimationFrame.prototype={_onLoop:null,start:function(){this.isRunning=!0;var e=this;window.requestAnimationFrame?(this._isSetTimeOut=!1,this._onLoop=function(t){return e.updateRAF(t)},window.requestAnimationFrame(this._onLoop)):(this._isSetTimeOut=!0,this._onLoop=function(){return e.updateSetTimeout()},this._timeOutID=window.setTimeout(this._onLoop,0))},updateRAF:function(e){this.game.update(e),window.requestAnimationFrame(this._onLoop)},updateSetTimeout:function(){this.game.update(Date.now()),this._timeOutID=window.setTimeout(this._onLoop,this.game.time.timeToCall)},stop:function(){this._isSetTimeOut?clearTimeout(this._timeOutID):window.cancelAnimationFrame,this.isRunning=!1},isSetTimeOut:function(){return this._isSetTimeOut},isRAF:function(){return this._isSetTimeOut===!1}},Phaser.RandomDataGenerator=function(e){typeof e=="undefined"&&(e=[]),this.sow(e)},Phaser.RandomDataGenerator.prototype={c:1,s0:0,s1:0,s2:0,rnd:function(){var e=2091639*this.s0+this.c*2.3283064365386963e-10;return this.c=e|0,this.s0=this.s1,this.s1=this.s2,this.s2=e-this.c,this.s2},sow:function(e){typeof e=="undefined"&&(e=[]),this.s0=this.hash(" "),this.s1=this.hash(this.s0),this.s2=this.hash(this.s1);var t;for(var n=0;t=e[n++];)this.s0-=this.hash(t),this.s0+=~~(this.s0<0),this.s1-=this.hash(t),this.s1+=~~(this.s1<0),this.s2-=this.hash(t),this.s2+=~~(this.s2<0)},hash:function(e){var t,n,r;r=4022871197,e=e.toString();for(n=0;n<e.length;n++)r+=e.charCodeAt(n),t=.02519603282416938*r,r=t>>>0,t-=r,t*=r,r=t>>>0,t-=r,r+=t*4294967296;return(r>>>0)*2.3283064365386963e-10},integer:function(){return this.rnd.apply(this)*4294967296},frac:function(){return this.rnd.apply(this)+(this.rnd.apply(this)*2097152|0)*1.1102230246251565e-16},real:function(){return this.integer()+this.frac()},integerInRange:function(e,t){return Math.floor(this.realInRange(e,t))},realInRange:function(e,t){return e=e||0,t=t||0,this.frac()*(t-e)+e},normal:function(){return 1-2*this.frac()},uuid:function(){var e,t;for(t=e="";e++<36;t+=~e%5|e*3&4?(e^15?8^this.frac()*(e^20?16:4):4).toString(16):"-");return t},pick:function(e){return e[this.integerInRange(0,e.length)]},weightedPick:function(e){return e[~~(Math.pow(this.frac(),2)*e.length)]},timestamp:function(e,t){return this.realInRange(e||9466848e5,t||1577862e6)},angle:function(){return this.integerInRange(-180,180)}},Phaser.Math={PI2:Math.PI*2,fuzzyEqual:function(e,t,n){return typeof n=="undefined"&&(n=1e-4),Math.abs(e-t)<n},fuzzyLessThan:function(e,t,n){return typeof n=="undefined"&&(n=1e-4),e<t+n},fuzzyGreaterThan:function(e,t,n){return typeof n=="undefined"&&(n=1e-4),e>t-n},fuzzyCeil:function(e,t){return typeof t=="undefined"&&(t=1e-4),Math.ceil(e-t)},fuzzyFloor:function(e,t){return typeof t=="undefined"&&(t=1e-4),Math.floor(e+t)},average:function(){var e=[];for(var t=0;t<arguments.length-0;t++)e[t]=arguments[t+0];var n=0;for(var r=0;r<e.length;r++)n+=e[r];return n/e.length},truncate:function(e){return e>0?Math.floor(e):Math.ceil(e)},shear:function(e){return e%1},snapTo:function(e,t,n){return typeof n=="undefined"&&(n=0),t==0?e:(e-=n,e=t*Math.round(e/t),n+e)},snapToFloor:function(e,t,n){return typeof n=="undefined"&&(n=0),t==0?e:(e-=n,e=t*Math.floor(e/t),n+e)},snapToCeil:function(e,t,n){return typeof n=="undefined"&&(n=0),t==0?e:(e-=n,e=t*Math.ceil(e/t),n+e)},snapToInArray:function(e,t,n){typeof n=="undefined"&&(n=!0),n&&t.sort();if(e<t[0])return t[0];var r=1;while(t[r]<e)r++;var i=t[r-1],s=r<t.length?t[r]:Number.POSITIVE_INFINITY;return s-e<=e-i?s:i},roundTo:function(e,t,n){typeof t=="undefined"&&(t=0),typeof n=="undefined"&&(n=10);var r=Math.pow(n,-t);return Math.round(e*r)/r},floorTo:function(e,t,n){typeof t=="undefined"&&(t=0),typeof n=="undefined"&&(n=10);var r=Math.pow(n,-t);return Math.floor(e*r)/r},ceilTo:function(e,t,n){typeof t=="undefined"&&(t=0),typeof n=="undefined"&&(n=10);var r=Math.pow(n,-t);return Math.ceil(e*r)/r},interpolateFloat:function(e,t,n){return(t-e)*n+e},angleBetween:function(e,t,n,r){return Math.atan2(r-t,n-e)},normalizeAngle:function(e,t){typeof t=="undefined"&&(t=!0);var n=t?Math.PI:180;return this.wrap(e,-n,n)},nearestAngleBetween:function(e,t,n){typeof n=="undefined"&&(n=!0);var r=n?Math.PI:180;return e=this.normalizeAngle(e,n),t=this.normalizeAngle(t,n),e<-r/2&&t>r/2&&(e+=r*2),t<-r/2&&e>r/2&&(t+=r*2),t-e},interpolateAngles:function(e,t,n,r,i){return typeof r=="undefined"&&(r=!0),typeof i=="undefined"&&(i=null),e=this.normalizeAngle(e,r),t=this.normalizeAngleToAnother(t,e,r),typeof i=="function"?i(n,e,t-e,1):this.interpolateFloat(e,t,n)},chanceRoll:function(e){return typeof e=="undefined"&&(e=50),e<=0?!1:e>=100?!0:Math.random()*100>=e?!1:!0},numberArray:function(e,t){var n=[];for(var r=e;r<=t;r++)n.push(r);return n},maxAdd:function(e,t,n){return e+=t,e>n&&(e=n),e},minSub:function(e,t,n){return e-=t,e<n&&(e=n),e},wrap:function(e,t,n){var r=n-t;if(r<=0)return 0;var i=(e-t)%r;return i<0&&(i+=r),i+t},wrapValue:function(e,t,n){var r;return e=Math.abs(e),t=Math.abs(t),n=Math.abs(n),r=(e+t)%n,r},randomSign:function(){return Math.random()>.5?1:-1},isOdd:function(e){return e&1},isEven:function(e){return e&1?!1:!0},max:function(){for(var e=1,t=0,n=arguments.length;e<n;e++)arguments[t]<arguments[e]&&(t=e);return arguments[t]},min:function(){for(var e=1,t=0,n=arguments.length;e<n;e++)arguments[e]<arguments[t]&&(t=e);return arguments[t]},wrapAngle:function(e){var t=e;return e>=-180&&e<=180?e:(t=(e+180)%360,t<0&&(t+=360),t-180)},angleLimit:function(e,t,n){var r=e;return e>n?r=n:e<t&&(r=t),r},linearInterpolation:function(e,t){var n=e.length-1,r=n*t,i=Math.floor(r);return t<0?this.linear(e[0],e[1],r):t>1?this.linear(e[n],e[n-1],n-r):this.linear(e[i],e[i+1>n?n:i+1],r-i)},bezierInterpolation:function(e,t){var n=0,r=e.length-1;for(var i=0;i<=r;i++)n+=Math.pow(1-t,r-i)*Math.pow(t,i)*e[i]*this.bernstein(r,i);return n},catmullRomInterpolation:function(e,t){var n=e.length-1,r=n*t,i=Math.floor(r);return e[0]===e[n]?(t<0&&(i=Math.floor(r=n*(1+t))),this.catmullRom(e[(i-1+n)%n],e[i],e[(i+1)%n],e[(i+2)%n],r-i)):t<0?e[0]-(this.catmullRom(e[0],e[0],e[1],e[1],-r)-e[0]):t>1?e[n]-(this.catmullRom(e[n],e[n],e[n-1],e[n-1],r-n)-e[n]):this.catmullRom(e[i?i-1:0],e[i],e[n<i+1?n:i+1],e[n<i+2?n:i+2],r-i)},linear:function(e,t,n){return(t-e)*n+e},bernstein:function(e,t){return this.factorial(e)/this.factorial(t)/this.factorial(e-t)},catmullRom:function(e,t,n,r,i){var s=(n-e)*.5,o=(r-t)*.5,u=i*i,a=i*u;return(2*t-2*n+s+o)*a+(-3*t+3*n-2*s-o)*u+s*i+t},difference:function(e,t){return Math.abs(e-t)},getRandom:function(e,t,n){typeof t=="undefined"&&(t=0),typeof n=="undefined"&&(n=0);if(e!=null){var r=n;if(r==0||r>e.length-t)r=e.length-t;if(r>0)return e[t+Math.floor(Math.random()*r)]}return null},floor:function(e){var t=e|0;return e>0?t:t!=e?t-1:t},ceil:function(e){var t=e|0;return e>0?t!=e?t+1:t:t},sinCosGenerator:function(e,t,n,r){typeof t=="undefined"&&(t=1),typeof n=="undefined"&&(n=1),typeof r=="undefined"&&(r=1);var i=t,s=n,o=r*Math.PI/e,u=[],a=[];for(var f=0;f<e;f++)s-=i*o,i+=s*o,u[f]=s,a[f]=i;return{sin:a,cos:u}},shift:function(e){var t=e.shift();return e.push(t),t},shuffleArray:function(e){for(var t=e.length-1;t>0;t--){var n=Math.floor(Math.random()*(t+1)),r=e[t];e[t]=e[n],e[n]=r}return e},distance:function(e,t,n,r){var i=e-n,s=t-r;return Math.sqrt(i*i+s*s)},distanceRounded:function(e,t,n,r){return Math.round(Phaser.Math.distance(e,t,n,r))},clamp:function(e,t,n){return e<t?t:e>n?n:e},clampBottom:function(e,t){return e<t?t:e},mapLinear:function(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t),e*e*(3-2*e))},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t),e*e*e*(e*(e*6-15)+10))},sign:function(e){return e<0?-1:e>0?1:0},degToRad:function(){var e=Math.PI/180;return function(t){return t*e}}(),radToDeg:function(){var e=180/Math.PI;return function(t){return t*e}}()},Phaser.QuadTree=function(e,t,n,r,i,s,o,u){this.physicsManager=e,this.ID=e.quadTreeID,e.quadTreeID++,this.maxObjects=s||10,this.maxLevels=o||4,this.level=u||0,this.bounds={x:Math.round(t),y:Math.round(n),width:r,height:i,subWidth:Math.floor(r/2),subHeight:Math.floor(i/2),right:Math.round(t)+Math.floor(r/2),bottom:Math.round(n)+Math.floor(i/2)},this.objects=[],this.nodes=[]},Phaser.QuadTree.prototype={split:function(){this.level++,this.nodes[0]=new Phaser.QuadTree(this.physicsManager,this.bounds.right,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level),this.nodes[1]=new Phaser.QuadTree(this.physicsManager,this.bounds.x,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level),this.nodes[2]=new Phaser.QuadTree(this.physicsManager,this.bounds.x,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level),this.nodes[3]=new Phaser.QuadTree(this.physicsManager,this.bounds.right,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level)},insert:function(e){var t=0,n;if(this.nodes[0]!=null){n=this.getIndex(e);if(n!==-1){this.nodes[n].insert(e);return}}this.objects.push(e);if(this.objects.length>this.maxObjects&&this.level<this.maxLevels){this.nodes[0]==null&&this.split();while(t<this.objects.length)n=this.getIndex(this.objects[t]),n!==-1?this.nodes[n].insert(this.objects.splice(t,1)[0]):t++}},getIndex:function(e){var t=-1;return e.x<this.bounds.right&&e.right<this.bounds.right?e.y<this.bounds.bottom&&e.bottom<this.bounds.bottom?t=1:e.y>this.bounds.bottom&&(t=2):e.x>this.bounds.right&&(e.y<this.bounds.bottom&&e.bottom<this.bounds.bottom?t=0:e.y>this.bounds.bottom&&(t=3)),t},retrieve:function(e){var t=this.objects;return e.body.quadTreeIndex=this.getIndex(e.body),e.body.quadTreeIDs.push(this.ID),this.nodes[0]&&(e.body.quadTreeIndex!==-1?t=t.concat(this.nodes[e.body.quadTreeIndex].retrieve(e)):(t=t.concat(this.nodes[0].retrieve(e)),t=t.concat(this.nodes[1].retrieve(e)),t=t.concat(this.nodes[2].retrieve(e)),t=t.concat(this.nodes[3].retrieve(e)))),t},clear:function(){this.objects=[];for(var e=0,t=this.nodes.length;e<t;e++)this.nodes[e]&&(this.nodes[e].clear(),delete this.nodes[e])}},Phaser.Circle=function(e,t,n){e=e||0,t=t||0,n=n||0,this.x=e,this.y=t,this._diameter=n,n>0?this._radius=n*.5:this._radius=0},Phaser.Circle.prototype={circumference:function(){return 2*Math.PI*this._radius},setTo:function(e,t,n){return this.x=e,this.y=t,this._diameter=n,this._radius=n*.5,this},copyFrom:function(e){return this.setTo(e.x,e.y,e.diameter)},copyTo:function(e){return e[x]=this.x,e[y]=this.y,e[diameter]=this._diameter,e},distance:function(e,t){return typeof t=="undefined"&&(t=!1),t?Phaser.Math.distanceRound(this.x,this.y,e.x,e.y):Phaser.Math.distance(this.x,this.y,e.x,e.y)},clone:function(e){return typeof e=="undefined"&&(e=new Phaser.Circle),e.setTo(a.x,a.y,a.diameter)},contains:function(e,t){return Phaser.Circle.contains(this,e,t)},circumferencePoint:function(e,t,n){return Phaser.Circle.circumferencePoint(this,e,t,n)},offset:function(e,t){return this.x+=e,this.y+=t,this},offsetPoint:function(e){return this.offset(e.x,e.y)},toString:function(){return"[{Phaser.Circle (x="+this.x+" y="+this.y+" diameter="+this.diameter+" radius="+this.radius+")}]"}},Object.defineProperty(Phaser.Circle.prototype,"diameter",{get:function(){return this._diameter},set:function(e){e>0&&(this._diameter=e,this._radius=e*.5)}}),Object.defineProperty(Phaser.Circle.prototype,"radius",{get:function(){return this._radius},set:function(e){e>0&&(this._radius=e,this._diameter=e*2)}}),Object.defineProperty(Phaser.Circle.prototype,"left",{get:function(){return this.x-this._radius},set:function(e){e>this.x?(this._radius=0,this._diameter=0):this.radius=this.x-e}}),Object.defineProperty(Phaser.Circle.prototype,"right",{get:function(){return this.x+this._radius},set:function(e){e<this.x?(this._radius=0,this._diameter=0):this.radius=e-this.x}}),Object.defineProperty(Phaser.Circle.prototype,"top",{get:function(){return this.y-this._radius},set:function(e){e>this.y?(this._radius=0,this._diameter=0):this.radius=this.y-e}}),Object.defineProperty(Phaser.Circle.prototype,"bottom",{get:function(){return this.y+this._radius},set:function(e){e<this.y?(this._radius=0,this._diameter=0):this.radius=e-this.y}}),Object.defineProperty(Phaser.Circle.prototype,"area",{get:function(){return this._radius>0?Math.PI*this._radius*this._radius:0}}),Object.defineProperty(Phaser.Circle.prototype,"empty",{get:function(){return this._diameter==0},set:function(e){this.setTo(0,0,0)}}),Phaser.Circle.contains=function(e,t,n){if(t>=e.left&&t<=e.right&&n>=e.top&&n<=e.bottom){var r=(e.x-t)*(e.x-t),i=(e.y-n)*(e.y-n);return r+i<=e.radius*e.radius}return!1},Phaser.Circle.equals=function(e,t){return e.x==t.x&&e.y==t.y&&e.diameter==t.diameter},Phaser.Circle.intersects=function(e,t){return Phaser.Math.distance(e.x,e.y,t.x,t.y)<=e.radius+t.radius},Phaser.Circle.circumferencePoint=function(e,t,n,r){return typeof n=="undefined"&&(n=!1),typeof r=="undefined"&&(r=new Phaser.Point),n===!0&&(t=Phaser.Math.radToDeg(t)),r.x=e.x+e.radius*Math.cos(t),r.y=e.y+e.radius*Math.sin(t),r},Phaser.Circle.intersectsRectangle=function(e,t){var n=Math.abs(e.x-t.x-t.halfWidth),r=t.halfWidth+e.radius;if(n>r)return!1;var i=Math.abs(e.y-t.y-t.halfHeight),s=t.halfHeight+e.radius;if(i>s)return!1;if(n<=t.halfWidth||i<=t.halfHeight)return!0;var o=n-t.halfWidth,u=i-t.halfHeight,a=o*o,f=u*u,l=e.radius*e.radius;return a+f<=l},Phaser.Point=function(e,t){e=e||0,t=t||0,this.x=e,this.y=t},Phaser.Point.prototype={copyFrom:function(e){return this.setTo(e.x,e.y)},invert:function(){return this.setTo(this.y,this.x)},setTo:function(e,t){return this.x=e,this.y=t,this},add:function(e,t){return this.x+=e,this.y+=t,this},subtract:function(e,t){return this.x-=e,this.y-=t,this},multiply:function(e,t){return this.x*=e,this.y*=t,this},divide:function(e,t){return this.x/=e,this.y/=t,this},clampX:function(e,t){return this.x=Phaser.Math.clamp(this.x,e,t),this},clampY:function(e,t){return this.y=Phaser.Math.clamp(this.y,e,t),this},clamp:function(e,t){return this.x=Phaser.Math.clamp(this.x,e,t),this.y=Phaser.Math.clamp(this.y,e,t),this},clone:function(e){return typeof e=="undefined"&&(e=new Phaser.Point),e.setTo(this.x,this.y)},copyFrom:function(e){return this.setTo(e.x,e.y)},copyTo:function(e){return e[x]=this.x,e[y]=this.y,e},distance:function(e,t){return Phaser.Point.distance(this,e,t)},equals:function(e){return e.x==this.x&&e.y==this.y},rotate:function(e,t,n,r,i){return Phaser.Point.rotate(this,e,t,n,r,i)},toString:function(){return"[{Point (x="+this.x+" y="+this.y+")}]"}},Phaser.Point.add=function(e,t,n){return typeof n=="undefined"&&(n=new Phaser.Point),n.x=e.x+t.x,n.y=e.y+t.y,n},Phaser.Point.subtract=function(e,t,n){return typeof n=="undefined"&&(n=new Phaser.Point),n.x=e.x-t.x,n.y=e.y-t.y,n},Phaser.Point.multiply=function(e,t,n){return typeof n=="undefined"&&(n=new Phaser.Point),n.x=e.x*t.x,n.y=e.y*t.y,n},Phaser.Point.divide=function(e,t,n){return typeof n=="undefined"&&(n=new Phaser.Point),n.x=e.x/t.x,n.y=e.y/t.y,n},Phaser.Point.equals=function(e,t){return e.x==t.x&&e.y==t.y},Phaser.Point.distance=function(e,t,n){return typeof n=="undefined"&&(n=!1),n?Phaser.Math.distanceRound(e.x,e.y,t.x,t.y):Phaser.Math.distance(e.x,e.y,t.x,t.y)},Phaser.Point.rotate=function(e,t,n,r,i,s){return i=i||!1,s=s||null,i&&(r=Phaser.Math.radToDeg(r)),s===null&&(s=Math.sqrt((t-e.x)*(t-e.x)+(n-e.y)*(n-e.y))),e.setTo(t+s*Math.cos(r),n+s*Math.sin(r))},Phaser.Rectangle=function(e,t,n,r){e=e||0,t=t||0,n=n||0,r=r||0,this.x=e,this.y=t,this.width=n,this.height=r},Phaser.Rectangle.prototype={offset:function(e,t){return this.x+=e,this.y+=t,this},offsetPoint:function(e){return this.offset(e.x,e.y)},setTo:function(e,t,n,r){return this.x=e,this.y=t,this.width=n,this.height=r,this},floor:function(){this.x=Math.floor(this.x),this.y=Math.floor(this.y)},copyFrom:function(e){return this.setTo(e.x,e.y,e.width,e.height)},copyTo:function(e){return e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e},inflate:function(e,t){return Phaser.Rectangle.inflate(this,e,t)},size:function(e){return Phaser.Rectangle.size(this,e)},clone:function(e){return Phaser.Rectangle.clone(this,e)},contains:function(e,t){return Phaser.Rectangle.contains(this,e,t)},containsRect:function(e){return Phaser.Rectangle.containsRect(this,e)},equals:function(e){return Phaser.Rectangle.equals(this,e)},intersection:function(e,t){return Phaser.Rectangle.intersection(this,e,output)},intersects:function(e,t){return Phaser.Rectangle.intersects(this,e,t)},intersectsRaw:function(e,t,n,r,i){return Phaser.Rectangle.intersectsRaw(this,e,t,n,r,i)},union:function(e,t){return Phaser.Rectangle.union(this,e,t)},toString:function(){return"[{Rectangle (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+" empty="+this.empty+")}]"}},Object.defineProperty(Phaser.Rectangle.prototype,"halfWidth",{get:function(){return Math.round(this.width/2)}}),Object.defineProperty(Phaser.Rectangle.prototype,"halfHeight",{get:function(){return Math.round(this.height/2)}}),Object.defineProperty(Phaser.Rectangle.prototype,"bottom",{get:function(){return this.y+this.height},set:function(e){e<=this.y?this.height=0:this.height=this.y-e}}),Object.defineProperty(Phaser.Rectangle.prototype,"bottomRight",{get:function(){return new Phaser.Point(this.right,this.bottom)},set:function(e){this.right=e.x,this.bottom=e.y}}),Object.defineProperty(Phaser.Rectangle.prototype,"left",{get:function(){return this.x},set:function(e){e>=this.right?this.width=0:this.width=this.right-e,this.x=e}}),Object.defineProperty(Phaser.Rectangle.prototype,"right",{get:function(){return this.x+this.width},set:function(e){e<=this.x?this.width=0:this.width=this.x+e}}),Object.defineProperty(Phaser.Rectangle.prototype,"volume",{get:function(){return this.width*this.height}}),Object.defineProperty(Phaser.Rectangle.prototype,"perimeter",{get:function(){return this.width*2+this.height*2}}),Object.defineProperty(Phaser.Rectangle.prototype,"centerX",{get:function(){return this.x+this.halfWidth},set:function(e){this.x=e-this.halfWidth}}),Object.defineProperty(Phaser.Rectangle.prototype,"centerY",{get:function(){return this.y+this.halfHeight},set:function(e){this.y=e-this.halfHeight}}),Object.defineProperty(Phaser.Rectangle.prototype,"top",{get:function(){return this.y},set:function(e){e>=this.bottom?(this.height=0,this.y=e):this.height=this.bottom-e}}),Object.defineProperty(Phaser.Rectangle.prototype,"topLeft",{get:function(){return new Phaser.Point(this.x,this.y)},set:function(e){this.x=e.x,this.y=e.y}}),Object.defineProperty(Phaser.Rectangle.prototype,"empty",{get:function(){return!this.width||!this.height},set:function(e){this.setTo(0,0,0,0)}}),Phaser.Rectangle.inflate=function(e,t,n){return e.x-=t,e.width+=2*t,e.y-=n,e.height+=2*n,e},Phaser.Rectangle.inflatePoint=function(e,t){return Phaser.Phaser.Rectangle.inflate(e,t.x,t.y)},Phaser.Rectangle.size=function(e,t){return typeof t=="undefined"&&(t=new Phaser.Point),t.setTo(e.width,e.height)},Phaser.Rectangle.clone=function(e,t){return typeof t=="undefined"&&(t=new Phaser.Rectangle),t.setTo(e.x,e.y,e.width,e.height)},Phaser.Rectangle.contains=function(e,t,n){return t>=e.x&&t<=e.right&&n>=e.y&&n<=e.bottom},Phaser.Rectangle.containsPoint=function(e,t){return Phaser.Phaser.Rectangle.contains(e,t.x,t.y)},Phaser.Rectangle.containsRect=function(e,t){return e.volume>t.volume?!1:e.x>=t.x&&e.y>=t.y&&e.right<=t.right&&e.bottom<=t.bottom},Phaser.Rectangle.equals=function(e,t){return e.x==t.x&&e.y==t.y&&e.width==t.width&&e.height==t.height},Phaser.Rectangle.intersection=function(e,t,n){return n=n||new Phaser.Rectangle,Phaser.Rectangle.intersects(e,t)&&(n.x=Math.max(e.x,t.x),n.y=Math.max(e.y,t.y),n.width=Math.min(e.right,t.right)-n.x,n.height=Math.min(e.bottom,t.bottom)-n.y),n},Phaser.Rectangle.intersects=function(e,t,n){return n=n||0,!(e.x>t.right+n||e.right<t.x-n||e.y>t.bottom+n||e.bottom<t.y-n)},Phaser.Rectangle.intersectsRaw=function(e,t,n,r,i,s){return typeof s=="undefined"&&(s=0),!(t>e.right+s||n<e.left-s||r>e.bottom+s||i<e.top-s)},Phaser.Rectangle.union=function(e,t,n){return typeof n=="undefined"&&(n=new Phaser.Rectangle),n.setTo(Math.min(e.x,t.x),Math.min(e.y,t.y),Math.max(e.right,t.right),Math.max(e.bottom,t.bottom))},Phaser.Net=function(e){this.game=e},Phaser.Net.prototype={getHostName:function(){return window.location&&window.location.hostname?window.location.hostname:null},checkDomainName:function(e){return window.location.hostname.indexOf(e)!==-1},updateQueryString:function(e,t,n,r){typeof n=="undefined"&&(n=!1),typeof r=="undefined"&&(r=""),r==""&&(r=window.location.href);var i="",s=new RegExp("([?|&])"+e+"=.*?(&|#|$)(.*)","gi");if(s.test(r))typeof t!="undefined"&&t!==null?i=r.replace(s,"$1"+e+"="+t+"$2$3"):i=r.replace(s,"$1$3").replace(/(&|\?)$/,"");else if(typeof t!="undefined"&&t!==null){var o=r.indexOf("?")!==-1?"&":"?",u=r.split("#");r=u[0]+o+e+"="+t,u[1]&&(r+="#"+u[1]),i=r}else i=r;if(!n)return i;window.location.href=i},getQueryString:function(e){typeof e=="undefined"&&(e="");var t={},n=location.search.substring(1).split("&");for(var r in n){var i=n[r].split("=");if(i.length>1){if(e&&e==this.decodeURI(i[0]))return this.decodeURI(i[1]);t[this.decodeURI(i[0])]=this.decodeURI(i[1])}}return t},decodeURI:function(e){return decodeURIComponent(e.replace(/\+/g," "))}},Phaser.TweenManager=function(e){this.game=e,this._tweens=[],this._add=[],this.game.onPause.add(this.pauseAll,this),this.game.onResume.add(this.resumeAll,this)},Phaser.TweenManager.prototype={REVISION:"11dev",getAll:function(){return this._tweens},removeAll:function(){this._tweens=[]},add:function(e){this._add.push(e)},create:function(e){return new Phaser.Tween(e,this.game)},remove:function(e){var t=this._tweens.indexOf(e);t!==-1&&(this._tweens[t].pendingDelete=!0)},update:function(){if(this._tweens.length===0&&this._add.length===0)return!1;var e=0,t=this._tweens.length;while(e<t)this._tweens[e].update(this.game.time.now)?e++:(this._tweens.splice(e,1),t--);return this._add.length>0&&(this._tweens=this._tweens.concat(this._add),this._add.length=0),!0},pauseAll:function(){for(var e=this._tweens.length-1;e>=0;e--)this._tweens[e].pause()},resumeAll:function(){for(var e=this._tweens.length-1;e>=0;e--)this._tweens[e].resume()}},Phaser.Tween=function(e,t){this._object=e,this.game=t,this._manager=this.game.tweens,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._repeat=0,this._yoyo=!1,this._reversed=!1,this._delayTime=0,this._startTime=null,this._easingFunction=Phaser.Easing.Linear.None,this._interpolationFunction=Phaser.Math.linearInterpolation,this._chainedTweens=[],this._onStartCallback=null,this._onStartCallbackFired=!1,this._onUpdateCallback=null,this._onCompleteCallback=null,this._pausedTime=0,this._parent=null,this.pendingDelete=!1;for(var n in e)this._valuesStart[n]=parseFloat(e[n],10);this.onStart=new Phaser.Signal,this.onComplete=new Phaser.Signal,this.isRunning=!1},Phaser.Tween.prototype={to:function(e,t,n,r,i,s,o){t=t||1e3,n=n||null,r=r||!1,i=i||0,s=s||0,o=o||!1;var u;return this._parent?(u=this._manager.create(this._object),u._parent=this._parent,this.chain(u)):(u=this,u._parent=u),u._repeat=s,u._duration=t,u._valuesEnd=e,n!==null&&(u._easingFunction=n),i>0&&(u._delayTime=i),u._yoyo=o,r?u.start():u},start:function(e){if(this.game===null||this._object===null)return;this._manager.add(this),this.onStart.dispatch(this._object),this.isRunning=!0,this._onStartCallbackFired=!1,this._startTime=this.game.time.now+this._delayTime;for(var t in this._valuesEnd){if(this._valuesEnd[t]instanceof Array){if(this._valuesEnd[t].length===0)continue;this._valuesEnd[t]=[this._object[t]].concat(this._valuesEnd[t])}this._valuesStart[t]=this._object[t],this._valuesStart[t]instanceof Array==0&&(this._valuesStart[t]*=1),this._valuesStartRepeat[t]=this._valuesStart[t]||0}return this},stop:function(){return this._manager.remove(this),this.isRunning=!1,this},delay:function(e){return this._delayTime=e,this},repeat:function(e){return this._repeat=e,this},yoyo:function(e){return this._yoyo=e,this},easing:function(e){return this._easingFunction=e,this},interpolation:function(e){return this._interpolationFunction=e,this},chain:function(){return this._chainedTweens=arguments,this},loop:function(){return this._parent&&this.chain(this._parent),this},onStartCallback:function(e){return this._onStartCallback=e,this},onUpdateCallback:function(e){return this._onUpdateCallback=e,this},onCompleteCallback:function(e){return this._onCompleteCallback=e,this},pause:function(){this._paused=!0},resume:function(){this._paused=!1,this._startTime+=this.game.time.pauseDuration},update:function(e){if(this.pendingDelete)return!1;if(this._paused||e<this._startTime)return!0;var t;if(e<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback!==null&&this._onStartCallback.call(this._object),this._onStartCallbackFired=!0);var n=(e-this._startTime)/this._duration;n=n>1?1:n;var r=this._easingFunction(n);for(t in this._valuesEnd){var i=this._valuesStart[t]||0,s=this._valuesEnd[t];s instanceof Array?this._object[t]=this._interpolationFunction(s,r):(typeof s=="string"&&(s=i+parseFloat(s,10)),typeof s=="number"&&(this._object[t]=i+(s-i)*r))}this._onUpdateCallback!==null&&this._onUpdateCallback.call(this._object,r);if(n==1){if(this._repeat>0){isFinite(this._repeat)&&this._repeat--;for(t in this._valuesStartRepeat){typeof this._valuesEnd[t]=="string"&&(this._valuesStartRepeat[t]=this._valuesStartRepeat[t]+parseFloat(this._valuesEnd[t],10));if(this._yoyo){var o=this._valuesStartRepeat[t];this._valuesStartRepeat[t]=this._valuesEnd[t],this._valuesEnd[t]=o,this._reversed=!this._reversed}this._valuesStart[t]=this._valuesStartRepeat[t]}return this._startTime=e+this._delayTime,this.onComplete.dispatch(this._object),this._onCompleteCallback!==null&&this._onCompleteCallback.call(this._object),!0}this.onComplete.dispatch(this._object),this._onCompleteCallback!==null&&this._onCompleteCallback.call(this._object);for(var u=0,a=this._chainedTweens.length;u<a;u++)this._chainedTweens[u].start(e);return!1}return!0}},Phaser.Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-0.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-0.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return e===0?0:Math.pow(1024,e-1)},Out:function(e){return e===1?1:1-Math.pow(2,-10*e)},InOut:function(e){return e===0?0:e===1?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(-Math.pow(2,-10*(e-1))+2)}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-0.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){var t,n=.1,r=.4;return e===0?0:e===1?1:(!n||n<1?(n=1,t=r/4):t=r*Math.asin(1/n)/(2*Math.PI),-(n*Math.pow(2,10*(e-=1))*Math.sin((e-t)*2*Math.PI/r)))},Out:function(e){var t,n=.1,r=.4;return e===0?0:e===1?1:(!n||n<1?(n=1,t=r/4):t=r*Math.asin(1/n)/(2*Math.PI),n*Math.pow(2,-10*e)*Math.sin((e-t)*2*Math.PI/r)+1)},InOut:function(e){var t,n=.1,r=.4;return e===0?0:e===1?1:(!n||n<1?(n=1,t=r/4):t=r*Math.asin(1/n)/(2*Math.PI),(e*=2)<1?-0.5*n*Math.pow(2,10*(e-=1))*Math.sin((e-t)*2*Math.PI/r):n*Math.pow(2,-10*(e-=1))*Math.sin((e-t)*2*Math.PI/r)*.5+1)}},Back:{In:function(e){var t=1.70158;return e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?.5*e*e*((t+1)*e-t):.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(e){return 1-TWEEN.Easing.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?TWEEN.Easing.Bounce.In(e*2)*.5:TWEEN.Easing.Bounce.Out(e*2-1)*.5+.5}}},Phaser.Time=function(e){this.game=e,this._started=0,this._timeLastSecond=0,this._pauseStarted=0,this.physicsElapsed=0,this.time=0,this.pausedTime=0,this.now=0,this.elapsed=0,this.fps=0,this.fpsMin=1e3,this.fpsMax=0,this.msMin=1e3,this.msMax=0,this.frames=0,this.pauseDuration=0,this.timeToCall=0,this.lastTime=0,this.game.onPause.add(this.gamePaused,this),this.game.onResume.add(this.gameResumed,this),this._justResumed=!1},Phaser.Time.prototype={totalElapsedSeconds:function(){return(this.now-this._started)*.001},update:function(e){this.now=e,this._justResumed&&(this.time=this.now,this._justResumed=!1),this.timeToCall=this.game.math.max(0,16-(e-this.lastTime)),this.elapsed=this.now-this.time,this.msMin=this.game.math.min(this.msMin,this.elapsed),this.msMax=this.game.math.max(this.msMax,this.elapsed),this.frames++,this.now>this._timeLastSecond+1e3&&(this.fps=Math.round(this.frames*1e3/(this.now-this._timeLastSecond)),this.fpsMin=this.game.math.min(this.fpsMin,this.fps),this.fpsMax=this.game.math.max(this.fpsMax,this.fps),this._timeLastSecond=this.now,this.frames=0),this.time=this.now,this.lastTime=e+this.timeToCall,this.physicsElapsed=1*(this.elapsed/1e3),this.game.paused&&(this.pausedTime=this.now-this._pauseStarted)},gamePaused:function(){this._pauseStarted=this.now},gameResumed:function(){this.time=Date.now(),this.pauseDuration=this.pausedTime,this._justResumed=!0},elapsedSince:function(e){return this.now-e},elapsedSecondsSince:function(e){return(this.now-e)*.001},reset:function(){this._started=this.now}},Phaser.AnimationManager=function(e){this.sprite=e,this.game=e.game,this.currentFrame=null,this.updateIfVisible=!0,this._frameData=null,this._anims={},this._outputFrames=[]},Phaser.AnimationManager.prototype={loadFrameData:function(e){this._frameData=e,this.frame=0},add:function(e,t,n,r,i){if(this._frameData==null){console.warn("No FrameData available for Phaser.Animation "+e);return}return n=n||60,typeof r=="undefined"&&(r=!1),typeof i=="undefined"&&(i=!0),this.sprite.events.onAnimationStart==null&&(this.sprite.events.onAnimationStart=new Phaser.Signal,this.sprite.events.onAnimationComplete=new Phaser.Signal,this.sprite.events.onAnimationLoop=new Phaser.Signal),this._outputFrames.length=0,this._frameData.getFrameIndexes(t,i,this._outputFrames),this._anims[e]=new Phaser.Animation(this.game,this.sprite,e,this._frameData,this._outputFrames,n,r),this.currentAnim=this._anims[e],this.currentFrame=this.currentAnim.currentFrame,this.sprite.setTexture(PIXI.TextureCache[this.currentFrame.uuid]),this._anims[e]},validateFrames:function(e,t){typeof t=="undefined"&&(t=!0);for(var n=0;n<e.length;n++)if(t==1){if(e[n]>this._frameData.total)return!1}else if(this._frameData.checkFrameName(e[n])==0)return!1;return!0},play:function(e,t,n){if(this._anims[e]){if(this.currentAnim!=this._anims[e])return this.currentAnim=this._anims[e],this.currentAnim.play(t,n);if(this.currentAnim.isPlaying==0)return this.currentAnim.play(t,n)}},stop:function(e,t){typeof t=="undefined"&&(t=!1),typeof e=="string"?this._anims[e]&&(this.currentAnim=this._anims[e],this.currentAnim.stop(t)):this.currentAnim&&this.currentAnim.stop(t)},update:function(){return this.updateIfVisible&&this.sprite.visible==0?!1:this.currentAnim&&this.currentAnim.update()==1?(this.currentFrame=this.currentAnim.currentFrame,this.sprite.currentFrame=this.currentFrame,!0):!1},destroy:function(){this._anims={},this._frameData=null,this._frameIndex=0,this.currentAnim=null,this.currentFrame=null}},Object.defineProperty(Phaser.AnimationManager.prototype,"frameData",{get:function(){return this._frameData}}),Object.defineProperty(Phaser.AnimationManager.prototype,"frameTotal",{get:function(){return this._frameData?this._frameData.total:-1}}),Object.defineProperty(Phaser.AnimationManager.prototype,"frame",{get:function(){if(this.currentFrame)return this._frameIndex},set:function(e){this._frameData&&this._frameData.getFrame(e)!==null&&(this.currentFrame=this._frameData.getFrame(e),this._frameIndex=e,this.sprite.currentFrame=this.currentFrame,this.sprite.setTexture(PIXI.TextureCache[this.currentFrame.uuid]))}}),Object.defineProperty(Phaser.AnimationManager.prototype,"frameName",{get:function(){if(this.currentFrame)return this.currentFrame.name},set:function(e){this._frameData&&this._frameData.getFrameByName(e)!==null?(this.currentFrame=this._frameData.getFrameByName(e),this._frameIndex=this.currentFrame.index,this.sprite.currentFrame=this.currentFrame,this.sprite.setTexture(PIXI.TextureCache[this.currentFrame.uuid])):console.warn("Cannot set frameName: "+e)}}),Phaser.Animation=function(e,t,n,r,i,s,o){this.game=e,this._parent=t,this._frameData=r,this.name=n,this._frames=[],this._frames=this._frames.concat(i),this.delay=1e3/s,this.looped=o,this.isFinished=!1,this.isPlaying=!1,this._frameIndex=0,this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex])},Phaser.Animation.prototype={play:function(e,t){return e=e||null,t=t||null,e!==null&&(this.delay=1e3/e),t!==null&&(this.looped=t),this.isPlaying=!0,this.isFinished=!1,this._timeLastFrame=this.game.time.now,this._timeNextFrame=this.game.time.now+this.delay,this._frameIndex=0,this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this._parent.setTexture(PIXI.TextureCache[this.currentFrame.uuid]),this._parent.events&&this._parent.events.onAnimationStart.dispatch(this._parent,this),this},restart:function(){this.isPlaying=!0,this.isFinished=!1,this._timeLastFrame=this.game.time.now,this._timeNextFrame=this.game.time.now+this.delay,this._frameIndex=0,this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex])},stop:function(e){typeof e=="undefined"&&(e=!1),this.isPlaying=!1,this.isFinished=!0,e&&(this.currentFrame=this._frameData.getFrame(this._frames[0]))},update:function(){return this.isPlaying==1&&this.game.time.now>=this._timeNextFrame?(this._frameIndex++,this._frameIndex==this._frames.length?this.looped?(this._frameIndex=0,this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this._parent.setTexture(PIXI.TextureCache[this.currentFrame.uuid]),this._parent.events.onAnimationLoop.dispatch(this._parent,this)):this.onComplete():(this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this._parent.setTexture(PIXI.TextureCache[this.currentFrame.uuid])),this._timeLastFrame=this.game.time.now,this._timeNextFrame=this.game.time.now+this.delay,!0):!1},destroy:function(){this.game=null,this._parent=null,this._frames=null,this._frameData=null,this.currentFrame=null,this.isPlaying=!1},onComplete:function(){this.isPlaying=!1,this.isFinished=!0,this._parent.events&&this._parent.events.onAnimationComplete.dispatch(this._parent,this)}},Object.defineProperty(Phaser.Animation.prototype,"frameTotal",{get:function(){return this._frames.length}}),Object.defineProperty(Phaser.Animation.prototype,"frame",{get:function(){return this.currentFrame!==null?this.currentFrame.index:this._frameIndex},set:function(e){this.currentFrame=this._frameData.getFrame(e),this.currentFrame!==null&&(this._frameIndex=e,this._parent.setTexture(PIXI.TextureCache[this.currentFrame.uuid]))}}),Phaser.Animation.Frame=function(e,t,n,r,i,s,o){this.index=e,this.x=t,this.y=n,this.width=r,this.height=i,this.name=s,this.uuid=o,this.centerX=Math.floor(r/2),this.centerY=Math.floor(i/2),this.distance=Phaser.Math.distance(0,0,r,i),this.rotated=!1,this.rotationDirection="cw",this.trimmed=!1,this.sourceSizeW=r,this.sourceSizeH=i,this.spriteSourceSizeX=0,this.spriteSourceSizeY=0,this.spriteSourceSizeW=0,this.spriteSourceSizeH=0},Phaser.Animation.Frame.prototype={setTrim:function(e,t,n,r,i,s,o){this.trimmed=e,e&&(this.width=t,this.height=n,this.sourceSizeW=t,this.sourceSizeH=n,this.centerX=Math.floor(t/2),this.centerY=Math.floor(n/2),this.spriteSourceSizeX=r,this.spriteSourceSizeY=i,this.spriteSourceSizeW=s,this.spriteSourceSizeH=o)}},Phaser.Animation.FrameData=function(){this._frames=[],this._frameNames=[]},Phaser.Animation.FrameData.prototype={addFrame:function(e){return e.index=this._frames.length,this._frames.push(e),e.name!==""&&(this._frameNames[e.name]=e.index),e},getFrame:function(e){return this._frames[e]?this._frames[e]:null},getFrameByName:function(e){return typeof this._frameNames[e]=="number"?this._frames[this._frameNames[e]]:null},checkFrameName:function(e){return this._frameNames[e]==null?!1:!0},getFrameRange:function(e,t,n){typeof n=="undefined"&&(n=[]);for(var r=e;r<=t;r++)n.push(this._frames[r]);return n},getFrames:function(e,t,n){typeof t=="undefined"&&(t=!0),typeof n=="undefined"&&(n=[]);if(typeof e=="undefined"||e.length==0)for(var r=0;r<this._frames.length;r++)n.push(this._frames[r]);else for(var r=0,i=e.length;r<i;r++)t?n.push(this.getFrame(e[r])):n.push(this.getFrameByName(e[r]));return n},getFrameIndexes:function(e,t,n){typeof t=="undefined"&&(t=!0),typeof n=="undefined"&&(n=[]);if(typeof e=="undefined"||e.length==0)for(var r=0,i=this._frames.length;r<i;r++)n.push(this._frames[r].index);else for(var r=0,i=e.length;r<i;r++)t?n.push(e[r]):n.push(this.getFrameByName(e[r]).index);return n}},Object.defineProperty(Phaser.Animation.FrameData.prototype,"total",{get:function(){return this._frames.length}}),Phaser.Animation.Parser={spriteSheet:function(e,t,n,r,i){var s=e.cache.getImage(t);if(s==null)return null;var o=s.width,u=s.height;n<=0&&(n=Math.floor(-o/Math.min(-1,n))),r<=0&&(r=Math.floor(-u/Math.min(-1,r)));var a=Math.round(o/n),f=Math.round(u/r),l=a*f;i!==-1&&(l=i);if(o==0||u==0||o<n||u<r||l===0)return console.warn("Phaser.Animation.Parser.spriteSheet: width/height zero or width/height < given frameWidth/frameHeight"),null;var c=new Phaser.Animation.FrameData,h=0,p=0;for(var d=0;d<l;d++){var v=e.rnd.uuid();c.addFrame(new Phaser.Animation.Frame(d,h,p,n,r,"",v)),PIXI.TextureCache[v]=new PIXI.Texture(PIXI.BaseTextureCache[t],{x:h,y:p,width:n,height:r}),h+=n,h===o&&(h=0,p+=r)}return c},JSONData:function(e,t,n){if(!t.frames){console.warn("Phaser.Animation.Parser.JSONData: Invalid Texture Atlas JSON given, missing 'frames' array"),console.log(t);return}var r=new Phaser.Animation.FrameData,i=t.frames,s;for(var o=0;o<i.length;o++){var u=e.rnd.uuid();s=r.addFrame(new Phaser.Animation.Frame(o,i[o].frame.x,i[o].frame.y,i[o].frame.w,i[o].frame.h,i[o].filename,u)),PIXI.TextureCache[u]=new PIXI.Texture(PIXI.BaseTextureCache[n],{x:i[o].frame.x,y:i[o].frame.y,width:i[o].frame.w,height:i[o].frame.h}),i[o].trimmed&&(s.setTrim(i[o].trimmed,i[o].sourceSize.w,i[o].sourceSize.h,i[o].spriteSourceSize.x,i[o].spriteSourceSize.y,i[o].spriteSourceSize.w,i[o].spriteSourceSize.h),PIXI.TextureCache[u].realSize=i[o].spriteSourceSize,PIXI.TextureCache[u].trim.x=0)}return r},JSONDataHash:function(e,t,n){if(!t.frames){console.warn("Phaser.Animation.Parser.JSONDataHash: Invalid Texture Atlas JSON given, missing 'frames' object"),console.log(t);return}var r=new Phaser.Animation.FrameData,i=t.frames,s,o=0;for(var u in i){var a=e.rnd.uuid();s=r.addFrame(new Phaser.Animation.Frame(o,i[u].frame.x,i[u].frame.y,i[u].frame.w,i[u].frame.h,u,a)),PIXI.TextureCache[a]=new PIXI.Texture(PIXI.BaseTextureCache[n],{x:i[u].frame.x,y:i[u].frame.y,width:i[u].frame.w,height:i[u].frame.h}),i[u].trimmed&&(s.setTrim(i[u].trimmed,i[u].sourceSize.w,i[u].sourceSize.h,i[u].spriteSourceSize.x,i[u].spriteSourceSize.y,i[u].spriteSourceSize.w,i[u].spriteSourceSize.h),PIXI.TextureCache[a].realSize=i[u].spriteSourceSize,PIXI.TextureCache[a].trim.x=0),o++}return r},XMLData:function(e,t,n){if(!t.getElementsByTagName("TextureAtlas")){console.warn("Phaser.Animation.Parser.XMLData: Invalid Texture Atlas XML given, missing <TextureAtlas> tag");return}var r=new Phaser.Animation.FrameData,i=t.getElementsByTagName("SubTexture"),s;for(var o=0;o<i.length;o++){var u=e.rnd.uuid(),a=i[o].attributes;s=r.addFrame(new Phaser.Animation.Frame(o,a.x.nodeValue,a.y.nodeValue,a.width.nodeValue,a.height.nodeValue,a.name.nodeValue,u)),PIXI.TextureCache[u]=new PIXI.Texture(PIXI.BaseTextureCache[n],{x:a.x.nodeValue,y:a.y.nodeValue,width:a.width.nodeValue,height:a.height.nodeValue});if(a.frameX.nodeValue!="-0"||a.frameY.nodeValue!="-0")s.setTrim(!0,a.width.nodeValue,a.height.nodeValue,Math.abs(a.frameX.nodeValue),Math.abs(a.frameY.nodeValue),a.frameWidth.nodeValue,a.frameHeight.nodeValue),PIXI.TextureCache[u].realSize={x:Math.abs(a.frameX.nodeValue),y:Math.abs(a.frameY.nodeValue),w:a.frameWidth.nodeValue,h:a.frameHeight.nodeValue},PIXI.TextureCache[u].trim.x=0}return r}},Phaser.Cache=function(e){this.game=e,this._canvases={},this._images={},this._textures={},this._sounds={},this._text={},this._tilemaps={},this.addDefaultImage(),this.onSoundUnlock=new Phaser.Signal},Phaser.Cache.prototype={addCanvas:function(e,t,n){this._canvases[e]={canvas:t,context:n}},addRenderTexture:function(e,t){var n=new Phaser.Animation.Frame(0,0,0,t.width,t.height,"","");this._textures[e]={texture:t,frame:n}},addSpriteSheet:function(e,t,n,r,i,s){this._images[e]={url:t,data:n,spriteSheet:!0,frameWidth:r,frameHeight:i},PIXI.BaseTextureCache[e]=new PIXI.BaseTexture(n),PIXI.TextureCache[e]=new PIXI.Texture(PIXI.BaseTextureCache[e]),this._images[e].frameData=Phaser.Animation.Parser.spriteSheet(this.game,e,r,i,s)},addTilemap:function(e,t,n,r,i){this._tilemaps[e]={url:t,data:n,spriteSheet:!0,mapData:r,format:i},PIXI.BaseTextureCache[e]=new PIXI.BaseTexture(n),PIXI.TextureCache[e]=new PIXI.Texture(PIXI.BaseTextureCache[e])},addTextureAtlas:function(e,t,n,r,i){this._images[e]={url:t,data:n,spriteSheet:!0},PIXI.BaseTextureCache[e]=new PIXI.BaseTexture(n),PIXI.TextureCache[e]=new PIXI.Texture(PIXI.BaseTextureCache[e]),i==Phaser.Loader.TEXTURE_ATLAS_JSON_ARRAY?this._images[e].frameData=Phaser.Animation.Parser.JSONData(this.game,r,e):i==Phaser.Loader.TEXTURE_ATLAS_JSON_HASH?this._images[e].frameData=Phaser.Animation.Parser.JSONDataHash(this.game,r,e):i==Phaser.Loader.TEXTURE_ATLAS_XML_STARLING&&(this._images[e].frameData=Phaser.Animation.Parser.XMLData(this.game,r,e))},addBitmapFont:function(e,t,n,r){this._images[e]={url:t,data:n,spriteSheet:!0},PIXI.BaseTextureCache[e]=new PIXI.BaseTexture(n),PIXI.TextureCache[e]=new PIXI.Texture(PIXI.BaseTextureCache[e]),Phaser.Loader.Parser.bitmapFont(this.game,r,e)},addDefaultImage:function(){this._images.__default={url:null,data:null,spriteSheet:!1},this._images.__default.frame=new Phaser.Animation.Frame(0,0,0,32,32,"","");var e=new PIXI.BaseTexture;e.width=32,e.height=32,e.hasLoaded=!0,PIXI.BaseTextureCache.__default=e,PIXI.TextureCache.__default=new PIXI.Texture(e)},addImage:function(e,t,n){this._images[e]={url:t,data:n,spriteSheet:!1},this._images[e].frame=new Phaser.Animation.Frame(0,0,0,n.width,n.height,"",""),PIXI.BaseTextureCache[e]=new PIXI.BaseTexture(n),PIXI.TextureCache[e]=new PIXI.Texture(PIXI.BaseTextureCache[e])},addSound:function(e,t,n,r,i){r=r||!0,i=i||!1;var s=this.game.sound.touchLocked,o=!1;i&&(o=!0),this._sounds[e]={url:t,data:n,isDecoding:!1,decoded:o,webAudio:r,audioTag:i}},reloadSound:function(e){var t=this;this._sounds[e]&&(this._sounds[e].data.src=this._sounds[e].url,this._sounds[e].data.addEventListener("canplaythrough",function(){return t.reloadSoundComplete(e)},!1),this._sounds[e].data.load())},reloadSoundComplete:function(e){this._sounds[e]&&(this._sounds[e].locked=!1,this.onSoundUnlock.dispatch(e))},updateSound:function(e,t,n){this._sounds[e]&&(this._sounds[e][t]=n)},decodedSound:function(e,t){this._sounds[e].data=t,this._sounds[e].decoded=!0,this._sounds[e].isDecoding=!1},addText:function(e,t,n){this._text[e]={url:t,data:n}},getCanvas:function(e){return this._canvases[e]?this._canvases[e].canvas:null},checkImageKey:function(e){return this._images[e]?!0:!1},getImage:function(e){return this._images[e]?this._images[e].data:null},getTilemap:function(e){return this._tilemaps[e]?this._tilemaps[e]:null},getFrameData:function(e){return this._images[e]&&this._images[e].frameData?this._images[e].frameData:null},getFrameByIndex:function(e,t){return this._images[e]&&this._images[e].frameData?this._images[e].frameData.getFrame(t):null},getFrameByName:function(e,t){return this._images[e]&&this._images[e].frameData?this._images[e].frameData.getFrameByName(t):null},getFrame:function(e){return this._images[e]&&this._images[e].spriteSheet==0?this._images[e].frame:null},getTextureFrame:function(e){return this._textures[e]?this._textures[e].frame:null},getTexture:function(e){return this._textures[e]?this._textures[e]:null},getSound:function(e){return this._sounds[e]?this._sounds[e]:null},getSoundData:function(e){return this._sounds[e]?this._sounds[e].data:null},isSoundDecoded:function(e){if(this._sounds[e])return this._sounds[e].decoded},isSoundReady:function(e){return this._sounds[e]&&this._sounds[e].decoded&&this.game.sound.touchLocked==0},isSpriteSheet:function(e){return this._images[e]?this._images[e].spriteSheet:!1},getText:function(e){return this._text[e]?this._text[e].data:null},getKeys:function(e){var t=[];for(var n in e)n!=="__default"&&t.push(n);return t},getImageKeys:function(){return this.getKeys(this._images)},getSoundKeys:function(){return this.getKeys(this._sounds)},getTextKeys:function(){return this.getKeys(this._text)},removeCanvas:function(e){delete this._canvases[e]},removeImage:function(e){delete this._images[e]},removeSound:function(e){delete this._sounds[e]},removeText:function(e){delete this._text[e]},destroy:function(){for(var e in this._canvases)delete this._canvases[e.key];for(var e in this._images)delete this._images[e.key];for(var e in this._sounds)delete this._sounds[e.key];for(var e in this._text)delete this._text[e.key]}},Phaser.Loader=function(e){this.game=e,this._keys=[],this._fileList={},this._progressChunk=0,this._xhr=new XMLHttpRequest,this.queueSize=0,this.isLoading=!1,this.hasLoaded=!1,this.progress=0,this.preloadSprite=null,this.crossOrigin="",this.baseURL="",this.onFileComplete=new Phaser.Signal,this.onFileError=new Phaser.Signal,this.onLoadStart=new Phaser.Signal,this.onLoadComplete=new Phaser.Signal},Phaser.Loader.TEXTURE_ATLAS_JSON_ARRAY=0,Phaser.Loader.TEXTURE_ATLAS_JSON_HASH=1,Phaser.Loader.TEXTURE_ATLAS_XML_STARLING=2,Phaser.Loader.prototype={setPreloadSprite:function(e,t){t=t||0,this.preloadSprite={sprite:e,direction:t,width:e.width,height:e.height,crop:null},t==0?this.preloadSprite.crop=new Phaser.Rectangle(0,0,0,e.height):this.preloadSprite.crop=new Phaser.Rectangle(0,0,e.width,0),e.crop=this.preloadSprite.crop},checkKeyExists:function(e){return this._fileList[e]?!0:!1},reset:function(){this.preloadSprite=null,this.queueSize=0,this.isLoading=!1},addToFileList:function(e,t,n,r){var i={type:e,key:t,url:n,data:null,error:!1,loaded:!1};if(typeof r!="undefined")for(var s in r)i[s]=r[s];this._fileList[t]=i,this._keys.push(t),this.queueSize++},image:function(e,t,n){typeof n=="undefined"&&(n=!1),(n||this.checkKeyExists(e)==0)&&this.addToFileList("image",e,t)},text:function(e,t,n){typeof n=="undefined"&&(n=!1),(n||this.checkKeyExists(e)==0)&&this.addToFileList("text",e,t)},spritesheet:function(e,t,n,r,i){typeof i=="undefined"&&(i=-1),this.checkKeyExists(e)===!1&&this.addToFileList("spritesheet",e,t,{frameWidth:n,frameHeight:r,frameMax:i})},audio:function(e,t,n){typeof n=="undefined"&&(n=!0),this.checkKeyExists(e)===!1&&this.addToFileList("audio",e,t,{buffer:null,autoDecode:n})},tilemap:function(e,t,n,r,i){typeof n=="undefined"&&(n=null),typeof r=="undefined"&&(r=null),typeof i=="undefined"&&(i=Phaser.Tilemap.CSV);if(this.checkKeyExists(e)===!1)if(n)this.addToFileList("tilemap",e,t,{mapDataURL:n,format:i});else{switch(i){case Phaser.Tilemap.CSV:break;case Phaser.Tilemap.JSON:typeof r=="string"&&(r=JSON.parse(r))}this.addToFileList("tilemap",e,t,{mapDataURL:null,mapData:r,format:i})}},bitmapFont:function(e,t,n,r){typeof n=="undefined"&&(n=null),typeof r=="undefined"&&(r=null);if(this.checkKeyExists(e)===!1)if(n)this.addToFileList("bitmapfont",e,t,{xmlURL:n});else if(typeof r=="string"){var i;try{if(window.DOMParser){var s=new DOMParser;i=s.parseFromString(r,"text/xml")}else i=new ActiveXObject("Microsoft.XMLDOM"),i.async="false",i.loadXML(r)}catch(o){i=undefined}if(!i||!i.documentElement||i.getElementsByTagName("parsererror").length)throw new Error("Phaser.Loader. Invalid Bitmap Font XML given");this.addToFileList("bitmapfont",e,t,{xmlURL:null,xmlData:i})}},atlasJSONArray:function(e,t,n,r){this.atlas(e,t,n,r,Phaser.Loader.TEXTURE_ATLAS_JSON_ARRAY)},atlasJSONHash:function(e,t,n,r){this.atlas(e,t,n,r,Phaser.Loader.TEXTURE_ATLAS_JSON_HASH)},atlasXML:function(e,t,n,r){this.atlas(e,t,n,r,Phaser.Loader.TEXTURE_ATLAS_XML_STARLING)},atlas:function(e,t,n,r,i){typeof n=="undefined"&&(n=null),typeof r=="undefined"&&(r=null),typeof i=="undefined"&&(i=Phaser.Loader.TEXTURE_ATLAS_JSON_ARRAY);if(this.checkKeyExists(e)===!1)if(n)this.addToFileList("textureatlas",e,t,{atlasURL:n,format:i});else{switch(i){case Phaser.Loader.TEXTURE_ATLAS_JSON_ARRAY:typeof r=="string"&&(r=JSON.parse(r));break;case Phaser.Loader.TEXTURE_ATLAS_XML_STARLING:if(typeof r=="string"){var s;try{if(window.DOMParser){var o=new DOMParser;s=o.parseFromString(r,"text/xml")}else s=new ActiveXObject("Microsoft.XMLDOM"),s.async="false",s.loadXML(r)}catch(u){s=undefined}if(!s||!s.documentElement||s.getElementsByTagName("parsererror").length)throw new Error("Phaser.Loader. Invalid Texture Atlas XML given");r=s}}this.addToFileList("textureatlas",e,t,{atlasURL:null,atlasData:r,format:i})}},removeFile:function(e){delete this._fileList[e]},removeAll:function(){this._fileList={}},start:function(){if(this.isLoading)return;this.progress=0,this.hasLoaded=!1,this.isLoading=!0,this.onLoadStart.dispatch(this.queueSize),this._keys.length>0?(this._progressChunk=100/this._keys.length,this.loadFile()):(this.progress=100,this.hasLoaded=!0,this.onLoadComplete.dispatch())},loadFile:function(){var e=this._fileList[this._keys.shift()],t=this;switch(e.type){case"image":case"spritesheet":case"textureatlas":case"bitmapfont":case"tilemap":e.data=new Image,e.data.name=e.key,e.data.onload=function(){return t.fileComplete(e.key)},e.data.onerror=function(){return t.fileError(e.key)},e.data.crossOrigin=this.crossOrigin,e.data.src=this.baseURL+e.url;break;case"audio":e.url=this.getAudioURL(e.url),e.url!==null?this.game.sound.usingWebAudio?(this._xhr.open("GET",this.baseURL+e.url,!0),this._xhr.responseType="arraybuffer",this._xhr.onload=function(){return t.fileComplete(e.key)},this._xhr.onerror=function(){return t.fileError(e.key)},this._xhr.send()):this.game.sound.usingAudioTag&&(this.game.sound.touchLocked?(e.data=new Audio,e.data.name=e.key,e.data.preload="auto",e.data.src=this.baseURL+e.url,this.fileComplete(e.key)):(e.data=new Audio,e.data.name=e.key,e.data.onerror=function(){return t.fileError(e.key)},e.data.preload="auto",e.data.src=this.baseURL+e.url,e.data.addEventListener("canplaythrough",Phaser.GAMES[this.game.id].load.fileComplete(e.key),!1),e.data.load())):this.fileError(e.key);break;case"text":this._xhr.open("GET",this.baseURL+e.url,!0),this._xhr.responseType="text",this._xhr.onload=function(){return t.fileComplete(e.key)},this._xhr.onerror=function(){return t.fileError(e.key)},this._xhr.send()}},getAudioURL:function(e){var t;for(var n=0;n<e.length;n++){t=e[n].toLowerCase(),t=t.substr((Math.max(0,t.lastIndexOf("."))||Infinity)+1);if(this.game.device.canPlayAudio(t))return e[n]}return null},fileError:function(e){this._fileList[e].loaded=!0,this._fileList[e].error=!0,this.onFileError.dispatch(e),console.warn("Phaser.Loader error loading file: "+e),this.nextFile(e,!1)},fileComplete:function(e){if(!this._fileList[e]){console.warn("Phaser.Loader fileComplete invalid key "+e);return}this._fileList[e].loaded=!0;var t=this._fileList[e],n=!0,r=this;switch(t.type){case"image":this.game.cache.addImage(t.key,t.url,t.data);break;case"spritesheet":this.game.cache.addSpriteSheet(t.key,t.url,t.data,t.frameWidth,t.frameHeight,t.frameMax);break;case"tilemap":t.mapDataURL==null?this.game.cache.addTilemap(t.key,t.url,t.data,t.mapData,t.format):(n=!1,this._xhr.open("GET",this.baseURL+t.mapDataURL,!0),this._xhr.responseType="text",t.format==Phaser.Tilemap.JSON?this._xhr.onload=function(){return r.jsonLoadComplete(t.key)}:t.format==Phaser.Tilemap.CSV&&(this._xhr.onload=function(){return r.csvLoadComplete(t.key)}),this._xhr.onerror=function(){return r.dataLoadError(t.key)},this._xhr.send());break;case"textureatlas":t.atlasURL==null?this.game.cache.addTextureAtlas(t.key,t.url,t.data,t.atlasData,t.format):(n=!1,this._xhr.open("GET",this.baseURL+t.atlasURL,!0),this._xhr.responseType="text",t.format==Phaser.Loader.TEXTURE_ATLAS_JSON_ARRAY||t.format==Phaser.Loader.TEXTURE_ATLAS_JSON_HASH?this._xhr.onload=function(){return r.jsonLoadComplete(t.key)}:t.format==Phaser.Loader.TEXTURE_ATLAS_XML_STARLING&&(this._xhr.onload=function(){return r.xmlLoadComplete(t.key)}),this._xhr.onerror=function(){return r.dataLoadError(t.key)},this._xhr.send());break;case"bitmapfont":t.xmlURL==null?this.game.cache.addBitmapFont(t.key,t.url,t.data,t.xmlData):(n=!1,this._xhr.open("GET",this.baseURL+t.xmlURL,!0),this._xhr.responseType="text",this._xhr.onload=function(){return r.xmlLoadComplete(t.key)},this._xhr.onerror=function(){return r.dataLoadError(t.key)},this._xhr.send());break;case"audio":if(this.game.sound.usingWebAudio){t.data=this._xhr.response,this.game.cache.addSound(t.key,t.url,t.data,!0,!1);if(t.autoDecode){this.game.cache.updateSound(e,"isDecoding",!0);var i=this,e=t.key;this.game.sound.context.decodeAudioData(t.data,function(t){t&&i.game.cache.decodedSound(e,t)})}}else t.data.removeEventListener("canplaythrough",Phaser.GAMES[this.game.id].load.fileComplete),this.game.cache.addSound(t.key,t.url,t.data,!1,!0);break;case"text":t.data=this._xhr.response,this.game.cache.addText(t.key,t.url,t.data)}n&&this.nextFile(e,!0)},jsonLoadComplete:function(e){var t=JSON.parse(this._xhr.response),n=this._fileList[e];n.type=="tilemap"?this.game.cache.addTilemap(n.key,n.url,n.data,t,n.format):this.game.cache.addTextureAtlas(n.key,n.url,n.data,t,n.format),this.nextFile(e,!0)},csvLoadComplete:function(e){var t=this._xhr.response,n=this._fileList[e];this.game.cache.addTilemap(n.key,n.url,n.data,t,n.format),this.nextFile(e,!0)},dataLoadError:function(e){var t=this._fileList[e];t.error=!0,console.warn("Phaser.Loader dataLoadError: "+e),this.nextFile(e,!0)},xmlLoadComplete:function(e){var t=this._xhr.response,n;try{if(window.DOMParser){var r=new DOMParser;n=r.parseFromString(t,"text/xml")}else n=new ActiveXObject("Microsoft.XMLDOM"),n.async="false",n.loadXML(t)}catch(i){n=undefined}if(!n||!n.documentElement||n.getElementsByTagName("parsererror").length)throw new Error("Phaser.Loader. Invalid XML given");var s=this._fileList[e];s.type=="bitmapfont"?this.game.cache.addBitmapFont(s.key,s.url,s.data,n):s.type=="textureatlas"&&this.game.cache.addTextureAtlas(s.key,s.url,s.data,n,s.format),this.nextFile(e,!0)},nextFile:function(e,t){this.progress=Math.round(this.progress+this._progressChunk),this.progress>100&&(this.progress=100),this.preloadSprite!==null&&(this.preloadSprite.direction==0?this.preloadSprite.crop.width=this.preloadSprite.width/100*this.progress:this.preloadSprite.crop.height=this.preloadSprite.height/100*this.progress,this.preloadSprite.sprite.crop=this.preloadSprite.crop),this.onFileComplete.dispatch(this.progress,e,t,this.queueSize-this._keys.length,this.queueSize),this._keys.length>0?this.loadFile():(this.hasLoaded=!0,this.isLoading=!1,this.removeAll(),this.onLoadComplete.dispatch())}},Phaser.Loader.Parser={bitmapFont:function(e,t,n){if(!t.getElementsByTagName("font")){console.warn("Phaser.Loader.Parser.bitmapFont: Invalid XML given, missing <font> tag");return}var r=PIXI.TextureCache[n],i={},s=t.getElementsByTagName("info")[0],o=t.getElementsByTagName("common")[0];i.font=s.attributes.getNamedItem("face").nodeValue,i.size=parseInt(s.attributes.getNamedItem("size").nodeValue,10),i.lineHeight=parseInt(o.attributes.getNamedItem("lineHeight").nodeValue,10),i.chars={};var u=t.getElementsByTagName("char");for(var a=0;a<u.length;a++){var f=parseInt(u[a].attributes.getNamedItem("id").nodeValue,10),l={x:parseInt(u[a].attributes.getNamedItem("x").nodeValue,10),y:parseInt(u[a].attributes.getNamedItem("y").nodeValue,10),width:parseInt(u[a].attributes.getNamedItem("width").nodeValue,10),height:parseInt(u[a].attributes.getNamedItem("height").nodeValue,10)};PIXI.TextureCache[f]=new PIXI.Texture(r,l),i.chars[f]={xOffset:parseInt(u[a].attributes.getNamedItem("xoffset").nodeValue,10),yOffset:parseInt(u[a].attributes.getNamedItem("yoffset").nodeValue,10),xAdvance:parseInt(u[a].attributes.getNamedItem("xadvance").nodeValue,10),kerning:{},texture:new PIXI.Texture(r,l)}}var c=t.getElementsByTagName("kerning");for(a=0;a<c.length;a++){var h=parseInt(c[a].attributes.getNamedItem("first").nodeValue,10),p=parseInt(c[a].attributes.getNamedItem("second").nodeValue,10),d=parseInt(c[a].attributes.getNamedItem("amount").nodeValue,10);i.chars[p].kerning[h]=d}PIXI.BitmapText.fonts[i.font]=i}},Phaser.Sound=function(e,t,n,r){n=n||1,typeof r=="undefined"&&(r=!1),this.game=e,this.name=t,this.key=t,this.loop=r,this._volume=n,this.markers={},this.context=null,this._buffer=null,this._muted=!1,this.autoplay=!1,this.totalDuration=0,this.startTime=0,this.currentTime=0,this.duration=0,this.stopTime=0,this.paused=!1,this.isPlaying=!1,this.currentMarker="",this.pendingPlayback=!1,this.override=!1,this.usingWebAudio=this.game.sound.usingWebAudio,this.usingAudioTag=this.game.sound.usingAudioTag,this.usingWebAudio?(this.context=this.game.sound.context,this.masterGainNode=this.game.sound.masterGain,typeof this.context.createGain=="undefined"?this.gainNode=this.context.createGainNode():this.gainNode=this.context.createGain(),this.gainNode.gain.value=n*this.game.sound.volume,this.gainNode.connect(this.masterGainNode)):this.game.cache.getSound(t)&&this.game.cache.isSoundReady(t)?(this._sound=this.game.cache.getSoundData(t),this.totalDuration=0,this._sound.duration&&(this.totalDuration=this._sound.duration)):this.game.cache.onSoundUnlock.add(this.soundHasUnlocked,this),this.onDecoded=new Phaser.Signal,this.onPlay=new Phaser.Signal,this.onPause=new Phaser.Signal,this.onResume=new Phaser.Signal,this.onLoop=new Phaser.Signal,this.onStop=new Phaser.Signal,this.onMute=new Phaser.Signal,this.onMarkerComplete=new Phaser.Signal},Phaser.Sound.prototype={soundHasUnlocked:function(e){e==this.key&&(this._sound=this.game.cache.getSoundData(this.key),this.totalDuration=this._sound.duration,console.log("sound has unlocked"+this._sound))},addMarker:function(e,t,n,r,i){r=r||1,typeof i=="undefined"&&(i=!1),this.markers[e]={name:e,start:t,stop:n,volume:r,duration:n-t,loop:i}},removeMarker:function(e){delete this.markers[e]},update:function(){this.pendingPlayback&&this.game.cache.isSoundReady(this.key)&&(this.pendingPlayback=!1,this.play(this._tempMarker,this._tempPosition,this._tempVolume,this._tempLoop)),this.isPlaying&&(this.currentTime=this.game.time.now-this.startTime,this.currentTime>=this.duration&&(this.usingWebAudio?this.loop?(this.onLoop.dispatch(this),this.currentMarker==""?(this.currentTime=0,this.startTime=this.game.time.now):this.play(this.currentMarker,0,this.volume,!0,!0)):this.stop():this.loop?(this.onLoop.dispatch(this),this.play(this.currentMarker,0,this.volume,!0,!0)):this.stop()))},play:function(e,t,n,r,i){e=e||"",t=t||0,n=n||1,typeof r=="undefined"&&(r=!1),typeof i=="undefined"&&(i=!1),console.log(this.name+" play "+e+" position "+t+" volume "+n+" loop "+r);if(this.isPlaying==1&&i==0&&this.override==0)return;this.isPlaying&&this.override&&(this.usingWebAudio?typeof this._sound.stop=="undefined"?this._sound.noteOff(0):this._sound.stop(0):this.usingAudioTag&&(this._sound.pause(),this._sound.currentTime=0)),this.currentMarker=e,e!==""&&this.markers[e]?(this.position=this.markers[e].start,this.volume=this.markers[e].volume,this.loop=this.markers[e].loop,this.duration=this.markers[e].duration*1e3,this._tempMarker=e,this._tempPosition=this.position,this._tempVolume=this.volume,this._tempLoop=this.loop):(this.position=t,this.volume=n,this.loop=r,this.duration=0,this._tempMarker=e,this._tempPosition=t,this._tempVolume=n,this._tempLoop=r),this.usingWebAudio?this.game.cache.isSoundDecoded(this.key)?(this._buffer==null&&(this._buffer=this.game.cache.getSoundData(this.key)),this._sound=this.context.createBufferSource(),this._sound.buffer=this._buffer,this._sound.connect(this.gainNode),this.totalDuration=this._sound.buffer.duration,this.duration==0&&(this.duration=this.totalDuration*1e3),this.loop&&e==""&&(this._sound.loop=!0),typeof this._sound.start=="undefined"?this._sound.noteGrainOn(0,this.position,this.duration/1e3):this._sound.start(0,this.position,this.duration/1e3),this.isPlaying=!0,this.startTime=this.game.time.now,this.currentTime=0,this.stopTime=this.startTime+this.duration,this.onPlay.dispatch(this)):(this.pendingPlayback=!0,this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).isDecoding==0&&this.game.sound.decode(this.key,this)):this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).locked?(this.game.cache.reloadSound(this.key),this.pendingPlayback=!0):this._sound&&this._sound.readyState==4?(this._sound.play(),this.totalDuration=this._sound.duration,this.duration==0&&(this.duration=this.totalDuration*1e3),this._sound.currentTime=this.position,this._sound.muted=this._muted,this._muted?this._sound.volume=0:this._sound.volume=this._volume,this.isPlaying=!0,this.startTime=this.game.time.now,this.currentTime=0,this.stopTime=this.startTime+this.duration,this.onPlay.dispatch(this)):this.pendingPlayback=!0},restart:function(e,t,n,r){e=e||"",t=t||0,n=n||1,typeof r=="undefined"&&(r=!1),this.play(e,t,n,r,!0)},pause:function(){this.isPlaying&&this._sound&&(this.stop(),this.isPlaying=!1,this.paused=!0,this.onPause.dispatch(this))},resume:function(){this.paused&&this._sound&&(this.usingWebAudio?typeof this._sound.start=="undefined"?this._sound.noteGrainOn(0,this.position,this.duration):this._sound.start(0,this.position,this.duration):this._sound.play(),this.isPlaying=!0,this.paused=!1,this.onResume.dispatch(this))},stop:function(){this.isPlaying&&this._sound&&(this.usingWebAudio?typeof this._sound.stop=="undefined"?this._sound.noteOff(0):this._sound.stop(0):this.usingAudioTag&&(this._sound.pause(),this._sound.currentTime=0)),this.isPlaying=!1;var e=this.currentMarker;this.currentMarker="",this.onStop.dispatch(this,e)}},Object.defineProperty(Phaser.Sound.prototype,"isDecoding",{get:function(){return this.game.cache.getSound(this.key).isDecoding}}),Object.defineProperty(Phaser.Sound.prototype,"isDecoded",{get:function(){return this.game.cache.isSoundDecoded(this.key)}}),Object.defineProperty(Phaser.Sound.prototype,"mute",{get:function(){return this._muted},set:function(e){e=e||null,e?(this._muted=!0,this.usingWebAudio?(this._muteVolume=this.gainNode.gain.value,this.gainNode.gain.value=0):this.usingAudioTag&&this._sound&&(this._muteVolume=this._sound.volume,this._sound.volume=0)):(this._muted=!1,this.usingWebAudio?this.gainNode.gain.value=this._muteVolume:this.usingAudioTag&&this._sound&&(this._sound.volume=this._muteVolume)),this.onMute.dispatch(this)}}),Object.defineProperty(Phaser.Sound.prototype,"volume",{get:function(){return this._volume},set:function(e){this.usingWebAudio?(this._volume=e,this.gainNode.gain.value=e):this.usingAudioTag&&this._sound&&e>=0&&e<=1&&(this._volume=e,this._sound.volume=e)}}),Phaser.SoundManager=function(e){this.game=e,this.onSoundDecode=new Phaser.Signal,this._muted=!1,this._unlockSource=null,this._volume=1,this._sounds=[],this.context=null,this.usingWebAudio=!0,this.usingAudioTag=!1,this.noAudio=!1,this.touchLocked=!1,this.channels=32},Phaser.SoundManager.prototype={boot:function(){this.game.device.iOS&&this.game.device.webAudio==0&&(this.channels=1),this.game.device.iOS||window.PhaserGlobal&&window.PhaserGlobal.fakeiOSTouchLock?(this.game.input.touch.callbackContext=this,this.game.input.touch.touchStartCallback=this.unlock,this.game.input.mouse.callbackContext=this,this.game.input.mouse.mouseDownCallback=this.unlock,this.touchLocked=!0):this.touchLocked=!1;if(window.PhaserGlobal){if(window["PhaserGlobal"].disableAudio==1){this.usingWebAudio=!1,this.noAudio=!0;return}if(window["PhaserGlobal"].disableWebAudio==1){this.usingWebAudio=!1,this.usingAudioTag=!0,this.noAudio=!1;return}}window.AudioContext?this.context=new window.AudioContext:window.webkitAudioContext?this.context=new window.webkitAudioContext:window.Audio?(this.usingWebAudio=!1,this.usingAudioTag=!0):(this.usingWebAudio=!1,this.noAudio=!0),this.context!==null&&(typeof this.context.createGain=="undefined"?this.masterGain=this.context.createGainNode():this.masterGain=this.context.createGain(),this.masterGain.gain.value=1,this.masterGain.connect(this.context.destination))},unlock:function(){if(this.touchLocked==0)return;if(this.game.device.webAudio==0||window.PhaserGlobal&&window["PhaserGlobal"].disableWebAudio==1)this.touchLocked=!1,this._unlockSource=null,this.game.input.touch.callbackContext=null,this.game.input.touch.touchStartCallback=null,this.game.input.mouse.callbackContext=null,this.game.input.mouse.mouseDownCallback=null;else{var e=this.context.createBuffer(1,1,22050);this._unlockSource=this.context.createBufferSource(),this._unlockSource.buffer=e,this._unlockSource.connect(this.context.destination),this._unlockSource.noteOn(0)}},stopAll:function(){for(var e=0;e<this._sounds.length;e++)this._sounds[e]&&this._sounds[e].stop()},pauseAll:function(){for(var e=0;e<this._sounds.length;e++)this._sounds[e]&&this._sounds[e].pause()},resumeAll:function(){for(var e=0;e<this._sounds.length;e++)this._sounds[e]&&this._sounds[e].resume()},decode:function(e,t){t=t||null;var n=this.game.cache.getSoundData(e);if(n&&this.game.cache.isSoundDecoded(e)===!1){this.game.cache.updateSound(e,"isDecoding",!0);var r=this;this.context.decodeAudioData(n,function(n){r.game.cache.decodedSound(e,n),t&&r.onSoundDecode.dispatch(t)})}},update:function(){this.touchLocked&&this.game.device.webAudio&&this._unlockSource!==null&&(this._unlockSource.playbackState===this._unlockSource.PLAYING_STATE||this._unlockSource.playbackState===this._unlockSource.FINISHED_STATE)&&(this.touchLocked=!1,this._unlockSource=null,this.game.input.touch.callbackContext=null,this.game.input.touch.touchStartCallback=null);for(var e=0;e<this._sounds.length;e++)this._sounds[e].update()},add:function(e,t,n){t=t||1,typeof n=="undefined"&&(n=!1);var r=new Phaser.Sound(this.game,e,t,n);return this._sounds.push(r),r}},Object.defineProperty(Phaser.SoundManager.prototype,"mute",{get:function(){return this._muted},set:function(e){e=e||null;if(e){if(this._muted)return;this._muted=!0,this.usingWebAudio&&(this._muteVolume=this.masterGain.gain.value,this.masterGain.gain.value=0);for(var t=0;t<this._sounds.length;t++)this._sounds[t].usingAudioTag&&(this._sounds[t].mute=!0)}else{if(this._muted==0)return;this._muted=!1,this.usingWebAudio&&(this.masterGain.gain.value=this._muteVolume);for(var t=0;t<this._sounds.length;t++)this._sounds[t].usingAudioTag&&(this._sounds[t].mute=!1)}}}),Object.defineProperty(Phaser.SoundManager.prototype,"volume",{get:function(){return this.usingWebAudio?this.masterGain.gain.value:this._volume},set:function(e){e=this.game.math.clamp(e,1,0),this._volume=e,this.usingWebAudio&&(this.masterGain.gain.value=e);for(var t=0;t<this._sounds.length;t++)this._sounds[t].usingAudioTag&&(this._sounds[t].volume=this._sounds[t].volume*e)}}),Phaser.Utils.Debug=function(e){this.game=e,this.context=e.context,this.font="14px Courier",this.lineHeight=16,this.renderShadow=!0,this.currentX=0,this.currentY=0,this.currentAlpha=1},Phaser.Utils.Debug.prototype={start:function(e,t,n){if(this.context==null)return;e=e||null,t=t||null,n=n||"rgb(255,255,255)",e&&t&&(this.currentX=e,this.currentY=t,this.currentColor=n),this.currentAlpha=this.context.globalAlpha,this.context.save(),this.context.setTransform(1,0,0,1,0,0),this.context.fillStyle=n,this.context.font=this.font,this.context.globalAlpha=1},stop:function(){this.context.restore(),this.context.globalAlpha=this.currentAlpha},line:function(e,t,n){if(this.context==null)return;t=t||null,n=n||null,t!==null&&(this.currentX=t),n!==null&&(this.currentY=n),this.renderShadow&&(this.context.fillStyle="rgb(0,0,0)",this.context.fillText(e,this.currentX+1,this.currentY+1),this.context.fillStyle=this.currentColor),this.context.fillText(e,this.currentX,this.currentY),this.currentY+=this.lineHeight},renderQuadTree:function(e,t){t=t||"rgba(255,0,0,0.3)",this.start();var n=e.bounds;if(e.nodes.length===0){this.context.strokeStyle=t,this.context.strokeRect(n.x,n.y,n.width,n.height),this.renderText(e.ID+" / "+e.objects.length,n.x+4,n.y+16,"rgb(0,200,0)","12px Courier"),this.context.strokeStyle="rgb(0,255,0)";for(var r=0;r<e.objects.length;r++)this.context.strokeRect(e.objects[r].x,e.objects[r].y,e.objects[r].width,e.objects[r].height)}else for(var r=0;r<e.nodes.length;r++)this.renderQuadTree(e.nodes[r]);this.stop()},renderSpriteCorners:function(e,t,n,r){if(this.context==null)return;t=t||!1,n=n||!1,r=r||"rgb(255,0,255)",this.start(0,0,r),n&&(this.context.strokeStyle="rgba(255,0,255,0.5)",this.context.strokeRect(e.bounds.x,e.bounds.y,e.bounds.width,e.bounds.height),this.context.stroke()),this.context.beginPath(),this.context.moveTo(e.topLeft.x,e.topLeft.y),this.context.lineTo(e.topRight.x,e.topRight.y),this.context.lineTo(e.bottomRight.x,e.bottomRight.y),this.context.lineTo(e.bottomLeft.x,e.bottomLeft.y),this.context.closePath(),this.context.strokeStyle="rgba(0,0,255,0.8)",this.context.stroke(),this.renderPoint(e.center),this.renderPoint(e.topLeft),this.renderPoint(e.topRight),this.renderPoint(e.bottomLeft),this.renderPoint(e.bottomRight),t&&(this.currentColor=r,this.line("x: "+Math.floor(e.topLeft.x)+" y: "+Math.floor(e.topLeft.y),e.topLeft.x,e.topLeft.y),this.line("x: "+Math.floor(e.topRight.x)+" y: "+Math.floor(e.topRight.y),e.topRight.x,e.topRight.y),this.line("x: "+Math.floor(e.bottomLeft.x)+" y: "+Math.floor(e.bottomLeft.y),e.bottomLeft.x,e.bottomLeft.y),this.line("x: "+Math.floor(e.bottomRight.x)+" y: "+Math.floor(e.bottomRight.y),e.bottomRight.x,e.bottomRight.y)),this.stop()},renderSoundInfo:function(e,t,n,r){if(this.context==null)return;r=r||"rgb(255,255,255)",this.start(t,n,r),this.line("Sound: "+e.key+" Locked: "+e.game.sound.touchLocked),this.line("Is Ready?: "+this.game.cache.isSoundReady(e.key)+" Pending Playback: "+e.pendingPlayback),this.line("Decoded: "+e.isDecoded+" Decoding: "+e.isDecoding),this.line("Total Duration: "+e.totalDuration+" Playing: "+e.isPlaying),this.line("Time: "+e.currentTime),this.line("Volume: "+e.volume+" Muted: "+e.mute),this.line("WebAudio: "+e.usingWebAudio+" Audio: "+e.usingAudioTag),e.currentMarker!==""&&(this.line("Marker: "+e.currentMarker+" Duration: "+e.duration),this.line("Start: "+e.markers[e.currentMarker].start+" Stop: "+e.markers[e.currentMarker].stop),this.line("Position: "+e.position)),this.stop()},renderCameraInfo:function(e,t,n,r){if(this.context==null)return;r=r||"rgb(255,255,0)",this.start(t,n,r),this.line("Camera ("+e.width+" x "+e.height+")"),this.line("X: "+e.x+" Y: "+e.y),this.stop()},renderPointer:function(e,t,n,r,i){if(this.context==null||e==null)return;t=t||!1,n=n||"rgba(0,255,0,0.5)",r=r||"rgba(255,0,0,0.5)",i=i||"rgb(255,255,255)";if(t==1&&e.isUp==1)return;this.start(e.x,e.y-100,i),this.context.beginPath(),this.context.arc(e.x,e.y,e.circle.radius,0,Math.PI*2),e.active?this.context.fillStyle=n:this.context.fillStyle=r,this.context.fill(),this.context.closePath(),this.context.beginPath(),this.context.moveTo(e.positionDown.x,e.positionDown.y),this.context.lineTo(e.position.x,e.position.y),this.context.lineWidth=2,this.context.stroke(),this.context.closePath(),this.line("ID: "+e.id+" Active: "+e.active),this.line("World X: "+e.worldX+" World Y: "+e.worldY),this.line("Screen X: "+e.x+" Screen Y: "+e.y),this.line("Duration: "+e.duration+" ms"),this.stop()},renderSpriteInputInfo:function(e,t,n,r){r=r||"rgb(255,255,255)",this.start(t,n,r),this.line("Sprite Input: ("+e.width+" x "+e.height+")"),this.line("x: "+e.input.pointerX().toFixed(1)+" y: "+e.input.pointerY().toFixed(1)),this.line("over: "+e.input.pointerOver()+" duration: "+e.input.overDuration().toFixed(0)),this.line("down: "+e.input.pointerDown()+" duration: "+e.input.downDuration().toFixed(0)),this.line("just over: "+e.input.justOver()+" just out: "+e.input.justOut()),this.stop()},renderSpriteCollision:function(e,t,n,r){r=r||"rgb(255,255,255)",this.start(t,n,r),this.line("Sprite Collision: ("+e.width+" x "+e.height+")"),this.line("left: "+e.body.touching.left),this.line("right: "+e.body.touching.right),this.line("up: "+e.body.touching.up),this.line("down: "+e.body.touching.down),this.line("velocity.x: "+e.body.velocity.x),this.line("velocity.y: "+e.body.velocity.y),this.stop()},renderInputInfo:function(e,t,n){if(this.context==null)return;n=n||"rgb(255,255,0)",this.start(e,t,n),this.line("Input"),this.line("X: "+this.game.input.x+" Y: "+this.game.input.y),this.line("World X: "+this.game.input.worldX+" World Y: "+this.game.input.worldY),this.line("Scale X: "+this.game.input.scale.x.toFixed(1)+" Scale Y: "+this.game.input.scale.x.toFixed(1)),this.line("Screen X: "+this.game.input.activePointer.screenX+" Screen Y: "+this.game.input.activePointer.screenY),this.stop()},renderSpriteInfo:function(e,t,n,r){if(this.context==null)return;r=r||"rgb(255, 255, 255)",this.start(t,n,r),this.line("Sprite:  ("+e.width+" x "+e.height+") anchor: "+e.anchor.x+" x "+e.anchor.y),this.line("x: "+e.x.toFixed(1)+" y: "+e.y.toFixed(1)+" rotation: "+e.rotation.toFixed(1)),this.line("visible: "+e.visible),this.line("in camera: "+e.inCamera),this.line("body x: "+e.body.x.toFixed(1)+" y: "+e.body.y.toFixed(1))},renderWorldTransformInfo:function(e,t,n,r){if(this.context==null)return;r=r||"rgb(255, 255, 255)",this.start(t,n,r),this.line("World Transform"),this.line("skewX:  "+e.worldTransform[3]),this.line("skewY:  "+e.worldTransform[1]),this.line("scaleX: "+e.worldTransform[0]),this.line("scaleY: "+e.worldTransform[4]),this.line("transX: "+e.worldTransform[2]),this.line("transY: "+e.worldTransform[5])},renderLocalTransformInfo:function(e,t,n,r){if(this.context==null)return;r=r||"rgb(255, 255, 255)",this.start(t,n,r),this.line("Local Transform"),this.line("skewX:  "+e.localTransform[3]),this.line("skewY:  "+e.localTransform[1]),this.line("scaleX: "+e.localTransform[0]),this.line("scaleY: "+e.localTransform[4]),this.line("transX: "+e.localTransform[2]),this.line("transY: "+e.localTransform[5]),this.line("sX:     "+e._sx),this.line("sY:     "+e._sy)},renderPointInfo:function(e,t,n,r){if(this.context==null)return;r=r||"rgb(255, 255, 255)",this.start(t,n,r),this.line("px: "+e.x.toFixed(1)+" py: "+e.y.toFixed(1)),this.stop()},renderSpriteBody:function(e,t){if(this.context==null)return;t=t||"rgba(255,0,255, 0.3)",this.start(0,0,t),this.context.fillStyle=t,this.context.fillRect(e.body.x,e.body.y,e.body.width,e.body.height),this.stop()},renderSpriteBounds:function(e,t,n){if(this.context==null)return;t=t||"rgb(255,0,255)",this.start(0,0,t),n?(this.context.fillStyle=t,this.context.fillRect(e.bounds.x,e.bounds.y,e.bounds.width,e.bounds.height)):(this.context.strokeStyle=t,this.context.strokeRect(e.bounds.x,e.bounds.y,e.bounds.width,e.bounds.height),this.context.stroke()),this.stop()},renderPixel:function(e,t,n){if(this.context==null)return;n=n||"rgba(0,255,0,1)",this.start(),this.context.fillStyle=n,this.context.fillRect(e,t,2,2),this.stop()},renderPoint:function(e,t){if(this.context==null)return;t=t||"rgba(0,255,0,1)",this.start(),this.context.fillStyle=t,this.context.fillRect(e.x,e.y,4,4),this.stop()},renderRectangle:function(e,t){if(this.context==null)return;t=t||"rgba(0,255,0,0.3)",this.start(),this.context.fillStyle=t,this.context.fillRect(e.x,e.y,e.width,e.height),this.stop()},renderCircle:function(e,t){if(this.context==null)return;t=t||"rgba(0,255,0,0.3)",this.start(),this.context.beginPath(),this.context.fillStyle=t,this.context.arc(e.x,e.y,e.radius,0,Math.PI*2,!1),this.context.fill(),this.context.closePath(),this.stop()},renderText:function(e,t,n,r,i){if(this.context==null)return;r=r||"rgb(255,255,255)",i=i||"16px Courier",this.start(),this.context.font=i,this.context.fillStyle=r,this.context.fillText(e,t,n),this.stop()}},Phaser.Color={getColor32:function(e,t,n,r){return e<<24|t<<16|n<<8|r},getColor:function(e,t,n){return e<<16|t<<8|n},hexToRGB:function(e){var t=e.charAt(0)=="#"?e.substring(1,7):e,n=parseInt(t.substring(0,2),16),r=parseInt(t.substring(2,4),16),i=parseInt(t.substring(4,6),16);return n<<16|r<<8|i},getColorInfo:function(e){var t=Phaser.Color.getRGB(e),n=Phaser.Color.RGBtoHSV(e),r=Phaser.Color.RGBtoHexstring(e)+"\n";return r=r.concat("Alpha: "+t.alpha+" Red: "+t.red+" Green: "+t.green+" Blue: "+t.blue)+"\n",r=r.concat("Hue: "+n.hue+" Saturation: "+n.saturation+" Lightnes: "+n.lightness),r},RGBtoHexstring:function(e){var t=Phaser.Color.getRGB(e);return"0x"+Phaser.Color.colorToHexstring(t.alpha)+Phaser.Color.colorToHexstring(t.red)+Phaser.Color.colorToHexstring(t.green)+Phaser.Color.colorToHexstring(t.blue)},RGBtoWebstring:function(e){var t=Phaser.Color.getRGB(e);return"#"+Phaser.Color.colorToHexstring(t.red)+Phaser.Color.colorToHexstring(t.green)+Phaser.Color.colorToHexstring(t.blue)},colorToHexstring:function(e){var t="0123456789ABCDEF",n=e%16,r=(e-n)/16,i=t.charAt(r)+t.charAt(n);return i},interpolateColor:function(e,t,n,r,i){typeof i=="undefined"&&(i=255);var s=Phaser.Color.getRGB(e),o=Phaser.Color.getRGB(t),u=(o.red-s.red)*r/n+s.red,a=(o.green-s.green)*r/n+s.green,f=(o.blue-s.blue)*r/n+s.blue;return Phaser.Color.getColor32(i,u,a,f)},interpolateColorWithRGB:function(e,t,n,r,i,s){var o=Phaser.Color.getRGB(e),u=(t-o.red)*s/i+o.red,a=(n-o.green)*s/i+o.green,f=(r-o.blue)*s/i+o.blue;return Phaser.Color.getColor(u,a,f)},interpolateRGB:function(e,t,n,r,i,s,o,u){var a=(r-e)*u/o+e,f=(i-t)*u/o+t,l=(s-n)*u/o+n;return Phaser.Color.getColor(a,f,l)},getRandomColor:function(e,t,n){typeof e=="undefined"&&(e=0),typeof t=="undefined"&&(t=255),typeof n=="undefined"&&(n=255);if(t>255)return Phaser.Color.getColor(255,255,255);if(e>t)return Phaser.Color.getColor(255,255,255);var r=e+Math.round(Math.random()*(t-e)),i=e+Math.round(Math.random()*(t-e)),s=e+Math.round(Math.random()*(t-e));return Phaser.Color.getColor32(n,r,i,s)},getRGB:function(e){return{alpha:e>>>24,red:e>>16&255,green:e>>8&255,blue:e&255}},getWebRGB:function(e){var t=(e>>>24)/255,n=e>>16&255,r=e>>8&255,i=e&255;return"rgba("+n.toString()+","+r.toString()+","+i.toString()+","+t.toString()+")"},getAlpha:function(e){return e>>>24},getAlphaFloat:function(e){return(e>>>24)/255},getRed:function(e){return e>>16&255},getGreen:function(e){return e>>8&255},getBlue:function(e){return e&255}},Phaser.Physics={},Phaser.Physics.Arcade=function(e){this.game=e,this.gravity=new Phaser.Point,this.bounds=new Phaser.Rectangle(0,0,e.world.width,e.world.height),this.maxObjects=10,this.maxLevels=4,this.OVERLAP_BIAS=4,this.TILE_OVERLAP=!1,this.quadTree=new Phaser.QuadTree(this,this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels),this.quadTreeID=0,this._bounds1=new Phaser.Rectangle,this._bounds2=new Phaser.Rectangle,this._overlap=0,this._maxOverlap=0,this._velocity1=0,this._velocity2=0,this._newVelocity1=0,this._newVelocity2=0,this._average=0,this._mapData=[],this._result=!1,this._total=0},Phaser.Physics.Arcade.prototype={updateMotion:function(e){this._velocityDelta=(this.computeVelocity(0,!1,e.angularVelocity,e.angularAcceleration,e.angularDrag,e.maxAngular)-e.angularVelocity)/2,e.angularVelocity+=this._velocityDelta,e.rotation+=e.angularVelocity*this.game.time.physicsElapsed,this._velocityDelta=(this.computeVelocity(1,e,e.velocity.x,e.acceleration.x,e.drag.x)-e.velocity.x)/2,e.velocity.x+=this._velocityDelta,this._delta=e.velocity.x*this.game.time.physicsElapsed,e.x+=this._delta,this._velocityDelta=(this.computeVelocity(2,e,e.velocity.y,e.acceleration.y,e.drag.y)-e.velocity.y)/2,e.velocity.y+=this._velocityDelta,this._delta=e.velocity.y*this.game.time.physicsElapsed,e.y+=this._delta},computeVelocity:function(e,t,n,r,i,s){return s=s||1e4,e==1&&t.allowGravity?n+=this.gravity.x+t.gravity.x:e==2&&t.allowGravity&&(n+=this.gravity.y+t.gravity.y),r!==0?n+=r*this.game.time.physicsElapsed:i!==0&&(this._drag=i*this.game.time.physicsElapsed,n-this._drag>0?n-=this._drag:n+this._drag<0?n+=this._drag:n=0),n!=0&&(n>s?n=s:n<-s&&(n=-s)),n},preUpdate:function(){this.quadTree.clear(),this.quadTreeID=0,this.quadTree=new Phaser.QuadTree(this,this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels)},postUpdate:function(){this.quadTree.clear()},collide:function(e,t,n,r,i){return n=n||null,r=r||null,i=i||n,this._result=!1,this._total=0,e&&t&&e.exists&&t.exists&&(e.type==Phaser.SPRITE?t.type==Phaser.SPRITE?this.collideSpriteVsSprite(e,t,n,r,i):t.type==Phaser.GROUP||t.type==Phaser.EMITTER?this.collideSpriteVsGroup(e,t,n,r,i):t.type==Phaser.TILEMAP&&this.collideSpriteVsTilemap(e,t,n,r,i):e.type==Phaser.GROUP?t.type==Phaser.SPRITE?this.collideSpriteVsGroup(t,e,n,r,i):t.type==Phaser.GROUP||t.type==Phaser.EMITTER?this.collideGroupVsGroup(e,t,n,r,i):t.type==Phaser.TILEMAP&&this.collideGroupVsTilemap(e,t,n,r,i):e.type==Phaser.TILEMAP?t.type==Phaser.SPRITE?this.collideSpriteVsTilemap(t,e,n,r,i):(t.type==Phaser.GROUP||t.type==Phaser.EMITTER)&&this.collideGroupVsTilemap(t,e,n,r,i):e.type==Phaser.EMITTER&&(t.type==Phaser.SPRITE?this.collideSpriteVsGroup(t,e,n,r,i):t.type==Phaser.GROUP||t.type==Phaser.EMITTER?this.collideGroupVsGroup(e,t,n,r,i):t.type==Phaser.TILEMAP&&this.collideGroupVsTilemap(e,t,n,r,i))),this._total>0},collideSpriteVsSprite:function(e,t,n,r,i){this.separate(e.body,t.body),this._result&&(r?r.call(i,e,t)&&(this._total++,n&&n.call(i,e,t)):(this._total++,n&&n.call(i,e,t)))},collideGroupVsTilemap:function(e,t,n,r,i){if(e.length==0)return;if(e._container.first._iNext){var s=e._container.first._iNext;do s.exists&&this.collideSpriteVsTilemap(s,t,n,r,i),s=s._iNext;while(s!=e._container.last._iNext)}},collideSpriteVsTilemap:function(e,t,n,r,i){this._mapData=t.collisionLayer.getTileOverlaps(e);var s=this._mapData.length;while(s--)r?r.call(i,e,this._mapData[s].tile)&&(this._total++,n&&n.call(i,e,this._mapData[s].tile)):(this._total++,n&&n.call(i,e,this._mapData[s].tile))},collideSpriteVsGroup:function(e,t,n,r,i){if(t.length==0)return;this._potentials=this.quadTree.retrieve(e);for(var s=0,o=this._potentials.length;s<o;s++)this._potentials[s].sprite.group==t&&(this.separate(e.body,this._potentials[s]),this._result&&r&&(this._result=r.call(i,e,this._potentials[s].sprite)),this._result&&(this._total++,n&&n.call(i,e,this._potentials[s].sprite)))},collideGroupVsGroup:function(e,t,n,r,i){if(e.length==0||t.length==0)return;if(e._container.first._iNext){var s=e._container.first._iNext;do s.exists&&this.collideSpriteVsGroup(s,t,n,r,i),s=s._iNext;while(s!=e._container.last._iNext)}},separate:function(e,t){this._result=this.separateX(e,t)||this.separateY(e,t),this._result&&(e.postUpdate(),t.postUpdate())},separateX:function(e,t){return e.immovable&&t.immovable?!1:(this._overlap=0,e.deltaX()!=t.deltaX()&&(this._bounds1.setTo(e.x-(e.deltaX()>0?e.deltaX():0),e.lastY,e.width+(e.deltaX()>0?e.deltaX():-e.deltaX()),e.height),this._bounds2.setTo(t.x-(t.deltaX()>0?t.deltaX():0),t.lastY,t.width+(t.deltaX()>0?t.deltaX():-t.deltaX()),t.height),this._bounds1.right>this._bounds2.x&&this._bounds1.x<this._bounds2.right&&this._bounds1.bottom>this._bounds2.y&&this._bounds1.y<this._bounds2.bottom&&(this._maxOverlap=e.deltaAbsX()+t.deltaAbsX()+this.OVERLAP_BIAS,e.deltaX()>t.deltaX()?(this._overlap=e.x+e.width-t.x,this._overlap>this._maxOverlap||e.allowCollision.right==0||t.allowCollision.left==0?this._overlap=0:(e.touching.right=!0,t.touching.left=!0)):e.deltaX()<t.deltaX()&&(this._overlap=e.x-t.width-t.x,-this._overlap>this._maxOverlap||e.allowCollision.left==0||t.allowCollision.right==0?this._overlap=0:(e.touching.left=!0,t.touching.right=!0)))),this._overlap!=0?(e.overlapX=this._overlap,t.overlapX=this._overlap,e.customSeparateX||t.customSeparateX?!0:(this._velocity1=e.velocity.x,this._velocity2=t.velocity.x,!e.immovable&&!t.immovable?(this._overlap*=.5,e.x=e.x-this._overlap,t.x+=this._overlap,this._newVelocity1=Math.sqrt(this._velocity2*this._velocity2*t.mass/e.mass)*(this._velocity2>0?1:-1),this._newVelocity2=Math.sqrt(this._velocity1*this._velocity1*e.mass/t.mass)*(this._velocity1>0?1:-1),this._average=(this._newVelocity1+this._newVelocity2)*.5,this._newVelocity1-=this._average,this._newVelocity2-=this._average,e.velocity.x=this._average+this._newVelocity1*e.bounce.x,t.velocity.x=this._average+this._newVelocity2*t.bounce.x):e.immovable?t.immovable||(t.x+=this._overlap,t.velocity.x=this._velocity1-this._velocity2*t.bounce.x):(e.x=e.x-this._overlap,e.velocity.x=this._velocity2-this._velocity1*e.bounce.x),!0)):!1)},separateY:function(e,t){return e.immovable&&t.immovable?!1:(this._overlap=0,e.deltaY()!=t.deltaY()&&(this._bounds1.setTo(e.x,e.y-(e.deltaY()>0?e.deltaY():0),e.width,e.height+e.deltaAbsY()),this._bounds2.setTo(t.x,t.y-(t.deltaY()>0?t.deltaY():0),t.width,t.height+t.deltaAbsY()),this._bounds1.right>this._bounds2.x&&this._bounds1.x<this._bounds2.right&&this._bounds1.bottom>this._bounds2.y&&this._bounds1.y<this._bounds2.bottom&&(this._maxOverlap=e.deltaAbsY()+t.deltaAbsY()+this.OVERLAP_BIAS,e.deltaY()>t.deltaY()?(this._overlap=e.y+e.height-t.y,this._overlap>this._maxOverlap||e.allowCollision.down==0||t.allowCollision.up==0?this._overlap=0:(e.touching.down=!0,t.touching.up=!0)):e.deltaY()<t.deltaY()&&(this._overlap=e.y-t.height-t.y,-this._overlap>this._maxOverlap||e.allowCollision.up==0||t.allowCollision.down==0?this._overlap=0:(e.touching.up=!0,t.touching.down=!0)))),this._overlap!=0?(e.overlapY=this._overlap,t.overlapY=this._overlap,e.customSeparateY||t.customSeparateY?!0:(this._velocity1=e.velocity.y,this._velocity2=t.velocity.y,!e.immovable&&!t.immovable?(this._overlap*=.5,e.y=e.y-this._overlap,t.y+=this._overlap,this._newVelocity1=Math.sqrt(this._velocity2*this._velocity2*t.mass/e.mass)*(this._velocity2>0?1:-1),this._newVelocity2=Math.sqrt(this._velocity1*this._velocity1*e.mass/t.mass)*(this._velocity1>0?1:-1),this._average=(this._newVelocity1+this._newVelocity2)*.5,this._newVelocity1-=this._average,this._newVelocity2-=this._average,e.velocity.y=this._average+this._newVelocity1*e.bounce.y,t.velocity.y=this._average+this._newVelocity2*t.bounce.y):e.immovable?t.immovable||(t.y+=this._overlap,t.velocity.y=this._velocity1-this._velocity2*t.bounce.y,e.sprite.active&&e.moves&&e.deltaY()<t.deltaY()&&(t.x+=e.x-e.lastX)):(e.y=e.y-this._overlap,e.velocity.y=this._velocity2-this._velocity1*e.bounce.y,t.active&&t.moves&&e.deltaY()>t.deltaY()&&(e.x+=t.x-t.lastX)),!0)):!1)},separateTile:function(e,t,n,r,i,s,o,u,a,f,l,c){var h=this.separateTileY(e.body,t,n,r,i,s,a,f,c),p=this.separateTileX(e.body,t,n,r,i,s,o,u,l);return p||h?(e.body.postUpdate(),!0):!1},separateTileX:function(e,t,n,r,i,s,o,u,a){return e.immovable?!1:(this._overlap=0,e.deltaX()!=0&&(this._bounds1.setTo(e.x,e.y,e.width,e.height),this._bounds1.right>t&&this._bounds1.x<t+r&&this._bounds1.bottom>n&&this._bounds1.y<n+i&&(this._maxOverlap=e.deltaAbsX()+this.OVERLAP_BIAS,e.deltaX()>0?(this._overlap=e.x+e.width-t,this._overlap>this._maxOverlap||!e.allowCollision.right||!o?this._overlap=0:e.touching.right=!0):e.deltaX()<0&&(this._overlap=e.x-r-t,-this._overlap>this._maxOverlap||!e.allowCollision.left||!u?this._overlap=0:e.touching.left=!0))),this._overlap!=0?(a&&(e.x=e.x-this._overlap,e.bounce.x==0?e.velocity.x=0:e.velocity.x=-e.velocity.x*e.bounce.x),!0):!1)},separateTileY:function(e,t,n,r,i,s,o,u,a){return e.immovable?!1:(this._overlap=0,e.deltaY()!=0&&(this._bounds1.setTo(e.x,e.y,e.width,e.height),this._bounds1.right>t&&this._bounds1.x<t+r&&this._bounds1.bottom>n&&this._bounds1.y<n+i&&(this._maxOverlap=e.deltaAbsY()+this.OVERLAP_BIAS,e.deltaY()>0?(this._overlap=e.bottom-n,this._overlap>this._maxOverlap||!e.allowCollision.down||!u?this._overlap=0:e.touching.down=!0):(this._overlap=e.y-i-n,-this._overlap>this._maxOverlap||!e.allowCollision.up||!o?this._overlap=0:e.touching.up=!0))),this._overlap!=0?(a&&(e.y=e.y-this._overlap,e.bounce.y==0?e.velocity.y=0:e.velocity.y=-e.velocity.y*e.bounce.y),!0):!1)},velocityFromAngle:function(e,t,n){t=t||0,n=n||new Phaser.Point;var r=this.game.math.degToRad(e);return n.setTo(Math.cos(r)*t,Math.sin(r)*t)},moveTowardsObject:function(e,t,n,r){n=n||60,r=r||0;var i=this.angleBetween(e,t);if(r>0){var s=this.distanceBetween(e,t);n=s/(r/1e3)}e.body.velocity.x=Math.cos(i)*n,e.body.velocity.y=Math.sin(i)*n},accelerateTowardsObject:function(e,t,n,r,i){r=r||1e3,i=i||1e3;var s=this.angleBetween(e,t);e.body.velocity.x=0,e.body.velocity.y=0,e.body.acceleration.x=Math.cos(s)*n,e.body.acceleration.y=Math.sin(s)*n,e.body.maxVelocity.x=r,e.body.maxVelocity.y=i},moveTowardsMouse:function(e,t,n){t=t||60,n=n||0;var r=this.angleBetweenMouse(e);if(n>0){var i=this.distanceToMouse(e);t=i/(n/1e3)}e.body.velocity.x=Math.cos(r)*t,e.body.velocity.y=Math.sin(r)*t},accelerateTowardsMouse:function(e,t,n,r){n=n||1e3,r=r||1e3;var i=this.angleBetweenMouse(e);e.body.velocity.x=0,e.body.velocity.y=0,e.body.acceleration.x=Math.cos(i)*t,e.body.acceleration.y=Math.sin(i)*t,e.body.maxVelocity.x=n,e.body.maxVelocity.y=r},moveTowardsPoint:function(e,t,n,r){n=n||60,r=r||0;var i=this.angleBetweenPoint(e,t);if(r>0){var s=this.distanceToPoint(e,t);n=s/(r/1e3)}e.body.velocity.x=Math.cos(i)*n,e.body.velocity.y=Math.sin(i)*n},accelerateTowardsPoint:function(e,t,n,r,i){r=r||1e3,i=i||1e3;var s=this.angleBetweenPoint(e,t);e.body.velocity.x=0,e.body.velocity.y=0,e.body.acceleration.x=Math.cos(s)*n,e.body.acceleration.y=Math.sin(s)*n,e.body.maxVelocity.x=r,e.body.maxVelocity.y=i},distanceBetween:function(e,t){var n=e.center.x-t.center.x,r=e.center.y-t.center.y;return Math.sqrt(n*n+r*r)},distanceToPoint:function(e,t){var n=e.center.x-t.x,r=e.center.y-t.y;return Math.sqrt(n*n+r*r)},distanceToMouse:function(e){var t=e.center.x-this.game.input.x,n=e.center.y-this.game.input.y;return Math.sqrt(t*t+n*n)},angleBetweenPoint:function(e,t,n){n=n||!1;var r=t.x-e.center.x,i=t.y-e.center.y;return n?this.game.math.radToDeg(Math.atan2(i,r)):Math.atan2(i,r)},angleBetween:function(e,t,n){n=n||!1;var r=t.center.x-e.center.x,i=t.center.y-e.center.y;return n?this.game.math.radToDeg(Math.atan2(i,r)):Math.atan2(i,r)},velocityFromFacing:function(e,t){},angleBetweenMouse:function(e,t){t=t||!1;var n=this.game.input.x-e.bounds.x,r=this.game.input.y-e.bounds.y;return t?this.game.math.radToDeg(Math.atan2(r,n)):Math.atan2(r,n)}},Phaser.Physics.Arcade.Body=function(e){this.sprite=e,this.game=e.game,this.offset=new Phaser.Point,this.x=e.x,this.y=e.y,this.lastX=e.x,this.lastY=e.y,this.sourceWidth=e.currentFrame.sourceSizeW,this.sourceHeight=e.currentFrame.sourceSizeH,this.width=e.currentFrame.sourceSizeW,this.height=e.currentFrame.sourceSizeH,this.halfWidth=Math.floor(e.currentFrame.sourceSizeW/2),this.halfHeight=Math.floor(e.currentFrame.sourceSizeH/2),this._sx=e.scale.x,this._sy=e.scale.y,this.velocity=new Phaser.Point,this.acceleration=new Phaser.Point,this.drag=new Phaser.Point,this.gravity=new Phaser.Point,this.bounce=new Phaser.Point,this.maxVelocity=new Phaser.Point(1e4,1e4),this.angularVelocity=0,this.angularAcceleration=0,this.angularDrag=0,this.maxAngular=1e3,this.mass=1,this.quadTreeIDs=[],this.quadTreeIndex=-1,this.allowCollision={none:!1,any:!0,up:!0,down:!0,left:!0,right:!0},this.touching={none:!0,up:!1,down:!1,left:!1,right:!1},this.wasTouching={none:!0,up:!1,down:!1,left:!1,right:!1},this.immovable=!1,this.moves=!0,this.rotation=0,this.allowRotation=!0,this.allowGravity=!0,this.customSeparateX=!1,this.customSeparateY=!1,this.overlapX=0,this.overlapY=0,this.collideWorldBounds=!1},Phaser.Physics.Arcade.Body.prototype={updateBounds:function(e,t,n,r){if(n!=this._sx||r!=this._sy)this.width=this.sourceWidth*n,this.height=this.sourceHeight*r,this.halfWidth=Math.floor(this.width/2),this.halfHeight=Math.floor(this.height/2),this._sx=n,this._sy=r},update:function(){this.wasTouching.none=this.touching.none,this.wasTouching.up=this.touching.up,this.wasTouching.down=this.touching.down,this.wasTouching.left=this.touching.left,this.wasTouching.right=this.touching.right,this.touching.none=!0,this.touching.up=!1,this.touching.down=!1,this.touching.left=!1,this.touching.right=!1,this.lastX=this.x,this.lastY=this.y,this.rotation=this.sprite.angle,this.x=this.sprite.x-this.sprite.anchor.x*this.width+this.offset.x,this.y=this.sprite.y-this.sprite.anchor.y*this.height+this.offset.y,this.moves&&this.game.physics.updateMotion(this),this.collideWorldBounds&&this.checkWorldBounds(),this.allowCollision.none==0&&this.sprite.visible&&this.sprite.alive&&(this.quadTreeIDs=[],this.quadTreeIndex=-1,this.game.physics.quadTree.insert(this)),this.deltaX()!=0&&(this.sprite.x-=this.deltaX()),this.deltaY()!=0&&(this.sprite.y-=this.deltaY()),this.sprite.x=this.x-this.offset.x+this.sprite.anchor.x*this.width,this.sprite.y=this.y-this.offset.y+this.sprite.anchor.y*this.height,this.allowRotation&&(this.sprite.angle=this.rotation)},postUpdate:function(){this.sprite.x=this.x-this.offset.x+this.sprite.anchor.x*this.width,this.sprite.y=this.y-this.offset.y+this.sprite.anchor.y*this.height,this.allowRotation&&(this.sprite.angle=this.rotation)},checkWorldBounds:function(){this.x<this.game.world.bounds.x?(this.x=this.game.world.bounds.x,this.velocity.x*=-this.bounce.x):this.right>this.game.world.bounds.right&&(this.x=this.game.world.bounds.right-this.width,this.velocity.x*=-this.bounce.x),this.y<this.game.world.bounds.y?(this.y=this.game.world.bounds.y,this.velocity.y*=-this.bounce.y):this.bottom>this.game.world.bounds.bottom&&(this.y=this.game.world.bounds.bottom-this.height,this.velocity.y*=-this.bounce.y)},setSize:function(e,t,n,r){n=n||this.offset.x,r=r||this.offset.y,this.sourceWidth=e,this.sourceHeight=t,this.width=this.sourceWidth*this._sx,this.height=this.sourceHeight*this._sy,this.halfWidth=Math.floor(this.width/2),this.halfHeight=Math.floor(this.height/2),this.offset.setTo(n,r)},reset:function(){this.velocity.setTo(0,0),this.acceleration.setTo(0,0),this.angularVelocity=0,this.angularAcceleration=0,this.x=this.sprite.x-this.sprite.anchor.x*this.width+this.offset.x,this.y=this.sprite.y-this.sprite.anchor.y*this.height+this.offset.y,this.lastX=this.x,this.lastY=this.y},deltaAbsX:function(){return this.deltaX()>0?this.deltaX():-this.deltaX()},deltaAbsY:function(){return this.deltaY()>0?this.deltaY():-this.deltaY()},deltaX:function(){return this.x-this.lastX},deltaY:function(){return this.y-this.lastY}},Object.defineProperty(Phaser.Physics.Arcade.Body.prototype,"bottom",{get:function(){return this.y+this.height},set:function(e){e<=this.y?this.height=0:this.height=this.y-e}}),Object.defineProperty(Phaser.Physics.Arcade.Body.prototype,"right",{get:function(){return this.x+this.width},set:function(e){e<=this.x?this.width=0:this.width=this.x+e}}),Phaser.Particles=function(e){this.emitters={},this.ID=0},Phaser.Particles.prototype={emitters:null,add:function(e){return this.emitters[e.name]=e,e},remove:function(e){delete this.emitters[e.name]},update:function(){for(var e in this.emitters)this.emitters[e].exists&&this.emitters[e].update()}},Phaser.Particles.Arcade={},Phaser.Particles.Arcade.Emitter=function(e,t,n,r){r=r||50,Phaser.Group.call(this,e),this.name="emitter"+this.game.particles.ID++,this.type=Phaser.EMITTER,this.x=0,this.y=0,this.width=1,this.height=1,this.minParticleSpeed=new Phaser.Point(-100,-100),this.maxParticleSpeed=new Phaser.Point(100,100),this.minParticleScale=1,this.maxParticleScale=1,this.minRotation=-360,this.maxRotation=360,this.gravity=2,this.particleClass=null,this.particleDrag=new Phaser.Point,this.angularDrag=0,this.frequency=100,this.maxParticles=r,this.lifespan=2e3,this.bounce=new Phaser.Point,this._quantity=0,this._timer=0,this._counter=0,this._explode=!0,this.on=!1,this.exists=!0,this.emitX=t,this.emitY=n},Phaser.Particles.Arcade.Emitter.prototype=Object.create(Phaser.Group.prototype),Phaser.Particles.Arcade.Emitter.prototype.constructor=Phaser.Particles.Arcade.Emitter,Phaser.Particles.Arcade.Emitter.prototype.update=function(){if(this.on)if(this._explode){this._counter=0;do this.emitParticle(),this._counter++;while(this._counter<this._quantity);this.on=!1}else this.game.time.now>=this._timer&&(this.emitParticle(),this._counter++,this._quantity>0&&this._counter>=this._quantity&&(this.on=!1),this._timer=this.game.time.now+this.frequency)},Phaser.Particles.Arcade.Emitter.prototype.makeParticles=function(e,t,n,r,i){typeof t=="undefined"&&(t=0),n=n||this.maxParticles,r=r||0,typeof i=="undefined"&&(i=!1);var s,o=0,u=e,a=0;while(o<n)this.particleClass==null&&(typeof e=="object"&&(u=this.game.rnd.pick(e)),typeof t=="object"&&(a=this.game.rnd.pick(t)),s=new Phaser.Sprite(this.game,0,0,u,a)),r>0?(s.body.allowCollision.any=!0,s.body.allowCollision.none=!1):s.body.allowCollision.none=!0,s.body.collideWorldBounds=i,s.exists=!1,s.visible=!1,s.anchor.setTo(.5,.5),this.add(s),o++;return this},Phaser.Particles.Arcade.Emitter.prototype.kill=function(){this.on=!1,this.alive=!1,this.exists=!1},Phaser.Particles.Arcade.Emitter.prototype.revive=function(){this.alive=!0,this.exists=!0},Phaser.Particles.Arcade.Emitter.prototype.start=function(e,t,n,r){typeof e!="boolean"&&(e=!0),t=t||0,n=n||250,r=r||0,this.revive(),this.visible=!0,this.on=!0,this._explode=e,this.lifespan=t,this.frequency=n,e?this._quantity=r:this._quantity+=r,this._counter=0,this._timer=this.game.time.now+n},Phaser.Particles.Arcade.Emitter.prototype.emitParticle=function(){var e=this.getFirstExists(!1);if(e==null)return;this.width>1||this.height>1?e.reset(this.emiteX-this.game.rnd.integerInRange(this.left,this.right),this.emiteY-this.game.rnd.integerInRange(this.top,this.bottom)):e.reset(this.emitX,this.emitY),e.lifespan=this.lifespan,e.body.bounce.setTo(this.bounce.x,this.bounce.y),this.minParticleSpeed.x!=this.maxParticleSpeed.x?e.body.velocity.x=this.game.rnd.integerInRange(this.minParticleSpeed.x,this.maxParticleSpeed.x):e.body.velocity.x=this.minParticleSpeed.x,this.minParticleSpeed.y!=this.maxParticleSpeed.y?e.body.velocity.y=this.game.rnd.integerInRange(this.minParticleSpeed.y,this.maxParticleSpeed.y):e.body.velocity.y=this.minParticleSpeed.y,e.body.gravity.y=this.gravity,this.minRotation!=this.maxRotation?e.body.angularVelocity=this.game.rnd.integerInRange(this.minRotation,this.maxRotation):e.body.angularVelocity=this.minRotation;if(this.minParticleScale!==1||this.maxParticleScale!==1){var t=this.game.rnd.realInRange(this.minParticleScale,this.maxParticleScale);e.scale.setTo(t,t)}e.body.drag.x=this.particleDrag.x,e.body.drag.y=this.particleDrag.y,e.body.angularDrag=this.angularDrag},Phaser.Particles.Arcade.Emitter.prototype.setSize=function(e,t){this.width=e,this.height=t},Phaser.Particles.Arcade.Emitter.prototype.setXSpeed=function(e,t){e=e||0,t=t||0,this.minParticleSpeed.x=e,this.maxParticleSpeed.x=t},Phaser.Particles.Arcade.Emitter.prototype.setYSpeed=function(e,t){e=e||0,t=t||0,this.minParticleSpeed.y=e,this.maxParticleSpeed.y=t},Phaser.Particles.Arcade.Emitter.prototype.setRotation=function(e,t){e=e||0,t=t||0,this.minRotation=e,this.maxRotation=t},Phaser.Particles.Arcade.Emitter.prototype.at=function(e){this.emitX=e.center.x,this.emitY=e.center.y},Object.defineProperty(Phaser.Particles.Arcade.Emitter.prototype,"alpha",{get:function(){return this._container.alpha},set:function(e){this._container.alpha=e}}),Object.defineProperty(Phaser.Particles.Arcade.Emitter.prototype,"visible",{get:function(){return this._container.visible},set:function(e){this._container.visible=e}}),Object.defineProperty(Phaser.Particles.Arcade.Emitter.prototype,"x",{get:function(){return this.emitX},set:function(e){this.emitX=e}}),Object.defineProperty(Phaser.Particles.Arcade.Emitter.prototype,"y",{get:function(){return this.emitY},set:function(e){this.emitY=e}}),Object.defineProperty(Phaser.Particles.Arcade.Emitter.prototype,"left",{get:function(){return Math.floor(this.x-this.width/2)}}),Object.defineProperty(Phaser.Particles.Arcade.Emitter.prototype,"right",{get:function(){return Math.floor(this.x+this.width/2)}}),Object.defineProperty(Phaser.Particles.Arcade.Emitter.prototype,"top",{get:function(){return Math.floor(this.y-this.height/2)}}),Object.defineProperty(Phaser.Particles.Arcade.Emitter.prototype,"bottom",{get:function(){return Math.floor(this.y+this.height/2)}}),Phaser.Tilemap=function(e,t,n,r,i,s,o){typeof i=="undefined"&&(i=!0),typeof s=="undefined"&&(s=0),typeof o=="undefined"&&(o=0),this.game=e,this.group=null,this.name="",this.key=t,this.renderOrderID=0,this.collisionCallback=null,this.exists=!0,this.visible=!0,this.tiles=[],this.layers=[];var u=this.game.cache.getTilemap(t);PIXI.DisplayObjectContainer.call(this),this.position.x=n,this.position.y=r,this.type=Phaser.TILEMAP,this.renderer=new Phaser.TilemapRenderer(this.game),this.mapFormat=u.format;switch(this.mapFormat){case Phaser.Tilemap.CSV:this.parseCSV(u.mapData,t,s,o);break;case Phaser.Tilemap.JSON:this.parseTiledJSON(u.mapData,t)}this.currentLayer&&i&&this.game.world.setSize(this.currentLayer.widthInPixels,this.currentLayer.heightInPixels,!0)},Phaser.Tilemap.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),Phaser.Tilemap.prototype.constructor=Phaser.Tilemap,Phaser.Tilemap.CSV=0,Phaser.Tilemap.JSON=1,Phaser.Tilemap.prototype.parseCSV=function(e,t,n,r){var i=new Phaser.TilemapLayer(this,0,t,Phaser.Tilemap.CSV,"TileLayerCSV"+this.layers.length.toString(),n,r);e=e.trim();var s=e.split("\n");for(var o=0;o<s.length;o++){var u=s[o].split(",");u.length>0&&i.addColumn(u)}i.updateBounds(),i.createCanvas();var a=i.parseTileOffsets();this.currentLayer=i,this.collisionLayer=i,this.layers.push(i),this.generateTiles(a)},Phaser.Tilemap.prototype.parseTiledJSON=function(e,t){for(var n=0;n<e.layers.length;n++){var r=new Phaser.TilemapLayer(this,n,t,Phaser.Tilemap.JSON,e.layers[n].name,e.tilewidth,e.tileheight);if(!e.layers[n].data)continue;r.alpha=e.layers[n].opacity,r.visible=e.layers[n].visible,r.tileMargin=e.tilesets[0].margin,r.tileSpacing=e.tilesets[0].spacing;var i=0,s;for(var o=0;o<e.layers[n].data.length;o++)i==0&&(s=[]),s.push(e.layers[n].data[o]),i++,i==e.layers[n].width&&(r.addColumn(s),i=0);r.updateBounds(),r.createCanvas();var u=r.parseTileOffsets();this.currentLayer=r,this.collisionLayer=r,this.layers.push(r)}this.generateTiles(u)},Phaser.Tilemap.prototype.generateTiles=function(e){for(var t=0;t<e;t++)this.tiles.push(new Phaser.Tile(this.game,this,t,this.currentLayer.tileWidth,this.currentLayer.tileHeight))},Phaser.Tilemap.prototype.setCollisionCallback=function(e,t){this.collisionCallbackContext=e,this.collisionCallback=t},Phaser.Tilemap.prototype.setCollisionRange=function(e,t,n,r,i,s,o,u,a){typeof o=="undefined"&&(o=!1),typeof u=="undefined"&&(u=!0),typeof a=="undefined"&&(a=!0);for(var f=e;f<t;f++)this.tiles[f].setCollision(n,r,i,s,o,u,a)},Phaser.Tilemap.prototype.setCollisionByIndex=function(e,t,n,r,i,s,o,u){typeof s=="undefined"&&(s=!1),typeof o=="undefined"&&(o=!0),typeof u=="undefined"&&(u=!0);for(var a=0;a<e.length;a++)this.tiles[e[a]].setCollision(t,n,r,i,s,o,u)},Phaser.Tilemap.prototype.getTileByIndex=function(e){return this.tiles[e]?this.tiles[e]:null},Phaser.Tilemap.prototype.getTile=function(e,t,n){return typeof n=="undefined"&&(n=this.currentLayer.ID),this.tiles[this.layers[n].getTileIndex(e,t)]},Phaser.Tilemap.prototype.getTileFromWorldXY=function(e,t,n){return typeof n=="undefined"&&(n=this.currentLayer.ID),this.tiles[this.layers[n].getTileFromWorldXY(e,t)]},Phaser.Tilemap.prototype.getTileFromInputXY=function(e){return typeof e=="undefined"&&(e=this.currentLayer.ID),this.tiles[this.layers[e].getTileFromWorldXY(this.game.input.worldX,this.game.input.worldY)]},Phaser.Tilemap.prototype.getTileOverlaps=function(e){return this.currentLayer.getTileOverlaps(e)},Phaser.Tilemap.prototype.collide=function(e,t,n){e=e||this.game.world.group,t=t||null,n=n||null,t&&n&&(this.collisionCallback=t,this.collisionCallbackContext=n),e instanceof Phaser.Group?e.forEachAlive(this.collideGameObject,this):this.collideGameObject(e)},Phaser.Tilemap.prototype.collideGameObject=function(e){return e instanceof Phaser.Group||e instanceof Phaser.Tilemap?!1:e.exists&&e.body.allowCollision.none==0?(this._tempCollisionData=this.collisionLayer.getTileOverlaps(e),this.collisionCallback&&this._tempCollisionData.length>0&&this.collisionCallback.call(this.collisionCallbackContext,e,this._tempCollisionData),!0):!1},Phaser.Tilemap.prototype.putTile=function(e,t,n,r){typeof r=="undefined"&&(r=this.currentLayer.ID),this.layers[r].putTile(e,t,n)},Phaser.Tilemap.prototype.update=function(){this.renderer.render(this)},Phaser.Tilemap.prototype.destroy=function(){this.tiles.length=0,this.layers.length=0},Object.defineProperty(Phaser.Tilemap.prototype,"widthInPixels",{get:function(){return this.currentLayer.widthInPixels}}),Object.defineProperty(Phaser.Tilemap.prototype,"heightInPixels",{get:function(){return this.currentLayer.heightInPixels}}),Phaser.TilemapLayer=function(e,t,n,r,i,s,o){this.exists=!0,this.visible=!0,this.widthInTiles=0,this.heightInTiles=0,this.widthInPixels=0,this.heightInPixels=0,this.tileMargin=0,this.tileSpacing=0,this.parent=e,this.game=e.game,this.ID=t,this.name=i,this.key=n,this.type=Phaser.TILEMAPLAYER,this.mapFormat=r,this.tileWidth=s,this.tileHeight=o,this.boundsInTiles=new Phaser.Rectangle;var u=this.game.cache.getTilemap(n);this.tileset=u.data,this._alpha=1,this.canvas=null,this.context=null,this.baseTexture=null,this.texture=null,this.sprite=null,this.mapData=[],this._tempTileBlock=[],this._tempBlockResults=[]},Phaser.TilemapLayer.prototype={putTileWorldXY:function(e,t,n){e=this.game.math.snapToFloor(e,this.tileWidth)/this.tileWidth,t=this.game.math.snapToFloor(t,this.tileHeight)/this.tileHeight,t>=0&&t<this.mapData.length&&e>=0&&e<this.mapData[t].length&&(this.mapData[t][e]=n)},putTile:function(e,t,n){t>=0&&t<this.mapData.length&&e>=0&&e<this.mapData[t].length&&(this.mapData[t][e]=n)},swapTile:function(e,t,n,r,i,s){n=n||0,r=r||0,i=i||this.widthInTiles,s=s||this.heightInTiles,this.getTempBlock(n,r,i,s);for(var o=0;o<this._tempTileBlock.length;o++)this._tempTileBlock[o].tile.index==e&&(this._tempTileBlock[o].newIndex=!0),this._tempTileBlock[o].tile.index==t&&(this.mapData[this._tempTileBlock[o].y][this._tempTileBlock[o].x]=e);for(var o=0;o<this._tempTileBlock.length;o++)this._tempTileBlock[o].newIndex==1&&(this.mapData[this._tempTileBlock[o].y][this._tempTileBlock[o].x]=t)},fillTile:function(e,t,n,r,i){t=t||0,n=n||0,r=r||this.widthInTiles,i=i||this.heightInTiles,this.getTempBlock(t,n,r,i);for(var s=0;s<this._tempTileBlock.length;s++)this.mapData[this._tempTileBlock[s].y][this._tempTileBlock[s].x]=e},randomiseTiles:function(e,t,n,r,i){t=t||0,n=n||0,r=r||this.widthInTiles,i=i||this.heightInTiles,this.getTempBlock(t,n,r,i);for(var s=0;s<this._tempTileBlock.length;s++)this.mapData[this._tempTileBlock[s].y][this._tempTileBlock[s].x]=this.game.math.getRandom(e)},replaceTile:function(e,t,n,r,i,s){n=n||0,r=r||0,i=i||this.widthInTiles,s=s||this.heightInTiles,this.getTempBlock(n,r,i,s);for(var o=0;o<this._tempTileBlock.length;o++)this._tempTileBlock[o].tile.index==e&&(this.mapData[this._tempTileBlock[o].y][this._tempTileBlock[o].x]=t)},getTileBlock:function(e,t,n,r){var i=[];this.getTempBlock(e,t,n,r);for(var s=0;s<this._tempTileBlock.length;s++)i.push({x:this._tempTileBlock[s].x,y:this._tempTileBlock[s].y,tile:this._tempTileBlock[s].tile});return i},getTileFromWorldXY:function(e,t){return e=Phaser.Math.snapToFloor(e,this.tileWidth)/this.tileWidth,t=Phaser.Math.snapToFloor(t,this.tileHeight)/this.tileHeight,this.getTileIndex(e,t)},getTileOverlaps:function(e){this._tempBlockResults.length=0;if(e.body.x<0||e.body.x>this.widthInPixels||e.body.y<0||e.body.bottom>this.heightInPixels)return this._tempBlockResults;this._tempTileX=this.game.math.snapToFloor(e.body.x,this.tileWidth)/this.tileWidth,this._tempTileY=this.game.math.snapToFloor(e.body.y,this.tileHeight)/this.tileHeight,this._tempTileW=(this.game.math.snapToCeil(e.body.width,this.tileWidth)+this.tileWidth)/this.tileWidth,this._tempTileH=(this.game.math.snapToCeil(e.body.height,this.tileHeight)+this.tileHeight)/this.tileHeight,this.getTempBlock(this._tempTileX,this._tempTileY,this._tempTileW,this._tempTileH,!0);for(var t=0;t<this._tempTileBlock.length;t++)this.game.physics.separateTile(e,this._tempTileBlock[t].x*this.tileWidth,this._tempTileBlock[t].y*this.tileHeight,this.tileWidth,this.tileHeight,this._tempTileBlock[t].tile.mass,this._tempTileBlock[t].tile.collideLeft,this._tempTileBlock[t].tile.collideRight,this._tempTileBlock[t].tile.collideUp,this._tempTileBlock[t].tile.collideDown,this._tempTileBlock[t].tile.separateX,this._tempTileBlock[t].tile.separateY)&&this._tempBlockResults.push({x:this._tempTileBlock[t].x,y:this._tempTileBlock[t].y,tile:this._tempTileBlock[t].tile});return this._tempBlockResults},getTempBlock:function(e,t,n,r,i){typeof i=="undefined"&&(i=!1),e<0&&(e=0),t<0&&(t=0),n>this.widthInTiles&&(n=this.widthInTiles),r>this.heightInTiles&&(r=this.heightInTiles),this._tempTileBlock=[];for(var s=t;s<t+r;s++)for(var o=e;o<e+n;o++)i?this.mapData[s]&&this.mapData[s][o]&&this.parent.tiles[this.mapData[s][o]].collideNone==0&&this._tempTileBlock.push({x:o,y:s,tile:this.parent.tiles[this.mapData[s][o]]}):this.mapData[s]&&this.mapData[s][o]&&this._tempTileBlock.push({x:o,y:s,tile:this.parent.tiles[this.mapData[s][o]]})},getTileIndex:function(e,t){return t>=0&&t<this.mapData.length&&e>=0&&e<this.mapData[t].length?this.mapData[t][e]:null},addColumn:function(e){var t=[];for(var n=0;n<e.length;n++)t[n]=parseInt(e[n]);this.widthInTiles==0&&(this.widthInTiles=t.length,this.widthInPixels=this.widthInTiles*this.tileWidth),this.mapData.push(t),this.heightInTiles++,this.heightInPixels+=this.tileHeight},createCanvas:function(){var e=this.game.width,t=this.game.height;this.widthInPixels<e&&(e=this.widthInPixels),this.heightInPixels<t&&(t=this.heightInPixels),this.canvas=Phaser.Canvas.create(e,t),this.context=this.canvas.getContext("2d"),this.baseTexture=new PIXI.BaseTexture(this.canvas),this.texture=new PIXI.Texture(this.baseTexture),this.sprite=new PIXI.Sprite(this.texture),this.parent.addChild(this.sprite)},updateBounds:function(){this.boundsInTiles.setTo(0,0,this.widthInTiles,this.heightInTiles)},parseTileOffsets:function(){this.tileOffsets=[];var e=0;this.mapFormat==Phaser.Tilemap.JSON&&(this.tileOffsets[0]=null,e=1);for(var t=this.tileMargin;t<this.tileset.height;t+=this.tileHeight+this.tileSpacing)for(var n=this.tileMargin;n<this.tileset.width;n+=this.tileWidth+this.tileSpacing)this.tileOffsets[e]={x:n,y:t},e++;return this.tileOffsets.length}},Object.defineProperty(Phaser.TilemapLayer.prototype,"alpha",{get:function(){return this._alpha},set:function(e){this.sprite&&(this.sprite.alpha=e),this._alpha=e}}),Phaser.Tile=function(e,t,n,r,i){this.mass=1,this.collideNone=!0,this.collideLeft=!1,this.collideRight=!1,this.collideUp=!1,this.collideDown=!1,this.separateX=!0,this.separateY=!0,this.game=e,this.tilemap=t,this.index=n,this.width=r,this.height=i},Phaser.Tile.prototype={destroy:function(){this.tilemap=null},setCollision:function(e,t,n,r,i,s,o){i&&this.resetCollision(),this.separateX=s,this.separateY=o,this.collideNone=!0,this.collideLeft=e,this.collideRight=t,this.collideUp=n,this.collideDown=r;if(e||t||n||r)this.collideNone=!1},resetCollision:function(){this.collideNone=!0,this.collideLeft=!1,this.collideRight=!1,this.collideUp=!1,this.collideDown=!1},toString:function(){return""}},Phaser.TilemapRenderer=function(e){this.game=e,this._ga=1,this._dx=0,this._dy=0,this._dw=0,this._dh=0,this._tx=0,this._ty=0,this._tl=0,this._maxX=0,this._maxY=0,this._startX=0,this._startY=0},Phaser.TilemapRenderer.prototype={render:function(e){this._tl=e.layers.length;for(var t=0;t<this._tl;t++){if(e.layers[t].visible==0||e.layers[t].alpha<.1)continue;var n=e.layers[t];this._maxX=this.game.math.ceil(n.canvas.width/n.tileWidth)+1,this._maxY=this.game.math.ceil(n.canvas.height/n.tileHeight)+1,this._startX=this.game.math.floor(this.game.camera.x/n.tileWidth),this._startY=this.game.math.floor(this.game.camera.y/n.tileHeight),this._startX<0&&(this._startX=0),this._startY<0&&(this._startY=0),this._maxX>n.widthInTiles&&(this._maxX=n.widthInTiles),this._maxY>n.heightInTiles&&(this._maxY=n.heightInTiles),this._startX+this._maxX>n.widthInTiles&&(this._startX=n.widthInTiles-this._maxX),this._startY+this._maxY>n.heightInTiles&&(this._startY=n.heightInTiles-this._maxY),this._dx=-(this.game.camera.x-this._startX*n.tileWidth),this._dy=-(this.game.camera.y-this._startY*n.tileHeight),this._tx=this._dx,this._ty=this._dy,n.alpha!==1&&(this._ga=n.context.globalAlpha,n.context.globalAlpha=n.alpha),n.context.clearRect(0,0,n.canvas.width,n.canvas.height);for(var r=this._startY;r<this._startY+this._maxY;r++){this._columnData=n.mapData[r];for(var i=this._startX;i<this._startX+this._maxX;i++)n.tileOffsets[this._columnData[i]]&&n.context.drawImage(n.tileset,n.tileOffsets[this._columnData[i]].x,n.tileOffsets[this._columnData[i]].y,n.tileWidth,n.tileHeight,this._tx,this._ty,n.tileWidth,n.tileHeight),this._tx+=n.tileWidth;this._tx=this._dx,this._ty+=n.tileHeight}this._ga>-1&&(n.context.globalAlpha=this._ga),this.game.renderType==Phaser.WEBGL&&PIXI.texturesToUpdate.push(n.baseTexture)}return!0}},define("phaser",function(e){return function(){var t,n;return t||e.Phaser}}(this)),define("demos/game",["phaser"],function(e){var t="demo-game",n={id:t,constructor:function(){function u(){o.load.spritesheet("possum","img/awesome-possum-sprite.png",84,84),o.load.spritesheet("monster","img/monster1/mon1_sprite_walk_left.png",84,84)}function p(){l=o.add.sprite(0,o.world.centerY,"possum"),l.scale=new e.Point(1.5,1.5),l.animations.add("walk",[0,1,2,3],15,!0,!0),l.animations.add("punch",[4,5,6,6,6],5,!1,!0),c=o.add.sprite(o.world.width+84,o.world.centerY+42,"monster"),c.animations.add("walk",[0,1,2,3,4],15,!0,!0),c.animations.add("die",[0,0,14,13,12,11],5,!1,!0)}function d(){l.x>o.world.width&&(l.x=-a,c.visible=!0),l.x>=o.world.centerX-a&&l.x<=o.world.centerX?h>0?(l.animations.play("punch"),h--,c.animations.play("die")):(h=f,l.x+=a,c.visible=!1,c.x=o.world.width+84):(l.animations.play("walk"),l.x+=a,c.visible&&(c.animations.play("walk"),c.x-=a))}var n=document.getElementsByClassName(t)[0],r=n.getElementsByClassName("demo-container")[0],i=r.offsetWidth,s=r.offsetHeight,o=new e.Game(i,s,e.AUTO,"phaser-container",{preload:u,create:p,update:d},!0),a=5,f=40,l,c,h=f}};return n}),define("demoController",["jquery","demos/robot","demos/creative","demos/game"],function(e,t,n,r){var i={width:0,height:0,demos:[t,n,r],onSlide:function(t){this.stopDemos();var n=e(".slide:eq("+t+")");for(var r=0;r<this.demos.length;r++){var i=this.demos[r];if(n.hasClass(i.id)){if(!i.object||i.object.start==="undefined"){var s=i.constructor;i.object=new s}i.object.start&&i.object.start()}}},stopDemos:function(){for(var e=0;e<this.demos.length;e++){var t=this.demos[e];t.object&&typeof t.object.stop!="undefined"&&t.object.stop()}},init:function(){this.setSize();var e=this;window.addEventListener("resize",function(){e.setSize();for(var t=0;t<e.demos.length;t++){var n=e.demos[t];n.updateSize&&n.updateSize(e.width,e.height)}},!1)},setSize:function(){var t=e(".slide .contents");this.width=t.width(),this.height=t.height()}};return i}),define("slides",["jquery","demoController"],function(e,t){var n=function(t){var n=this,r=document,i=!1,s=0,o=/\s+/,u=[""],a=function(e){return Array.prototype.slice.call(e||[],0)},f=function(e){return typeof e=="string"?r.getElementById(e):e},l=function(e,t){if(!e)return[];if(typeof e!="string")return a(e);if(typeof t=="string"){t=f(t);if(!t)return[]}t=t||document;var n=t.nodeType==9,r=n?t:t.ownerDocument||document;if(!n||">~+".indexOf(e.charAt(0))>=0)t.id=t.id||"qUnique"+s++,e="#"+t.id+" "+e;return">~+".indexOf(e.slice(-1))>=0&&(e+=" *"),a(r.querySelectorAll(e))},c=function(e){return typeof e=="string"||e instanceof String?e.indexOf(" ")<0?(u[0]=e,u):e.split(o):e},h=function(e,t){t=c(t);var n=" "+e.className+" ";for(var r=0,i=t.length,s;r<i;++r)s=t[r],s&&n.indexOf(" "+s+" ")<0&&(n+=s+" ");e.className=n.trim()},p=function(e,t){var n;if(t!==undefined){t=c(t),n=" "+e.className+" ";for(var r=0,i=t.length;r<i;++r)n=n.replace(" "+t[r]+" "," ");n=n.trim()}else n="";e.className!=n&&(e.className=n)},d=function(e,t){var n=" "+e.className+" ";n.indexOf(" "+t.trim()+" ")>=0?p(e,t):h(e,t)},v=navigator.userAgent,m=parseFloat(v.split("Firefox/")[1])||undefined,g=parseFloat(v.split("WebKit/")[1])||undefined,y=parseFloat(v.split("Opera/")[1])||undefined,b=function(){var e=parseFloat(v.split("Version/")[1])||undefined,t=g||m&&m>3.6||y&&e>=10.5;return function(){return t}}(),w=function(e,t){this._node=e,t>=0&&(this._count=t+1),this._node&&h(this._node,"slide distant-slide"),this._makeBuildList()};w.prototype={_node:null,_count:0,_buildList:[],_visited:!1,_currentState:"",_states:["distant-slide","far-past","past","current","future","far-future","distant-slide"],setState:function(e){typeof e!="string"&&(e=this._states[e]),e=="current"&&!this._visited&&(this._visited=!0,this._makeBuildList()),p(this._node,this._states),h(this._node,e),this._currentState=e;var t=this;setTimeout(function(){t._runAutos()},400)},_makeCounter:function(){if(!this._count||!this._node)return;var e=r.createElement("span");e.innerHTML=this._count,e.className="counter",this._node.appendChild(e)},_makeBuildList:function(){this._buildList=[];if(i)return;this._node&&(this._buildList=l("[data-build] > *:not(.current)",this._node)),this._buildList.forEach(function(e){h(e,"to-build")})},_runAutos:function(){if(this._currentState!="current")return;var e=-1;this._buildList.some(function(t,n){return t.hasAttribute("data-auto")?(e=n,!0):!1});if(e>=0){var t=this._buildList.splice(e,1)[0],n=g?"webkitTransitionEnd":m?"mozTransitionEnd":"oTransitionEnd",r=this;if(b()){var i=function(e){t.parentNode.removeEventListener(n,i,!1),r._runAutos()};t.parentNode.addEventListener(n,i,!1),p(t,"to-build")}else setTimeout(function(){p(t,"to-build"),r._runAutos()},400)}},buildNext:function(){if(!this._buildList.length)return!1;var t=this._buildList.shift();return p(t,"to-build"),typeof e("[data-build]",this._node).data("slideshow")!="undefined"&&(e("[data-build] > *",this._node).removeClass("current"),h(t,"current")),!0},buildPrev:function(){var t=e(".current",this._node);if(t){var n=t.index();if(n>0){var r=t.prev();return r.addClass("current").removeClass("to-build"),t.addClass("to-build").removeClass("current"),this._buildList.unshift(t[0]),!0}}return!1}};var E=function(e){this._slides=(e||[]).map(function(e,t){return new w(e,t)});var t=window.location.hash;try{this.current=parseInt(t.split("#slide")[1],10)}catch(n){}this.current=isNaN(this.current)?1:this.current;var i=this;r.addEventListener("keydown",function(e){i.handleKeys(e)},!1),r.addEventListener("touchstart",function(e){i.handleTouchStart(e),e.preventDefault()},!1),r.addEventListener("touchmove",function(e){e.preventDefault()},!1),r.addEventListener("touchend",function(e){i.handleTouchEnd(e)},!1),r.ontouchmove=function(e){e.preventDefault()},window.addEventListener("popstate",function(e){e.state&&i.go(e.state)},!1),this._update()};E.prototype={_autoAdvance:!1,_slides:[],_timeout:null,_update:function(e){history.pushState?e||history.replaceState(this.current,"Slide "+this.current,"#slide"+this.current):window.location.hash="slide"+this.current;for(var t=this.current-1;t<this.current+7;t++)this._slides[t-4]&&this._slides[t-4].setState(Math.max(0,t-this.current))},current:0,next:function(){if(!this._slides[this.current-1].buildNext()){this._timeout&&clearTimeout(this._timeout);var e=this.current;this.current=Math.min(this.current+1,this._slides.length),this._update(),this.current!==e&&this.slideChanged()}else this.slideChanged()},prev:function(){if(!this._slides[this.current-1].buildPrev()){this._timeout&&clearTimeout(this._timeout);var e=this.current;this.current=Math.max(this.current-1,1),this._update(),this.current!==e&&this.slideChanged()}else this.slideChanged()},go:function(e){this._timeout&&clearTimeout(this._timeout);var t=this.current;this.current=e,this._update(!0),this.current!==t&&this.slideChanged()},_notesOn:!1,showNotes:function(){var e=this._notesOn=!this._notesOn;l(".notes").forEach(function(e){e.style.display=notesOn?"block":"none"})},switch3D:function(){d(document.body,"three-d")},handleWheel:function(e){var t=0;e.wheelDelta?(t=e.wheelDelta/120,y&&(t=-t)):e.detail&&(t=-e.detail/3);if(t>0){this.prev();return}if(t<0){this.next();return}},handleKeys:function(e){if(/^(input|textarea)$/i.test(e.target.nodeName))return;switch(e.keyCode){case 37:this.prev();break;case 39:case 32:this.next();break;case 50:this.showNotes();break;case 51:this.switch3D()}},_touchStartX:0,handleTouchStart:function(e){this._touchStartX=e.touches[0].pageX},handleTouchEnd:function(e){var t=this._touchStartX-e.changedTouches[0].pageX,n=150;t>n?this.next():t<-n&&this.prev()},slideChanged:function(){var e=this;window.setTimeout(function(){t&&t.onSlide(e.current-1)},250),this.autoSlides()},autoSlides:function(){this._timeout&&clearTimeout(this._timeout);if(this.current>1){var t=this._slides[this.current-1]._node,n=e("[data-autoslide]",e(t));if(n.length>0&&e(".to-build",e(t)).length>0&&e(n).attr("data-autoslide")!=="undefined"&&e(n).attr("data-autoslide")!==!1){var r=parseInt(e(".current",n).attr("data-autoslide"));r||(r=parseInt(e(n).attr("data-autoslide")));var i=this;this._timeout=setTimeout(function(){i.autoAdvance()},r)}}},autoAdvance:function(){this._autoAdvance&&this.next()}},this.slideshow=new E(l(".slide")),this.slideshow.slideChanged(),e(window).bind("hashchange",function(){var e=window.location.hash,t=0;try{t=parseInt(e.split("#slide")[1],10)}catch(r){}n.slideshow.go(t)})};return n}),require.config({paths:{detector:"lib/Detector",flyControlsMod:"lib/FlyControlsMod",jquery:"lib/jquery-1.9.1",pace:"lib/pace",phaser:"lib/phaser",stats:"lib/stats.min",three:"lib/three.min",tween:"lib/tween.min"},shim:{detector:{exports:"Detector"},flyControlsMod:{deps:["three"]},phaser:{exports:"Phaser"},stats:{exports:"Stats"},three:{exports:"THREE"},tween:{exports:"TWEEN"}}}),require(["demoController","slides"],function(e,t){e.init(),new t(e)}),define("main",function(){});